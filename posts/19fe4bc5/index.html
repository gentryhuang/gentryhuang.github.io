<!DOCTYPE html>
<html lang=zh>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- å¼ºåˆ¶é¡µé¢åœ¨å½“å‰çª—å£ä»¥ç‹¬ç«‹é¡µé¢æ˜¾ç¤º,é˜²æ­¢åˆ«äººåœ¨æ¡†æ¶é‡Œè°ƒç”¨é¡µé¢ -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>RedisåŸç† - Redisä¸»æµç¨‹ | gentryhuangçš„åšå®¢</title>
  <meta name="description" content="æ¦‚è¿°æœ¬ç¯‡æ–‡ç« å°†ä»æºç å±‚é¢å¯¹ Redis ä¸»å¹²è½®å»“è¿›è¡Œè¯´æ˜ã€‚ä»¥ä¸»çº¿ç¨‹æ‰§è¡Œæµç¨‹ä¸ºä¸»å¹²ï¼Œå¯¹é€”å¾„çš„ææè”“è”“ç®€å•ä»‹ç»ï¼Œä¸ä¼šè¿‡åº¦å±•å¼€ï¼Œåç»­å°†é’ˆå¯¹æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œè¯¦ç»†åˆ†æã€‚ç”±äº Redis æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œå½“ç„¶åº”è¯¥ä» main å‡½æ•°å¼€å¯é˜…è¯»æºç æ—…ç¨‹ã€‚ main å‡½æ•°Redis æœåŠ¡å™¨å¯åŠ¨çš„å…¥å£æ˜¯ main å‡½æ•°ï¼Œå…¶å®ƒçš„æ— éœ€å¤šè¯´ï¼Œä¸‹é¢ç›´æ¥ä¸Šä»£ç ã€‚ 1234567891011121314151617181920">
<meta property="og:type" content="article">
<meta property="og:title" content="RedisåŸç† - Redisä¸»æµç¨‹">
<meta property="og:url" content="https://gentryhuang.com/posts/19fe4bc5/index.html">
<meta property="og:site_name" content="gentryhuangâ€˜s blog">
<meta property="og:description" content="æ¦‚è¿°æœ¬ç¯‡æ–‡ç« å°†ä»æºç å±‚é¢å¯¹ Redis ä¸»å¹²è½®å»“è¿›è¡Œè¯´æ˜ã€‚ä»¥ä¸»çº¿ç¨‹æ‰§è¡Œæµç¨‹ä¸ºä¸»å¹²ï¼Œå¯¹é€”å¾„çš„ææè”“è”“ç®€å•ä»‹ç»ï¼Œä¸ä¼šè¿‡åº¦å±•å¼€ï¼Œåç»­å°†é’ˆå¯¹æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œè¯¦ç»†åˆ†æã€‚ç”±äº Redis æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œå½“ç„¶åº”è¯¥ä» main å‡½æ•°å¼€å¯é˜…è¯»æºç æ—…ç¨‹ã€‚ main å‡½æ•°Redis æœåŠ¡å™¨å¯åŠ¨çš„å…¥å£æ˜¯ main å‡½æ•°ï¼Œå…¶å®ƒçš„æ— éœ€å¤šè¯´ï¼Œä¸‹é¢ç›´æ¥ä¸Šä»£ç ã€‚ 1234567891011121314151617181920">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://blog-picture-oss.oss-cn-hangzhou.aliyuncs.com/redis/themory/redis-outline-main-process.jpg">
<meta property="og:image" content="https://blog-picture-oss.oss-cn-hangzhou.aliyuncs.com/redis/themory/redis-outline-multi-process.jpg">
<meta property="article:published_time" content="2021-11-27T16:00:00.000Z">
<meta property="article:modified_time" content="2021-12-07T03:19:06.132Z">
<meta property="article:author" content="gentryhuang">
<meta property="article:tag" content="æ±‚èŒ">
<meta property="article:tag" content="æŠ€æœ¯">
<meta property="article:tag" content="ç”Ÿæ´»">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://blog-picture-oss.oss-cn-hangzhou.aliyuncs.com/redis/themory/redis-outline-main-process.jpg">
  <!-- Canonical links -->
  <link rel="canonical" href="https://gentryhuang.com/posts/19fe4bc5/index.html">
  
    <link rel="alternate" href="/atom.xml" title="gentryhuangâ€˜s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
<meta name="generator" content="Hexo 4.2.1"></head>


<body class="main-center" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://gentryhuang.com" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.png" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Gentryhuang&#39;s Blog</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md"></h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Hangzhou, China</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="æœç´¢" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">é¦–é¡µ</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">å½’æ¡£</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">åˆ†ç±»</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">æ ‡ç­¾</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">é¡¹ç›®</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-links">
          <a href="/links">
            
            <i class="icon icon-friendship"></i>
            
            <span class="menu-title">å‹é“¾</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">å…³äº</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/gentryhuang" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      

<script defer="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<div class="widget">
    <h3 class="widget-title">å…¬å‘Š</h3>
    <div class="widget-body">
        <div id="board">

            

            <div class="content">
                <p>æ¬¢è¿äº¤æµä¸åˆ†äº«ç»éªŒ!</p>
            </div>
        </div>
    </div>
</div>

    
      
  <div class="widget">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget-body">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/JDK/">JDK</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/RPC/">RPC</a><span class="category-list-count">68</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E4%BB%BB%E5%8A%A1%E8%B0%83%E5%BA%A6/">ä»»åŠ¡è°ƒåº¦</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%88%86%E5%B8%83%E5%BC%8F/">åˆ†å¸ƒå¼</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/">ç½‘ç»œé€šä¿¡</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a><span class="category-list-count">32</span></li></ul>
    </div>
  </div>


    
      
<!-- è¿™é‡Œä½¿ç”¨ false å…³é—­å³ä¾§æ ‡ç­¾  -->






    
      
  <div class="widget">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/AQS/" style="font-size: 13.5px;">AQS</a> <a href="/tags/ConcurrentHashMap/" style="font-size: 13px;">ConcurrentHashMap</a> <a href="/tags/CopyOnWrite/" style="font-size: 13px;">CopyOnWrite</a> <a href="/tags/Dubbo/" style="font-size: 14px;">Dubbo</a> <a href="/tags/Filter/" style="font-size: 13.75px;">Filter</a> <a href="/tags/Gossip/" style="font-size: 13px;">Gossip</a> <a href="/tags/HashMap/" style="font-size: 13px;">HashMap</a> <a href="/tags/HashedWheelTimer/" style="font-size: 13px;">HashedWheelTimer</a> <a href="/tags/I-O/" style="font-size: 13.13px;">I/O</a> <a href="/tags/JMM/" style="font-size: 13px;">JMM</a> <a href="/tags/JUC/" style="font-size: 13.75px;">JUC</a> <a href="/tags/Javassist/" style="font-size: 13.25px;">Javassist</a> <a href="/tags/Lock/" style="font-size: 13.13px;">Lock</a> <a href="/tags/LongAdder/" style="font-size: 13px;">LongAdder</a> <a href="/tags/Mina/" style="font-size: 13px;">Mina</a> <a href="/tags/Netty/" style="font-size: 13px;">Netty</a> <a href="/tags/Protocol/" style="font-size: 13.25px;">Protocol</a> <a href="/tags/Queue/" style="font-size: 13.38px;">Queue</a> <a href="/tags/RPC/" style="font-size: 13.63px;">RPC</a> <a href="/tags/Raft/" style="font-size: 13px;">Raft</a> <a href="/tags/Redis/" style="font-size: 13.38px;">Redis</a> <a href="/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 13.13px;">Redisæ•°æ®ç»“æ„</a> <a href="/tags/SCAN/" style="font-size: 13px;">SCAN</a> <a href="/tags/SPI/" style="font-size: 13.25px;">SPI</a> <a href="/tags/Spring/" style="font-size: 13.25px;">Spring</a> <a href="/tags/Thread/" style="font-size: 13.13px;">Thread</a> <a href="/tags/Zookeeper/" style="font-size: 13.13px;">Zookeeper</a> <a href="/tags/cahce/" style="font-size: 13px;">cahce</a> <a href="/tags/false-sharing/" style="font-size: 13px;">false sharing</a> <a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 13px;">ä»£ç†</a> <a href="/tags/%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95/" style="font-size: 13px;">å…±è¯†ç®—æ³•</a> <a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/" style="font-size: 13px;">åˆ†å¸ƒå¼é”</a> <a href="/tags/%E6%85%A2%E6%9F%A5%E8%AF%A2%E6%97%A5%E5%BF%97/" style="font-size: 13px;">æ…¢æŸ¥è¯¢æ—¥å¿—</a> <a href="/tags/%E7%BC%93%E5%AD%98/" style="font-size: 13px;">ç¼“å­˜</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 13.88px;">è®¾è®¡æ¨¡å¼</a> <a href="/tags/%E9%99%90%E6%B5%81/" style="font-size: 13px;">é™æµ</a>
    </div>
  </div>

    
      <!-- è¿™é‡Œä½¿ç”¨ false å…³é—­å³ä¾§å½’æ¡£  -->




    
      
  <div class="widget">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled ">
        
          <li>
            
            <div class="item-thumb">
              <a href="/posts/c1861d8c/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/Redis/">Redis</a>
              </p>
              <p class="item-title">
                <a href="/posts/c1861d8c/" class="title">RedisåŸç† - SCAN åŸç†</a>
              </p>
              <p class="item-date">
                <time datetime="2022-06-26T13:14:47.000Z" itemprop="datePublished">2022-06-26</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/posts/db98efcf/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/JDK/">JDK</a>
              </p>
              <p class="item-title">
                <a href="/posts/db98efcf/" class="title">é˜Ÿåˆ— - DelayQueue</a>
              </p>
              <p class="item-date">
                <time datetime="2022-06-15T12:10:53.000Z" itemprop="datePublished">2022-06-15</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/posts/282602b0/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/JDK/">JDK</a>
              </p>
              <p class="item-title">
                <a href="/posts/282602b0/" class="title">å¹¶å‘ - LongAdder</a>
              </p>
              <p class="item-date">
                <time datetime="2022-05-30T02:25:18.000Z" itemprop="datePublished">2022-05-30</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/posts/218dc61f/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/JDK/">JDK</a>
              </p>
              <p class="item-title">
                <a href="/posts/218dc61f/" class="title">å¹¶å‘ - ConcurrentHashMap</a>
              </p>
              <p class="item-date">
                <time datetime="2022-05-14T02:30:35.000Z" itemprop="datePublished">2022-05-14</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/posts/9012be3f/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                <a class="category-link" href="/categories/JDK/">JDK</a>
              </p>
              <p class="item-title">
                <a href="/posts/9012be3f/" class="title">å¹¶å‘ - ScheduledThreadPoolExecutor</a>
              </p>
              <p class="item-date">
                <time datetime="2022-05-02T01:55:06.000Z" itemprop="datePublished">2022-05-02</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">æ–‡ç« ç›®å½•</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#æ¦‚è¿°"><span class="toc-number">1.</span> <span class="toc-text">æ¦‚è¿°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#main-å‡½æ•°"><span class="toc-number">2.</span> <span class="toc-text">main å‡½æ•°</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#äº‹ä»¶å¾ªç¯"><span class="toc-number">3.</span> <span class="toc-text">äº‹ä»¶å¾ªç¯</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å°ç»“"><span class="toc-number">4.</span> <span class="toc-text">å°ç»“</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-redis/themory/Rediså…¨æµç¨‹" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      RedisåŸç† - Redisä¸»æµç¨‹
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/posts/19fe4bc5/" class="article-date">
	  <time datetime="2021-11-27T16:00:00.000Z" itemprop="datePublished">2021-11-28</time>
	</a>
</span>
        
  <span class="article-category">
    <i class="icon icon-folder"></i>
    <a class="article-category-link" href="/categories/Redis/">Redis</a>
  </span>

        

        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/posts/19fe4bc5/#comments" class="article-comment-link">è¯„è®º</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">å­—æ•°ç»Ÿè®¡: 1.8k(å­—)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">é˜…è¯»æ—¶é•¿: 7(åˆ†)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>æœ¬ç¯‡æ–‡ç« å°†ä»æºç å±‚é¢å¯¹ Redis ä¸»å¹²è½®å»“è¿›è¡Œè¯´æ˜ã€‚ä»¥ä¸»çº¿ç¨‹æ‰§è¡Œæµç¨‹ä¸ºä¸»å¹²ï¼Œå¯¹é€”å¾„çš„ææè”“è”“ç®€å•ä»‹ç»ï¼Œä¸ä¼šè¿‡åº¦å±•å¼€ï¼Œåç»­å°†é’ˆå¯¹æ¯ä¸€ä¸ªæ¨¡å—è¿›è¡Œè¯¦ç»†åˆ†æã€‚ç”±äº Redis æ˜¯ç”¨ C è¯­è¨€å®ç°çš„ï¼Œå½“ç„¶åº”è¯¥ä» main å‡½æ•°å¼€å¯é˜…è¯»æºç æ—…ç¨‹ã€‚</p>
<h1 id="main-å‡½æ•°"><a href="#main-å‡½æ•°" class="headerlink" title="main å‡½æ•°"></a>main å‡½æ•°</h1><p>Redis æœåŠ¡å™¨å¯åŠ¨çš„å…¥å£æ˜¯ main å‡½æ•°ï¼Œå…¶å®ƒçš„æ— éœ€å¤šè¯´ï¼Œä¸‹é¢ç›´æ¥ä¸Šä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Redis Server å¯åŠ¨å…¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> *  Redisæ˜¯ç”¨Cè¯­è¨€å®ç°çš„ï¼Œä» main å‡½æ•°å¯åŠ¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>;</span></span><br><span class="line">    <span class="keyword">int</span> j;</span><br><span class="line">    <span class="keyword">char</span> config_from_stdin = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> INIT_SETPROCTITLE_REPLACEMENT</span></span><br><span class="line">    <span class="comment">// 1 åˆå§‹åŒ–åº“</span></span><br><span class="line">    spt_init(argc, argv);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2 æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦ä»¥ Sentinel æ¨¡å¼å¯åŠ¨</span></span><br><span class="line">    <span class="comment">// è¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼Œå› ä¸º Sentinel å’Œæ™®é€šçš„å®ä¾‹ä¸åŒ</span></span><br><span class="line">    server.sentinel_mode = checkForSentinelMode(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3  åˆå§‹åŒ–æœåŠ¡å™¨é…ç½®</span></span><br><span class="line">    initServerConfig();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4 ACL åˆå§‹åŒ–ï¼ˆ6.0 å¯¹ ACL è¿›è¡Œäº†åŠŸèƒ½ä¸°å¯Œï¼‰</span></span><br><span class="line">    ACLInit(); <span class="comment">/* The ACL subsystem must be initialized ASAP because the</span></span><br><span class="line"><span class="comment">                  basic networking code and client creation depends on it. */</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 5 å¦‚æœæœåŠ¡å™¨ä»¥ Sentinel æ¨¡å¼å¯åŠ¨ï¼Œé‚£ä¹ˆéœ€è¦è¿›è¡Œ Sentinel åŠŸèƒ½ç›¸å…³çš„åˆå§‹åŒ–ï¼Œå¹¶ä¸ºè¦ç›‘è§†çš„ä¸»æœåŠ¡å™¨åˆ›å»ºä¸€äº›ç›¸åº”çš„æ•°æ®ç»“æ„</span></span><br><span class="line">    <span class="keyword">if</span> (server.sentinel_mode) &#123;</span><br><span class="line">        <span class="comment">// Sentinel æ‰€å±çš„å±æ€§è¦†ç›–æœåŠ¡å™¨é»˜è®¤çš„å±æ€§</span></span><br><span class="line">        initSentinelConfig();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å“¨å…µæ¨¡å¼åˆå§‹åŒ–</span></span><br><span class="line">        initSentinel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 6 æ˜¯å¦éœ€è¦åœ¨ redis-check-rdb/aofæ¨¡å¼ä¸‹å¯åŠ¨ï¼Œè¿™æ ·å¯ä»¥æ ¡éªŒæŒä¹…åŒ–æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(argv[<span class="number">0</span>], <span class="string">"redis-check-rdb"</span>) != <span class="literal">NULL</span>)</span><br><span class="line">        redis_check_rdb_main(argc, argv, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strstr</span>(argv[<span class="number">0</span>], <span class="string">"redis-check-aof"</span>) != <span class="literal">NULL</span>)</span><br><span class="line">        redis_check_aof_main(argc, argv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7 æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æŒ‡å®šäº†é…ç½®æ–‡ä»¶ï¼Œæˆ–è€…é…ç½®é€‰é¡¹</span></span><br><span class="line">    <span class="keyword">if</span> (argc &gt;= <span class="number">2</span>) &#123;...&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">background</span> = server.daemonize &amp;&amp; !server.supervised;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 8 å°†æœåŠ¡å™¨è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹è¿è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">background</span>) daemonize();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 9 åˆ›å»ºå¹¶åˆå§‹åŒ–æœåŠ¡å™¨</span></span><br><span class="line">    initServer();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸŒŸ æœåŠ¡å™¨ä¸æ˜¯è¿è¡Œåœ¨ SENTINEL æ¨¡å¼ï¼Œé‚£ä¹ˆæ‰§è¡Œä»¥ä¸‹ä»£ç </span></span><br><span class="line">    <span class="keyword">if</span> (!server.sentinel_mode) &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// 10  bio å’Œ io çº¿ç¨‹çš„åˆå§‹åŒ–</span></span><br><span class="line">        InitServerLast();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 11 ä» AOF æ–‡ä»¶æˆ–è€… RDB æ–‡ä»¶ä¸­è½½å…¥æ•°æ®</span></span><br><span class="line">        loadDataFromDisk();</span><br><span class="line">        <span class="keyword">if</span> (server.cluster_enabled) &#123;</span><br><span class="line">            <span class="keyword">if</span> (verifyClusterConfigWithData() == C_ERR) &#123;</span><br><span class="line">                serverLog(LL_WARNING,</span><br><span class="line">                          <span class="string">"You can't have keys in a DB different than DB 0 when in "</span></span><br><span class="line">                          <span class="string">"Cluster mode. Exiting."</span>);</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// ä»¥ SENTINEL æ¨¡å¼è¿è¡Œ</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ACLLoadUsersAtStartup();</span><br><span class="line">        <span class="comment">// bio å’Œ io çº¿ç¨‹çš„åˆå§‹åŒ–</span></span><br><span class="line">        InitServerLast();</span><br><span class="line">        <span class="comment">// Sentinel å‡†å¤‡å°±ç»ªåæ‰§è¡Œ</span></span><br><span class="line">        sentinelIsRunning();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12 ğŸŒŸ å¯åŠ¨äº‹ä»¶å¤„ç†å¾ªç¯</span></span><br><span class="line">    <span class="comment">// ä¸»è¦å›´ç»• IOå¤šè·¯å¤ç”¨ å±•å¼€çš„ï¼Œé©±åŠ¨æ³¨å†Œçš„æ—¶é—´äº‹ä»¶å›è°ƒå’Œ IO äº‹ä»¶å›è°ƒ</span></span><br><span class="line">    aeMain(server.el);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 12 é€€å‡ºäº‹ä»¶å¾ªç¯ï¼Œå›æ”¶å†…å­˜</span></span><br><span class="line">    aeDeleteEventLoop(server.el);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// retun 0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Redis æœåŠ¡å¯åŠ¨åï¼Œä¸»çº¿ç¨‹ main ä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸Šæµç¨‹ï¼Œç›´åˆ°è¿›å…¥ <strong>aeMain</strong> äº‹ä»¶å¤„ç†å¾ªç¯æ–¹æ³•ä¸­ã€‚éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œä¸Šè¿°ä»£ç ç‰‡æ®µåˆ é™¤æ‰äº†ä¸å…³å¿ƒçš„é€»è¾‘ï¼Œæœ¬ç¯‡æ–‡ç« æˆ‘ä»¬åªå…³æ³¨ä»¥ä¸‹ä¸¤ä¸ªé€»è¾‘ï¼š</p>
<ul>
<li>æ‰§è¡Œå„ç§åˆå§‹åŒ–</li>
<li>æ‰§è¡Œäº‹ä»¶å¾ªç¯</li>
</ul>
<p>Redis æœåŠ¡å™¨åˆå§‹åŒ–é€»è¾‘è¾ƒä¸ºå¤æ‚ï¼Œä»åº•å±‚çš„æ•°æ®ç»“æ„åˆ°æœåŠ¡å™¨ä¸åŒçš„è§’è‰²ï¼Œåˆå§‹åŒ–çš„é€»è¾‘å’Œå±æ€§éƒ½ä¸ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚ä¸‹é¢å¯¹æµç¨‹è¿›è¡Œæ¦‚æ‹¬ï¼š</p>
<p><img src="https://blog-picture-oss.oss-cn-hangzhou.aliyuncs.com/redis/themory/redis-outline-main-process.jpg" alt></p>
<h1 id="äº‹ä»¶å¾ªç¯"><a href="#äº‹ä»¶å¾ªç¯" class="headerlink" title="äº‹ä»¶å¾ªç¯"></a>äº‹ä»¶å¾ªç¯</h1><p>äº‹ä»¶å¾ªç¯é€»è¾‘æ˜¯ Redis æ ¸å¿ƒçš„ç›´æ¥ä½“ç°ï¼Œå®ƒå°±æ˜¯åœ¨è¿™ä¸ªå¾ªç¯ä¸­ä¸æ–­å¤„ç†ç½‘ç»œè¯·æ±‚å’Œå†…éƒ¨è‡ªèº«é€»è¾‘çš„ã€‚ä¸‹é¢æˆ‘ä»¬ç›´æ¥ä¸Šä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">aeMain</span><span class="params">(aeEventLoop *eventLoop)</span> </span>&#123;</span><br><span class="line">    eventLoop-&gt;<span class="built_in">stop</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹è¿›å…¥ä¸»å¾ªç¯ï¼Œä¸€ç›´å¤„ç†äº‹ä»¶ï¼Œç›´åˆ°æœåŠ¡å™¨å…³é—­</span></span><br><span class="line">    <span class="keyword">while</span> (!eventLoop-&gt;<span class="built_in">stop</span>) &#123;</span><br><span class="line">        <span class="comment">// å¼€å§‹å¤„ç†äº‹ä»¶</span></span><br><span class="line">        aeProcessEvents(eventLoop, AE_ALL_EVENTS |</span><br><span class="line">                                   AE_CALL_BEFORE_SLEEP |</span><br><span class="line">                                   AE_CALL_AFTER_SLEEP);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œåªè¦äº‹ä»¶å¾ªç¯ <code>aeEventLoop</code> æ²¡æœ‰è¢«åœæ­¢ï¼Œä¸»çº¿ç¨‹ main å°±ä¼šä¸€ç›´è‡ªæ—‹ï¼Œä¸æ–­æ‰§è¡Œ <code>aeProcessEvents</code> æ–¹æ³•ã€‚ä¸éš¾çœ‹å‡º <code>aeProcessEvents</code> æ–¹æ³•å°è£…äº† Redis çš„æ‰€æœ‰åŠŸèƒ½é€»è¾‘ï¼Œè¿™é‡Œæå‰è¯´ä¸‹ï¼ŒRedis çš„åŠŸèƒ½é€»è¾‘æ€»å…±ä¸¤å¤§ç±»ï¼šä¸€ä¸ªæ˜¯ç½‘ç»œäº‹ä»¶ï¼Œä¹Ÿç§°ä¸ºæ–‡ä»¶äº‹ä»¶ï¼›å¦ä¸€ä¸ªæ˜¯æ—¶é—´äº‹ä»¶ï¼›å‰è€…ç”¨äºå¤„ç†ç½‘ç»œä¸­çš„äº¤äº’ï¼Œåè€…ç”¨äºå¤„ç† Redis è‡ªèº«çš„ä¸€äº›é€»è¾‘ã€‚</p>
<p>ä¸‹é¢ç»§ç»­è´´å‡º <code>aeProcessEvents</code> æ–¹æ³•çš„ä»£ç ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">aeProcessEvents</span><span class="params">(aeEventLoop *eventLoop, <span class="keyword">int</span> flags)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> processed = <span class="number">0</span>, numevents;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Nothing to do? return ASAP */</span></span><br><span class="line">    <span class="keyword">if</span> (!(flags &amp; AE_TIME_EVENTS) &amp;&amp; !(flags &amp; AE_FILE_EVENTS)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (eventLoop-&gt;maxfd != <span class="number">-1</span> ||</span><br><span class="line">        ((flags &amp; AE_TIME_EVENTS) &amp;&amp; !(flags &amp; AE_DONT_WAIT))) &#123;</span><br><span class="line">        <span class="keyword">int</span> j;</span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">tv</span>, *<span class="title">tvp</span>;</span></span><br><span class="line">        <span class="keyword">int64_t</span> usUntilTimer = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1 è·å–æœ€è¿‘çš„æ—¶é—´äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">if</span> (flags &amp; AE_TIME_EVENTS &amp;&amp; !(flags &amp; AE_DONT_WAIT))</span><br><span class="line">            usUntilTimer = usUntilEarliestTimer(eventLoop);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1.1 ä½¿ç”¨ usUntilTimer æ¥å†³å®šæ–‡ä»¶äº‹ä»¶çš„é˜»å¡æ—¶é—´</span></span><br><span class="line">        <span class="keyword">if</span> (usUntilTimer &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            tv.tv_sec = usUntilTimer / <span class="number">1000000</span>;</span><br><span class="line">            tv.tv_usec = usUntilTimer % <span class="number">1000000</span>;</span><br><span class="line">            tvp = &amp;tv;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1.2 æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ²¡æœ‰æ—¶é—´äº‹ä»¶ã€‚é‚£ä¹ˆæ ¹æ® AE_DONT_WAIT æ˜¯å¦è®¾ç½®æ¥å†³å®šæ˜¯å¦é˜»å¡ï¼Œä»¥åŠé˜»å¡çš„æ—¶é—´é•¿åº¦</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (flags &amp; AE_DONT_WAIT) &#123;</span><br><span class="line">                <span class="comment">// è®¾ç½®æ–‡ä»¶äº‹ä»¶ä¸é˜»å¡</span></span><br><span class="line">                tv.tv_sec = tv.tv_usec = <span class="number">0</span>;</span><br><span class="line">                tvp = &amp;tv;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">/* Otherwise we can block */</span></span><br><span class="line">                <span class="comment">// æ–‡ä»¶äº‹ä»¶é˜»å¡ç›´åˆ°æœ‰äº‹ä»¶åˆ°è¾¾ä¸ºæ­¢</span></span><br><span class="line">                tvp = <span class="literal">NULL</span>; <span class="comment">/* wait forever */</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (eventLoop-&gt;flags &amp; AE_DONT_WAIT) &#123;</span><br><span class="line">            tv.tv_sec = tv.tv_usec = <span class="number">0</span>;</span><br><span class="line">            tvp = &amp;tv;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/* 2 å‰ç½®å›è°ƒå‡½æ•° - beforeSleep */</span></span><br><span class="line">        <span class="keyword">if</span> (eventLoop-&gt;beforesleep != <span class="literal">NULL</span> &amp;&amp; flags &amp; AE_CALL_BEFORE_SLEEP)</span><br><span class="line">            eventLoop-&gt;beforesleep(eventLoop);</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line">        <span class="number">3</span> è°ƒç”¨å¤šè·¯å¤ç”¨ APIï¼Œåªä¼šåœ¨è¶…æ—¶æˆ–æŸäº›äº‹ä»¶è§¦å‘æ—¶è¿”å›ã€‚å³ç­‰å¾…äº‹ä»¶äº§ç”Ÿ</span><br><span class="line">        numevents = aeApiPoll(eventLoop, tvp);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">        <span class="comment">/* 4 åç½®å›è°ƒå‡½æ•° - beforeSleep */</span></span><br><span class="line">        <span class="keyword">if</span> (eventLoop-&gt;aftersleep != <span class="literal">NULL</span> &amp;&amp; flags &amp; AE_CALL_AFTER_SLEEP)</span><br><span class="line">            eventLoop-&gt;aftersleep(eventLoop);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5 éå†æ‰€æœ‰å·²äº§ç”Ÿçš„äº‹ä»¶ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å™¨æ¥å¤„ç†è¿™äº›äº‹ä»¶</span></span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; numevents; j++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.1 ä»å·²å°±ç»ªæ•°ç»„ä¸­è·å–æ–‡ä»¶æè¿°ç¬¦ä¿¡æ¯</span></span><br><span class="line">            aeFileEvent *fe = &amp;eventLoop-&gt;events[eventLoop-&gt;fired[j].fd];</span><br><span class="line">            <span class="keyword">int</span> mask = eventLoop-&gt;fired[j].mask;</span><br><span class="line">            <span class="keyword">int</span> fd = eventLoop-&gt;fired[j].fd;</span><br><span class="line">            <span class="keyword">int</span> fired = <span class="number">0</span>; <span class="comment">/* Number of events fired for current fd. */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> invert = fe-&gt;mask &amp; AE_BARRIER;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5.2 å¦‚æœæ˜¯å¥—æ¥å­—ä¸Šå‘ç”Ÿè¯»äº‹ä»¶ï¼Œè°ƒç”¨è¯»äº‹ä»¶å¤„ç†å™¨å¤„ç†è¯»äº‹ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (!invert &amp;&amp; fe-&gt;mask &amp; mask &amp; AE_READABLE) &#123;</span><br><span class="line">                fe-&gt;rfileProc(eventLoop, fd, fe-&gt;clientData, mask);</span><br><span class="line">                fired++;</span><br><span class="line">                fe = &amp;eventLoop-&gt;events[fd]; <span class="comment">/* Refresh in case of resize. */</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* Fire the writable event. */</span></span><br><span class="line">            <span class="comment">// 5.3 å¦‚æœæ˜¯å¥—æ¥å­—ä¸Šå‘ç”Ÿå†™äº‹ä»¶ï¼Œè°ƒç”¨å†™äº‹ä»¶å¤„ç†å™¨å¤„ç†å†™äº‹ä»¶</span></span><br><span class="line">            <span class="keyword">if</span> (fe-&gt;mask &amp; mask &amp; AE_WRITABLE) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!fired || fe-&gt;wfileProc != fe-&gt;rfileProc) &#123;</span><br><span class="line">                    fe-&gt;wfileProc(eventLoop, fd, fe-&gt;clientData, mask);</span><br><span class="line">                    fired++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/* If we have to invert the call, fire the readable event now</span></span><br><span class="line"><span class="comment">             * after the writable one.</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             * å¦‚æœéœ€è¦åè½¬è°ƒç”¨ï¼Œåœ¨å¯å†™äº‹ä»¶ä¹‹åè§¦å‘å¯è¯»äº‹ä»¶</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (invert) &#123;</span><br><span class="line">                fe = &amp;eventLoop-&gt;events[fd]; <span class="comment">/* Refresh in case of resize. */</span></span><br><span class="line">                <span class="keyword">if</span> ((fe-&gt;mask &amp; mask &amp; AE_READABLE) &amp;&amp;</span><br><span class="line">                    (!fired || fe-&gt;wfileProc != fe-&gt;rfileProc)) &#123;</span><br><span class="line">                    fe-&gt;rfileProc(eventLoop, fd, fe-&gt;clientData, mask);</span><br><span class="line">                    fired++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            processed++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="comment">// 6 å¦‚æœæ˜¯æ—¶é—´äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (flags &amp; AE_TIME_EVENTS)</span><br><span class="line">        <span class="comment">// æ‰§è¡Œæ—¶é—´äº‹ä»¶</span></span><br><span class="line">        processed += processTimeEvents(eventLoop);</span><br><span class="line">    <span class="keyword">return</span> processed; <span class="comment">/* return the number of processed file/time events */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šè¿°ä»£ç ç‰‡æ®µä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä¸»çº¿ç¨‹åœ¨ä¸æ–­è½®è¯¢æ—¶é—´äº‹ä»¶å’Œæ–‡ä»¶äº‹ä»¶ï¼Œæ‰¾åˆ°å°±å°è¯•æ‰§è¡Œã€‚ä¸Šè¿°ä»£ç è™½ç„¶ç®€çŸ­ï¼Œä½†æ˜¯å´å‡ ä¹åŒ…å«äº† Redis çš„æ‰€æœ‰åŠŸèƒ½ï¼Œç§˜å¯†å°±åœ¨ä»¥ä¸‹å‡ ä¸ªç»„ä»¶ä¸­ï¼š</p>
<ul>
<li>å‰ç½®å¤„ç†å™¨ beforeSleep </li>
<li>IOå¤šè·¯å¤ç”¨åº“ï¼ˆåŠå¤šç§å›è°ƒå‡½æ•°ï¼‰</li>
<li>åç½®å¤„ç†å™¨ afterSleep</li>
</ul>
<p>å…³äºä»¥ä¸Šä»£ç ç‰‡æ®µèƒŒåçš„ä¿¡æ¯ï¼Œä¼šåœ¨åé¢çš„æ–‡ç« ä¸­ä»‹ç» Redis äº‹ä»¶ä¸€æ–‡ä¸­è¯¦ç»†è¯´æ˜ï¼Œè¿™é‡Œå…ˆä¸å±•å¼€ã€‚ä¸‹é¢å¯¹ä»¥ä¸Šæ–¹æ³•è¿›è¡Œæ¦‚æ‹¬ï¼š</p>
<p><img src="https://blog-picture-oss.oss-cn-hangzhou.aliyuncs.com/redis/themory/redis-outline-multi-process.jpg" alt></p>
<h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>æœ¬ç¯‡æ–‡ç« ç®€å•ä»‹ç»äº† Redis å¯åŠ¨çš„å…¥å£ä»¥åŠæ‰§è¡Œçš„ä¸»å¹²æµç¨‹ï¼Œè¿™é‡Œæœ‰ä¸ªå°è±¡å³å¯ï¼Œåç»­ä¼šå¯¹æ¯ä¸ªæ¨¡å—å±•å¼€è¯´æ˜ã€‚</p>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
      <a href="https://gentryhuang.com/posts/19fe4bc5/" title="RedisåŸç† - Redisä¸»æµç¨‹" target="_blank" rel="external">https://gentryhuang.com/posts/19fe4bc5/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>ç‰ˆæƒå£°æ˜ï¼š </strong> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CNåè®®</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
    </li>
  </ul>
</blockquote>



<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://gentryhuang.com" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.png" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h2 id="name" style="margin: -2px 0 5px 0">
        <a href="https://gentryhuang.com" target="_blank">
           <span class="text-dark">gentryhuang</span>
           <small class="ml-1x">xw</small>
        </a>
      </h2>
        <div>ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    

  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/posts/f7ccc3b4/" title="Redisæ•°æ®ç»“æ„ - SDS"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;ä¸Šä¸€ç¯‡</span></a>
    </li>
    
    
    <li class="next">
      <a href="/posts/adccc332/" title="Redis æºç ç»“æ„æ€»è§ˆ"><span>ä¸‹ä¸€ç¯‡&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="æ–‡ç« ç›®å½•" role="button">
        <span>[&nbsp;</span><span>æ–‡ç« ç›®å½•</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  
  <div class="bar-right">
    
  </div>
  </div>
</nav>
  


</main>

  
<script type="text/javascript">
    var sc_project=12352980; 
    var sc_invisible=0; 
    var sc_security="3d83ff9f"; 
    var scJsHost = "https://";
    document.write("<sc"+"ript type='text/javascript' src='" +
    scJsHost+
    "statcounter.com/counter/counter.js'></"+"script>");
</script>

<footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/gentryhuang" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        &copy; 2019 - 2024 gentryhuang
        
       
        <!-- ç»Ÿè®¡ä»£ç  -->
        <div class="publishby">
            <div class="statcounter">
                <a title="Web Analytics" href="http://statcounter.com/p12352980/summary/?guest=1" target="_blank">
                    <img class="statcounter" src="https://c.statcounter.com/12352980/0/3d83ff9f/0/" alt="Web Analytics">
               </a>
        </div>
    </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'æ–‡ç« ',
            PAGES: 'é¡µé¢',
            CATEGORIES: 'åˆ†ç±»',
            TAGS: 'æ ‡ç­¾',
            UNTITLED: '(æœªå‘½å)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   





  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //åˆ©ç”¨ FancyBox å®ç°ç‚¹å‡»å›¾ç‰‡æ”¾å¤§
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>