{"meta":{"title":"gentryhuangâ€˜s blog","subtitle":"blog","description":"åšå®¢","author":"gentryhuang","url":"https://gentryhuang.com","root":"/"},"pages":[{"title":"å…³äºæˆ‘","date":"2020-07-06T16:28:53.042Z","updated":"2020-07-04T07:35:16.691Z","comments":false,"path":"about/index.html","permalink":"https://gentryhuang.com/about/index.html","excerpt":"","text":"123456789101112131415161718&#x2F;** * * * â”â”“ â”â”“ * â”ƒ â”ƒ + +* â”ƒ â” â”ƒ ++ + + +* â–ˆâ–ˆâ–ˆâ–ˆâ”â–ˆâ–ˆâ–ˆâ–ˆ â”ƒ ğŸš‚ğŸš‚ğŸš‚-&lt;-&lt; æ¬¢è¿è®¿é—®æˆ‘çš„åšå®¢* â”ƒ â”ƒ + * â”ƒ â”» â”ƒ + + * â”ƒ â”ƒ * â”—â”â”“ â”â”â”›Code is far away from bug with the animal protecting * â”ƒ â”ƒ ç¥å…½æŠ¤ä½“ï¼Œæ°¸æ— bug * â”ƒ â”ƒ +* â”ƒ â”—â”â”â”â”“+* â”ƒ â”£â”“ ğŸ“¬ è”ç³»æˆ‘ï¼šgentryhuang.xw@gmail.com* â”ƒ â”â”› + + * â”—â”“â”“â”â”â”³â”“â”â”› +* â”ƒâ”«â”« â”ƒâ”«â”« * â”—â”»â”› â”—â”»â”› *&#x2F;"},{"title":"åˆ†ç±»","date":"2020-07-03T15:03:26.305Z","updated":"2020-07-03T15:03:26.305Z","comments":false,"path":"categories/index.html","permalink":"https://gentryhuang.com/categories/index.html","excerpt":"","text":""},{"title":"é¡¹ç›®","date":"2020-07-06T16:29:08.229Z","updated":"2020-07-06T16:29:08.229Z","comments":false,"path":"repository/index.html","permalink":"https://gentryhuang.com/repository/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2020-07-05T10:07:05.047Z","updated":"2020-07-03T15:03:37.362Z","comments":true,"path":"links/index.html","permalink":"https://gentryhuang.com/links/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2020-07-03T15:03:56.993Z","updated":"2020-07-03T15:03:56.993Z","comments":false,"path":"tags/index.html","permalink":"https://gentryhuang.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"é“¾è¡¨","slug":"redis_theory/data_structure/é“¾è¡¨","date":"2020-07-08T11:33:59.000Z","updated":"2020-07-08T11:41:12.445Z","comments":false,"path":"posts/2362a8ea/","link":"","permalink":"https://gentryhuang.com/posts/2362a8ea/","excerpt":"","text":"é“¾è¡¨ redisä¸­çš„é“¾è¡¨ é“¾è¡¨ä½œä¸ºä¸€ç§å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œå†…ç½®åœ¨å¾ˆå¤šé«˜çº§ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå› ä¸ºredisä½¿ç”¨cè¯­è¨€å¹¶æ²¡æœ‰å†…ç½®è¿™ä¸­æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥redisæ„å»ºäº†è‡ªå·±çš„é“¾è¡¨å®ç°ã€‚ redisé“¾è¡¨èŠ‚ç‚¹çš„ç»“æ„ 12345678typedef struct listNode&#123; // å‰ç½®èŠ‚ç‚¹ struct listNode *prev; // åç½®èŠ‚ç‚¹ struct listNode *next; // èŠ‚ç‚¹çš„å€¼ (å¯ç”¨äºä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼) void *value&#125;listNode; redisé“¾è¡¨ç»“æ„ 123456789101112131415161718192021typedef struct list &#123; // è¡¨å¤´èŠ‚ç‚¹ listNode *head; // è¡¨å°¾èŠ‚ç‚¹ listNode *tail; // èŠ‚ç‚¹å€¼å¤åˆ¶å‡½æ•°ï¼Œç”¨äºå¤åˆ¶é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ void *(*dup)(void *ptr); // èŠ‚ç‚¹å€¼é‡Šæ”¾å‡½æ•°ï¼Œç”¨äºé‡Šæ”¾é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼ void (*free)(void *ptr); // èŠ‚ç‚¹å€¼å¯¹æ¯”å‡½æ•°ï¼Œç”¨äºå¯¹æ¯”é“¾è¡¨èŠ‚ç‚¹æ‰€ä¿å­˜çš„å€¼å’Œå…¶ä»–å€¼æ˜¯å¦ç›¸ç­‰ int (*match)(void *ptr, void *key); // é“¾è¡¨æ‰€åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ unsigned long len;&#125; list; redisé“¾è¡¨çš„ç‰¹ç‚¹ 12345- åŒç«¯ï¼šé“¾è¡¨èŠ‚ç‚¹å¸¦æœ‰prevå’ŒnextæŒ‡é’ˆï¼Œè·å–æŸä¸ªèŠ‚ç‚¹çš„å‰ç½®èŠ‚ç‚¹å’Œåç½®èŠ‚ç‚¹çš„å¤æ‚åº¦éƒ½æ˜¯O(1)- æ— ç¯ï¼šè¡¨å¤´èŠ‚ç‚¹çš„prevæŒ‡é’ˆå’Œè¡¨å°¾èŠ‚ç‚¹çš„nextæŒ‡é’ˆéƒ½æŒ‡å‘NULLï¼Œå¯¹é“¾è¡¨çš„è®¿é—®ä»¥NULLä¸ºç»ˆç‚¹- å¸¦è¡¨å¤´å’Œè¡¨å°¾æŒ‡é’ˆï¼šä½¿ç”¨listç»“æ„çš„headæŒ‡é’ˆå’ŒtailæŒ‡é’ˆï¼Œç¨‹åºè·å–é“¾è¡¨çš„è¡¨å¤´èŠ‚ç‚¹å’Œè¡¨å°¾èŠ‚ç‚¹çš„å¤æ‚åº¦ä¸ºO(1)- å¸¦é“¾è¡¨é•¿åº¦è®¡æ•°å™¨ï¼šç¨‹åºä½¿ç”¨listç»“æ„çš„lenå±æ€§æ ‡è®°é“¾è¡¨ä¸­èŠ‚ç‚¹çš„ä¸ªæ•°ï¼Œç¨‹åºè·å–é“¾è¡¨ä¸­èŠ‚ç‚¹ä¸ªæ•°çš„å¤æ‚åº¦ä¸ºO(1)- å¤šæ€ï¼šé“¾è¡¨å¯ä»¥ä¿å­˜å„ç§ä¸åŒç±»å‹çš„å€¼ é“¾è¡¨åœ¨redisä¸­çš„åº”ç”¨ é“¾è¡¨è¢«å¹¿æ³›ç”¨äºå®ç°redisçš„å„ç§åŠŸèƒ½ï¼Œå¦‚ï¼šåˆ—è¡¨é”®ã€å‘å¸ƒä¸è®¢é˜…ã€æ…¢æŸ¥è¯¢ã€ç›‘è§†å™¨ï¼ŒredisæœåŠ¡å™¨æœ¬èº«è¿˜ä½¿ç”¨é“¾è¡¨æ¥ä¿å­˜å¤šä¸ªå®¢æˆ·ç«¯çš„çŠ¶æ€ä¿¡æ¯ï¼Œä»¥åŠä½¿ç”¨é“¾è¡¨æ¥æ„å»ºå®¢æˆ·ç«¯è¾“å‡ºç¼“å†²åŒºã€‚","categories":[{"name":"RedisåŸç†","slug":"RedisåŸç†","permalink":"https://gentryhuang.com/categories/Redis%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"Redisæ•°æ®ç»“æ„","slug":"Redisæ•°æ®ç»“æ„","permalink":"https://gentryhuang.com/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"ç®€å•åŠ¨æ€å­—ç¬¦ä¸²","slug":"redis_theory/data_structure/ç®€å•åŠ¨æ€å­—ç¬¦ä¸²","date":"2020-07-08T11:00:50.000Z","updated":"2020-07-21T07:41:30.123Z","comments":false,"path":"posts/aa1d8127/","link":"","permalink":"https://gentryhuang.com/posts/aa1d8127/","excerpt":"","text":"ç®€å•åŠ¨æ€å­—ç¬¦ä¸² åˆè¯†åŠ¨æ€å­—ç¬¦ä¸² redisæ²¡æœ‰ç›´æ¥ä½¿ç”¨Cè¯­è¨€ä¼ ç»Ÿçš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼ˆä»¥ç©ºå­—ç¬¦ç»“å°¾çš„å­—ç¬¦æ•°ç»„ï¼‰ï¼Œè€Œæ˜¯è‡ªå·±æ„å»ºäº†ä¸€ç§åä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆsimple dynamic stringï¼ŒSDSï¼‰çš„æŠ½è±¡ç±»å‹ï¼Œå¹¶å°†SDSä½œä¸ºredisçš„é»˜è®¤å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ åœ¨redisä¸­ï¼Œcå­—ç¬¦ä¸²åªä¼šä½œä¸ºå­—ç¬¦ä¸²å­—é¢é‡ç”¨åœ¨ä¸€äº›æ— é¡»å¯¹å­—ç¬¦ä¸²å€¼è¿›è¡Œä¿®æ”¹çš„åœ°æ–¹ï¼Œæ¯”å¦‚æ—¥å¿—ã€‚å½“Rediséœ€è¦çš„ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å­—é¢é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯ä»¥è¢«ä¿®æ”¹çš„å­—ç¬¦ä¸²å€¼æ—¶ï¼Œrediså°±ä¼šä½¿ç”¨SDSæ¥è¡¨ç¤ºå­—ç¬¦ä¸²å€¼ã€‚ å€¼çš„æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºredisä¸­çš„keyéƒ½æ˜¯ä½¿ç”¨SDSæ¥å®ç°çš„ã€‚æ­¤å¤–ï¼ŒSDSé™¤äº†ç”¨æ¥ä¿å­˜Redisæ•°æ®åº“ä¸­çš„å­—ç¬¦ä¸²å€¼ä¹‹å¤–ï¼ŒSDSè¿˜è¢«ç”¨ä½œç¼“å†²åŒºï¼ˆbufferï¼‰: AOFæ¨¡å—ä¸­çš„AOFç¼“å†²åŒºï¼Œä»¥åŠå®¢æˆ·ç«¯çŠ¶æ€ä¸­çš„è¾“å…¥ç¼“å†²åŒºã€‚ sdsçš„ç»“æ„ 12345678struct sdshdr&#123; // è®°å½•bufæ•°ç»„ä¸­å·²ä½¿ç”¨å­—èŠ‚çš„æ•°é‡ç­‰ä»·äºsdsæ‰€ä¿å­˜å­—ç¬¦ä¸²çš„é•¿åº¦ int len; // è®°å½•bufæ•°ç»„ä¸­æœªä½¿ç”¨å­—èŠ‚çš„æ•°é‡ int free; // å­—èŠ‚æ•°ç»„ï¼Œç”¨äºä¿å­˜å­—ç¬¦ä¸² char buf[];&#125; æ³¨æ„ï¼š sdséµå¾ªcå­—ç¬¦ä¸²ä»¥ç©ºå­—ç¬¦ç»“å°¾çš„æƒ¯ä¾‹ï¼Œä¿å­˜ç©ºå­—ç¬¦çš„1å­—èŠ‚ç©ºé—´ä¸è®¡ç®—åœ¨sdsçš„lenå±æ€§ä¸­ï¼Œå¹¶ä¸”ä¸ºç©ºå­—ç¬¦åˆ†é…é¢å¤–çš„1å­—èŠ‚ç©ºé—´ï¼Œä»¥åŠæ·»åŠ ç©ºå­—ç¬¦åˆ°å­—ç¬¦ä¸²æœ«å°¾ç­‰æ“ä½œï¼Œéƒ½æ˜¯ç”±sdså‡½æ•°è‡ªåŠ¨å®Œæˆçš„ã€‚éµå¾ªç©ºå­—ç¬¦ç»“å°¾çš„å¥½å¤„æ˜¯ï¼Œsdså¯ä»¥ç›´æ¥ä½¿ç”¨ä¸€éƒ¨åˆ†Cå­—ç¬¦ä¸²å‡½æ•°åº“é‡Œé¢çš„å‡½æ•°ã€‚ sdsä¸cå­—ç¬¦ä¸²çš„åŒºåˆ« cè¯­è¨€ä½¿ç”¨çš„ç®€å•å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ï¼Œå¹¶ä¸èƒ½æ»¡è¶³rediså¯¹å­—ç¬¦ä¸²åœ¨å®‰å…¨æ€§ã€æ•ˆç‡ä»¥åŠåŠŸèƒ½æ–¹é¢çš„è¦æ±‚ã€‚ 3.1 å¸¸æ•°å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦ å› ä¸ºcå­—ç¬¦ä¸²å¹¶ä¸è®°å½•è‡ªèº«çš„é•¿åº¦ä¿¡æ¯ï¼Œæ‰€ä»¥è¦è·å–é•¿åº¦å°±å¿…é¡»éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œæ•…è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦ä¸ºO(N)ã€‚è€Œredisçš„sdsç»“æ„ä¸­é€šè¿‡lenå±æ€§è®°å½•äº†sdsçš„é•¿åº¦ï¼Œæ•…è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦ä¸ºO(1)ã€‚æ³¨æ„ï¼Œè®¾ç½®å’Œæ›´æ–°sdsé•¿åº¦çš„å·¥ä½œæ˜¯ç”±sdsçš„APIåœ¨æ‰§è¡Œæ—¶è‡ªåŠ¨å®Œæˆçš„ï¼Œä½¿ç”¨sdsæ— é¡»è¿›è¡Œä»»ä½•æ‰‹åŠ¨ä¿®æ”¹é•¿åº¦çš„æ“ä½œã€‚ 3.2 é¿å…ç¼“å†²åŒºæº¢å‡º cå­—ç¬¦ä¸²ä¸è®°å½•è‡ªèº«é•¿åº¦ï¼Œå¾ˆå®¹æ˜“é€ æˆç¼“å†²åŒºæº¢å‡ºã€‚ä¸cå­—ç¬¦ä¸²ä¸åŒï¼Œsdsçš„ç©ºé—´åˆ†é…ç­–ç•¥å®Œå…¨æœç»äº†å‘ç”Ÿç¼“å†²åŒºæº¢å‡ºçš„å¯èƒ½æ€§ï¼Œå½“sds apiéœ€è¦å¯¹sdsè¿›è¡Œä¿®æ”¹æ—¶ï¼Œapiä¼šå…ˆæ£€æŸ¥sdsçš„ç©ºé—´æ˜¯å¦æ»¡è¶³éœ€è¦ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œapiä¼šè‡ªåŠ¨å°†sdsçš„ç©ºé—´æ‰©å±•è‡³æ‰§è¡Œæ‰€éœ€çš„å¤§å°ï¼Œç„¶åæ‰æ‰§è¡Œå®é™…çš„ä¿®æ”¹æ“ä½œï¼Œå› æ­¤ä½¿ç”¨sdsæ—¢ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹sdsçš„ç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡ºç°cå­—ç¬¦ä¸²ä¸­å¯èƒ½å‡ºç°çš„ç¼“å†²åŒºæº¢å‡ºé—®é¢˜ã€‚ 1234567891011121314151617sds sdscatlen(sds s, const void *t, size_t len) &#123; size_t curlen = sdslen(s); //è¿½åŠ æ—¶å…ˆè¿›è¡Œæ‰©å®¹ï¼Œåé¢è¯¦ç»†è¯´æ˜ s = sdsMakeRoomFor(s,len); if (s == NULL) return NULL; //æ‹¼æ¥å­—ç¬¦ä¸² memcpy(s+curlen, t, len); sdssetlen(s, curlen+len); s[curlen+len] = '\\0'; return s;&#125;// s:åŸæ•°ç»„ //strlen(t) éœ€æ‹¼æ¥çš„ç›®æ ‡æ•°ç»„çš„é•¿åº¦sds sdscat(sds s, const char *t) &#123; return sdscatlen(s, t, strlen(t));&#125;â€‹ 3.3 å†…å­˜åˆ†é…ä¸é‡Šæ”¾ å› ä¸ºcå­—ç¬¦ä¸²çš„é•¿åº¦å’Œåº•å±‚æ•°ç»„çš„é•¿åº¦ä¹‹é—´å­˜åœ¨ç€å…³è”æ€§ï¼Œæ‰€ä»¥æ¯æ¬¡å¢åŠ æˆ–è€…ç¼©çŸ­ä¸€ä¸ªcå­—ç¬¦ä¸²ï¼Œç¨‹åºéƒ½æ€»è¦å¯¹ä¿å­˜è¿™ä¸ªcå­—ç¬¦ä¸²çš„æ•°å­—è¿›è¡Œä¸€æ¬¡åˆ†é…æ“ä½œï¼Œä½†æ˜¯å†…å­˜åˆ†é…æ“ä½œæ¶‰åŠåˆ°å¤æ‚çš„ç®—æ³•ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥é€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„æ“ä½œã€‚redisä½œä¸ºæ•°æ®åº“ï¼Œç»å¸¸è¢«ç”¨äºé€Ÿåº¦è¦æ±‚ä¸¥è‹›ã€æ•°æ®è¢«é¢‘ç¹ä¿®æ”¹çš„åœºåˆï¼Œä¸ºäº†é¿å…cå­—ç¬¦ä¸²çš„è¿™ç§ç¼ºé™·ï¼Œsdsé€šè¿‡æœªä½¿ç”¨ç©ºé—´è§£é™¤äº†å­—ç¬¦ä¸²é•¿åº¦å’Œåº•å±‚æ•°ç»„é•¿åº¦ä¹‹é—´çš„å…³è”ï¼Œé€šè¿‡æœªä½¿ç”¨ç©ºé—´ï¼Œsdså®ç°äº†ç©ºé—´é¢„åˆ†é…å’Œæƒ°æ€§ç©ºé—´é‡Šæ”¾ä¸¤ç§ä¼˜åŒ–ç­–ç•¥ã€‚ ç©ºé—´é¢„åˆ†é… ç©ºé—´é¢„åˆ†é…ç”¨äºä¼˜åŒ–sdsçš„å­—ç¬¦ä¸²å¢é•¿æ“ä½œï¼šå½“sdsçš„apiå¯¹ä¸€ä¸ªsdsè¿›è¡Œä¿®æ”¹ï¼Œå¹¶ä¸”éœ€è¦å¯¹sdsè¿›è¡Œç©ºé—´æ‰©å±•çš„æ—¶å€™ï¼Œç¨‹åºä¸ä»…ä¼šä¸ºsdsåˆ†é…ä¿®æ”¹æ‰€å¿…é¡»è¦çš„ç©ºé—´ï¼Œè¿˜ä¼šä¸ºsdsåˆ†é…é¢å¤–çš„æœªä½¿ç”¨ç©ºé—´ã€‚é€šè¿‡ç©ºé—´é¢„åˆ†é…ç­–ç•¥ï¼Œrediså¯ä»¥å‡å°‘è¿ç»­æ‰§è¡Œå­—ç¬¦ä¸²å¢é•¿æ“ä½œæ‰€éœ€çš„å†…å­˜é‡æ–°åˆ†é…æ¬¡æ•°ï¼Œåœ¨æ‰©å±•sdsç©ºé—´ä¹‹å‰ï¼Œsds api ä¼šå…ˆæ£€æŸ¥æœªä½¿ç”¨ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœè¶³å¤Ÿå°±ç›´æ¥ä½¿ç”¨æœªä½¿ç”¨ç©ºé—´ï¼Œè€Œä¸éœ€è¦æ‰§è¡Œå†…å­˜é‡æ–°åˆ†é…ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152// redis æ‰©å®¹æºç /* * å¯¹ sds ä¸­ buf çš„é•¿åº¦è¿›è¡Œæ‰©å±•ï¼Œç¡®ä¿åœ¨å‡½æ•°æ‰§è¡Œä¹‹åï¼Œ * buf è‡³å°‘ä¼šæœ‰ addlen + 1 é•¿åº¦çš„ç©ºä½™ç©ºé—´ * ï¼ˆé¢å¤–çš„ 1 å­—èŠ‚æ˜¯ä¸º \\0 å‡†å¤‡çš„ï¼‰ * * è¿”å›å€¼ * sds ï¼šæ‰©å±•æˆåŠŸè¿”å›æ‰©å±•åçš„ sds * æ‰©å±•å¤±è´¥è¿”å› NULL * * å¤æ‚åº¦ * T = O(N) */sds sdsMakeRoomFor(sds s, size_t addlen) &#123; struct sdshdr *sh, *newsh; // è·å– s ç›®å‰çš„ç©ºä½™ç©ºé—´é•¿åº¦ size_t free = sdsavail(s); size_t len, newlen; // s ç›®å‰çš„ç©ºä½™ç©ºé—´å·²ç»è¶³å¤Ÿï¼Œæ— é¡»å†è¿›è¡Œæ‰©å±•ï¼Œç›´æ¥è¿”å› if (free &gt;= addlen) return s; // è·å– s ç›®å‰å·²å ç”¨ç©ºé—´çš„é•¿åº¦ len = sdslen(s); sh = (void*) (s-(sizeof(struct sdshdr))); // s æœ€å°‘éœ€è¦çš„é•¿åº¦ newlen = (len+addlen); // æ ¹æ®æ–°é•¿åº¦ï¼Œä¸º s åˆ†é…æ–°ç©ºé—´æ‰€éœ€çš„å¤§å° if (newlen &lt; SDS_MAX_PREALLOC) // å¦‚æœæ–°é•¿åº¦å°äº SDS_MAX_PREALLOC // é‚£ä¹ˆä¸ºå®ƒåˆ†é…ä¸¤å€äºæ‰€éœ€é•¿åº¦çš„ç©ºé—´ newlen *= 2; else // å¦åˆ™ï¼Œåˆ†é…é•¿åº¦ä¸ºç›®å‰é•¿åº¦åŠ ä¸Š SDS_MAX_PREALLOC newlen += SDS_MAX_PREALLOC; // T = O(N) newsh = zrealloc(sh, sizeof(struct sdshdr)+newlen+1); // å†…å­˜ä¸è¶³ï¼Œåˆ†é…å¤±è´¥ï¼Œè¿”å› if (newsh == NULL) return NULL; // æ›´æ–° sds çš„ç©ºä½™é•¿åº¦ newsh-&gt;free = newlen - len; // è¿”å› sds return newsh-&gt;buf;&#125; é¢å¤–åˆ†é…æœªä½¿ç”¨ç©ºé—´æ•°é‡çš„è®¡ç®—ç­–ç•¥ï¼š å¯¹sdsä¿®æ”¹åï¼Œsdsçš„é•¿åº¦ï¼ˆå³lenå±æ€§çš„å€¼ï¼‰å°äº1MBï¼Œé‚£ä¹ˆç¨‹åºåˆ†é…å’Œlenå±æ€§åŒæ ·å¤§å°çš„æœªä½¿ç”¨ç©ºé—´ï¼Œè¿™æ—¶sdsçš„lenå±æ€§çš„å€¼å°†å’Œfreeå±æ€§çš„å€¼ç›¸åŒã€‚ä¾‹å¦‚ï¼šä¿®æ”¹åsdsçš„lenå˜æˆ10å­—èŠ‚ï¼Œé‚£ä¹ˆç¨‹åºä¹Ÿä¼šåˆ†é…10å­—èŠ‚çš„æœªä½¿ç”¨ç©ºé—´ï¼Œsdsçš„bufæ•°ç»„çš„å®é™…é•¿åº¦ï¼š10 + 10 + 1 = 21å­—èŠ‚ å¯¹sdsä¿®æ”¹åï¼Œsdsçš„é•¿åº¦å¤§äºç­‰äº1MBï¼Œé‚£ä¹ˆç¨‹åºä¼šåˆ†é…1MBçš„æœªä½¿ç”¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼šä¿®æ”¹åsdsçš„lenå˜æˆ30MBï¼Œé‚£ä¹ˆç¨‹åºä¼šåˆ†é…1MBçš„æœªä½¿ç”¨ç©ºé—´ï¼Œsdsçš„bufæ•°ç»„çš„æ—¶é—´é•¿åº¦ï¼š30MB + 1MB + 1byte æƒ°æ€§ç©ºé—´é‡Šæ”¾ æƒ°æ€§ç©ºé—´é‡Šæ”¾ç”¨äºä¼˜åŒ–sdsçš„å­—ç¬¦ä¸²ç¼©çŸ­æ“ä½œï¼šå½“sdsçš„apiéœ€è¦ç¼©çŸ­sdsä¿å­˜çš„å­—ç¬¦ä¸²æ—¶ï¼Œç¨‹åºå¹¶ä¸ç«‹å³ä½¿ç”¨å†…å­˜é‡åˆ†é…æ¥å›æ”¶ç¼©çŸ­åå¤šæ¥çš„å­—èŠ‚ï¼Œè€Œæ˜¯ä½¿ç”¨freeå±æ€§å°†è¿™äº›å­—èŠ‚çš„æ•°é‡çºªå½•èµ·æ¥ï¼Œç”¨äºå°†æ¥å¯¹sdsè¿›è¡Œå¢é•¿æ“ä½œæ—¶ï¼Œè¿™äº›æœªä½¿ç”¨ç©ºé—´å¯èƒ½å°±æ´¾ä¸Šç”¨åœºäº†ã€‚æ³¨æ„ï¼Œsdsä¹Ÿæä¾›äº†ç›¸åº”çš„apiï¼Œå¯ä»¥çœŸæ­£åœ°é‡Šæ”¾sdsçš„æœªä½¿ç”¨ç©ºé—´ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒæƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ä¼šé€ æˆå†…å­˜æµªè´¹ã€‚ 3.4 äºŒè¿›åˆ¶å®‰å…¨ cå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦å¿…é¡»ç¬¦åˆæŸç§ç¼–ç ï¼Œå¹¶ä¸”é™¤äº†å­—ç¬¦ä¸²çš„æœ«å°¾ä¹‹å¤–ï¼Œå­—ç¬¦ä¸²é‡Œä¸èƒ½åŒ…å«ç©ºå­—ç¬¦ï¼Œå¦åˆ™åœ¨è¯»å–çš„æ—¶å€™ä¼šè¢«é»˜è®¤ä¸ºç»“æŸå­—ç¬¦ï¼Œè¿™äº›é™åˆ¶ä½¿å¾—cå­—ç¬¦ä¸²åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œä¸èƒ½ä¿å­˜å›¾ç‰‡ã€éŸ³è§†é¢‘ã€å‹ç¼©æ–‡ä»¶è¿™ç±»çš„äºŒè¿›åˆ¶æ•°æ®ã€‚sdsçš„apiéƒ½æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ‰€æœ‰çš„sds apiéƒ½ä¼šä»¥äºŒè¿›åˆ¶çš„æ–¹å¼å¤„ç†sdså­˜æ”¾åœ¨bufæ•°ç»„é‡Œçš„æ•°æ®,ç¨‹åºä¸ä¼šå¯¹å…¶ä¸­çš„æ•°æ®åšä»»ä½•é™åˆ¶ã€è¿‡æ»¤ï¼Œæ•°æ®å†™å…¥æ—¶æ˜¯ä»€ä¹ˆæ ·ï¼Œå®ƒè¢«è¯»å–æ—¶å°±æ˜¯ä»€ä¹ˆæ ·ã€‚è¿™ä¹Ÿæ˜¯å°†sdsçš„bufå±æ€§ç§°ä¸ºå­—èŠ‚æ•°ç»„çš„åŸå› ï¼Œredisä¸æ˜¯ç”¨è¿™ä¸ªæ•°ç»„æ¥ä¿å­˜å­—ç¬¦ï¼Œè€Œæ˜¯ç”¨å®ƒæ¥ä¿å­˜ä¸€ç³»åˆ—äºŒè¿›åˆ¶æ•°æ®ã€‚ cå­—ç¬¦ä¸²å’Œsdsä¹‹é—´çš„åŒºåˆ« 123456 Cå­—ç¬¦ä¸² SDS- è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦ä¸ºOï¼ˆnï¼‰ è·å–å­—ç¬¦ä¸²é•¿åº¦çš„å¤æ‚åº¦Oï¼ˆ1ï¼‰- APIæ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½é€ æˆç¼“å†²åŒºæº¢å‡º APIæ˜¯å®‰å…¨çš„- ä¿®æ”¹å­—ç¬¦ä¸²é•¿åº¦Næ¬¡ï¼Œå¿…ç„¶è¦æ‰§è¡ŒNæ¬¡å†…å­˜é‡åˆ†é… ä¿®æ”¹å­—ç¬¦é•¿åº¦Næ¬¡ï¼Œæœ€å¤šæ‰§è¡ŒNæ¬¡å†…å­˜é‡åˆ†é…- åªèƒ½ä¿å­˜æ–‡æœ¬æ•°æ® å¯ä»¥ä¿å­˜æ–‡æœ¬æˆ–è€…äºŒè¿›åˆ¶æ•°æ®- å¯ä½¿ç”¨&lt;string.h&gt;åº“ä¸­çš„å‡½æ•° å¯ä½¿ç”¨ä¸€éƒ¨åˆ†&lt;string.h&gt;åº“ä¸­çš„å‡½æ•° sdsæ›´å¤šçš„apiå¯å‚è€ƒæºç ","categories":[{"name":"RedisåŸç†","slug":"RedisåŸç†","permalink":"https://gentryhuang.com/categories/Redis%E5%8E%9F%E7%90%86/"}],"tags":[{"name":"Redisæ•°æ®ç»“æ„","slug":"Redisæ•°æ®ç»“æ„","permalink":"https://gentryhuang.com/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"}]},{"title":"dubboç¬¬ä¸‰ä¾‹","slug":"rpc/Dubboç¬¬ä¸‰ä¾‹","date":"2020-03-05T16:00:00.000Z","updated":"2020-08-04T12:14:10.052Z","comments":false,"path":"posts/7202a9c0/","link":"","permalink":"https://gentryhuang.com/posts/7202a9c0/","excerpt":"","text":"å¿«é€Ÿå¯åŠ¨ä½¿ç”¨æ³¨è§£çš„æ–¹å¼è¿›è¡Œé…ç½® å®šä¹‰æœåŠ¡æ¥å£12345678910package com.alibaba.dubbo.examples.annotation.api;/** * AsyncService */public interface AnnotationService &#123; String sayHello(String name);&#125; æœåŠ¡æä¾›æ–¹123456789101112131415161718package com.alibaba.dubbo.examples.annotation.impl;import com.alibaba.dubbo.config.annotation.Service;import com.alibaba.dubbo.examples.annotation.api.AnnotationService;/** * AsyncServiceImplï¼Œæ³¨æ„ï¼Œè¿™é‡Œ @Service æ³¨è§£æ˜¯Dubboçš„æ³¨è§£ï¼Œç”¨æ¥è¿›è¡ŒæœåŠ¡æš´éœ²çš„ */@Servicepublic class AnnotationServiceImpl implements AnnotationService &#123; @Override public String sayHello(String name) &#123; System.out.println(\"async provider received: \" + name); return \"annotation: hello, \" + name; &#125;&#125; æœåŠ¡æä¾›æ–¹å±æ€§é…ç½®12345# dubbo-provider.propertiesdubbo.application.name&#x3D;annotation-providerdubbo.registry.address&#x3D;zookeeper:&#x2F;&#x2F;127.0.0.1:2181dubbo.protocol.name&#x3D;dubbodubbo.protocol.port&#x3D;20880 è¯´æ˜: ä½¿ç”¨dubboæ³¨è§£å½¢å¼ä¸€èˆ¬ç»“åˆå±æ€§é…ç½®ï¼Œç”¨æ¥é…ç½®åº”ç”¨å…±äº«çš„é…ç½®é¡¹ã€‚ æŒ‡å®šæ‰«æè·¯å¾„ï¼Œå¯åŠ¨å®¹å™¨å¹¶æš´éœ²æœåŠ¡123456789101112131415161718192021222324252627282930313233343536package com.alibaba.dubbo.examples.annotation;import com.alibaba.dubbo.config.ProviderConfig;import com.alibaba.dubbo.config.spring.context.annotation.EnableDubbo;import org.springframework.context.annotation.AnnotationConfigApplicationContext;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.PropertySource;/** * MergeProvider * * Java Config + æ³¨è§£çš„æ–¹å¼ */public class AnnotationProvider &#123; public static void main(String[] args) throws Exception &#123; AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ProviderConfiguration.class); context.start(); System.in.read(); &#125; @Configuration @EnableDubbo(scanBasePackages = \"com.alibaba.dubbo.examples.annotation.impl\") @PropertySource(\"classpath:/com/alibaba/dubbo/examples/annotation/dubbo-provider.properties\") static public class ProviderConfiguration &#123; @Bean public ProviderConfig providerConfig() &#123; ProviderConfig providerConfig = new ProviderConfig(); providerConfig.setTimeout(5000); return providerConfig; &#125; &#125;&#125; æœåŠ¡æ¶ˆè´¹æ–¹123456789101112131415161718192021package com.alibaba.dubbo.examples.annotation.action;import com.alibaba.dubbo.config.annotation.Reference;import com.alibaba.dubbo.examples.annotation.api.AnnotationService;import org.springframework.stereotype.Component;/** * AnnotationActionï¼Œæ³¨æ„ï¼Œ@Referenceæ³¨è§£ç”¨æ¥å¼•ç”¨æœåŠ¡ */@Component(\"annotationAction\")public class AnnotationAction &#123; @Reference private AnnotationService annotationService; public String doSayHello(String name) &#123; return annotationService.sayHello(name); &#125;&#125; æœåŠ¡æ¶ˆè´¹æ–¹å±æ€§é…ç½®1234# dubbo-consumer.propertiesdubbo.application.name&#x3D;annotation-consumerdubbo.registry.address&#x3D;zookeeper:&#x2F;&#x2F;127.0.0.1:2181dubbo.consumer.timeout&#x3D;3000 è¯´æ˜: ä½¿ç”¨dubboæ³¨è§£å½¢å¼ä¸€èˆ¬ç»“åˆå±æ€§é…ç½®ï¼Œç”¨æ¥é…ç½®åº”ç”¨å…±äº«çš„é…ç½®é¡¹ã€‚ æ‰«æè·¯å¾„ï¼Œå¯åŠ¨å®¹å™¨å¹¶è°ƒç”¨æœåŠ¡1234567891011121314151617181920212223242526272829303132package com.alibaba.dubbo.examples.annotation;import com.alibaba.dubbo.config.spring.context.annotation.EnableDubbo;import com.alibaba.dubbo.examples.annotation.action.AnnotationAction;import org.springframework.context.annotation.AnnotationConfigApplicationContext;import org.springframework.context.annotation.ComponentScan;import org.springframework.context.annotation.Configuration;import org.springframework.context.annotation.PropertySource;/** * CallbackConsumer */public class AnnotationConsumer &#123; public static void main(String[] args) throws Exception &#123; AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(ConsumerConfiguration.class); context.start(); final AnnotationAction annotationAction = (AnnotationAction) context.getBean(\"annotationAction\"); String hello = annotationAction.doSayHello(\"world\"); System.out.println(\"result :\" + hello); System.in.read(); &#125; @Configuration @EnableDubbo(scanBasePackages = \"com.alibaba.dubbo.examples.annotation.action\") @PropertySource(\"classpath:/com/alibaba/dubbo/examples/annotation/dubbo-consumer.properties\") @ComponentScan(value = &#123;\"com.alibaba.dubbo.examples.annotation.action\"&#125;) static public class ConsumerConfiguration &#123; &#125;&#125; å°ç»“æ³¨è§£å®ç°æ˜¯ä»£ç æ›´æ•´æ´ï¼Œå¼€æ”¾æ•ˆç‡æ›´é«˜ï¼Œéšç€æ³¨è§£å’Œé…ç½®åŒ–çš„ç››è¡Œï¼Œxmlçš„æ–¹å¼ä¼šæ¸æ¸åœ°æ·¡å‡ºèˆå°ã€‚ä½†ä½¿ç”¨æ³¨è§£å¯¹å¼€æ”¾è€…çš„è¦æ±‚æ›´é«˜ï¼Œå…·ä½“çš„dubboæ³¨è§£å¦‚ä½•ä¸Springèåˆï¼Œåœ¨åé¢çš„ç« èŠ‚ä¸­ä¼šè¿›è¡Œè¯´æ˜ã€‚","categories":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/categories/rpc/"}],"tags":[{"name":"dubbo","slug":"dubbo","permalink":"https://gentryhuang.com/tags/dubbo/"},{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/tags/rpc/"}]},{"title":"dubboç¬¬äºŒä¾‹","slug":"rpc/Dubboç¬¬äºŒä¾‹","date":"2020-03-03T16:00:00.000Z","updated":"2020-08-04T12:14:10.047Z","comments":false,"path":"posts/3f1c0a92/","link":"","permalink":"https://gentryhuang.com/posts/3f1c0a92/","excerpt":"","text":"å¿«é€Ÿå¯åŠ¨ä½¿ç”¨xmlçš„æ–¹å¼è¿›è¡Œé…ç½®ï¼Œè¯¦ç»†é…ç½®é¡¹ï¼šé…ç½®å‚è€ƒæ‰‹å†Œ å®šä¹‰æœåŠ¡æ¥å£12345package com.alibaba.dubbo.demo;public interface DemoService &#123; String sayHello(String name);&#125; æœåŠ¡æä¾›æ–¹å®ç°æ¥å£12345678910111213141516package com.alibaba.dubbo.demo.provider;import com.alibaba.dubbo.demo.DemoService;import com.alibaba.dubbo.rpc.RpcContext;import java.text.SimpleDateFormat;import java.util.Date;public class DemoServiceImpl implements DemoService &#123; @Override public String sayHello(String name) &#123; System.out.println(\"[\" + new SimpleDateFormat(\"HH:mm:ss\").format(new Date()) + \"] Hello \" + name + \", request from consumer: \" + RpcContext.getContext().getRemoteAddress()); return \"Hello \" + name + \", response from provider: \" + RpcContext.getContext().getLocalAddress(); &#125;&#125; æœåŠ¡æä¾›æ–¹æœåŠ¡æš´éœ²é…ç½®1234567891011121314151617181920212223&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dubbo=\"http://dubbo.apache.org/schema/dubbo\" xmlns=\"http://www.springframework.org/schema/beans\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"&gt; &lt;!-- æä¾›æ–¹åº”ç”¨ä¿¡æ¯ï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³» --&gt; &lt;dubbo:application name=\"demo-provider\" owner=\"gentryhuang\"/&gt; &lt;!-- ä½¿ç”¨zookeeperæ³¨å†Œä¸­å¿ƒæš´éœ²æœåŠ¡åœ°å€ --&gt; &lt;dubbo:registry address=\"zookeeper://127.0.0.1:2181\"/&gt; &lt;!-- ç”¨dubboåè®®åœ¨20880ç«¯å£æš´éœ²æœåŠ¡ --&gt; &lt;dubbo:protocol name=\"dubbo\" port=\"20880\"/&gt; &lt;!-- å£°æ˜éœ€è¦æš´éœ²çš„æœåŠ¡æ¥å£ --&gt; &lt;bean id=\"demoService\" class=\"com.alibaba.dubbo.demo.provider.DemoServiceImpl\"/&gt; &lt;!-- å’Œæœ¬åœ°beanä¸€æ ·å®ç°æœåŠ¡ --&gt; &lt;dubbo:service interface=\"com.alibaba.dubbo.demo.DemoService\" ref=\"demoService\"/&gt;&lt;/beans&gt; å¯åŠ¨Springå®¹å™¨ï¼Œè¿›è¡ŒæœåŠ¡æš´éœ²12345678910111213package com.alibaba.dubbo.demo.provider;import org.springframework.context.support.ClassPathXmlApplicationContext;public class Provider &#123; public static void main(String[] args) throws Exception &#123; ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;\"META-INF/spring/dubbo-demo-provider.xml\"&#125;); context.start(); System.in.read(); // press any key to exit &#125;&#125; æœåŠ¡æ¶ˆè´¹è€…å¼•ç”¨æœåŠ¡é…ç½®1234567891011121314151617&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:dubbo=\"http://dubbo.apache.org/schema/dubbo\" xmlns=\"http://www.springframework.org/schema/beans\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.3.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd\"&gt; &lt;!-- æ¶ˆè´¹æ–¹åº”ç”¨åï¼Œç”¨äºè®¡ç®—ä¾èµ–å…³ç³»ï¼Œä¸æ˜¯åŒ¹é…æ¡ä»¶ï¼Œä¸è¦ä¸æä¾›æ–¹ä¸€æ · --&gt; &lt;dubbo:application name=\"demo-consumer\"/&gt; &lt;!-- ä½¿ç”¨zookeeperæ³¨å†Œä¸­å¿ƒæš´éœ²å‘ç°æœåŠ¡åœ°å€ --&gt; &lt;dubbo:registry address=\"zookeeper://127.0.0.1:2181\"/&gt; &lt;!-- ç”Ÿæˆè¿œç¨‹æœåŠ¡ä»£ç†ï¼Œå¯ä»¥å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨demoService --&gt; &lt;dubbo:reference id=\"demoService\" check=\"false\" interface=\"com.alibaba.dubbo.demo.DemoService\"/&gt;&lt;/beans&gt; åŠ è½½Springé…ç½®ï¼Œå¹¶è°ƒç”¨è¿œç¨‹æœåŠ¡123456789101112131415161718192021222324package com.alibaba.dubbo.demo.consumer;import com.alibaba.dubbo.demo.DemoService;import org.springframework.context.support.ClassPathXmlApplicationContext;public class Consumer &#123; public static void main(String[] args) &#123; ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(new String[]&#123;\"META-INF/spring/dubbo-demo-consumer.xml\"&#125;); context.start(); DemoService demoService = (DemoService) context.getBean(\"demoService\"); // get remote service proxy while (true) &#123; try &#123; Thread.sleep(5000); String hello = demoService.sayHello(\"world\"); // call remote method System.out.println(hello); // get result &#125; catch (Throwable throwable) &#123; throwable.printStackTrace(); &#125; &#125; &#125;&#125; å°ç»“dubboè‡ªå®šä¹‰äº†å¾ˆå¤šçš„xmlæ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾æ˜¯æ€ä¹ˆå’Œpringèåˆçš„åœ¨springè‡ªå®šä¹‰æ ‡ç­¾ä¸­å·²ç»ä»‹ç»äº†å®ç°åŸç†ï¼Œåœ¨åé¢çš„dubboé…ç½®è§£æä¸­ä¼šç»§ç»­è¯´æ˜ã€‚æ›´å¤šæ›´èƒ½çš„é…ç½®å‚è€ƒï¼šé…ç½®å‚è€ƒæ‰‹å†Œ","categories":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/categories/rpc/"}],"tags":[{"name":"dubbo","slug":"dubbo","permalink":"https://gentryhuang.com/tags/dubbo/"},{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/tags/rpc/"}]},{"title":"dubboç¬¬ä¸€ä¾‹","slug":"rpc/Dubboç¬¬ä¸€ä¾‹","date":"2020-03-02T16:00:00.000Z","updated":"2020-08-04T12:14:10.054Z","comments":false,"path":"posts/f0ae64a/","link":"","permalink":"https://gentryhuang.com/posts/f0ae64a/","excerpt":"","text":"å¿«é€Ÿå¯åŠ¨ä½¿ç”¨APIçš„æ–¹å¼è¿›è¡Œå¯åŠ¨ã€è°ƒç”¨ã€‚API å±æ€§ä¸é…ç½®é¡¹ä¸€å¯¹ä¸€ï¼Œå„å±æ€§å«ä¹‰ï¼Œè¯·å‚è§ï¼šé…ç½®å‚è€ƒæ‰‹å†Œï¼Œæ¯”å¦‚ï¼šApplicationConfig.setName(â€œxxxâ€) å¯¹åº” &lt;dubbo:application name=â€xxxâ€ /&gt; å®šä¹‰æœåŠ¡æ¥å£1234567891011121314151617package com.code.resorce.api;/** * DemoService * * @author shunhua * @since 2020/03/03 * &lt;p&gt; * descï¼š */public interface DemoService &#123; /** * @return */ String hello();&#125; æœåŠ¡æä¾›æ–¹å®ç°æ¥å£123456789101112131415161718package com.code.resource.reading.api;import com.code.resorce.api.DemoService;/** * DemoServiceImpl * * @author shunhua * @since 2020/03/03 * &lt;p&gt; * descï¼š */public class DemoServiceImpl implements DemoService &#123; @Override public String hello() &#123; return \"hello world\"; &#125;&#125; ä½¿ç”¨APIé…ç½®å£°æ˜æš´éœ²æœåŠ¡123456789101112131415161718192021222324252627282930313233343536public class ServiceExport &#123; public static void main(String[] args) &#123; DemoService demoService = new DemoServiceImpl(); // å½“å‰åº”ç”¨é…ç½® ApplicationConfig application = new ApplicationConfig(); application.setName(\"app-api\"); // è¿æ¥æ³¨å†Œä¸­å¿ƒé…ç½® RegistryConfig registry = new RegistryConfig(); registry.setAddress(\"zookeeper://127.0.0.1:2181\"); registry.setUsername(\"aaa\"); registry.setPassword(\"bbb\"); // æœåŠ¡æä¾›è€…åè®®é…ç½® ProtocolConfig protocol = new ProtocolConfig(); protocol.setName(\"dubbo\"); protocol.setPort(20880); protocol.setThreads(200); // æ³¨æ„ï¼šServiceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œä»¥åŠå¼€å¯æœåŠ¡ç«¯å£ // æœåŠ¡æä¾›è€…æš´éœ²æœåŠ¡é…ç½® ServiceConfig&lt;DemoService&gt; service = new ServiceConfig&lt;&gt;(); // æ­¤å®ä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼ service.setApplication(application); service.setRegistry(registry); // å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries() service.setProtocol(protocol); // å¤šä¸ªåè®®å¯ä»¥ç”¨setProtocols() service.setInterface(DemoService.class); service.setRef(demoService); service.setVersion(\"1.0.0\"); // æš´éœ²åŠæ³¨å†ŒæœåŠ¡ service.export(); &#125;&#125; ä½¿ç”¨APIé…ç½®æœåŠ¡å¼•ç”¨1234567891011121314151617181920212223242526272829import org.apache.dubbo.rpc.config.ApplicationConfig;import org.apache.dubbo.rpc.config.RegistryConfig;import org.apache.dubbo.rpc.config.ConsumerConfig;import org.apache.dubbo.rpc.config.ReferenceConfig;import com.xxx.XxxService; // å½“å‰åº”ç”¨é…ç½®ApplicationConfig application = new ApplicationConfig();application.setName(\"app-api-consumer\"); // è¿æ¥æ³¨å†Œä¸­å¿ƒé…ç½®RegistryConfig registry = new RegistryConfig();registry.setAddress(\"zookeeper://127.0.0.1:2181\");registry.setUsername(\"aaa\");registry.setPassword(\"bbb\"); // æ³¨æ„ï¼šReferenceConfigä¸ºé‡å¯¹è±¡ï¼Œå†…éƒ¨å°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ï¼Œä»¥åŠä¸æœåŠ¡æä¾›æ–¹çš„è¿æ¥ // å¼•ç”¨è¿œç¨‹æœåŠ¡ReferenceConfig&lt;DemoService&gt; reference = new ReferenceConfig&lt;&gt;(); // æ­¤å®ä¾‹å¾ˆé‡ï¼Œå°è£…äº†ä¸æ³¨å†Œä¸­å¿ƒçš„è¿æ¥ä»¥åŠä¸æä¾›è€…çš„è¿æ¥ï¼Œè¯·è‡ªè¡Œç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½é€ æˆå†…å­˜å’Œè¿æ¥æ³„æ¼reference.setApplication(application);reference.setRegistry(registry); // å¤šä¸ªæ³¨å†Œä¸­å¿ƒå¯ä»¥ç”¨setRegistries()reference.setInterface(DemoService.class);reference.setVersion(\"1.0.0\"); // å’Œæœ¬åœ°beanä¸€æ ·ä½¿ç”¨xxxServiceDemoService demoService = reference.get(); // æ³¨æ„ï¼šæ­¤ä»£ç†å¯¹è±¡å†…éƒ¨å°è£…äº†æ‰€æœ‰é€šè®¯ç»†èŠ‚ï¼Œå¯¹è±¡è¾ƒé‡ï¼Œè¯·ç¼“å­˜å¤ç”¨// demoService è¿›è¡ŒæœåŠ¡è°ƒç”¨ å°ç»“APIçš„ä½¿ç”¨æ˜¯æœ‰èŒƒå›´çš„ï¼Œä»…ç”¨äº OpenAPI, ESB, Test, Mock ç­‰ç³»ç»Ÿé›†æˆï¼Œæ™®é€šæœåŠ¡æä¾›æ–¹æˆ–æ¶ˆè´¹æ–¹ï¼Œåº”è¯¥ä½¿ç”¨xmlæˆ–æ³¨è§£é…ç½®æ–¹å¼ã€‚","categories":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/categories/rpc/"}],"tags":[{"name":"dubbo","slug":"dubbo","permalink":"https://gentryhuang.com/tags/dubbo/"},{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/tags/rpc/"}]},{"title":"springè‡ªå®šä¹‰æ ‡ç­¾","slug":"rpc/Springè‡ªå®šä¹‰æ ‡ç­¾","date":"2020-03-01T16:00:00.000Z","updated":"2020-08-04T12:53:36.713Z","comments":false,"path":"posts/eee3e639/","link":"","permalink":"https://gentryhuang.com/posts/eee3e639/","excerpt":"","text":"springè‡ªå®šä¹‰æ ‡ç­¾springé™¤äº†å¾ˆå¤šå†…ç½®çš„xmlæ ‡ç­¾å¤–ï¼Œè¿˜æ”¯æŒè‡ªå®šä¹‰xmlæ ‡ç­¾ï¼Œå¼€å‘è€…åªéœ€è¦æŒ‰ç…§Springçš„çº¦å®šè§„åˆ™å°±å¯ä»¥å®ç°è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¿™æ ·å¼€å‘è€…å°±å¯ä»¥æŠŠè‡ªå®šä¹‰çš„Beanäº¤ç»™Springç®¡ç†ã€‚è‡ªå®šä¹‰æ ‡ç­¾åŒ…ç»“æ„å¦‚ä¸‹ï¼š è‡ªå®šä¹‰æ ‡ç­¾çš„è§„åˆ™ç¼–å†™æ¨¡å‹1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.code.resource.reading.xml.schema.model;/** * Hero * * @author shunhua * @since 2020/03/02 * &lt;p&gt; * descï¼š */public class Hero &#123; /** * name */ private String name; /** * age */ private int age; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; @Override public String toString() &#123; return \"Hero&#123;\" + \"name='\" + name + '\\'' + \", age=\" + age + '&#125;'; &#125;&#125; å®šä¹‰æ¨¡å‹çš„xsdæ–‡ä»¶12345678910111213141516171819202122232425262728293031&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;xsd:schema xmlns=\"http://gentryhuang.site/schema/people\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" targetNamespace=\"http://gentryhuang.com/schema/people\"&gt; &lt;!-- å®šä¹‰å…ƒç´ çš„å¤æ‚ç±»å‹ --&gt; &lt;xsd:complexType name=\"elementComplexType\"&gt; &lt;!-- å®šä¹‰æ¨¡å‹ç±»ä¸­çš„å±æ€§ --&gt; &lt;xsd:attribute name=\"name\" type=\"xsd:string\"&gt; &lt;xsd:annotation&gt; &lt;xsd:documentation&gt;&lt;![CDATA[ The element name. ]]&gt;&lt;/xsd:documentation&gt; &lt;/xsd:annotation&gt; &lt;/xsd:attribute&gt; &lt;xsd:attribute name=\"age\" type=\"xsd:int\"&gt; &lt;xsd:annotation&gt; &lt;xsd:documentation&gt;&lt;![CDATA[ The element age. ]]&gt;&lt;/xsd:documentation&gt; &lt;/xsd:annotation&gt; &lt;/xsd:attribute&gt; &lt;/xsd:complexType&gt; &lt;!-- å®šä¹‰åœ¨xmlæ–‡ä»¶ä¸­ç”¨åˆ°çš„å…ƒç´ åç§° --&gt; &lt;xsd:element name=\"hero\" type=\"elementComplexType\"&gt; &lt;xsd:annotation&gt; &lt;xsd:documentation&gt;&lt;![CDATA[ å®šä¹‰æ ‡ç­¾ ]]&gt;&lt;/xsd:documentation&gt; &lt;/xsd:annotation&gt; &lt;/xsd:element&gt;&lt;/xsd:schema&gt; è¯´æ˜: è¯¥æ–‡ä»¶è¦æ”¾åœ¨ resourcesçš„META-INFç›®å½•ä¸‹ã€‚è¯¥æ–‡ä»¶æ˜¯ç”¨æ¥çº¦æŸä½¿ç”¨xmlé…ç½®æ—¶çš„æ ‡ç­¾å’Œå¯¹åº”çš„å±æ€§ã€‚ ç¼–å†™spring.schemasæ–‡ä»¶1http\\:&#x2F;&#x2F;gentryhuang.com&#x2F;schema&#x2F;people&#x2F;hero.xsd&#x3D;META-INF&#x2F;hero.xsd è¯´æ˜: http://gentryhuang.com/schema/people å°±æ˜¯æ¨¡å‹å¯¹åº”çš„xsdä¸­çš„targetNamespaceçš„å€¼ï¼Œå®ƒæŒ‡å®šäº†çº¦æŸæ–‡ä»¶çš„å…·ä½“è·¯å¾„ã€‚ ç¼–å†™BeanDefinitionParser12345678910111213141516171819202122232425262728293031323334353637383940414243package com.code.resource.reading.xml.schema;import org.springframework.beans.factory.config.BeanDefinition;import org.springframework.beans.factory.support.BeanDefinitionRegistry;import org.springframework.beans.factory.support.RootBeanDefinition;import org.springframework.beans.factory.xml.BeanDefinitionParser;import org.springframework.beans.factory.xml.ParserContext;import org.w3c.dom.Element;/** * HeroBeanDefinitionParser * * @author shunhua * @since 2020/03/02 * &lt;p&gt; * descï¼š */public class HeroBeanDefinitionParser implements BeanDefinitionParser &#123; /** * æ ‡ç­¾å¯¹åº”çš„ç±» */ private final Class&lt;?&gt; beanClass; public HeroBeanDefinitionParser(Class&lt;?&gt; beanClass) &#123; this.beanClass = beanClass; &#125; @Override public BeanDefinition parse(Element element, ParserContext parserContext) &#123; RootBeanDefinition beanDefinition = new RootBeanDefinition(); beanDefinition.setBeanClass(beanClass); beanDefinition.setLazyInit(false); beanDefinition.getPropertyValues().add(\"name\",element.getAttribute(\"name\")); beanDefinition.getPropertyValues().add(\"age\",element.getAttribute(\"age\")); // è·å–Beanå®šä¹‰æ³¨å†Œè¡¨ BeanDefinitionRegistry registry = parserContext.getRegistry(); // æ³¨å†ŒBean registry.registerBeanDefinition(\"hero\",beanDefinition); return beanDefinition; &#125;&#125; è¯´æ˜: ç”¨æ¥è§£æè‡ªå®šä¹‰çš„xmlæ ‡ç­¾ ç¼–å†™å‘½åç©ºé—´å¤„ç†å™¨123456789101112131415161718192021222324package com.code.resource.reading.xml.schema;import com.code.resource.reading.xml.schema.model.Hero;import org.springframework.beans.factory.xml.NamespaceHandlerSupport;/** * HeroNamespaceHandler * * @author shunhua * @since 2020/03/02 * &lt;p&gt; * descï¼š */public class HeroNamespaceHandler extends NamespaceHandlerSupport &#123; /** * å®šä¹‰äº†&lt;xsd:element/&gt;å¯¹åº”çš„BeanDefinitionParser */ @Override public void init() &#123; registerBeanDefinitionParser(\"hero\",new HeroBeanDefinitionParser(Hero.class)); &#125;&#125; è¯´æ˜:ä¸€èˆ¬æƒ…å†µä¸‹ ä¸€ä¸ª&lt;xsd:element/&gt; å¯¹åº”ä¸€ä¸ªBeanDefinitionParser ç¼–å†™spring.handlersæ–‡ä»¶1http\\:&#x2F;&#x2F;gentryhuang.com&#x2F;schema&#x2F;people&#x3D;com.code.resource.reading.xml.schema.HeroNamespaceHandler è¯´æ˜: è¿™æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ï¼Œkeyæ˜¯xsdæ–‡ä»¶ä¸­çš„ targetNamespaceï¼Œè¯¥æ–‡ä»¶æŒ‡æ˜äº†ä½¿ç”¨å“ªä¸ªç±»æ¥è§£æè‡ªå®šä¹‰çš„æ ‡ç­¾ã€‚ ä½¿ç”¨springçš„è‡ªå®šä¹‰æ ‡ç­¾12345678910111213141516&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:people=\"http://gentryhuang.com/schema/people\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://gentryhuang.com/schema/people http://gentryhuang.com/schema/people/hero.xsd\"&gt; &lt;!-- 1 xmlns:peopleçš„å€¼æ˜¯xsdæ–‡ä»¶ä¸­çš„targetNamespace 2 xmlns:hero å¯ä»¥å†™æˆxmlns:xxx,æ­¤æ—¶æ ‡ç­¾å‰ç¼€ä¹Ÿè¦æ˜¯ &lt;xxx:hero/&gt; --&gt; &lt;people:hero name=\"hlb\" age=\"18\"/&gt;&lt;/beans&gt; æµ‹è¯•123456789101112131415161718192021package com.code.resource.reading.xml.schema;import com.code.resource.reading.xml.schema.model.Hero;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;/** * Client * * @author shunhua * @since 2020/03/02 * &lt;p&gt; * descï¼š */public class Client &#123; public static void main(String[] args) &#123; ApplicationContext applicationContext = new ClassPathXmlApplicationContext(\"hero.xml\"); Hero hero = (Hero) applicationContext.getBean(\"hero\"); System.out.println(hero); &#125;&#125; å°ç»“springåœ¨è§£æåˆ°è‡ªå®šä¹‰çš„namespaceæ ‡ç­¾æ—¶ï¼Œæ¯”å¦‚ &lt;people:hero /&gt;ï¼Œä¼šæŸ¥æ‰¾å¯¹åº”çš„spring.schemaså’Œspring.handlersæ–‡ä»¶ï¼Œé€šè¿‡spring.schemasæ–‡ä»¶ç¡®å®šéœ€è¦åŠ è½½çš„æ ‡ç­¾åŠå±æ€§ï¼Œç„¶åä¼šè§¦å‘spring.handlersæ–‡ä»¶ä¸­æŒ‡å®šçš„ç±»æ¥è¿›è¡Œåˆå§‹åŒ–å’Œè§£æã€‚","categories":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/categories/rpc/"}],"tags":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/tags/rpc/"},{"name":"spring","slug":"spring","permalink":"https://gentryhuang.com/tags/spring/"}]},{"title":"åˆè¯†rpc","slug":"rpc/åˆè¯†RPC","date":"2020-02-29T16:00:00.000Z","updated":"2020-08-04T12:14:10.056Z","comments":false,"path":"posts/626d9676/","link":"","permalink":"https://gentryhuang.com/posts/626d9676/","excerpt":"","text":"åŸºæœ¬æ¦‚å¿µRPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªèŠ‚ç‚¹è¯·æ±‚å¦ä¸€ä¸ªèŠ‚ç‚¹æä¾›çš„æœåŠ¡ã€‚è¯·æ±‚æ–¹æ²¡æœ‰æœåŠ¡å®ç°çš„ç»†èŠ‚ï¼Œæ‰§è¡Œç›®æ ‡è¡Œä¸ºè¿˜æ˜¯æœåŠ¡æä¾›çš„èŠ‚ç‚¹ã€‚è¯·æ±‚æœåŠ¡çš„èŠ‚ç‚¹å’ŒæœåŠ¡æä¾›çš„èŠ‚ç‚¹ä»¥æŸç§æ–¹å¼è¿›è¡Œé€šä¿¡ï¼Œè¯·æ±‚æ–¹æŠŠè¡Œä¸ºåŠè¡Œä¸ºå‚æ•°ä¼ é€’ç»™æœåŠ¡æä¾›æ–¹ï¼ŒæœåŠ¡æä¾›æ–¹ä¼šæ ¹æ®è¯·æ±‚æ–¹ä¼ é€’çš„æ•°æ®æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡å®ç°ç„¶åæ‰§è¡Œç›®æ ‡è¡Œä¸ºï¼Œæœ€åå†æŠŠæ‰§è¡Œç»“æœè¿”å›ç»™è¯·æ±‚æ–¹ã€‚ æœ¬åœ°è¿‡ç¨‹è°ƒç”¨å‘èµ·è¯·æ±‚å’Œå“åº”ç»“æœéƒ½åœ¨åŒä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹ä¸Šï¼Œåœ¨Javaä¸­å°±æ˜¯åŒä¸€ä¸ªJVMä¸­çš„æ–¹æ³•è°ƒç”¨è¿‡ç¨‹ã€‚ è¿œç¨‹è¿‡ç¨‹è°ƒç”¨è¯·æ±‚çš„å‘èµ·è€…å’Œè¯·æ±‚çš„å¤„ç†è€…ä¸åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå®ƒä»¬ä¹‹é—´éœ€è¦è¿›è¡Œç½‘ç»œé€šä¿¡æ‰èƒ½å®Œæˆè¯·æ±‚å’Œå“åº”ã€‚ ç®€å•RPCå®ç°è¯´æ˜: ä¾‹å­æ˜¯ä½¿ç”¨æ¢é£å¤§ä½¬çš„ æŠ€æœ¯åšå®¢ ä¸­çš„æ¡ˆä¾‹ æœåŠ¡æ¥å£åŠå®ç°12345678910111213141516171819202122232425262728293031package com.alibaba.study.rpc.service;/** * HelloService */public interface HelloService &#123; /** * æœåŠ¡æ–¹æ³• * * @param name * @return */ String hello(String name);&#125;---package com.alibaba.study.rpc.service.impl;import com.alibaba.study.rpc.service.HelloService;/** * HelloServiceImpl */public class HelloServiceImpl implements HelloService &#123; @Override public String hello(String name) &#123; return \"Hello \" + name; &#125;&#125; RPCæ¡†æ¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177package com.alibaba.study.rpc.framework;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.net.ServerSocket;import java.net.Socket;/** * RpcFramework */public class RpcFramework &#123; /** * æš´éœ²æœåŠ¡ * * @param service æœåŠ¡å®ç° * @param port æœåŠ¡ç«¯å£ * @throws Exception */ public static void export(final Object service, int port) throws Exception &#123; if (service == null) &#123; throw new IllegalArgumentException(\"service instance == null\"); &#125; if (port &lt;= 0 || port &gt; 65535) &#123; throw new IllegalArgumentException(\"Invalid port \" + port); &#125; System.out.println(\"Export service \" + service.getClass().getName() + \" on port \" + port); // ä»¥æŒ‡å®šç«¯å£åˆ›å»ºServerSocket ServerSocket server = new ServerSocket(port); for (; ; ) &#123; try &#123; // ç­‰å¾…æ¥æ”¶è¯·æ±‚ final Socket socket = server.accept(); new Thread(new Runnable() &#123; @Override public void run() &#123; try &#123; try &#123; // è·å–è¯·æ±‚çš„æ•°æ®æµ ObjectInputStream input = new ObjectInputStream(socket.getInputStream()); try &#123; // è·å–å®¢æˆ·ç«¯è¯·æ±‚çš„æ–¹æ³•å String methodName = input.readUTF(); // è·å–å®¢æˆ·ç«¯è¯·æ±‚çš„å‚æ•°ç±»å‹åˆ—è¡¨ Class&lt;?&gt;[] parameterTypes = (Class&lt;?&gt;[]) input.readObject(); // è·å–å®¢æˆ·ç«¯è¯·æ±‚çš„å‚æ•°åˆ—è¡¨ Object[] arguments = (Object[]) input.readObject(); // åˆ›å»ºå¯¹è±¡è¾“å‡ºæµå¯¹è±¡ï¼Œç”¨äºå“åº”ç»“æœç»™å®¢æˆ·ç«¯ ObjectOutputStream output = new ObjectOutputStream(socket.getOutputStream()); try &#123; // é€šè¿‡åå°„ï¼Œè·å–æœåŠ¡æ¥å£æŒ‡å®šçš„æ–¹æ³• Method method = service.getClass().getMethod(methodName, parameterTypes); // åå°„è°ƒç”¨ Object result = method.invoke(service, arguments); // å°†ç»“æœå“åº”ç»™å®¢æˆ·ç«¯ output.writeObject(result); &#125; catch (Throwable t) &#123; output.writeObject(t); &#125; finally &#123; output.close(); &#125; &#125; finally &#123; input.close(); &#125; &#125; finally &#123; socket.close(); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125;).start(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; /** * å¼•ç”¨æœåŠ¡ * * @param &lt;T&gt; æ¥å£æ³›å‹ * @param interfaceClass æ¥å£ç±»å‹ * @param host æœåŠ¡å™¨ä¸»æœºå * @param port æœåŠ¡å™¨ç«¯å£ * @return è¿œç¨‹æœåŠ¡ * @throws Exception */ @SuppressWarnings(\"unchecked\") public static &lt;T&gt; T refer(final Class&lt;T&gt; interfaceClass, final String host, final int port) throws Exception &#123; if (interfaceClass == null) &#123; throw new IllegalArgumentException(\"Interface class == null\"); &#125; if (!interfaceClass.isInterface()) &#123; throw new IllegalArgumentException(\"The \" + interfaceClass.getName() + \" must be interface class!\"); &#125; if (host == null || host.length() == 0) &#123; throw new IllegalArgumentException(\"Host == null!\"); &#125; if (port &lt;= 0 || port &gt; 65535) &#123; throw new IllegalArgumentException(\"Invalid port \" + port); &#125; System.out.println(\"Get remote service \" + interfaceClass.getName() + \" from server \" + host + \":\" + port); /** * ä½¿ç”¨JDKçš„åŠ¨æ€ä»£ç†åˆ›å»ºæ¥å£çš„ä»£ç†å¯¹è±¡ * è¯´æ˜ï¼š * åœ¨ InvocationHandler#invokeæ–¹æ³•å†…éƒ¨å®ç°Socketä¸ServerSocketçš„é€šä¿¡ã€‚å½“ä½¿ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå†…éƒ¨ä½¿ç”¨Socketè¿›è¡Œé€šä¿¡ï¼Œç„¶åæŠŠé€šä¿¡çš„ç»“æœè¿”å›ã€‚ */ return (T) Proxy.newProxyInstance( interfaceClass.getClassLoader(), new Class&lt;?&gt;[]&#123;interfaceClass&#125;, new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] arguments) throws Throwable &#123; // åˆ›å»ºSocketï¼Œç”¨äºè¿æ¥ServerSocket Socket socket = new Socket(host, port); try &#123; // åˆ›å»ºç”¨äºå‘é€æ•°æ®åˆ°ServerSocketçš„è¾“å‡ºæµ ObjectOutputStream output = new ObjectOutputStream(socket.getOutputStream()); try &#123; //--------------------- æ•°æ®å¥‘çº¦ ----------------------------/ // æ–¹æ³•å output.writeUTF(method.getName()); // å‚æ•°ç±»å‹ output.writeObject(method.getParameterTypes()); // å‚æ•°å€¼ output.writeObject(arguments); //------------------------ æ•°æ®å¥‘çº¦ --------------------------/ // åˆ›å»ºç”¨äºæ¥æ”¶ServerSocketçš„è¾“å…¥æµ ObjectInputStream input = new ObjectInputStream(socket.getInputStream()); try &#123; // è¯»å–ServerSocketå“åº”çš„æ•°æ® Object result = input.readObject(); if (result instanceof Throwable) &#123; throw (Throwable) result; &#125; // è¿”å›ç»“æœ return result; &#125; finally &#123; input.close(); &#125; &#125; finally &#123; output.close(); &#125; &#125; finally &#123; socket.close(); &#125; &#125; &#125;); &#125;&#125; æœåŠ¡æš´éœ²1234567891011121314151617package com.alibaba.study.rpc.provider;import com.alibaba.study.rpc.framework.RpcFramework;import com.alibaba.study.rpc.service.HelloService;import com.alibaba.study.rpc.service.impl.HelloServiceImpl;/** * RpcProvider */public class RpcProvider &#123; public static void main(String[] args) throws Exception &#123; // æœåŠ¡å®ç° HelloService service = new HelloServiceImpl(); // æš´éœ²æœåŠ¡ RpcFramework.export(service, 1234); &#125;&#125; å¼•ç”¨æœåŠ¡1234567891011121314151617181920package com.alibaba.study.rpc.consumer;import com.alibaba.study.rpc.framework.RpcFramework;import com.alibaba.study.rpc.service.HelloService;/** * RpcConsumer */public class RpcConsumer &#123; public static void main(String[] args) throws Exception &#123; // å¼•ç”¨æœåŠ¡ã€ä»£ç†å¯¹è±¡ã€‘ HelloService service = RpcFramework.refer(HelloService.class, \"127.0.0.1\", 1234); while (true) &#123; String hello = service.hello(\"World\"); System.out.println(hello); Thread.sleep(1000); &#125; &#125;&#125; å°ç»“è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€šä¿¡æ˜¯ä½¿ç”¨åŒæ­¥é˜»å¡çš„Socketæ¥å®ç°çš„ï¼Œé‡‡ç”¨ç«¯å¯¹ç«¯çš„æ–¹å¼ã€‚è¿œç¨‹è°ƒç”¨ä½¿ç”¨çš„æ˜¯JDKçš„åŠ¨æ€ä»£ç†ï¼Œåœ¨invokeæ–¹æ³•ä¸­å®ç°ç½‘ç»œé€šä¿¡ã€‚å‚æ•°åºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯JDKçš„ObjectStreamã€‚ä¸€ä¸ªå®Œå–„çš„RPCæ¡†æ¶å…¶å®å°±æ˜¯åœ¨è¿™ä¾‹å­çš„åŸºç¡€ä¸Šè¿›è¡Œå¤šæ–¹ä½æ‰©å±•å’Œæ”¹è¿›ã€‚æ¯”å¦‚ï¼Œç½‘ç»œé€šä¿¡å¯ä»¥ä½¿ç”¨æ€§èƒ½æ›´å¥½çš„NIOæ¡†æ¶Nettyï¼ŒåŠ¨æ€ä»£ç†å¯ä»¥ä½¿ç”¨javaassistå­—èŠ‚ç ç”Ÿæˆæ–¹å¼[æ³¨æ„ï¼šä¸æ˜¯javaassistæä¾›çš„åŠ¨æ€ä»£ç†æ¥å£ï¼Œè¯¥æ¥å£æ¯”JDKè‡ªå¸¦çš„è¿˜æ…¢]ï¼Œåºåˆ—åŒ–æ–¹å¼å¯ä»¥é‡‡ç”¨fastjsonã€hession2ä»¥åŠkryoç­‰æŠ€æœ¯ã€‚å¦‚æœæœåŠ¡æ•°é‡è¾¾åˆ°ä¸€å®šè§„æ¨¡ï¼Œå¯ä»¥å¼•è¿›æ³¨å†Œä¸­å¿ƒè¿›è¡ŒæœåŠ¡çš„æ²»ç†ã€‚èŠ‚ç‚¹é—´çš„é€šä¿¡æ–¹å¼å¯ä»¥æœ‰å¤šç§ï¼Œå› æ­¤å¯ä»¥æ‰©å±•å¤šåè®®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæ€§èƒ½å’Œå¥å£®æ€§ä¹Ÿæ˜¯ä¸€ä¸ªä¼˜ç§€çš„RPCæ¡†æ¶æ‰€å¿…é¡»çš„ï¼Œå¦‚é›†ç¾¤å®¹é”™ã€è´Ÿè½½å‡è¡¡ã€é‡è¯•æœºåˆ¶ã€æœåŠ¡é™çº§â€¦è¿™äº›éƒ½ä¼šåœ¨åé¢åˆ†æçš„Dubboæ¡†æ¶ä¸­å¾—åˆ°å¾ˆå¥½çš„ä½“ç°ã€‚","categories":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/categories/rpc/"}],"tags":[{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/tags/rpc/"}]},{"title":"å‘½ä»¤æ¨¡å¼","slug":"design_pattern/behaviour_type/å‘½ä»¤æ¨¡å¼","date":"2019-10-04T16:00:00.000Z","updated":"2020-07-05T04:13:10.181Z","comments":true,"path":"posts/78134e07/","link":"","permalink":"https://gentryhuang.com/posts/78134e07/","excerpt":"","text":"å®šä¹‰å‘½ä»¤æ¨¡å¼åˆå«æŒ‡ä»¤æ¨¡å¼ï¼Œæ˜¯å°†â€œè¯·æ±‚â€å°è£…æˆå¯¹è±¡ï¼Œä»¥ä¾¿ä½¿ç”¨ä¸åŒçš„è¯·æ±‚ã€‚æˆ‘ä»¬å¯ä»¥æŠŠä¸åŒçš„è¯·æ±‚å°è£…æˆä¸åŒè¯·æ±‚å¯¹è±¡ï¼Œå¯¹äºæ¥æ”¶è€…æ¥è¯´è¿™äº›ç±»å‹éƒ½èƒ½è¯†åˆ«ï¼Œç„¶åæ ¹æ®ä¸åŒçš„è¯·æ±‚å¯¹è±¡æ‰§è¡Œä¸åŒçš„è¡Œä¸ºã€‚ è¯´æ˜å‘½ä»¤æ¨¡å¼è§£å†³äº†åº”ç”¨ç¨‹åºä¸­å¯¹è±¡çš„èŒè´£ä»¥åŠå®ƒä»¬ä¹‹é—´çš„é€šä¿¡æ–¹å¼ï¼Œå‘½ä»¤æ¨¡å¼å¯ä»¥ä½¿å‘½ä»¤å‘é€è€…å’Œæ¥æ”¶è€…å®Œå…¨è§£è€¦ï¼Œå‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´æ²¡æœ‰ç›´æ¥çš„å¼•ç”¨å…³ç³»ã€‚å‘é€å‘½ä»¤çš„å¯¹è±¡åªçŸ¥é“å¦‚ä½•ä¸‹å‘½ä»¤ï¼Œä¸éœ€è¦çŸ¥é“å¦‚ä½•å®Œæˆå‘½ä»¤ã€‚ ç±»å‹è¡Œä¸ºå‹ ä½¿ç”¨åœºæ™¯121. è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…éœ€è¦è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’2. éœ€è¦æŠ½è±¡å‡ºç­‰å¾…æ‰§è¡Œçš„è¡Œä¸º ä¼˜ç‚¹1231. é™ä½è€¦åˆ - é€šè¿‡å‘½ä»¤æ¨¡å¼æŠŠè¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„æ¥æ”¶è€…è¿›è¡Œè§£è€¦2. å®¹æ˜“æ‰©å±•æ–°å‘½ä»¤æˆ–è€…ä¸€ç»„å‘½ä»¤ ç¼ºç‚¹12å‘½ä»¤çš„æ— é™æ‰©å±•ä¼šå¢åŠ ç±»çš„æ•°é‡ï¼Œæé«˜ç³»ç»Ÿå®ç°å¤æ‚åº¦ - é’ˆå¯¹æ¯ä¸€ä¸ªå‘½ä»¤æˆ‘ä»¬éƒ½è¦è®¾è®¡å¹¶å¼€å‘ä¸€ä¸ªå…·ä½“çš„å‘½ä»¤ç±» ç›¸å…³çš„è®¾è®¡æ¨¡å¼å‘½ä»¤æ¨¡å¼å’Œå¤‡å¿˜å½•æ¨¡å¼ 1å¯ä»¥æŠŠä¸¤è€…ç»“åˆä½¿ç”¨ï¼Œä½¿ç”¨å¤‡å¿˜å½•æ¨¡å¼ä¿å­˜å‘½ä»¤çš„å†å²è®°å½•ï¼Œè¿™æ ·å¯ä»¥è°ƒç”¨ä¹‹å‰çš„å‘½ä»¤ ç®€å•éœ€æ±‚ä¸€åˆ›ä¸šå…¬å¸ä¸ºäº†æŠ¢å å¸‚åœºï¼Œè€æ¿å¯¹å¼€å‘éƒ¨å‰åä¸‹è¾¾äº†ä¸¤ä¸ªå‘½ä»¤ï¼Œå…ˆä½¿ç”¨å•ä¾‹æ¶æ„å¿«é€Ÿå¼€å‘å‡ºäº§å“ï¼Œç­‰åˆ°æŠ¢å äº†å¸‚åœºåå†æ‰©å¤§è§„æ¨¡æŠŠå•ä½“ç»“æ„æ‹†æˆå¾®æœåŠ¡æ¶æ„ã€‚ å‘½ä»¤æ¨¡å¼æ¼”ç»ƒ æŠŠå‘½ä»¤æŠ½è±¡æˆå¯¹è±¡ï¼Œè¿™æ˜¯å‘½ä»¤æ¨¡å¼å®ç°çš„æ ¸å¿ƒ 1å‘½ä»¤æ‰©å±•å¾ˆå®¹æ˜“ï¼Œå¢åŠ å‘½ä»¤åªéœ€å°è£…ä¸€ä¸ªå‘½ä»¤ç±»ã€‚å¦‚æœæœ‰å‘½ä»¤è¡Œä¸ºä½“æ ¹æ®æƒ…å†µä¿®æ”¹å‘½ä»¤è¡Œä¸ºä½“ã€‚ å‘½ä»¤è¡Œä¸ºä½“ 1æ¯ä¸ªå‘½ä»¤æ‰§è¡Œçš„å…·ä½“è¡Œä¸ºåœ¨è¡Œä¸ºä½“ä¸­ï¼Œä½†ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥ä¸è¦è¡Œä¸ºä½“ï¼Œè®©å‘½ä»¤æ‰§è¡Œå˜å¾—æ›´çµæ´»ã€‚ 123456789101112131415161718192021222324252627282930313233343536package com.design.pattern.command;import lombok.extern.slf4j.Slf4j;/** * Project é¡¹ç›® * * @author shunhua * @date 2019-10-04 */@Slf4jpublic class Project &#123; /** * é¡¹ç›®åç§° */ private String name; public Project(String name)&#123; this.name = name; &#125; /** * ä½¿ç”¨å•ä½“æ¶æ„å¼€å‘é¡¹ç›® */ public void monomer()&#123; log.info(String.format(\"%sé¡¹ç›®ä½¿ç”¨å•ä½“æ¶æ„å¼€å‘\",this.name)); &#125; /** * ä½¿ç”¨å¾®æœåŠ¡æ¶æ„å¼€å‘é¡¹ç›® */ public void microservice()&#123; log.info(String.format(\"%sé¡¹ç›®ä½¿ç”¨å¾®æœåŠ¡æ¶æ„å¼€å‘\",this.name)); &#125;&#125; å‘½ä»¤æ¥å£ 1234567891011121314package com.design.pattern.command;/** * Command å‘½ä»¤æ¥å£ * * @author shunhua * @date 2019-10-04 */public interface Command &#123; /** * æ‰§è¡Œå‘½ä»¤ */ void execute();&#125; å•ä½“æ¶æ„å¼€å‘å‘½ä»¤ 123456789101112131415161718192021222324252627282930package com.design.pattern.command;/** * MonomerCommand å•ä½“æ¶æ„å¼€å‘å‘½ä»¤ç±»ï¼Œæ‰§è¡Œçš„æ˜¯å•ä½“æ¶æ„å¼€å‘ * * @author shunhua * @date 2019-10-04 */public class MonomerCommand implements Command &#123; /** * ç»„åˆï¼Œå‘½ä»¤å¯¹åº”çš„è¡Œä¸ºä½“ (éå¿…é¡»çš„ï¼Œå‘½ä»¤çš„è¡Œä¸ºå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡ç¼–å†™) */ private Project project; /** * æ„é€ æ–¹æ³• * @param project */ public MonomerCommand(Project project)&#123; this.project = project; &#125; /** * æ‰§è¡Œå‘½ä»¤ */ @Override public void execute() &#123; project.monomer(); &#125;&#125; å¾®æœåŠ¡æ¶æ„å¼€å‘å‘½ä»¤ 12345678910111213141516171819202122232425262728293031package com.design.pattern.command;/** * MicroserviceCommand å¾®æœåŠ¡æ¶æ„å¼€å‘å‘½ä»¤ç±»ï¼Œæ‰§è¡Œçš„æ˜¯å¾®æœåŠ¡æ¶æ„å¼€å‘ * * @author shunhua * @date 2019-10-04 */public class MicroserviceCommand implements Command &#123; /** * ç»„åˆï¼Œå‘½ä»¤å¯¹åº”çš„è¡Œä¸ºä½“ (éå¿…é¡»çš„ï¼Œå‘½ä»¤çš„è¡Œä¸ºå¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡ç¼–å†™) */ private Project project; /** * æ„é€ æ–¹æ³• * @param project */ public MicroserviceCommand(Project project)&#123; this.project = project; &#125; /** * æ‰§è¡Œå‘½ä»¤ */ @Override public void execute() &#123; project.microservice(); &#125;&#125; å‘½ä»¤æ¥æ”¶è€… 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package com.design.pattern.command;import java.util.ArrayList;import java.util.List;/** * Staff å‘½ä»¤æ‰§è¡Œè€… * * @author shunhua * @date 2019-10-04 */public class Staff &#123; /** * å‘½ä»¤é›†åˆï¼Œå¯ä»¥æ¥æ”¶å¤šä¸ªå‘½ä»¤ */ private List&lt;Command&gt; commands = new ArrayList&lt;&gt;(); /** * æ¥æ”¶å‘½ä»¤ * @param command */ public void addCommand(Command command)&#123; commands.add(command); &#125; /** * ç§»é™¤å‘½ä»¤ * @param command */ public void removeCommand(Command command)&#123; commands.remove(command); &#125; /** * æ‰§è¡ŒæŒ‡å®šçš„å * @param command */ public void execureCommand(Command command)&#123; command.execute(); &#125; /** * æ‰§è¡Œå‘½ä»¤é›† */ public void executeCommandList()&#123; this.commands.stream().forEach(Command::execute); commands.clear(); &#125;&#125; åº”ç”¨å±‚ 1234567891011121314151617181920212223242526272829303132333435363738package com.design.pattern.command;import org.junit.Test;/** * Boss å‘½ä»¤çš„ä¸‹è¾¾è€… * * @author shunhua * @date 2019-10-04 */public class Boss &#123; @Test public void test() throws InterruptedException &#123; // åˆ›å»ºå‘½ä»¤çš„è¡Œä¸ºä½“ Project projectDevelopment = new Project(\"å¸¦ä½ é£\"); // åˆ›å»ºå‘½ä»¤å¯¹è±¡(è€æ¿ä¸‹è¾¾å‘½ä»¤) MicroserviceCommand microserviceCommand = new MicroserviceCommand(projectDevelopment); MonomerCommand monomerCommand = new MonomerCommand(projectDevelopment); System.out.println(\"//-----------------------åˆ†åˆ«æ‰§è¡Œå‘½ä»¤---------------------------/\"); // å‘˜å·¥æ¥æ”¶å¹¶æ‰§è¡Œå‘½ä»¤ Staff staff = new Staff(); staff.execureCommand(microserviceCommand); staff.execureCommand(monomerCommand); Thread.sleep(2000); System.out.println(\"//-----------------------ç»Ÿä¸€æ‰§è¡Œå‘½ä»¤é›†-------------------------/\"); // å‘˜å·¥æ¥æ”¶å¤šä¸ªå‘½ä»¤,ç»Ÿä¸€æ‰§è¡Œ staff.addCommand(microserviceCommand); staff.addCommand(monomerCommand); staff.executeCommandList(); &#125;&#125; å‘½ä»¤æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨Runnableæ¥å£çš„å®ç°ç±» 1Runnableå¯ä»¥çœ‹æˆä¸€ä¸ªæŠ½è±¡çš„å‘½ä»¤ï¼Œå®ƒçš„å®ç°å¯ä»¥ç†è§£ä¸ºå…·ä½“çš„å‘½ä»¤å®ç°","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"çŠ¶æ€æ¨¡å¼","slug":"design_pattern/behaviour_type/çŠ¶æ€æ¨¡å¼","date":"2019-10-04T16:00:00.000Z","updated":"2020-07-04T16:28:45.956Z","comments":true,"path":"posts/8acb1976/","link":"","permalink":"https://gentryhuang.com/posts/8acb1976/","excerpt":"","text":"å®šä¹‰å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¦‚æœè¡Œä¸ºä¸éœ€è¦æ”¹å˜å°±ä¸è¦æ”¹å˜ã€‚ä¸€èˆ¬è¿™ä¸ªå­˜åœ¨å¤šä¸ªçŠ¶æ€çš„å¯¹è±¡æ˜¯ä¸€ä¸ªâ€œä¸Šä¸‹æ–‡â€ã€‚ ç±»å‹è¡Œä¸ºå‹ ä½¿ç”¨åœºæ™¯1ä¸€ä¸ªå¯¹è±¡å­˜åœ¨å¤šä¸ªçŠ¶æ€ï¼ˆä¸åŒçŠ¶æ€ä¸‹è¡Œä¸ºä¸åŒï¼‰ï¼Œä¸”çŠ¶æ€å¯ç›¸äº’è½¬æ¢ ä¼˜ç‚¹12341. å°†ä¸åŒçš„çŠ¶æ€éš”ç¦» - æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ä¸€ä¸ªç±»2. æŠŠå„ç§çŠ¶æ€çš„è½¬æ¢é€»è¾‘åˆ†å¸ƒåˆ°Stateçš„å­ç±»ä¸­ï¼Œå‡å°‘ç›¸äº’é—´ä¾èµ– 3. å¢åŠ æ–°çš„çŠ¶æ€éå¸¸ç®€å•ï¼ˆä¹Ÿå°±å¢åŠ ä¸€ä¸ªçŠ¶æ€ç±»ï¼Œå¦‚æœè¿˜è¦æ»¡è¶³ç›¸äº’è½¬æ¢ï¼Œå…¶ä»–å·²æœ‰çš„çŠ¶æ€å†…éƒ¨ä¹Ÿéœ€è¦ä¿®æ”¹ï¼‰ ç¼ºç‚¹1çŠ¶æ€å¤šçš„ä¸šåŠ¡åœºæ™¯å¯¼è‡´ç±»æ•°ç›®å¢åŠ ï¼Œç³»ç»Ÿå˜å¾—å¤æ‚ ç›¸å…³çš„è®¾è®¡æ¨¡å¼çŠ¶æ€æ¨¡å¼å’Œäº«å…ƒæ¨¡å¼ 1å®ƒä»¬æœ‰æ—¶å¯ä»¥é…åˆä½¿ç”¨ ç®€å•éœ€æ±‚æ’­æ”¾è§†é¢‘çš„æ—¶å€™ï¼Œæœ‰æ’­æ”¾çŠ¶æ€ã€å¿«è¿›æ’­æ”¾çŠ¶æ€ã€æš‚åœçŠ¶æ€ä»¥åŠåœæ­¢çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€å¤§éƒ½å¯ä»¥ç›¸äº’è½¬æ¢ã€‚å½“çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶å¯¹åº”çš„æ’­æ”¾è¡Œä¸ºä¹Ÿå‘ç”Ÿäº†æ”¹å˜ã€‚ çŠ¶æ€çˆ¶ç±» 1234567891011121314151617181920212223242526272829303132333435363738package com.design.pattern.state;import lombok.Setter;/** * VideoState è§†é¢‘çŠ¶æ€ * * @author shunhua * @date 2019-10-05 */@Setterpublic abstract class VideoState &#123; /** * è§†é¢‘èµ„æºä¸Šä¸‹æ–‡ */ protected VideoContext videoContext; /** * æ’­æ”¾ */ public abstract void play(); /** * å¿«è¿› */ public abstract void speed(); /** * æš‚åœ */ public abstract void pause(); /** * åœæ­¢ */ public abstract void stop(); &#125; æ’­æ”¾çŠ¶æ€ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142package com.design.pattern.state;import lombok.extern.slf4j.Slf4j;/** * PlayState è§†é¢‘æ’­æ”¾çŠ¶æ€ * * @author shunhua * @date 2019-10-05 */@Slf4jpublic class PlayState extends VideoState &#123; @Override public void play() &#123; log.info(\"è§†é¢‘æ­£å¸¸æ’­æ”¾çŠ¶æ€\"); &#125; /** * å¯åˆ‡æ¢å¿«è¿› */ @Override public void speed() &#123; super.videoContext.setVideoState(VideoContext.SPEED_STATE); &#125; /** * å¯åˆ‡æ¢æš‚åœ */ @Override public void pause() &#123; super.videoContext.setVideoState(VideoContext.PAUSE_STATE); &#125; /** * å¯åˆ‡æ¢åœæ­¢ */ @Override public void stop() &#123; super.videoContext.setVideoState(VideoContext.STOP_STATE); &#125;&#125; æš‚åœæ’­æ”¾çŠ¶æ€ç±» 123456789101112131415161718192021222324252627282930313233package com.design.pattern.state;import lombok.extern.slf4j.Slf4j;/** * PauseState è§†é¢‘æš‚åœçŠ¶æ€ * * @author shunhua * @date 2019-10-05 */@Slf4jpublic class PauseState extends VideoState &#123; @Override public void play() &#123; super.videoContext.setVideoState(VideoContext.PLAY_STATE); &#125; @Override public void speed() &#123; super.videoContext.setVideoState(VideoContext.SPEED_STATE); &#125; @Override public void pause() &#123; log.info(\"è§†é¢‘æš‚åœæ’­æ”¾çŠ¶æ€\"); &#125; @Override public void stop() &#123; super.videoContext.setVideoState(VideoContext.STOP_STATE); &#125;&#125; å¿«è¿›æ’­æ”¾çŠ¶æ€ç±» 123456789101112131415161718192021222324252627282930313233package com.design.pattern.state;import lombok.extern.slf4j.Slf4j;/** * SpeedState è§†é¢‘åŠ é€ŸçŠ¶æ€ * * @author shunhua * @date 2019-10-05 */@Slf4jpublic class SpeedState extends VideoState &#123; @Override public void play() &#123; super.videoContext.setVideoState(VideoContext.PLAY_STATE); &#125; @Override public void speed() &#123; log.info(\"è§†é¢‘å¿«è¿›æ’­æ”¾çŠ¶æ€\"); &#125; @Override public void pause() &#123; super.videoContext.setVideoState(VideoContext.PAUSE_STATE); &#125; @Override public void stop() &#123; super.videoContext.setVideoState(VideoContext.STOP_STATE); &#125;&#125; åœæ­¢çŠ¶æ€ç±» 123456789101112131415161718192021222324252627282930313233package com.design.pattern.state;import lombok.extern.slf4j.Slf4j;/** * StopState è§†é¢‘åœæ­¢çŠ¶æ€ * * @author shunhua * @date 2019-10-05 */@Slf4jpublic class StopState extends VideoState &#123; @Override public void play() &#123; super.videoContext.setVideoState(VideoContext.PLAY_STATE); &#125; @Override public void speed() &#123; log.info(\"åœæ­¢çŠ¶æ€ä¸èƒ½å¿«è¿›\"); &#125; @Override public void pause() &#123; log.info(\"åœæ­¢çŠ¶æ€ä¸èƒ½æš‚åœ\"); &#125; @Override public void stop() &#123; log.info(\"è§†é¢‘åœæ­¢æ’­æ”¾çŠ¶æ€\"); &#125;&#125; çŠ¶æ€å¯¹åº”çš„ä¸Šä¸‹æ–‡ 123456789101112131415161718192021222324252627282930313233package com.design.pattern.state;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-04 */@Slf4jpublic class Client &#123; @Test public void test()&#123; // å£°æ˜ä¸€ä¸ªä¸Šä¸‹æ–‡ VideoContext videoContext = new VideoContext(); videoContext.setVideoState(new PlayState()); log.info(\"å½“å‰çŠ¶æ€ï¼š\" + videoContext.getVideoState().getClass().getSimpleName()); videoContext.pause(); log.info(\"å½“å‰çŠ¶æ€ï¼š\" + videoContext.getVideoState().getClass().getSimpleName()); videoContext.speed(); log.info(\"å½“å‰çŠ¶æ€ï¼š\" + videoContext.getVideoState().getClass().getSimpleName()); videoContext.stop(); log.info(\"å½“å‰çŠ¶æ€ï¼š\" + videoContext.getVideoState().getClass().getSimpleName()); &#125;&#125; çŠ¶æ€æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨ çŠ¶æ€æ¨¡å¼å’Œä¸šåŠ¡åœºæ™¯æ›´ç´§å¯†ç›¸å…³ï¼Œæ¯”å¦‚ç”µå•†ä¸­è®¢å•çš„çŠ¶æ€ã€æ ¹æ®ä¸šåŠ¡è®¾ç½®çŠ¶æ€æœºã€åŠå…¬ç³»ç»Ÿæµç¨‹çš„çŠ¶æ€ç­‰ï¼Œæºç ä¸­ç›¸å¯¹å¾ˆå°‘ä½¿ç”¨","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è®¿é—®è€…æ¨¡å¼","slug":"design_pattern/behaviour_type/è®¿é—®è€…æ¨¡å¼","date":"2019-10-04T16:00:00.000Z","updated":"2020-07-04T16:28:45.961Z","comments":true,"path":"posts/64b51ed9/","link":"","permalink":"https://gentryhuang.com/posts/64b51ed9/","excerpt":"","text":"å®šä¹‰å°è£…ä½œç”¨äºæŸæ•°æ®ç»“æ„(å¦‚List/Set/Mapç­‰)ä¸­çš„å„å…ƒç´ çš„æ“ä½œã€‚å¯ä»¥åœ¨ä¸æ”¹å˜å„å…ƒç´ çš„ç±»çš„å‰æä¸‹ï¼Œå®šä¹‰ä½œç”¨äºè¿™äº›å…ƒç´ çš„æ“ä½œã€‚å³å½“è®¿é—®æŸä¸ªèµ„æºæ—¶ï¼Œä¸å»ä¿®æ”¹èµ„æºæœ¬èº«è€Œæ˜¯å®šä¹‰è®¿é—®èµ„æºçš„æ“ä½œ ç±»å‹è¡Œä¸ºå‹ ä½¿ç”¨åœºæ™¯121. ä¸€ä¸ªæ•°æ®ç»“æ„å¦‚ï¼ˆList&#x2F;Set&#x2F;Mapç­‰ï¼‰åŒ…å«å¾ˆå¤šç±»å‹å¯¹è±¡2. æ•°æ®ç»“æ„äºæ•°æ®æ“ä½œåˆ†ç¦» ä¼˜ç‚¹1å¢åŠ æ–°çš„æ“ä½œå¾ˆå®¹æ˜“ï¼Œå³å¢åŠ ä¸€ä¸ªæ–°çš„è®¿é—®è€… ç¼ºç‚¹1231. å¢åŠ æ–°çš„æ•°æ®ç»“æ„å›°éš¾ï¼Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹æ¯”è¾ƒå¤š2. å…·ä½“å…ƒç´ å˜æ›´æ¯”è¾ƒéº»çƒ¦ - å¢åŠ æˆ–è€…åˆ é™¤å…ƒç´ é‡Œé¢çš„å±æ€§éƒ½ç®—å˜æ›´ ç›¸å…³çš„è®¾è®¡æ¨¡å¼è®¿é—®è€…æ¨¡å¼å’Œè¿­ä»£å™¨æ¨¡å¼ 121. å®ƒä»¬éƒ½æ˜¯åœ¨æŸç§æ•°æ®ç»“æ„ä¸Šè¿›è¡Œå¤„ç†2. è®¿é—®è€…æ¨¡å¼ä¸»è¦å¯¹ä¿å­˜åœ¨æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ è¿›è¡ŒæŸç§ç‰¹å®šçš„å¤„ç†ï¼Œè¿­ä»£å™¨ç”¨äºé€ä¸ªéå†ä¿å­˜åœ¨æ•°æ®ç»“æ„ä¸­çš„ä¸€äº›å…ƒç´  ç®€å•éœ€æ±‚ç½‘ç»œè¯¾ç¨‹æœ‰å…è´¹çš„ä¹Ÿæœ‰ä»˜è´¹çš„ï¼Œå…è´¹çš„è¯¾ç¨‹æ™®é€šç”¨æˆ·éƒ½å¯ä»¥è®¿é—®ï¼Œä»˜è´¹çš„è¯¾ç¨‹éœ€è¦è´­ä¹°ç§°ä¸ºVipç”¨æˆ·æ‰èƒ½è®¿é—®ã€‚ç›¸åŒçš„èµ„æºä¸åŒçš„ç”¨æˆ·èº«ä»½ï¼Œè®¿é—®çš„ç»“æœä¸åŒ è®¿é—®è€…æ¨¡å¼æ¼”ç»ƒ å½“è®¿é—®æŸä¸ªèµ„æºæ—¶ï¼Œä¸å»ä¿®æ”¹èµ„æºæœ¬èº«è€Œæ˜¯å®šä¹‰è®¿é—®èµ„æºçš„æ“ä½œã€‚ç›¸åŒçš„èµ„æºä¸åŒçš„è®¿é—®èº«ä»½ï¼Œäº§ç”Ÿä¸åŒçš„æ“ä½œè¡Œä¸º æŠ½è±¡è¯¾ç¨‹èµ„æº 12345678910111213141516171819202122232425262728package com.design.pattern.visitor;import lombok.Getter;import lombok.Setter;/** * Course è¢«è®¿é—®çš„èµ„æº * * ä¸æ”¹å˜Course,è€Œæ˜¯å®šä¹‰è®¿é—®Courseçš„æ“ä½œï¼Œè¿™é‡Œä½“ç°åœ¨IVisitorçš„æ–¹æ³•ä¸Š * * @author shunhua * @date 2019-10-05 */@Getter@Setterpublic abstract class Course &#123; /** * è¯¾ç¨‹åç§° */ private String name; /** * æ¥å—è®¿é—® æŠŠè®¿é—®è€…ä¼ å…¥ * @param visitor */ public abstract void accept(IVisitor visitor); &#125; å…è´¹è¯¾ç¨‹èµ„æº 12345678910111213141516171819package com.design.pattern.visitor;/** * FreeCourse * * @author shunhua * @date 2019-10-05 */public class FreeCourse extends Course &#123; /** * æ¥å—è®¿é—® * @param visitor */ @Override public void accept(IVisitor visitor) &#123; visitor.visit(this); &#125;&#125; ä»˜è´¹è¯¾ç¨‹èµ„æº 12345678910111213141516171819202122232425262728package com.design.pattern.visitor;import lombok.Getter;import lombok.Setter;/** * PayCourse * * @author shunhua * @date 2019-10-05 */@Getter@Setterpublic class PayCourse extends Course &#123; /** * ä»·æ ¼ */ private int price; /** * æ¥å—è®¿é—® * @param visitor */ @Override public void accept(IVisitor visitor) &#123; visitor.visit(this); &#125;&#125; è®¿é—®è€…æŠ½è±¡ 12345678910111213141516171819202122232425package com.design.pattern.visitor;/** * IVisitor è®¿é—®æ¥å£ * * è¿™é‡Œå®šä¹‰äº†è®¿é—®èµ„æºçš„æ“ä½œï¼Œå…·ä½“çš„è®¿é—®ç»†èŠ‚ä½“ç°åœ¨å®ç°ç±»ä¸­ï¼Œä¸åŒçš„å®ç°ç±»å¯¹ç›¸åŒçš„èµ„æºäº§ç”Ÿä¸åŒçš„æ“ä½œè¡Œä¸ºï¼Œè¿™æ˜¯è®¿é—®è€…çš„æ ¸å¿ƒ * * @author shunhua * @date 2019-10-05 */public interface IVisitor &#123; /** * è®¿é—®å…è´¹è¯¾ç¨‹ * @param freeCourse */ void visit(FreeCourse freeCourse); /** * è®¿é—®ä»˜è´¹è¯¾ç¨‹ * @param payCourse */ void visit(PayCourse payCourse);&#125; æ™®é€šè®¿é—®è€… 12345678910111213141516171819202122232425262728293031package com.design.pattern.visitor;import lombok.extern.slf4j.Slf4j;/** * GeneralVisitor æ™®é€šè®¿é—®è€… * * @author shunhua * @date 2019-10-05 */@Slf4jpublic class GeneralVisitor implements IVisitor &#123; /** * è®¿é—®å…è´¹è¯¾ç¨‹ * @param freeCourse */ @Override public void visit(FreeCourse freeCourse) &#123; log.info(\"å…è´¹è¯¾ç¨‹åï¼š\" + freeCourse.getName()); &#125; /** * è®¿é—®ä»˜è´¹è¯¾ç¨‹ * @param payCourse */ @Override public void visit(PayCourse payCourse) &#123; log.info(\"è¿™æ˜¯ä»˜è´¹è¯¾ç¨‹ï¼Œä½ è¿˜æ²¡æœ‰è´­ä¹°ï¼Œæ²¡æœ‰è®¿é—®æƒé™\"); &#125;&#125; Vipè®¿é—®è€… 12345678910111213141516171819202122232425262728293031package com.design.pattern.visitor;import lombok.extern.slf4j.Slf4j;/** * VipVisitor Vipè®¿é—®è€… * * @author shunhua * @date 2019-10-05 */@Slf4jpublic class VipVisitor implements IVisitor&#123; /** * è®¿é—®å…è´¹è¯¾ç¨‹ * @param freeCourse */ @Override public void visit(FreeCourse freeCourse) &#123; log.info(\"å…è´¹è¯¾ç¨‹åï¼š\" + freeCourse.getName()); &#125; /** * è®¿é—®ä»˜è´¹è¯¾ç¨‹ * @param payCourse */ @Override public void visit(PayCourse payCourse) &#123; log.info(\"ä»˜è´¹è¯¾ç¨‹åï¼š\" + payCourse.getName() + \" ä»·æ ¼ä¸ºï¼š\" + payCourse.getPrice()); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.design.pattern.visitor;import org.junit.Test;import java.util.ArrayList;import java.util.List;/** * Client * * @author shunhua * @date 2019-10-05 */public class Client &#123; @Test public void test()&#123; List&lt;Course&gt; courseList = new ArrayList&lt;&gt;(); FreeCourse freeCourse = new FreeCourse(); freeCourse.setName(\"è¿™æ˜¯ä¸€ä¸ªå…è´¹çš„è¯¾ç¨‹\"); PayCourse payCourse = new PayCourse(); payCourse.setName(\"è¿™æ˜¯ä¸€ä¸ªä»˜è´¹çš„è¯¾ç¨‹\"); payCourse.setPrice(300); courseList.add(freeCourse); courseList.add(payCourse); // æ™®é€šè®¿é—®è€… GeneralVisitor generalVisitor = new GeneralVisitor(); // Vipç”¨æˆ· VipVisitor vipVisitor = new VipVisitor(); System.out.println(\"//----------æ™®é€šè®¿é—®è€…----------------/\"); courseList.stream().forEach(course -&gt; &#123; course.accept(generalVisitor); &#125;); System.out.println(\"//----------vipç”¨æˆ·------------------/\"); courseList.stream().forEach(course -&gt; &#123; course.accept(vipVisitor); &#125;); &#125;&#125; è®¿é—®è€…æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨FileVisitor 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package java.nio.file;import java.nio.file.attribute.BasicFileAttributes;import java.io.IOException;import java.util.Objects;/** * èµ„æºæ˜¯æ–‡ä»¶ * * @since 1.7 */public class SimpleFileVisitor&lt;T&gt; implements FileVisitor&lt;T&gt; &#123; /** * Initializes a new instance of this class. */ protected SimpleFileVisitor() &#123; &#125; /** * Invoked for a directory before entries in the directory are visited. * * &lt;p&gt; Unless overridden, this method returns &#123;@link FileVisitResult#CONTINUE * CONTINUE&#125;. */ @Override public FileVisitResult preVisitDirectory(T dir, BasicFileAttributes attrs) throws IOException &#123; Objects.requireNonNull(dir); Objects.requireNonNull(attrs); return FileVisitResult.CONTINUE; &#125; /** * Invoked for a file in a directory. * * &lt;p&gt; Unless overridden, this method returns &#123;@link FileVisitResult#CONTINUE * CONTINUE&#125;. */ @Override public FileVisitResult visitFile(T file, BasicFileAttributes attrs) throws IOException &#123; Objects.requireNonNull(file); Objects.requireNonNull(attrs); return FileVisitResult.CONTINUE; &#125; /** * Invoked for a file that could not be visited. * * &lt;p&gt; Unless overridden, this method re-throws the I/O exception that prevented * the file from being visited. */ @Override public FileVisitResult visitFileFailed(T file, IOException exc) throws IOException &#123; Objects.requireNonNull(file); throw exc; &#125; /** * Invoked for a directory after entries in the directory, and all of their * descendants, have been visited. * * &lt;p&gt; Unless overridden, this method returns &#123;@link FileVisitResult#CONTINUE * CONTINUE&#125; if the directory iteration completes without an I/O exception; * otherwise this method re-throws the I/O exception that caused the iteration * of the directory to terminate prematurely. */ @Override public FileVisitResult postVisitDirectory(T dir, IOException exc) throws IOException &#123; Objects.requireNonNull(dir); if (exc != null) throw exc; return FileVisitResult.CONTINUE; &#125;&#125; BeanDefinitionVisitor 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package org.springframework.beans.factory.config;import java.util.LinkedHashMap;import java.util.LinkedHashSet;import java.util.List;import java.util.Map;import java.util.Set;import org.springframework.beans.MutablePropertyValues;import org.springframework.beans.PropertyValue;import org.springframework.lang.Nullable;import org.springframework.util.Assert;import org.springframework.util.ObjectUtils;import org.springframework.util.StringValueResolver;/** * èµ„æºï¼šBeançš„å®šä¹‰ * * @author Juergen Hoeller * @author Sam Brannen * @since 1.2 * @see BeanDefinition * @see BeanDefinition#getPropertyValues * @see BeanDefinition#getConstructorArgumentValues * @see PropertyPlaceholderConfigurer */public class BeanDefinitionVisitor &#123; @Nullable private StringValueResolver valueResolver; /** * Create a new BeanDefinitionVisitor, applying the specified * value resolver to all bean metadata values. * @param valueResolver the StringValueResolver to apply */ public BeanDefinitionVisitor(StringValueResolver valueResolver) &#123; Assert.notNull(valueResolver, \"StringValueResolver must not be null\"); this.valueResolver = valueResolver; &#125; /** * Create a new BeanDefinitionVisitor for subclassing. * Subclasses need to override the &#123;@link #resolveStringValue&#125; method. */ protected BeanDefinitionVisitor() &#123; &#125; /** * Traverse the given BeanDefinition object and the MutablePropertyValues * and ConstructorArgumentValues contained in them. * @param beanDefinition the BeanDefinition object to traverse * @see #resolveStringValue(String) */ public void visitBeanDefinition(BeanDefinition beanDefinition) &#123; visitParentName(beanDefinition); visitBeanClassName(beanDefinition); visitFactoryBeanName(beanDefinition); visitFactoryMethodName(beanDefinition); visitScope(beanDefinition); if (beanDefinition.hasPropertyValues()) &#123; visitPropertyValues(beanDefinition.getPropertyValues()); &#125; if (beanDefinition.hasConstructorArgumentValues()) &#123; ConstructorArgumentValues cas = beanDefinition.getConstructorArgumentValues(); visitIndexedArgumentValues(cas.getIndexedArgumentValues()); visitGenericArgumentValues(cas.getGenericArgumentValues()); &#125; &#125; &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"ä¸­ä»‹è€…æ¨¡å¼","slug":"design_pattern/behaviour_type/ä¸­ä»‹è€…æ¨¡å¼","date":"2019-10-03T16:00:00.000Z","updated":"2020-07-04T16:28:45.952Z","comments":true,"path":"posts/d036071c/","link":"","permalink":"https://gentryhuang.com/posts/d036071c/","excerpt":"","text":"å®šä¹‰å®šä¹‰äº†ä¸€ä¸ªå°è£…ä¸€ç»„å¯¹è±¡å¦‚ä½•äº¤äº’çš„å¯¹è±¡ï¼ˆè¿™ä¸ªå¯¹è±¡ç”¨æ¥åè°ƒè¿™ä¸€ç»„å¯¹è±¡ï¼ˆâ€œåŒäº‹ç±»â€ï¼‰ï¼‰ã€‚é€šè¿‡ä½¿å¯¹è±¡æ˜ç¡®åœ°ç›¸äº’å¼•ç”¨æ¥ä¿ƒè¿›æ¾æ•£è€¦åˆï¼Œå¹¶å…è®¸ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬çš„äº¤äº’ã€‚ ç±»å‹è¡Œä¸ºå‹ é€‚ç”¨åœºæ™¯121. ç³»ç»Ÿä¸­å¯¹è±¡ä¹‹é—´å­˜åœ¨å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼Œäº§ç”Ÿçš„ç›¸äº’ä¾èµ–å…³ç³»ç»“æ„æ··ä¹±éš¾ä»¥ç†è§£ï¼Œä½¿ç”¨ä¸­ä»‹è€…è¿›è¡Œåè°ƒ2. äº¤äº’çš„å…¬å…±è¡Œä¸ºï¼Œå¦‚æœéœ€è¦æ”¹å˜è¡Œä¸ºåˆ™å¯ä»¥å¢åŠ æ–°çš„ä¸­ä»‹è€…ç±» ä¼˜ç‚¹121. å°†ä¸€å¯¹å¤šè½¬åŒ–æˆäº†ä¸€å¯¹ä¸€ã€é™ä½ç¨‹åºå¤æ‚åº¦2. ç±»ä¹‹é—´çš„è§£è€¦ ç¼ºç‚¹1ä¸­ä»‹è€…è¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿå¤æ‚ ç›¸å…³çš„è®¾è®¡æ¨¡å¼ä¸­ä»‹è€…æ¨¡å¼å’Œè§‚å¯Ÿè€…æ¨¡å¼ 1ä¸¤è€…æœ‰æ—¶ç»“åˆä½¿ç”¨ï¼Œä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼å®ç°ä¸­ä»‹è€…æ¨¡å¼ä¸­è§’è‰²é—´çš„é€šä¿¡ ç®€å•éœ€æ±‚å…¬å¸çš„å‘˜å·¥ä¹‹é—´å‘é€å…¬æœ‰æ¶ˆæ¯ï¼Œä½¿ç”¨å·¥ä½œç¾¤ç»Ÿä¸€å‘é€ï¼Œä¸éœ€è¦å‘é€è€…é€ä¸€å‘ç»™å…¶ä»–å‘˜å·¥ ä¸­ä»‹è€…æ¨¡å¼æ¼”ç»ƒ ä¸­ä»‹è€… 12345678910111213141516171819202122232425package com.design.pattern.mediator;import lombok.extern.slf4j.Slf4j;import java.util.Date;/** * WorkGroup ä¸­ä»‹è€… - å·¥ä½œç¾¤ * * @author shunhua * @date 2019-10-04 */@Slf4jpublic class WorkGroup &#123; /** * ä¸­ä»‹è€…æ˜¾ç¤ºå‘˜å·¥å‘é€çš„æ¶ˆæ¯ * @param worker * @param msg */ public static void showMsg(Worker worker, String msg)&#123; log.info(String.format(\"%s ã€%sã€‘: %s\",new Date().toString(),worker.getName(),msg)); &#125;&#125; å‚ä¸äº¤äº’çš„å¯¹è±¡ç±» 123456789101112131415161718192021222324252627package com.design.pattern.mediator;import lombok.AllArgsConstructor;import lombok.Data;/** * Worker å‘˜å·¥ é€šå¸¸ç§°ä¸ºâ€œåŒäº‹ç±»â€ * * @author shunhua * @date 2019-10-04 */@Data@AllArgsConstructorpublic class Worker &#123; /** * èŠ±å */ private String name; /** * å‘˜å·¥åªå’Œä¸­ä»‹è€…ï¼ˆå·¥ä½œç¾¤ï¼‰æ‰“äº¤é“ï¼Œè¿™æ˜¯ä¸­ä»‹è€…æ¨¡å¼çš„æ ¸å¿ƒ * @param msg */ public void sendMsg(String msg)&#123; WorkGroup.showMsg(this,msg); &#125;&#125; åº”ç”¨å±‚ 12345678910111213141516171819202122232425package com.design.pattern.mediator;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-04 */public class Client &#123; @Test public void test()&#123; Worker worker = new Worker(\"èˆœå\"); Worker worker1= new Worker(\"é«˜æ–¯æ—\"); worker1.sendMsg(\"å°ä¼™å­ï¼Œå°±ä½ è¿˜æƒ³å­¦æˆ‘çš„Javaï¼ï¼ï¼\"); worker.sendMsg(\"æœ‰å¥è¯ä¸çŸ¥å½“è®²ä¸å½“è®²ï¼Ÿ\"); &#125;&#125; ä¸­ä»‹è€…æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨Timer 1Timeræ˜¯ä¸€ä¸ªä¸­ä»‹è€…ï¼Œå®ƒåè°ƒTimerTaskä»»åŠ¡ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465package java.util;import java.util.Date;import java.util.concurrent.atomic.AtomicInteger;public class Timer &#123; /** * The timer task queue. This data structure is shared with the timer * thread. The timer produces tasks, via its various schedule calls, * and the timer thread consumes, executing timer tasks as appropriate, * and removing them from the queue when they're obsolete. */ private final TaskQueue queue = new TaskQueue(); /** * The timer thread. */ private final TimerThread thread = new TimerThread(queue); /** * Timerä¸­æœ‰å¤šä¸ªscheduleé‡è½½æ–¹æ³•ï¼Œé‡Œé¢éƒ½è°ƒç”¨äº†schedæ–¹æ³• */ public void schedule(TimerTask task, long delay) &#123; if (delay &lt; 0) throw new IllegalArgumentException(\"Negative delay.\"); sched(task, System.currentTimeMillis()+delay, 0); &#125; /** * * Timeræ˜¯ä¸€ä¸ªä¸­ä»‹è€…ï¼Œé€šè¿‡schedæ–¹æ³•ç»Ÿä¸€åè°ƒTimerTask * * @param task è¢«åè°ƒçš„å¯¹è±¡ * @param time * @param period */ private void sched(TimerTask task, long time, long period) &#123; if (time &lt; 0) throw new IllegalArgumentException(\"Illegal execution time.\"); // Constrain value of period sufficiently to prevent numeric // overflow while still being effectively infinitely large. if (Math.abs(period) &gt; (Long.MAX_VALUE &gt;&gt; 1)) period &gt;&gt;= 1; synchronized(queue) &#123; if (!thread.newTasksMayBeScheduled) throw new IllegalStateException(\"Timer already cancelled.\"); synchronized(task.lock) &#123; if (task.state != TimerTask.VIRGIN) throw new IllegalStateException( \"Task already scheduled or cancelled\"); task.nextExecutionTime = time; task.period = period; task.state = TimerTask.SCHEDULED; &#125; queue.add(task); if (queue.getMin() == task) queue.notify(); &#125; &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å¤‡å¿˜å½•æ¨¡å¼","slug":"design_pattern/behaviour_type/å¤‡å¿˜å½•æ¨¡å¼","date":"2019-10-03T16:00:00.000Z","updated":"2020-07-04T16:28:45.954Z","comments":true,"path":"posts/c3176455/","link":"","permalink":"https://gentryhuang.com/posts/c3176455/","excerpt":"","text":"å®šä¹‰ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªçŠ¶æ€ï¼Œä»¥ä¾¿åœ¨é€‚å½“çš„æ—¶å€™æ¢å¤å¯¹è±¡ã€‚è¿™é‡Œçš„çŠ¶æ€å¯ä»¥ç†è§£ä¸ºå¯¹è±¡çš„ä¸€ä¸ªå¿«ç…§ã€‚ ç±»å‹è¡Œä¸ºå‹ é€‚ç”¨åœºæ™¯121 ä¿å­˜åŠæ¢å¤æ•°æ®ç›¸å…³ä¸šåŠ¡åœºæ™¯2 åæ‚”çš„æ—¶å€™ï¼Œå³æƒ³æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ ä¼˜ç‚¹121 ä¸ºç”¨æˆ·æä¾›ä¸€ç§å¯æ¢å¤æœºåˆ¶2 å­˜æ¡£ä¿¡æ¯çš„å°è£… ç¼ºç‚¹12èµ„æºå ç”¨ - å¦‚æœæš‚å­˜çš„å¯¹è±¡æ¯”è¾ƒå¤šï¼Œè€Œä¸”å¯¹è±¡çš„å±æ€§ä¹Ÿæ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆè‚¯å®šä¼šå¯¹èµ„æºé€ æˆä¸€å®šçš„æ¶ˆè€—ï¼Œå ç”¨å¤§é‡çš„èµ„æºã€‚ ç›¸å…³çš„è®¾è®¡æ¨¡å¼å¤‡å¿˜å½•æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼ 1å¤‡å¿˜å½•æ¨¡å¼ä¸­æ˜¯ç”¨å®ä¾‹æ¥è¡¨ç¤ºçŠ¶æ€çš„ï¼Œæˆ‘ä»¬å­˜æ¡£çš„æ˜¯ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚çŠ¶æ€æ¨¡å¼ä¸­æ˜¯ä½¿ç”¨ç±»æ¥è¡¨ç¤ºçŠ¶æ€ã€‚ ç®€å•éœ€æ±‚åœ¨å†™æ–‡æ¡£æ—¶ï¼Œé—´æ–­æ€§åœ°ä¿å­˜ï¼Œç„¶åå¯ä»¥æ’¤é”€å›é€€åˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬ å¤‡å¿˜å½•æ¨¡å¼æ¼”ç»ƒ æ–‡ç«  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.design.pattern.memento;import lombok.AllArgsConstructor;import lombok.Data;import java.io.Serializable;/** * Article æ–‡ç«  * * @author shunhua * @date 2019-10-04 */@Data@AllArgsConstructorpublic class Article implements Serializable &#123; private static final long serialVersionUID = -321234774998152556L; /** * æ–‡ç« æ ‡é¢˜ */ private String title; /** * æ–‡ç« å†…å®¹ */ private String content; /** * å›¾ç‰‡ */ private String img; /** * æŠŠæ–‡ç« ä¿å­˜èµ·æ¥ * @return */ public ArticleMemento saveToMemento()&#123; ArticleMemento articleMemento = new ArticleMemento(this.title,this.content,this.img); return articleMemento; &#125; /** * æŠŠä¿å­˜çš„æ–‡ç« æ ‡é¢˜ã€å†…å®¹ä»¥åŠå›¾ç‰‡å›é€€å›æ¥ * @param articleMemento */ public void undoFromMemento(ArticleMemento articleMemento)&#123; this.title = articleMemento.getTitle(); this.content = articleMemento.getContent(); this.img = articleMemento.getImg(); &#125;&#125; æ–‡ç« å¿«ç…§ 123456789101112131415161718192021222324252627282930package com.design.pattern.memento;import lombok.AllArgsConstructor;import lombok.Getter;import lombok.ToString;/** * ArticleMemento æ–‡ç« å¿«ç…§,å¯¹äºå¿«ç…§ä¸éœ€è¦Setteræ–¹æ³•ï¼Œåªç”¨äºä¿å­˜ * * @author shunhua * @date 2019-10-04 */@Getter@ToString@AllArgsConstructorpublic class ArticleMemento &#123; /** * æ ‡é¢˜ */ private String title; /** * å†…å®¹ */ private String content; /** * å›¾ç‰‡ */ private String img;&#125; æ–‡ç« å¿«ç…§æš‚å­˜ç®¡ç† 12345678910111213141516171819202122232425262728293031323334package com.design.pattern.memento;import java.util.Stack;/** * ArticleMementoManager æ–‡ç« å¿«ç…§ç®¡ç†è€… * * @author shunhua * @date 2019-10-04 */public class ArticleMementoManager &#123; /** * ä¿å­˜ æ–‡ç« å¿«ç…§ çš„æ ˆï¼Œåœ¨å›é€€çš„æ—¶å€™å›é€€çš„æ˜¯æœ€æ–°çš„çŠ¶æ€ */ private final Stack&lt;ArticleMemento&gt; ARTICLE_MEMENTO_STACK = new Stack&lt;&gt;(); /** * è·å–æ–‡ç« å¿«ç…§ * @return */ public ArticleMemento getMemento()&#123; ArticleMemento articleMemento = ARTICLE_MEMENTO_STACK.pop(); return articleMemento; &#125; /** * æŠŠæ–‡ç« ä¿å­˜ä¸ºå¿«ç…§ * @param articleMemento */ public void addMemento(ArticleMemento articleMemento)&#123; ARTICLE_MEMENTO_STACK.push(articleMemento); &#125;&#125; å¤‡å¿˜å½•æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨spring-webflowä¸­çš„ä½¿ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839package org.springframework.binding.message;import java.io.Serializable;import org.springframework.context.MessageSource;/** * A message context whose internal state can be managed by an external care-taker. State management employs the GOF * Memento pattern. This context can produce a serializable memento representing its internal state at any time. A * care-taker can then use that memento at a later time to restore any context instance to a previous state. * * @author Keith Donald */public interface StateManageableMessageContext extends MessageContext &#123; /** * å­˜æ¡£ * Create a serializable memento, or token representing a snapshot of the internal state of this message context. * @return the messages memento */ Serializable createMessagesMemento(); /** * å›é€€ * Set the state of this context from the memento provided. After this call, the messages in this context will match * what is encapsulated inside the memento. Any previous state will be overridden. * @param messagesMemento the messages memento */ void restoreMessages(Serializable messagesMemento); /** * Configure the message source used to resolve messages added to this context. May be set at any time to change how * coded messages are resolved. * @param messageSource the message source * @see MessageContext#addMessage(MessageResolver) */ void setMessageSource(MessageSource messageSource);&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è´£ä»»é“¾æ¨¡å¼","slug":"design_pattern/behaviour_type/è´£ä»»é“¾æ¨¡å¼","date":"2019-10-03T16:00:00.000Z","updated":"2020-07-04T16:28:45.961Z","comments":true,"path":"posts/6208627e/","link":"","permalink":"https://gentryhuang.com/posts/6208627e/","excerpt":"","text":"å®šä¹‰è´£ä»»é“¾æ¨¡å¼åˆå«èŒè´£é“¾æ¨¡å¼ã€‚ä¸ºè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ¥æ”¶æ­¤æ¬¡è¯·æ±‚çš„å¯¹è±¡çš„é“¾ï¼Œè¿™ä¸ªé“¾æ¡ç”±å¤šä¸ªå¯¹è±¡ç»„æˆã€‚ ç±»å‹è¡Œä¸ºå‹ é€‚ç”¨åœºæ™¯1ä¸€ä¸ªè¯·æ±‚çš„å¤„ç†éœ€è¦é“¾ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªåä½œå¤„ç† ä¼˜ç‚¹1231.è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ï¼ˆè¯·æ±‚çš„å¤„ç†è€…ï¼‰è§£è€¦ 2.è´£ä»»é“¾å¯ä»¥åŠ¨æ€ç»„åˆ3.è´£ä»»é“¾æ–¹ä¾¿æ‰©å±•å’Œæ”¶ç¼©ï¼ˆå¢åŠ æˆ–å‡å°‘å¤„ç†å¯¹è±¡ï¼‰ ç¼ºç‚¹121. è´£ä»»é“¾å¤ªé•¿æˆ–è€…å¤„ç†æ—¶é—´è¿‡é•¿ä¼šå½±å“æ€§èƒ½2. è´£ä»»é“¾æœ‰å¯èƒ½è¿‡å¤š ç›¸å…³çš„è®¾è®¡æ¨¡å¼è´£ä»»é“¾æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼ 1è´£ä»»é“¾æ¨¡å¼ä¸­å„ä¸ªå¯¹è±¡ä¸ä¼šæŒ‡å®šä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡æ˜¯è°ï¼Œåªæœ‰åœ¨å®¢æˆ·ç«¯è®¾å®šé“¾æ¡ä¸­çš„é¡ºåºä»¥åŠå…ƒç´ ç›´åˆ°è¢«æŸä¸ªå…ƒç´ å¤„ç†æˆ–æ•´æ¡é“¾ç»“æŸã€‚çŠ¶æ€æ¨¡å¼æ˜¯è®©æ¯ä¸ªçŠ¶æ€å¯¹è±¡çŸ¥é“è‡ªå·±ä¸‹ä¸€ä¸ªå¤„ç†çš„å¯¹è±¡æ˜¯è°ï¼Œåœ¨ç¼–è¯‘æ—¶å°±è®¾å®šå¥½äº†ã€‚ ç®€å•éœ€æ±‚åœ¨æ³¨å†Œç½‘ç«™çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æä¾›ç”¨æˆ·åã€é‚®ç®±ä»¥åŠå¯†ç ï¼Œç½‘ç«™ä¼šæœ‰ä¸€ä¸ªæ ¡éªŒæµç¨‹ï¼Œåˆ†åˆ«å¯¹ç”¨æˆ·åã€é‚®ç®±ä»¥åŠå¯†ç è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä»»ä½•ä¸€ä¸ªæ­¥éª¤æ²¡æœ‰é€šè¿‡å°±ä¸èƒ½æ³¨å†Œï¼Œåªæœ‰å…¨éƒ¨æ ¡éªŒé€šè¿‡æ‰èƒ½å®Œæˆæ³¨å†Œã€‚ è´£ä»»é“¾æ¨¡å¼æ¼”ç»ƒ è´£ä»»é“¾çš„æ„å»ºæ˜¯ç”±å®¢æˆ·ç«¯å†³å®šçš„ï¼Œè´£ä»»é“¾çš„å…¥å£ä¹Ÿæ˜¯å®¢æˆ·ç«¯å†³å®šçš„ å¾…å¤„ç†çš„å¯¹è±¡ 12345678910111213141516171819202122232425262728package com.design.pattern.chain;import lombok.AllArgsConstructor;import lombok.Data;/** * User å¾…æ ¡éªŒçš„ç”¨æˆ· * * @author shunhua * @date 2019-10-04 */@Data@AllArgsConstructorpublic class User &#123; /** * ç”¨æˆ·å */ private String name; /** * é‚®ç®± */ private String email; /** * å¯†ç  */ private String password;&#125; å¤„ç†å™¨çˆ¶ç±» 1234567891011121314151617181920212223242526272829303132package com.design.pattern.chain;/** * Handler è´£ä»»é“¾æ¨¡å¼çš„æ ¸å¿ƒ * * æ³¨æ„ï¼šæ„é€ è´£ä»»é“¾æ˜¯å®¢æˆ·ç«¯çš„ä»»åŠ¡,å¹¶ä¸”å…¥å£ä¹Ÿæ˜¯å®¢æˆ·å•é€‰æ‹©çš„ * * @author shunhua * @date 2019-10-04 */public abstract class Handler &#123; /** * ä¸€ä¸ªè‡ªå·±ç±»å‹çš„å¯¹è±¡ï¼Œä¸€èˆ¬æ˜¯å­ç±»å¯¹è±¡ */ protected Handler handler; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†å™¨ * @param handler */ public void setNextHandler(Handler handler)&#123; this.handler = handler; &#125; /** * äº¤ç»™å­ç±»å®ç°ï¼Œç”¨æ¥æ ¡éªŒç”¨æˆ·ä¿¡æ¯æ˜¯å¦ç¬¦åˆ * @param user */ protected abstract void handle(User user);&#125; åç§°å¤„ç†å™¨ 1234567891011121314151617181920212223242526272829303132333435package com.design.pattern.chain;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.util.ObjectUtils;/** * NameHandler ç”¨æˆ·åå¤„ç†å™¨ * * @author shunhua * @date 2019-10-04 */@Slf4jpublic class NameHandler extends Handler &#123; /** * æ ¡éªŒç”¨æˆ·å * @param user */ @Override protected void handle(User user) &#123; if(StringUtils.isNotBlank(user.getName()))&#123; log.info(\"ç”¨æˆ·åç¬¦åˆè¦æ±‚\"); // å¦‚æœæœ‰ä¸‹ä¸€ä¸ªæ ¡éªŒå™¨å°±ç»§ç»­æ‰§è¡Œï¼Œæ³¨æ„è¿™ä¸ªé“¾çš„é¡ºåºæ˜¯ç”±å®¢æˆ·ç«¯å†³å®šçš„ if(!ObjectUtils.isEmpty(super.handler))&#123; super.handler.handle(user); return; &#125;else &#123; log.info(\"å®Œæˆæ³¨å†Œ\"); &#125; return; &#125; log.info(\"ç”¨æˆ·åæ ¡éªŒä¸é€šè¿‡ï¼Œç»“æŸæ ¡éªŒ\"); &#125;&#125; é‚®ç®±å¤„ç†å™¨ 123456789101112131415161718192021222324252627282930package com.design.pattern.chain;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.util.ObjectUtils;/** * EmailHandler é‚®ç®±æ ¡éªŒå™¨ * * @author shunhua * @date 2019-10-04 */@Slf4jpublic class EmailHandler extends Handler&#123; @Override protected void handle(User user) &#123; if(StringUtils.isNotBlank(user.getEmail()))&#123; log.info(\"é‚®ç®±ç¬¦åˆè¦æ±‚\"); if(!ObjectUtils.isEmpty(super.handler))&#123; super.handler.handle(user); return; &#125;else &#123; log.info(\"å®Œæˆæ³¨å†Œ\"); &#125; return; &#125; log.info(\"é‚®ç®±éªŒè¯ä¸é€šè¿‡ï¼ŒéªŒè¯ç»“æŸ\"); &#125;&#125; å¯†ç å¤„ç†å™¨ 123456789101112131415161718192021222324252627282930package com.design.pattern.chain;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.StringUtils;import org.springframework.util.ObjectUtils;/** * PasswordHandler å¯†ç éªŒè¯å™¨ * * @author shunhua * @date 2019-10-04 */@Slf4jpublic class PasswordHandler extends Handler &#123; @Override protected void handle(User user) &#123; if(StringUtils.isNotBlank(user.getPassword()) &amp;&amp; user.getPassword().length() &gt;5)&#123; log.info(\"å¯†ç ç¬¦åˆè¦æ±‚\"); if(!ObjectUtils.isEmpty(super.handler))&#123; super.handler.handle(user); return; &#125;else &#123; log.info(\"å®Œæˆæ³¨å†Œ\"); &#125; return; &#125; log.info(\"å¯†ç éªŒè¯ä¸é€šè¿‡ï¼ŒéªŒè¯ç»“æŸ\"); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425262728293031323334353637package com.design.pattern.chain;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-04 */public class Client &#123; @Test public void test()&#123; // åˆ›å»ºå¾…éªŒè¯çš„ç”¨æˆ· User user = new User(\"shunhua\",\"gentryhuang.xw@gmail.com\",\"123456\"); // å§“åéªŒè¯å™¨ NameHandler nameHandler = new NameHandler(); // é‚®ç®±éªŒè¯å™¨ EmailHandler emailHandler = new EmailHandler(); // å¯†ç éªŒè¯å™¨ PasswordHandler passwordHandler = new PasswordHandler(); /** * æ³¨æ„ï¼šæ„é€ è´£ä»»é“¾æ˜¯å®¢æˆ·ç«¯å†³å®šçš„ * * æ„å»ºè´£ä»»é“¾ : NameHandler -&gt; EmailHandler -&gt; PasswordHandler */ nameHandler.setNextHandler(emailHandler); emailHandler.setNextHandler(passwordHandler); /** * å¤„ç†è¯·æ±‚å…¥å£ */ nameHandler.handle(user); &#125;&#125; è´£ä»»é“¾åœ¨æºç ä¸­çš„ä½¿ç”¨è¿‡æ»¤å™¨-Filter 123456789101112131415161718192021222324252627282930313233// ä»¥OncePerRequestFilterä¸ºä¾‹public abstract class OncePerRequestFilter extends GenericFilterBean &#123; public static final String ALREADY_FILTERED_SUFFIX = \".FILTERED\"; public OncePerRequestFilter() &#123; &#125; public final void doFilter(ServletRequest request, ServletResponse response, FilterChain filterChain) throws ServletException, IOException &#123; if (request instanceof HttpServletRequest &amp;&amp; response instanceof HttpServletResponse) &#123; HttpServletRequest httpRequest = (HttpServletRequest)request; HttpServletResponse httpResponse = (HttpServletResponse)response; String alreadyFilteredAttributeName = this.getAlreadyFilteredAttributeName(); boolean hasAlreadyFilteredAttribute = request.getAttribute(alreadyFilteredAttributeName) != null; if (!hasAlreadyFilteredAttribute &amp;&amp; !this.skipDispatch(httpRequest) &amp;&amp; !this.shouldNotFilter(httpRequest)) &#123; request.setAttribute(alreadyFilteredAttributeName, Boolean.TRUE); try &#123; this.doFilterInternal(httpRequest, httpResponse, filterChain); &#125; finally &#123; request.removeAttribute(alreadyFilteredAttributeName); &#125; &#125; else &#123; // å¾…ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨å¤„ç† filterChain.doFilter(request, response); &#125; &#125; else &#123; throw new ServletException(\"OncePerRequestFilter just supports HTTP requests\"); &#125; &#125; // ... &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"ä»£ç†æ¨¡å¼","slug":"design_pattern/structure_type/ä»£ç†æ¨¡å¼","date":"2019-10-02T16:00:00.000Z","updated":"2020-07-04T16:28:45.967Z","comments":true,"path":"posts/7b510e10/","link":"","permalink":"https://gentryhuang.com/posts/7b510e10/","excerpt":"","text":"å®šä¹‰ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ä»£ç†å¯¹è±¡åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ã€‚ ä¸¾ä¾‹ï¼šç§Ÿæˆ¿å­ï¼Œç›®æ ‡å¯¹è±¡ä»£è¡¨æˆ¿ä¸œï¼Œå®¢æˆ·ç«¯ä»£è¡¨ç”¨æˆ·ï¼Œæˆ¿å±‹ä¸­ä»‹ä»£è¡¨ä¸­ä»‹ã€‚æˆ¿å±‹ä¸­ä»‹èµ·åˆ°ä»£ç†çš„ä½œç”¨ï¼Œç­¾åˆåŒå’Œç¼´çº³æ°´ç”µè´¹ç›´æ¥æ‰¾ä¸­ä»‹å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å’Œæˆ¿ä¸œç›´æ¥æ¥è§¦ï¼Œå³ä¸­ä»‹ä»£ç†æˆ¿ä¸œã€‚ ç±»å‹ç»“æ„å‹ ä½¿ç”¨åœºæ™¯12â—† ä¿æŠ¤ç›®æ ‡å¯¹è±¡â—† å¢å¼ºç›®æ ‡å¯¹è±¡ ä¼˜ç‚¹1234â—† ä»£ç†æ¨¡å¼èƒ½å°†ä»£ç†å¯¹è±¡ä¸çœŸå®è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡åˆ†ç¦»â—† ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œæ‰©å±•æ€§å¥½â—† ä¿æŠ¤ç›®æ ‡å¯¹è±¡â—† åœ¨ä¸ä¿®æ”¹ç›®æ ‡ç±»çš„å‰æä¸‹ï¼Œå¢å¼ºç›®æ ‡å¯¹è±¡ ç¼ºç‚¹123â—† ä»£ç†æ¨¡å¼ä¼šé€ æˆç³»ç»Ÿè®¾è®¡ä¸­ç±»çš„æ•°ç›®å¢åŠ â—† åœ¨å®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡å¢åŠ ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä¼šé€ æˆè¯·æ±‚å¤„ç†é€Ÿåº¦å˜æ…¢â—† å¢åŠ ç³»ç»Ÿçš„å¤æ‚åº¦ æ‰©å±• æ ¹æ®ä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡ä»£ç†å…³ç³»çš„åˆ›å»ºæ—¶æœºçš„ä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚åŠ¨æ€ä»£ç†åˆæ ¹æ®å®ç°æŠ€æœ¯çš„ä¸åŒåˆ†ä¸ºJDKçš„ProxyåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ã€‚ é™æ€ä»£ç† 1é™æ€ä»£ç†å°±æ˜¯åœ¨ä»£ç ä¸­æŒ‡å®šæ˜¾å¼çš„ä»£ç†,åœ¨ç¼–è¯‘ä¹‹å‰ä»£ç†å…³ç³»å°±å·²ç»ç¡®å®šäº†ã€‚åœ¨ä»£ç†ç±»ä¸­å¯¹åŒåçš„æ–¹æ³•è¿›è¡ŒåŒ…è£…ï¼Œç”¨æˆ·é€šè¿‡å¯¹ä»£ç†ç±»çš„è¢«åŒ…è£…è¿‡çš„æ–¹æ³•æ¥è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„ä¸šåŠ¡æ–¹æ³•ï¼ŒåŒæ—¶å¯¹ç›®æ ‡å¯¹è±¡çš„ä¸šåŠ¡æ–¹æ³•è¿›è¡Œå¢å¼ºã€‚ JDKåŠ¨æ€ä»£ç† 1jdkçš„åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡æ¥å£ä¸­çš„æ–¹æ³•åå¯¹åœ¨åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»ä¸­ï¼Œè°ƒç”¨ä¸šåŠ¡å®ç°ç±»çš„åŒåæ–¹æ³•ã€‚æ³¨æ„:å¿…é¡»æ˜¯æ¥å£,å› ä¸ºjdkåº•å±‚å…ˆåˆ›å»ºä¸€ä¸ªä»£ç†ç±»ï¼Œç„¶åå†åˆ›å»ºä»£ç†ç±»çš„å®ä¾‹ï¼Œå®ƒçš„ç±»å‹æ˜¯æ¥å£ç±»å‹ï¼Œä¸æ˜¯ç›®æ ‡ç±»çš„ç±»å‹ã€‚ CGLIBä»£ç† 1cglibæ˜¯é€šè¿‡ç»§æ‰¿æ¥å®ç°çš„ï¼Œç”Ÿæˆçš„ä»£ç†ç±»æ˜¯ä¸šåŠ¡ç±»çš„å­ç±»ï¼Œé€šè¿‡é‡å†™ä¸šåŠ¡æ–¹æ³•æ‰§è¡Œä»£ç†ã€‚ä½¿ç”¨CGLibè¿›è¡Œä»£ç†æ—¶ä¸€å®šè¦æ³¨æ„finalä¿®æ”¹çš„ç±»å’Œæ–¹æ³•ä»¥åŠæ˜¯å¦æœ‰æ— å‚æ„é€ å™¨ã€‚CGLibåº•å±‚ä½¿ç”¨asmå­—èŠ‚ç ç”Ÿæˆçš„ã€‚ ä»£ç†æ¨¡å¼ç›¸å…³çš„è®¾è®¡æ¨¡å¼ä»£ç†æ¨¡å¼å’Œè£…é¥°è€…æ¨¡å¼ 1ç›®çš„ä¸åŒï¼Œè£…é¥°è€…æ¨¡å¼æ˜¯ä¸ºå¯¹è±¡åŠ ä¸Šè¡Œä¸ºï¼Œè€Œä»£ç†æ¨¡å¼æ˜¯æ§åˆ¶è®¿é—®ï¼Œä»£ç†æ¨¡å¼æ›´åŠ å…³æ³¨é€šè¿‡æ§åˆ¶ä»£ç†äººçš„æ–¹å¼æ¥å¢å¼ºç›®æ ‡å¯¹è±¡ã€‚å¢å¼ºå¯¹è±¡çš„æ–¹å¼ä¸€èˆ¬æ˜¯å¢å¼ºå¯¹è±¡çš„æŸäº›è¡Œä¸ºã€‚ ä»£ç†æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼ 1é€‚é…å™¨æ¨¡å¼ä¸»è¦æ”¹å˜æ‰€è¦è€ƒè™‘å¯¹è±¡çš„æ¥å£ï¼Œä»£ç†æ¨¡å¼ä¸å¯ä»¥æ”¹å˜æ‰€ä»£ç†ç±»çš„æ¥å£ã€‚ ä»£ç†æ¨¡å¼æ¼”ç»ƒé™æ€ä»£ç† é™æ€ä»£ç†çš„ä»£ç†ç±»æ˜¯æ‰‹åŠ¨ç¼–å†™çš„ï¼Œä»£ç†å…³ç³»åœ¨ç¼–è¯‘ä¹‹å‰å°±ç¡®ç«‹äº†ã€‚é€šå¸¸ç›®æ ‡å¯¹è±¡åœ¨ä»£ç†ç±»ä¸­åˆ›å»ºã€‚ ç›®æ ‡ç±»æ¥å£ 1234567891011121314package com.design.pattern.proxy.staticproxy;/** * IRentalHouseService * * @author shunhua * @date 2019-10-03 */public interface IRentalHouseService &#123; /** * ç§Ÿæˆ¿æ–¹æ³• */ void rent();&#125; ç›®æ ‡ç±» 123456789101112131415161718192021222324package com.design.pattern.proxy.jdkproxy;import com.design.pattern.proxy.staticproxy.IRentalHouseService;import lombok.extern.slf4j.Slf4j;/** *RentalHouseServiceImpl * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class RentalHouseService implements IRentalHouseService &#123; /** * å‡ºç§Ÿæˆ¿å­ï¼Œç›®æ ‡æ–¹æ³• * @return */ @Override public void rent()&#123; log.info(\"1800/æœˆï¼Œ2å®¤1å…1å¨1å«ï¼\"); &#125;&#125; ä»£ç†ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.design.pattern.proxy.staticproxy;import lombok.extern.slf4j.Slf4j;/** * RentalHouseServiceProxy ä»£ç†ç±» * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class RentalHouseServiceProxy &#123; /** * ä»£ç†å¯¹è±¡éœ€è¦ç›®æ ‡å¯¹è±¡ */ private RentalHouseService rentalHouseService; /** * æ„é€ æ–¹æ³• */ public RentalHouseServiceProxy()&#123; rentalHouseService = new RentalHouseService(); &#125; /** * ä»£ç†æ–¹æ³• */ public void rent()&#123; dialNumber(); rentalHouseService.rent(); signContract(); &#125; /** * éœ€è¦æˆ¿ç§Ÿè¯·è”ç³»æˆ‘ï¼Œç›®æ ‡æ–¹æ³•çš„å‰ç½®æ–¹æ³• */ private void dialNumber() &#123; log.info(\"éœ€è¦ç§Ÿæˆ¿è¯·è‡´ç”µï¼š123456\"); &#125; /** * ç­¾åˆåŒï¼Œç›®æ ‡æ–¹æ³•çš„åç½®æ–¹æ³• */ private void signContract() &#123; log.info(\"æˆ¿å­è¿˜æ»¡æ„å°±å¯ä»¥ç­¾åˆåŒäº†ï¼\"); &#125;&#125; åº”ç”¨å±‚ 1234567891011121314151617181920package com.design.pattern.proxy.staticproxy;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-03 */public class Client &#123; @Test public void test()&#123; // ç§Ÿæˆ¿ç›´æ¥æ‰¾ä»£ç† RentalHouseServiceProxy proxy = new RentalHouseServiceProxy(); proxy.rent(); &#125;&#125; jdkåŠ¨æ€ä»£ç† jdkåŠ¨æ€ä»£ç†ç”¨äºç›®æ ‡ç±»æœ‰æ¥å£çš„æƒ…å†µã€‚ä»£ç†ç±»ä¸æ˜¯æ‰‹åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆã€‚æœ‰æ—¶ç›®æ ‡å¯¹è±¡éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸­åˆ›å»ºï¼Œè¿™æ ·æƒ…å†µä¸‹ä¸èƒ½å¤Ÿä¿æŠ¤å’Œéšè—ç›®æ ‡å¯¹è±¡ï¼Œåªæ˜¯å¢å¼ºäº†ç›®æ ‡æ–¹æ³•åŠŸèƒ½ã€‚ä»£ç†ç±»çš„åç§°ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼š$ + Proxy + æ•°å­—ï¼Œæ•°å­—è¡¨ç¤ºå½“å‰JDKçš„Proxyæ‰€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç´¢å¼•ï¼Œç´¢å¼•ä»0å¼€å§‹è®¡æ•°ã€‚ ç›®æ ‡ç±»æ¥å£ 1234567891011121314package com.design.pattern.proxy.jdkproxy;/** * IRentalHouseService * * @author shunhua * @date 2019-10-03 */public interface IRentalHouseService &#123; /** * ç§Ÿæˆ¿æ–¹æ³• */ void rent();&#125; ç›®æ ‡ç±» 123456789101112131415161718192021222324package com.design.pattern.proxy.jdkproxy;import com.design.pattern.proxy.staticproxy.IRentalHouseService;import lombok.extern.slf4j.Slf4j;/** * RentalHouseServiceImpl ç›®æ ‡ç±» * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class RentalHouseServiceImpl implements IRentalHouseService &#123; /** * å‡ºç§Ÿæˆ¿å­ï¼Œç›®æ ‡æ–¹æ³• * @return */ @Override public void rent()&#123; log.info(\"1800/æœˆï¼Œ2å®¤1å…1å¨1å«ï¼\"); &#125;&#125; InvocationHandlerå®ç° 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package com.design.pattern.proxy.jdkproxy;import lombok.extern.slf4j.Slf4j;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * RentalHouseServiceProxy * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class RentalHouseServiceProxy implements InvocationHandler &#123; private IRentalHouseService target; public RentalHouseServiceProxy(IRentalHouseService target) &#123; this.target = target; &#125; /** * å½“æ‰§è¡Œä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•æ—¶ï¼Œä»£ç†æ–¹æ³•ä¼šè°ƒç”¨è¯¥invoke() * * @param proxy ä»£ç†å¯¹è±¡ * @param method ç›®æ ‡æ–¹æ³• * @param args ç›®æ ‡æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ * @return * @throws Throwable */ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; // è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰ dialNumber(); // æ‰§è¡Œç›®æ ‡æ–¹æ³• Object result = method.invoke(target, args); // è°ƒç”¨ç›®æ ‡æ–¹æ³•å signContract(); return result; &#125; /** * éœ€è¦æˆ¿ç§Ÿè¯·è”ç³»æˆ‘ï¼Œç›®æ ‡æ–¹æ³•çš„å‰ç½®æ–¹æ³• */ private void dialNumber() &#123; log.info(\"éœ€è¦ç§Ÿæˆ¿è¯·è‡´ç”µï¼š123456\"); &#125; /** * ç­¾åˆåŒï¼Œç›®æ ‡æ–¹æ³•çš„åç½®æ–¹æ³• */ private void signContract() &#123; log.info(\"æˆ¿å­è¿˜æ»¡æ„å°±å¯ä»¥ç­¾åˆåŒäº†ï¼\"); &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233package com.design.pattern.proxy.jdkproxy;import org.junit.Test;import java.lang.reflect.Proxy;/** * Client * * @author shunhua * @date 2019-10-04 */public class Client &#123; @Test public void test()&#123; // åˆ›å»ºç›®æ ‡å¯¹è±¡ IRentalHouseService target = new RentalHouseServiceImpl(); // åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡ï¼‰ IRentalHouseService proxy = (IRentalHouseService) Proxy.newProxyInstance( target.getClass().getClassLoader(), target.getClass().getInterfaces(), new RentalHouseServiceProxy(target) ); /** * è°ƒç”¨ä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•,æ³¨æ„å½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•æ—¶ï¼ŒInvocationHandlerçš„invokeæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ */ proxy.rent(); &#125;&#125; CGLIBåŠ¨æ€ä»£ç† CGLIBçš„åº•å±‚æ˜¯é€šè¿‡ä½¿ç”¨å­—èŠ‚ç å¤„ç†æ¡†æ¶ASMæ¥è½¬æ¢å­—èŠ‚ç å¹¶ç”Ÿæˆæ–°çš„ç±»ï¼Œä»£ç†çš„ç›®æ ‡ç±»å¯ä»¥æ²¡æœ‰å®ç°æ¥å£ï¼Œä¹Ÿå¯ä»¥æœ‰å®ç°çš„æ¥å£ã€‚CGLIBä½¿ç”¨å­ç±»æ‰©å±•çˆ¶ç±»çš„æ–¹å¼æ¥ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œå³CGLIBä¼šåŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ä½œä¸ºä»£ç†ç±»ï¼Œå¹¶åˆ›å»ºå…¶å¯¹è±¡å³ä»£ç†å¯¹è±¡ã€‚ ç›®æ ‡ç±» 123456789101112131415161718192021222324package com.design.pattern.proxy.cglibproxy;import com.design.pattern.proxy.staticproxy.IRentalHouseService;import lombok.extern.slf4j.Slf4j;/** * RentalHouseServiceImpl ç›®æ ‡ç±» * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class RentalHouseServiceImpl implements IRentalHouseService &#123; /** * å‡ºç§Ÿæˆ¿å­ï¼Œç›®æ ‡æ–¹æ³• * @return */ @Override public void rent()&#123; log.info(\"1800/æœˆï¼Œ2å®¤1å…1å¨1å«ï¼\"); &#125;&#125; MethodInterceptorçš„å®ç° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.design.pattern.proxy.cglibproxy;import lombok.extern.slf4j.Slf4j;import net.sf.cglib.proxy.MethodInterceptor;import net.sf.cglib.proxy.MethodProxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * RentalHouseServiceProxy * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class RentalHouseServiceProxy implements MethodInterceptor &#123; /** * * @param o ä»£ç†å¯¹è±¡ * @param method ç›®æ ‡æ–¹æ³• * @param objects ç›®æ ‡æ–¹æ³•å‚æ•°åˆ—è¡¨ * @param methodProxy ç›®æ ‡æ–¹æ³•çš„ä»£ç†å¯¹è±¡ * @return * @throws Throwable */ @Override public Object intercept(Object o, Method method, Object[] objects, MethodProxy methodProxy) throws Throwable &#123; return null; &#125; /** * éœ€è¦æˆ¿ç§Ÿè¯·è”ç³»æˆ‘ï¼Œç›®æ ‡æ–¹æ³•çš„å‰ç½®æ–¹æ³• */ private void dialNumber() &#123; log.info(\"éœ€è¦ç§Ÿæˆ¿è¯·è‡´ç”µï¼š123456\"); &#125; /** * ç­¾åˆåŒï¼Œç›®æ ‡æ–¹æ³•çš„åç½®æ–¹æ³• */ private void signContract() &#123; log.info(\"æˆ¿å­è¿˜æ»¡æ„å°±å¯ä»¥ç­¾åˆåŒäº†ï¼\"); &#125;&#125; ç”Ÿæˆä»£ç†ç±»çš„é€»è¾‘ç±» 1234567891011121314151617181920212223242526272829303132333435package com.design.pattern.proxy.cglibproxy;import net.sf.cglib.proxy.Enhancer;import net.sf.cglib.proxy.MethodInterceptor;/** * CglibProxy æ‰‹åŠ¨åˆ›å»º * * @author shunhua * @date 2019-10-04 */public class CglibProxy &#123; /** * åˆ›å»ºCglibçš„ä»£ç†å¯¹è±¡ * * @param targetClass ç›®æ ‡ç±» * @param callBack å§”æ‰˜ç±»å¯¹è±¡ * @return */ public static IRentalHouseService createCglibProxy(Class targetClass, MethodInterceptor callBack)&#123; // åˆ›å»ºå¢å¼ºå…¶ Enhancer enhancer = new Enhancer(); // æŒ‡å®šç›®æ ‡ç±» enhancer.setSuperclass(targetClass); // è®¾ç½®å›è°ƒæ¥å£ enhancer.setCallback(callBack); // åˆ›å»ºå¹¶è¿”å›ä»£ç†å¯¹è±¡ï¼Œå³ç›®æ ‡ç±»çš„å­ç±»å¯¹è±¡ return (IRentalHouseService) enhancer.create(); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425262728293031package com.design.pattern.proxy.cglibproxy;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-04 */public class Client &#123; @Test public void test() &#123; // åˆ›å»ºç›®æ ‡å¯¹è±¡ IRentalHouseService target = new RentalHouseServiceImpl(); // åˆ›å»ºå§”æ‰˜å¯¹è±¡ RentalHouseServiceProxy rentalHouseServiceProxy = new RentalHouseServiceProxy(); // åˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆæ¥å£å®ç°ç±»çš„ä»£ç†å¯¹è±¡ï¼‰ IRentalHouseService cglibProxy = CglibProxy.createCglibProxy(target.getClass(), rentalHouseServiceProxy); /** * è°ƒç”¨ä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•,æ³¨æ„å½“è°ƒç”¨ä»£ç†å¯¹è±¡çš„ä»£ç†æ–¹æ³•æ—¶ï¼ŒInvocationHandlerçš„invokeæ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ */ cglibProxy.rent(); &#125;&#125; ä»£ç†æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨jdkä¸­çš„åº”ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490package java.lang.reflect;import java.lang.ref.WeakReference;import java.security.AccessController;import java.security.PrivilegedAction;import java.util.Arrays;import java.util.IdentityHashMap;import java.util.Map;import java.util.Objects;import java.util.concurrent.atomic.AtomicLong;import java.util.function.BiFunction;import sun.misc.ProxyGenerator;import sun.misc.VM;import sun.reflect.CallerSensitive;import sun.reflect.Reflection;import sun.reflect.misc.ReflectUtil;import sun.security.util.SecurityConstants;public class Proxy implements java.io.Serializable &#123; private static final long serialVersionUID = -2222568056686623797L; /** parameter types of a proxy class constructor */ private static final Class&lt;?&gt;[] constructorParams = &#123; InvocationHandler.class &#125;; /** * a cache of proxy classes */ private static final WeakCache&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; proxyClassCache = new WeakCache&lt;&gt;(new KeyFactory(), new ProxyClassFactory()); /** * the invocation handler for this proxy instance. * @serial */ protected InvocationHandler h; /** * Prohibits instantiation. */ private Proxy() &#123; &#125; /** * Constructs a new &#123;@code Proxy&#125; instance from a subclass * (typically, a dynamic proxy class) with the specified value * for its invocation handler. * * @param h the invocation handler for this proxy instance * * @throws NullPointerException if the given invocation handler, &#123;@code h&#125;, * is &#123;@code null&#125;. */ protected Proxy(InvocationHandler h) &#123; Objects.requireNonNull(h); this.h = h; &#125; @CallerSensitive public static Class&lt;?&gt; getProxyClass(ClassLoader loader, Class&lt;?&gt;... interfaces) throws IllegalArgumentException &#123; final Class&lt;?&gt;[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; checkProxyAccess(Reflection.getCallerClass(), loader, intfs); &#125; return getProxyClass0(loader, intfs); &#125; /* * Check permissions required to create a Proxy class. * * To define a proxy class, it performs the access checks as in * Class.forName (VM will invoke ClassLoader.checkPackageAccess): * 1. \"getClassLoader\" permission check if loader == null * 2. checkPackageAccess on the interfaces it implements * * To get a constructor and new instance of a proxy class, it performs * the package access check on the interfaces it implements * as in Class.getConstructor. * * If an interface is non-public, the proxy class must be defined by * the defining loader of the interface. If the caller's class loader * is not the same as the defining loader of the interface, the VM * will throw IllegalAccessError when the generated proxy class is * being defined via the defineClass0 method. */ private static void checkProxyAccess(Class&lt;?&gt; caller, ClassLoader loader, Class&lt;?&gt;... interfaces) &#123; SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; ClassLoader ccl = caller.getClassLoader(); if (VM.isSystemDomainLoader(loader) &amp;&amp; !VM.isSystemDomainLoader(ccl)) &#123; sm.checkPermission(SecurityConstants.GET_CLASSLOADER_PERMISSION); &#125; ReflectUtil.checkProxyPackageAccess(ccl, interfaces); &#125; &#125; /** * ç”Ÿæˆä»£ç†ç±»çš„æ ¸å¿ƒæ–¹æ³• */ private static Class&lt;?&gt; getProxyClass0(ClassLoader loader, Class&lt;?&gt;... interfaces) &#123; if (interfaces.length &gt; 65535) &#123; throw new IllegalArgumentException(\"interface limit exceeded\"); &#125; // å¦‚æœç¼“å­˜ä¸­æœ‰å¯¹åº”çš„ä»£ç†ç±»å°±ç›´æ¥è·å–ï¼Œæ²¡æœ‰å°±åˆ›å»ºç„¶åæ”¾å…¥ç¼“å­˜ return proxyClassCache.get(loader, interfaces); &#125; /* * a key used for proxy class with 0 implemented interfaces */ private static final Object key0 = new Object(); /* * Key1 and Key2 are optimized for the common use of dynamic proxies * that implement 1 or 2 interfaces. */ /* * a key used for proxy class with 1 implemented interface */ private static final class Key1 extends WeakReference&lt;Class&lt;?&gt;&gt; &#123; private final int hash; Key1(Class&lt;?&gt; intf) &#123; super(intf); this.hash = intf.hashCode(); &#125; @Override public int hashCode() &#123; return hash; &#125; @Override public boolean equals(Object obj) &#123; Class&lt;?&gt; intf; return this == obj || obj != null &amp;&amp; obj.getClass() == Key1.class &amp;&amp; (intf = get()) != null &amp;&amp; intf == ((Key1) obj).get(); &#125; &#125; /* * a key used for proxy class with 2 implemented interfaces */ private static final class Key2 extends WeakReference&lt;Class&lt;?&gt;&gt; &#123; private final int hash; private final WeakReference&lt;Class&lt;?&gt;&gt; ref2; Key2(Class&lt;?&gt; intf1, Class&lt;?&gt; intf2) &#123; super(intf1); hash = 31 * intf1.hashCode() + intf2.hashCode(); ref2 = new WeakReference&lt;Class&lt;?&gt;&gt;(intf2); &#125; @Override public int hashCode() &#123; return hash; &#125; @Override public boolean equals(Object obj) &#123; Class&lt;?&gt; intf1, intf2; return this == obj || obj != null &amp;&amp; obj.getClass() == Key2.class &amp;&amp; (intf1 = get()) != null &amp;&amp; intf1 == ((Key2) obj).get() &amp;&amp; (intf2 = ref2.get()) != null &amp;&amp; intf2 == ((Key2) obj).ref2.get(); &#125; &#125; /* * a key used for proxy class with any number of implemented interfaces * (used here for 3 or more only) */ private static final class KeyX &#123; private final int hash; private final WeakReference&lt;Class&lt;?&gt;&gt;[] refs; @SuppressWarnings(\"unchecked\") KeyX(Class&lt;?&gt;[] interfaces) &#123; hash = Arrays.hashCode(interfaces); refs = (WeakReference&lt;Class&lt;?&gt;&gt;[])new WeakReference&lt;?&gt;[interfaces.length]; for (int i = 0; i &lt; interfaces.length; i++) &#123; refs[i] = new WeakReference&lt;&gt;(interfaces[i]); &#125; &#125; @Override public int hashCode() &#123; return hash; &#125; @Override public boolean equals(Object obj) &#123; return this == obj || obj != null &amp;&amp; obj.getClass() == KeyX.class &amp;&amp; equals(refs, ((KeyX) obj).refs); &#125; private static boolean equals(WeakReference&lt;Class&lt;?&gt;&gt;[] refs1, WeakReference&lt;Class&lt;?&gt;&gt;[] refs2) &#123; if (refs1.length != refs2.length) &#123; return false; &#125; for (int i = 0; i &lt; refs1.length; i++) &#123; Class&lt;?&gt; intf = refs1[i].get(); if (intf == null || intf != refs2[i].get()) &#123; return false; &#125; &#125; return true; &#125; &#125; /** * A function that maps an array of interfaces to an optimal key where * Class objects representing interfaces are weakly referenced. */ private static final class KeyFactory implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Object&gt; &#123; @Override public Object apply(ClassLoader classLoader, Class&lt;?&gt;[] interfaces) &#123; switch (interfaces.length) &#123; case 1: return new Key1(interfaces[0]); // the most frequent case 2: return new Key2(interfaces[0], interfaces[1]); case 0: return key0; default: return new KeyX(interfaces); &#125; &#125; &#125; /** * A factory function that generates, defines and returns the proxy class given * the ClassLoader and array of interfaces. */ private static final class ProxyClassFactory implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; &#123; // prefix for all proxy class names private static final String proxyClassNamePrefix = \"$Proxy\"; // next number to use for generation of unique proxy class names private static final AtomicLong nextUniqueNumber = new AtomicLong(); @Override public Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123; Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = new IdentityHashMap&lt;&gt;(interfaces.length); for (Class&lt;?&gt; intf : interfaces) &#123; /* * Verify that the class loader resolves the name of this * interface to the same Class object. */ Class&lt;?&gt; interfaceClass = null; try &#123; interfaceClass = Class.forName(intf.getName(), false, loader); &#125; catch (ClassNotFoundException e) &#123; &#125; if (interfaceClass != intf) &#123; throw new IllegalArgumentException( intf + \" is not visible from class loader\"); &#125; /* * Verify that the Class object actually represents an * interface. */ if (!interfaceClass.isInterface()) &#123; throw new IllegalArgumentException( interfaceClass.getName() + \" is not an interface\"); &#125; /* * Verify that this interface is not a duplicate. */ if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) &#123; throw new IllegalArgumentException( \"repeated interface: \" + interfaceClass.getName()); &#125; &#125; String proxyPkg = null; // package to define proxy class in int accessFlags = Modifier.PUBLIC | Modifier.FINAL; /* * Record the package of a non-public proxy interface so that the * proxy class will be defined in the same package. Verify that * all non-public proxy interfaces are in the same package. */ for (Class&lt;?&gt; intf : interfaces) &#123; int flags = intf.getModifiers(); if (!Modifier.isPublic(flags)) &#123; accessFlags = Modifier.FINAL; String name = intf.getName(); int n = name.lastIndexOf('.'); String pkg = ((n == -1) ? \"\" : name.substring(0, n + 1)); if (proxyPkg == null) &#123; proxyPkg = pkg; &#125; else if (!pkg.equals(proxyPkg)) &#123; throw new IllegalArgumentException( \"non-public interfaces from different packages\"); &#125; &#125; &#125; if (proxyPkg == null) &#123; // if no non-public proxy interfaces, use com.sun.proxy package proxyPkg = ReflectUtil.PROXY_PACKAGE + \".\"; &#125; /* * Choose a name for the proxy class to generate. */ long num = nextUniqueNumber.getAndIncrement(); String proxyName = proxyPkg + proxyClassNamePrefix + num; /* * Generate the specified proxy class. */ byte[] proxyClassFile = ProxyGenerator.generateProxyClass( proxyName, interfaces, accessFlags); try &#123; return defineClass0(loader, proxyName, proxyClassFile, 0, proxyClassFile.length); &#125; catch (ClassFormatError e) &#123; /* * A ClassFormatError here means that (barring bugs in the * proxy class generation code) there was some other * invalid aspect of the arguments supplied to the proxy * class creation (such as virtual machine limitations * exceeded). */ throw new IllegalArgumentException(e.toString()); &#125; &#125; &#125; // è¯¥æ–¹æ³•æœ€ç»ˆè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ @CallerSensitive public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException &#123; Objects.requireNonNull(h); final Class&lt;?&gt;[] intfs = interfaces.clone(); final SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; checkProxyAccess(Reflection.getCallerClass(), loader, intfs); &#125; /* * ç”Ÿæˆä»£ç†ç±»çš„æ ¸å¿ƒæ–¹æ³• */ Class&lt;?&gt; cl = getProxyClass0(loader, intfs); /* * Invoke its constructor with the designated invocation handler. */ try &#123; if (sm != null) &#123; checkNewProxyPermission(Reflection.getCallerClass(), cl); &#125; final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; if (!Modifier.isPublic(cl.getModifiers())) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; cons.setAccessible(true); return null; &#125; &#125;); &#125; return cons.newInstance(new Object[]&#123;h&#125;); &#125; catch (IllegalAccessException|InstantiationException e) &#123; throw new InternalError(e.toString(), e); &#125; catch (InvocationTargetException e) &#123; Throwable t = e.getCause(); if (t instanceof RuntimeException) &#123; throw (RuntimeException) t; &#125; else &#123; throw new InternalError(t.toString(), t); &#125; &#125; catch (NoSuchMethodException e) &#123; throw new InternalError(e.toString(), e); &#125; &#125; private static void checkNewProxyPermission(Class&lt;?&gt; caller, Class&lt;?&gt; proxyClass) &#123; SecurityManager sm = System.getSecurityManager(); if (sm != null) &#123; if (ReflectUtil.isNonPublicProxyClass(proxyClass)) &#123; ClassLoader ccl = caller.getClassLoader(); ClassLoader pcl = proxyClass.getClassLoader(); // do permission check if the caller is in a different runtime package // of the proxy class int n = proxyClass.getName().lastIndexOf('.'); String pkg = (n == -1) ? \"\" : proxyClass.getName().substring(0, n); n = caller.getName().lastIndexOf('.'); String callerPkg = (n == -1) ? \"\" : caller.getName().substring(0, n); if (pcl != ccl || !pkg.equals(callerPkg)) &#123; sm.checkPermission(new ReflectPermission(\"newProxyInPackage.\" + pkg)); &#125; &#125; &#125; &#125; /** * Returns true if and only if the specified class was dynamically * generated to be a proxy class using the &#123;@code getProxyClass&#125; * method or the &#123;@code newProxyInstance&#125; method. * * &lt;p&gt;The reliability of this method is important for the ability * to use it to make security decisions, so its implementation should * not just test if the class in question extends &#123;@code Proxy&#125;. * * @param cl the class to test * @return &#123;@code true&#125; if the class is a proxy class and * &#123;@code false&#125; otherwise * @throws NullPointerException if &#123;@code cl&#125; is &#123;@code null&#125; */ public static boolean isProxyClass(Class&lt;?&gt; cl) &#123; return Proxy.class.isAssignableFrom(cl) &amp;&amp; proxyClassCache.containsValue(cl); &#125; /** * Returns the invocation handler for the specified proxy instance. * * @param proxy the proxy instance to return the invocation handler for * @return the invocation handler for the proxy instance * @throws IllegalArgumentException if the argument is not a * proxy instance * @throws SecurityException if a security manager, &lt;em&gt;s&lt;/em&gt;, is present * and the caller's class loader is not the same as or an * ancestor of the class loader for the invocation handler * and invocation of &#123;@link SecurityManager#checkPackageAccess * s.checkPackageAccess()&#125; denies access to the invocation * handler's class. */ @CallerSensitive public static InvocationHandler getInvocationHandler(Object proxy) throws IllegalArgumentException &#123; /* * Verify that the object is actually a proxy instance. */ if (!isProxyClass(proxy.getClass())) &#123; throw new IllegalArgumentException(\"not a proxy instance\"); &#125; final Proxy p = (Proxy) proxy; final InvocationHandler ih = p.h; if (System.getSecurityManager() != null) &#123; Class&lt;?&gt; ihClass = ih.getClass(); Class&lt;?&gt; caller = Reflection.getCallerClass(); if (ReflectUtil.needsPackageAccessCheck(caller.getClassLoader(), ihClass.getClassLoader())) &#123; ReflectUtil.checkPackageAccess(ihClass); &#125; &#125; return ih; &#125; private static native Class&lt;?&gt; defineClass0(ClassLoader loader, String name, byte[] b, int off, int len);&#125; Springä¸­çš„åº”ç”¨12345678910111213141516public class ProxyFactoryBean extends ProxyCreatorSupport implements FactoryBean&lt;Object&gt;, BeanClassLoaderAware, BeanFactoryAware &#123; //å¦‚æœä¸å£°æ˜ï¼Œé»˜è®¤å•ä¾‹å¯¹è±¡ï¼Œæ³¨è§£å£°æ˜å¤šä¾‹ï¼Œåˆ™å£°æ˜å¤šä¾‹å¯¹è±¡ public Object getObject() throws BeansException &#123; this.initializeAdvisorChain(); if (this.isSingleton()) &#123; return this.getSingletonInstance(); &#125; else &#123; if (this.targetName == null) &#123; this.logger.warn(\"Using non-singleton proxies with singleton targets is often undesirable. Enable prototype proxies by setting the 'targetName' property.\"); &#125; return this.newPrototypeInstance(); &#125; &#125;&#125; 12JdkDynamicAopProxy:å¯¹jdkåŠ¨æ€ä»£ç†çš„å°è£…CglibAopProxy:å¯¹ç±»è¿›è¡Œä»£ç†å¢å¼º MyBatisä¸­çš„åº”ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package org.apache.ibatis.binding;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.util.Map;import java.util.concurrent.ConcurrentHashMap;import org.apache.ibatis.session.SqlSession;/** * @author Lasse Voss */public class MapperProxyFactory&lt;T&gt; &#123; private final Class&lt;T&gt; mapperInterface; private final Map&lt;Method, MapperMethod&gt; methodCache = new ConcurrentHashMap&lt;&gt;(); public MapperProxyFactory(Class&lt;T&gt; mapperInterface) &#123; this.mapperInterface = mapperInterface; &#125; public Class&lt;T&gt; getMapperInterface() &#123; return mapperInterface; &#125; public Map&lt;Method, MapperMethod&gt; getMethodCache() &#123; return methodCache; &#125; @SuppressWarnings(\"unchecked\") protected T newInstance(MapperProxy&lt;T&gt; mapperProxy) &#123; // ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡å¹¶è¿”å› return (T) Proxy.newProxyInstance(mapperInterface.getClassLoader(), new Class[] &#123; mapperInterface &#125;,); &#125; public T newInstance(SqlSession sqlSession) &#123; final MapperProxy&lt;T&gt; mapperProxy = new MapperProxy&lt;&gt;(sqlSession, mapperInterface, methodCache); return newInstance(mapperProxy); &#125;&#125;/** * MapperProxyä»£ç†ç±»çš„ä¿¡æ¯ */public class MapperProxy&lt;T&gt; implements InvocationHandler, Serializable &#123; private static final long serialVersionUID = -6424540398559729838L; private final SqlSession sqlSession; private final Class&lt;T&gt; mapperInterface; private final Map&lt;Method, MapperMethod&gt; methodCache; public MapperProxy(SqlSession sqlSession, Class&lt;T&gt; mapperInterface, Map&lt;Method, MapperMethod&gt; methodCache) &#123; this.sqlSession = sqlSession; this.mapperInterface = mapperInterface; this.methodCache = methodCache; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; try &#123; if (Object.class.equals(method.getDeclaringClass())) &#123; return method.invoke(this, args); &#125; else if (isDefaultMethod(method)) &#123; return invokeDefaultMethod(proxy, method, args); &#125; &#125; catch (Throwable t) &#123; throw ExceptionUtil.unwrapThrowable(t); &#125; final MapperMethod mapperMethod = cachedMapperMethod(method); return mapperMethod.execute(sqlSession, args); &#125; private MapperMethod cachedMapperMethod(Method method) &#123; return methodCache.computeIfAbsent(method, k -&gt; new MapperMethod(mapperInterface, method, sqlSession.getConfiguration())); &#125; // ... ç­‰ç­‰ ï½","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è§‚å¯Ÿè€…æ¨¡å¼","slug":"design_pattern/behaviour_type/è§‚å¯Ÿè€…æ¨¡å¼","date":"2019-10-01T16:00:00.000Z","updated":"2020-07-04T16:28:45.959Z","comments":true,"path":"posts/9a246216/","link":"","permalink":"https://gentryhuang.com/posts/9a246216/","excerpt":"","text":"å®šä¹‰å®šä¹‰äº†å¯¹è±¡ä¹‹é—´çš„ä¸€å¯¹å¤šä¾èµ–ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ï¼Œå½“ä¸»é¢˜å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒçš„æ‰€æœ‰ä¾èµ–è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶æ›´æ–°ã€‚ ç±»å‹è¡Œä¸ºå‹ é€‚ç”¨åœºæ™¯1å…³è”è¡Œä¸ºåœºæ™¯ï¼Œå»ºç«‹ä¸€å¥—è§¦å‘æœºåˆ¶ã€‚å¦‚ï¼šæ³¨æŸä¸ªäº§å“çš„ä»·æ ¼ï¼Œç„¶åè¿›è¡Œé€šçŸ¥ï¼Œå…¶ä¸­ä»·æ ¼çš„å˜åŠ¨å¯èƒ½ä¼šå½±å“ä¸€æ¡é“¾ï¼Œå°±åƒæ˜¯ä¸€ä¸ªè§¦å‘é“¾æ¡ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ä¸ªç§é“¾å¼å‘æœºåˆ¶ã€‚ ä¼˜ç‚¹12341. è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆ - å› ä¸ºæ˜¯æŠ½è±¡çš„è€¦åˆå…³ç³»ï¼Œä¸ç®¡æ˜¯å¢åŠ è§‚å¯Ÿè€…è¿˜æ˜¯è¢«è§‚å¯Ÿè€…éƒ½å¾ˆå®¹æ˜“æ‰©å±•2. æ”¯æŒå¹¿æ’­é€šä¿¡ - ç±»ä¼¼æ¶ˆæ¯å¹¿æ’­ï¼Œéœ€è¦ç›‘å¬ä¸»é¢˜çš„åªéœ€è¦æ³¨å†Œå°±å¯ä»¥äº† ç¼ºç‚¹123451. è§‚å¯Ÿè€…ä¹‹é—´æœ‰è¿‡å¤šçš„ç»†èŠ‚ä¾èµ–ã€æé«˜äº†æ—¶é—´æ¶ˆè€—åŠç¨‹åºå¤æ‚åº¦ - è¿‡å¤šçš„ä¾èµ–ï¼šè§¦å‘æœºåˆ¶å’Œè§¦å‘é“¾æ¡ - æé«˜äº†æ—¶é—´æ¶ˆè€—åŠç¨‹åºå¤æ‚åº¦ï¼šå¦‚æœä¸€ä¸ªè¢«è§‚å¯Ÿå¯¹è±¡æœ‰å¤šä¸ªç›´æ¥æˆ–é—´æ¥è§‚å¯Ÿè€…ï¼Œä¸€æ—¦è¢«è§‚å¯Ÿè€…å˜åŒ–ï¼Œç„¶åå‘å‡ºé€šçŸ¥ï¼Œå°†æ‰€æœ‰è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´2. ä½¿ç”¨è¦å¾—å½“ï¼Œé¿å…å¾ªç¯è°ƒç”¨ - å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´æœ‰å¾ªç¯ä¾èµ–çš„è¯ï¼Œè¢«è§‚å¯Ÿè€…ï¼ˆä¸»é¢˜å¯¹è±¡ï¼‰ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œè¿™æ ·ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ ç®€å•éœ€æ±‚å­¦ç”Ÿåœ¨å­¦ä¹ è¯¾ç¨‹çš„æ—¶å€™å¯èƒ½ä¼šæå‡ºé—®é¢˜ï¼Œè€Œè€å¸ˆåˆ™æ˜¯å…³æ³¨è‡ªå·±çš„è¯¾ç¨‹ï¼Œæœ‰å­¦ç”Ÿæå‡ºè‡ªå·±è¯¾ç¨‹çš„é—®é¢˜å°±ç»™å‡ºè§£ç­” è§‚å¯Ÿè€…æ¨¡å¼æ¼”ç»ƒ è¢«è§‚å¯Ÿè€…éœ€è¦ç»§æ‰¿çš„ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109package java.util;/** * @since JDK1.0 */public class Observable &#123; private boolean changed = false; private Vector&lt;Observer&gt; obs; /** Construct an Observable with zero Observers. */ public Observable() &#123; obs = new Vector&lt;&gt;(); &#125; /** * * åœ¨è§‚å¯Ÿè€…åˆ—è¡¨ä¸­å¢åŠ ä¸€ä¸ªè§‚å¯Ÿè€… * * @param o è¦æ·»åŠ çš„è§‚å¯Ÿè€…å¯¹è±¡ * @throws NullPointerException å¦‚æœå‚æ•°ä¼ å…¥nullä¼šæŠ›å‡ºå¼‚å¸¸ */ public synchronized void addObserver(Observer o) &#123; if (o == null) throw new NullPointerException(); if (!obs.contains(o)) &#123; obs.addElement(o); &#125; &#125; /** * ä»è§‚å¯Ÿè€…åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šçš„è§‚å¯Ÿè€… * * @param o è¦è¢«ç§»å‡ºçš„è§‚å¯Ÿè€… å‡ºå…¥ä¸ºnullä¸ä¼šæŠ›å‡ºå¼‚å¸¸ */ public synchronized void deleteObserver(Observer o) &#123; obs.removeElement(o); &#125; /** * é€šçŸ¥è§‚å¯Ÿè€…ä»¬ï¼Œä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…å‘ç”Ÿäº†æ”¹å˜ï¼‰ï¼Œè¯¥æ–¹æ³•ä¸ä¼ å‚æ•°ç»™è§‚å¯Ÿè€…ä»¬ */ public void notifyObservers() &#123; notifyObservers(null); &#125; /** * é€šçŸ¥è§‚å¯Ÿè€…ä»¬ï¼Œä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…å‘ç”Ÿäº†æ”¹å˜ï¼‰ï¼Œè¯¥æ–¹æ³•ä¼ å‚æ•°ç»™è§‚å¯Ÿè€…ä»¬ */ public void notifyObservers(Object arg) &#123; /* * a temporary array buffer, used as a snapshot of the state of * current Observers. */ Object[] arrLocal; synchronized (this) &#123; /* * åœ¨é€šçŸ¥è§‚å¯Ÿè€…ä»¬ä¹‹å‰ä¼šå…ˆæ ¡éªŒæ ‡è¯†ä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰æ”¹å˜çš„å±æ€§ï¼Œå¦‚æœæ²¡æœ‰æ”¹å˜å°±ç›´æ¥è¿”å›ä¸è¿›è¡Œé€šçŸ¥ */ if (!changed) return; arrLocal = obs.toArray(); clearChanged(); &#125; for (int i = arrLocal.length-1; i&gt;=0; i--) // é€šè¿‡è°ƒç”¨è§‚å¯Ÿè€…çš„updateæ–¹æ³•é€šçŸ¥è§‚å¯Ÿè€…ï¼Œä¼šæŠŠå½“å‰ä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…å¯¹è±¡ï¼‰ä¼ ç»™è§‚å¯Ÿè€… ((Observer)arrLocal[i]).update(this, arg); &#125; /** * æ¸…é™¤è§‚å¯Ÿè€…åˆ—è¡¨ */ public synchronized void deleteObservers() &#123; obs.removeAllElements(); &#125; /** * è°ƒç”¨è¿™ä¸ªæ–¹æ³•å°±æ˜¯è¯´æ˜äº†ä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…å‘ç”Ÿäº†æ”¹å˜ï¼‰ï¼Œè®¾ç½®æ ‡è¯†å¯¹è±¡ä¸ºtrue */ protected synchronized void setChanged() &#123; changed = true; &#125; /** * * è°ƒç”¨è¿™ä¸ªæ–¹æ³•è¯´æ˜ä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å·²ç»ä¸å†æ”¹å˜äº†æˆ–è€…è¦é€šçŸ¥çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥å®Œäº†ã€‚è¿™ä¸ªæ–¹æ³•ä¼šåœ¨è°ƒç”¨notifyObserversæ–¹æ³•è‡ªåŠ¨è°ƒç”¨ */ protected synchronized void clearChanged() &#123; changed = false; &#125; /** * è·å–ä¸»é¢˜å¯¹è±¡æ˜¯å¦æ”¹å˜çš„æ ‡è¯† */ public synchronized boolean hasChanged() &#123; return changed; &#125; /** * è¿”å›å…³æ³¨ä¸»é¢˜å¯¹è±¡çš„è§‚å¯Ÿçš„ä¸ªæ•° * * @return the number of observers of this object. */ public synchronized int countObservers() &#123; return obs.size(); &#125;&#125; è§‚å¯Ÿè€…éœ€è¦å®ç°çš„æ¥å£ 123456789101112package java.util;/** * @since JDK1.0 */public interface Observer &#123; /** * * å½“è®¢é˜…çš„ä¸»é¢˜å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¼šé€šè¿‡è°ƒç”¨ notifyObserversæ–¹æ³•æ¥é€šçŸ¥æ‰€æœ‰è®¾è®¡åˆ°çš„è§‚å¯Ÿè€…ï¼Œå°±æ˜¯é€šè¿‡è°ƒç”¨è§‚å¯Ÿè€…çš„updateæ–¹æ³•è¿›è¡Œé€šçŸ¥çš„ */ void update(Observable o, Object arg);&#125; ä¸»é¢˜ç±»ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package com.design.pattern.observer;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.util.ArrayList;import java.util.List;import java.util.Observable;/** * Course * 1 å®ƒä¸‹é¢æœ‰é—®é¢˜ï¼ŒCourseå±äºè¢«è§‚å¯Ÿè€…ï¼Œä¹Ÿå°±æ˜¯ä¸»é¢˜å¯¹è±¡ * 2 ä½œä¸ºè¢«è§‚å¯Ÿè€…å¿…é¡»ç»§æ‰¿Observableç±»ï¼Œæ ‡å¿—æ˜¯å¯è§‚å¯Ÿçš„ * * @author shunhua * @date 2019-10-02 */@Data@Slf4jpublic class Course extends Observable &#123; /** * è¯¾ç¨‹å */ private String name; /** * è¯¾ç¨‹å¯¹åº”çš„é—®é¢˜åˆ—è¡¨ */ private List&lt;Question&gt; questions = new ArrayList&lt;&gt;(); public Course(String name) &#123; this.name = name; &#125; public void addQuestion(Question question) &#123; questions.add(question); &#125; /** * ä¸»é¢˜æ”¹å˜æ–¹æ³• * * @param course */ public void produceQuestion(Course course) &#123; questions.stream().forEach(question -&gt; &#123; log.info(String.format(\"%såœ¨%sæå‡ºäº†é—®é¢˜\", question.getUserName(), course.getName())); /** * è°ƒç”¨çˆ¶ç±»Observabelä¸­çš„setChangedæ–¹æ³•ï¼ŒæŠŠchangedæ ‡è¯†è®¾ç½®ä¸ºtrue,è¡¨ç¤ºä¸»é¢˜å¯¹è±¡å‘ç”Ÿäº†æ”¹å˜,æ­¤æ—¶è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´è¿›è¡Œé€šä¿¡ */ setChanged(); /** * é€šçŸ¥è§‚å¯Ÿè€… */ notifyObservers(question); &#125; ); &#125;&#125; è§‚å¯Ÿè€… 123456789101112131415161718192021222324252627282930313233343536373839package com.design.pattern.observer;import lombok.AllArgsConstructor;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.util.Observable;import java.util.Observer;/** * Teacher * * 1 è§‚å¯Ÿçš„æ˜¯è¯¾ç¨‹ï¼Œè€Œä¸æ˜¯é—®é¢˜ï¼Œé—®é¢˜å±äºè¯¾ç¨‹ ã€‚ Teacherå±äºè§‚å¯Ÿè€… * 2 å¿…é¡»å®ç°Observeræ¥å£ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªè§‚å¯Ÿè€… * * @author shunhua * @date 2019-10-02 */@Data@AllArgsConstructor@Slf4jpublic class Teacher implements Observer &#123; /** * è€å¸ˆåç§° */ private String name; /** * * @param o è¢«è§‚å¯Ÿå¯¹è±¡ * @param arg è¢«è§‚å¯Ÿè€…çš„notifyObserversæ–¹æ³•ä¼ é€’è¿‡æ¥çš„å¯¹è±¡ */ @Override public void update(Observable o, Object arg) &#123; Course course = (Course) o; Question question = (Question) arg; log.info(String.format(\"%sè¯¾ç¨‹è¢«%såŒå­¦æå‡º%sçš„é—®é¢˜ï¼Œéœ€è¦%sè§£ç­”\",course.getName(),question.getUserName(),question.getQuestionContent(),name)); &#125;&#125; åº”ç”¨è¾…åŠ©ç±» 1234567891011121314151617181920212223package com.design.pattern.observer;import lombok.Builder;import lombok.Data;/** * Question * * @author shunhua * @date 2019-10-02 */@Data@Builderpublic class Question &#123; /** * é—®é¢˜æé—®è€…åç§° */ private String userName; /** * å…·ä½“é—®é¢˜ */ private String questionContent;&#125; åº”ç”¨å±‚ 123456789101112131415161718192021222324252627282930313233343536package com.design.pattern.observer;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-02 */public class Client &#123; @Test public void test()&#123; Course course = new Course(\"ã€ŠJavaä»å…¥é—¨åˆ°æ”¾å¼ƒã€‹\"); Teacher teacher = new Teacher(\"Javaå­¦é™¢è€å¸ˆ\"); Teacher teacher1 = new Teacher(\"é¼“åŠ±å¸ˆ\"); // ä¸ºè¯¾ç¨‹æ·»åŠ è§‚å¯Ÿè€… course.addObserver(teacher); course.addObserver(teacher1); // æ·»åŠ è¯¾ç¨‹çš„é—®é¢˜ course.addQuestion(Question.builder() .userName(\"gentryhuang\") .questionContent(\"Javaå­¦ä¸å®Œï¼Œéœ€è¦æ”¾å¼ƒå—ï¼Ÿ\") .build()); course.addQuestion(Question.builder() .userName(\"xw\") .questionContent(\"å¿«çœ‹ï¼Œåˆä¸€ä¸ªå­¦Javaçš„è½¬è¡Œäº†ï¼Œè¦è·‘è·¯å—ï¼Ÿ\") .build()); // ä¸»é¢˜å¯¹è±¡å‘ç”Ÿå˜åŒ–ï¼ˆæœ‰é—®é¢˜æå‡ºäº†ï¼‰ course.produceQuestion(course); &#125;&#125; è§‚å¯Ÿè€…æ¨¡å¼æºç è§£æç›‘å¬å™¨å®ç°æ–¹æ¡ˆå°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å®ç°çš„ä¸€ç§ Guavaä¸­è§‚å¯Ÿè€…æ¨¡å¼çš„ä½¿ç”¨ ä½¿ç”¨@Subscribeè¿›è¡Œæ–¹æ³•æ ‡æ³¨ 12345678910111213141516171819package com.design.pattern.observer.guava;import com.google.common.eventbus.Subscribe;import lombok.extern.slf4j.Slf4j;/** * GuavaEvent * * @author shunhua * @date 2019-10-02 */@Slf4jpublic class GuavaEvent &#123; @Subscribe public void subscribe(String event)&#123; log.info(\"æ‰§è¡Œsubscribeæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°æ˜¯ï¼š\" + event); &#125;&#125; åœ¨åº”ç”¨å±‚æŠŠè®¢é˜…è€…è¿›è¡Œæ³¨å†Œ 12345678910111213141516171819202122232425262728293031323334package com.design.pattern.observer.guava;import com.google.common.eventbus.EventBus;import org.junit.Test;/** * GuavaEventTest * * @author shunhua * @date 2019-10-02 */public class GuavaEventTest &#123; @Test public void test() &#123; /** * Guavaå®ç°è§‚å¯Ÿè€…æ¨¡å¼çš„æ ¸å¿ƒç±» */ EventBus eventBus = new EventBus(); /** * GuavaEventä¸­æœ‰ä½¿ç”¨@Subscribeæ³¨è§£æ ‡æ³¨çš„æ–¹æ³• */ GuavaEvent guavaEvent = new GuavaEvent(); /** * GuavaEventçš„@Subscribeæ ‡æ³¨çš„æ–¹æ³• åŠ å…¥åˆ°è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œä½œä¸ºè®¢é˜…è€…å³è§‚å¯Ÿè€… */ eventBus.register(guavaEvent); /** * è°ƒç”¨EventBusçš„postæ–¹æ³•ä¼šå›è°ƒSubscribeæ ‡æ³¨çš„æ–¹æ³• */ eventBus.post(\"postçš„å†…å®¹\"); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å•ä¾‹æ¨¡å¼","slug":"design_pattern/creation_type/å•ä¾‹æ¨¡å¼","date":"2019-10-01T16:00:00.000Z","updated":"2020-07-04T16:28:45.963Z","comments":true,"path":"posts/f1601c3e/","link":"","permalink":"https://gentryhuang.com/posts/f1601c3e/","excerpt":"","text":"å•ä¾‹æ¨¡å¼å®šä¹‰ä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚ ç±»å‹åˆ›å»ºå‹ é€‚ç”¨åœºæ™¯12æƒ³ç¡®ä¿ä»»ä½•æƒ…å†µä¸‹éƒ½ç»å¯¹åªæœ‰ä¸€ä¸ªå®ä¾‹ - æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ä»¥åŠè®¡æ•°å™¨ç­‰ ä¼˜ç‚¹1234561. åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€ - ç‰¹åˆ«æ˜¯ä¸€ä¸ªå¯¹è±¡é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯ï¼Œè€Œä¸”åœ¨åˆ›å»ºå’Œé”€æ¯æ—¶æ€§èƒ½åˆä¸èƒ½å¾ˆå¥½çš„ä¼˜åŒ–2. å¯ä»¥é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ - å¦‚å¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†™æ“ä½œï¼Œç”±äºåªæœ‰ä¸€ä¸ªå®ä¾‹å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥é¿å…å¯¹åŒä¸€ä¸ªèµ„æºæ–‡ä»¶åŒæ—¶å†™æ“ä½œ3. è®¾ç½®å…¨å±€è®¿é—®ç‚¹ï¼Œä¸¥æ ¼æ§åˆ¶è®¿é—® - å¯¹å¤–æ§åˆ¶åˆ›å»ºçš„å…¥å£ ç¼ºç‚¹1æ²¡æœ‰æ¥å£ï¼Œæ‰©å±•å›°éš¾ï¼Œæƒ³è¦æ‰©å±•éœ€è¦ä¿®æ”¹æºä»£ç  æ‹“å±•ç‚¹1234567891011121. ç§æœ‰æ„é€ å™¨ - ä¸ºäº†ç¦æ­¢ä»å•ä¾‹ç±»å¤–éƒ¨è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œä¸ºäº†è¾¾åˆ°ç›®çš„å¿…é¡»è®¾ç½®æ„é€ å‡½æ•°ä¸ºç§æœ‰çš„2. çº¿ç¨‹å®‰å…¨ - çº¿ç¨‹å®‰å…¨åœ¨å•ä¾‹æ¨¡å¼è®¾è®¡çš„è¿‡ç¨‹ä¸­éå¸¸é‡è¦3. å»¶è¿ŸåŠ è½½ - å»¶æ—¶åˆ›å»ºå¯¹è±¡4. åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®‰å…¨ - å¯¹äºå•ä¾‹å¯¹è±¡ä¸€æ—¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå°±ä¼šå¯¹å•ä¾‹è¿›è¡Œç ´å5. åå°„ - å•ä¾‹æ¨¡å¼ä¹Ÿè¦é˜²æ­¢åå°„æ”»å‡»6. åŒé‡æ£€é”æœºåˆ¶7. å•ä¾‹é™æ€å†…éƒ¨ç±»çš„å®ç°æ–¹æ¡ˆ å•ä¾‹æ¨¡å¼ç›¸å…³çš„è®¾è®¡æ¨¡å¼å•ä¾‹æ¨¡å¼å’Œå·¥å‚æ¨¡å¼ 1åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå·¥å‚ç±»è®¾ç½®ä¸ºå•ä¾‹çš„ å•ä¾‹æ¨¡å¼å’Œäº«å…ƒæ¨¡å¼ 1åœ¨ä¸€äº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œè¦ç®¡ç†å¾ˆå¤šå•ä¾‹å¯¹è±¡ï¼Œé€šè¿‡äº«å…ƒæ¨¡å¼å’Œå•ä¾‹æ¨¡å¼ç»“åˆæ¥å®Œæˆå•ä¾‹å¯¹è±¡çš„è·å–ï¼Œåœ¨è¿™ç§ç»“åˆåœºæ™¯ä¸‹ï¼Œäº«å…ƒæ¨¡å¼çš„åº”ç”¨å°±ç±»ä¼¼äºå•ä¾‹å¯¹è±¡çš„ä¸€ä¸ªå·¥å‚ï¼Œåªä¸è¿‡ä¼šè·å–å·²ç»åˆ›å»ºå¥½çš„å¯¹è±¡è€Œä¸ä¼šé‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ å•ä¾‹æ¨¡å¼ç±»å‹æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼-éå®‰å…¨ 1234567891011121314151617181920212223242526272829303132333435363738394041package com.design.pattern.singleton.lazynosafe;/** * LazyDoubleCheckSingleton æ‡’æ±‰å¼-çº¿ç¨‹ä¸å®‰å…¨ * * @author shunhua * @date 2019-10-02 */public class LazySingleton &#123; /** * å®šä¹‰LazySingletonå±æ€§ */ private static LazySingleton lazySingleton = null; /** * æŒ‡å®šæ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ */ private LazySingleton()&#123;&#125; /** * å…¨å±€æ§åˆ¶ç‚¹ * @return */ public static LazySingleton getInstance()&#123; /** * åœ¨æ²¡æœ‰æ–­ç‚¹å¹²é¢„çš„æƒ…å†µä¸‹ï¼Œå¤šçº¿ç¨‹æ‰§è¡Œå’ŒCPUåˆ†é…æœ‰å…³ã€‚ä¸ºäº†æ›´æ¸…æ¥šçš„è§‚çœ‹å¤šçº¿ç¨‹æ‰§è¡Œï¼Œå¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹debugæ¥è¾¾åˆ°æ§åˆ¶å¤šä¸ªçº¿ç¨‹çš„ç›®çš„ * * åœ¨å¤šçº¿ç¨‹ä¸‹æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼Œè¿™é‡Œä»¥ä¸¤ä¸ªçº¿ç¨‹è§£é‡Šï¼Œçº¿ç¨‹Aå’Œçº¿ç¨‹B * * 1 å½“çº¿ç¨‹Bèµ°åˆ°if(lazySingleton == null)æ—¶ï¼Œçº¿ç¨‹Aå·²ç»æ‰§è¡Œåˆ›å»ºå¥½äº†å¯¹è±¡ï¼Œæ­¤æ—¶çº¿ç¨‹Bç›´æ¥è¿”å›çº¿ç¨‹Aåˆ›å»ºçš„å¯¹è±¡ * 2 å½“çº¿ç¨‹Bèµ°åˆ°if(lazySingleton == null)æ—¶ï¼Œçº¿ç¨‹Aè¿˜æ²¡æœ‰åˆ›å»ºå¥½å¯¹è±¡å³LazySingletonä»ç„¶ä¸ºç©ºï¼Œç´§æ¥ç€çº¿ç¨‹Bçš„ifåˆ¤æ–­é€šè¿‡ï¼Œå½“Aåˆ›å»ºå®Œå¯¹è±¡å‡†å¤‡è¿”å›lazySingletonå³æ‰§è¡Œreturn lazySingletonæ—¶ï¼Œçº¿ç¨‹Båˆ›å»ºå¥½äº†å¯¹è±¡å¹¶èµ‹å€¼ç»™lazySingletonï¼Œæ­¤æ—¶lazySingletonå˜é‡çš„å€¼æ˜¯çº¿ç¨‹Båˆ›å»ºçš„å¯¹è±¡å¼•ç”¨ï¼Œä¼šè¦†ç›–çº¿ç¨‹Aåˆ›å»ºçš„å¯¹è±¡å¯¹åº”çš„å¼•ç”¨ï¼Œæœ€ç»ˆçº¿ç¨‹Aå’Œçº¿ç¨‹Bè¿”å›çš„è™½ç„¶æ˜¯æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼ˆçº¿ç¨‹Båˆ›å»ºçš„ï¼‰çš„å¼•ç”¨ï¼Œä½†æ˜¯å®è´¨ä¸Šå¯¹è±¡å·²ç»åˆ›å»ºäº†ä¸¤æ¬¡ã€‚ * 3 å½“çº¿ç¨‹Bèµ°åˆ°if(lazySingleton == null)æ—¶ï¼Œçº¿ç¨‹Aè¿˜æ²¡æœ‰åˆ›å»ºå¥½å¯¹è±¡å³LazySingletonä»ç„¶ä¸ºç©ºï¼Œä»…æ¥ç€çº¿ç¨‹Bçš„ifåˆ¤æ–­é€šè¿‡ï¼Œçº¿ç¨‹Aåœ¨çº¿ç¨‹Båˆ›å»ºå¯¹è±¡ä¹‹å‰è¿”å›äº†ï¼Œé‚£ä¹ˆæœ€ç»ˆçº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½ä¼šåˆ›å»ºå¯¹è±¡ï¼Œå¹¶ä¸”è¿”å›çš„å¯¹è±¡å¼•ç”¨ä¸ä¼šç›¸åŒï¼Œå®ƒä»¬æŒ‡å‘å„è‡ªåˆ›å»ºçš„å¯¹è±¡ã€‚ * */ if(lazySingleton == null)&#123; lazySingleton = new LazySingleton(); &#125; return lazySingleton; &#125;&#125; 123456789101112131415161718192021package com.design.pattern.singleton.lazynosafe;import lombok.extern.slf4j.Slf4j;/** * MyThread å®ç°Runnableæ¥å£ï¼Œå®ç°å¤šçº¿ç¨‹ * * @author shunhua * @date 2019-10-02 */@Slf4jpublic class MyThread implements Runnable &#123; @Override public void run() &#123; // è·å–ç›®æ ‡å¯¹è±¡ LazySingleton lazySingleton = LazySingleton.getInstance(); // æ‰“å°å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¿¡æ¯å’Œç›®æ ‡å¯¹è±¡ä¿¡æ¯ log.info(Thread.currentThread().getName() +\" \"+ lazySingleton); &#125;&#125; æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼å®‰å…¨-é”ç²’åº¦è¾ƒå¤§ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.design.pattern.singleton.lazysafebutlockisbig;/** * LazyDoubleCheckSingleton æ‡’æ±‰å¼-çº¿ç¨‹å®‰å…¨ä½†æ˜¯é”çš„ç²’åº¦å¤ªå¤§ * * @author shunhua * @date 2019-10-02 */public class LazySingleton &#123; /** * å®šä¹‰LazySingletonå±æ€§ */ private static LazySingleton lazySingleton = null; /** * æŒ‡å®šæ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ */ private LazySingleton()&#123;&#125; /** * å…¨å±€æ§åˆ¶ç‚¹ * * synchronizeåŠ é”çš„ä½ç½®ä¸åŒï¼Œçº¿ç¨‹æŒæœ‰çš„å¯¹è±¡ä¹Ÿä¼šä¸åŒ * 1 åŠ åœ¨é™æ€æ–¹æ³•ä¸Šï¼ŒæŒæœ‰çš„æ˜¯ç±»çš„classæ–‡ä»¶ï¼Œå³å½“å‰ç±» * 2 åŠ åœ¨éé™æ€æ–¹æ³•ä¸Šï¼ŒæŒæœ‰çš„æ˜¯å †å†…å­˜ä¸­çš„å¯¹è±¡ï¼Œå³æ‰§è¡Œå½“å‰æ–¹æ³•çš„å¯¹è±¡ * * @return */ public synchronized static LazySingleton getInstance()&#123; /** * synchronizeåŠ é”åœ¨é™æ€æ–¹æ³•ä¸Šç­‰åŒäºé”ä»£ç å—æ—¶LazySingleton.classä½œä¸ºæŒæœ‰å¯¹è±¡ï¼š * * public static LazyDoubleCheckSingleton getInstance()&#123; * synchronized(LazyDoubleCheckSingleton.class)&#123; * if (lazySingleton == null) &#123; * lazySingleton = new LazyDoubleCheckSingleton(); * &#125; * &#125; * return lazySingleton; * &#125; */ if(lazySingleton == null)&#123; lazySingleton = new LazySingleton(); &#125; return lazySingleton; &#125;&#125; æ‡’æ±‰å¼å•ä¾‹æ¨¡å¼-åŒé‡æ£€é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package com.design.pattern.singleton.lazysafedoublecheck;/** * LazyDoubleCheckSingleton åŒé‡æ£€é”ï¼Œå…¼é¡¾äº†æ€§èƒ½å’Œçº¿ç¨‹å®‰å…¨ * * @author shunhua * @date 2019-10-03 */public class LazyDoubleCheckSingleton &#123; /** * å®šä¹‰LazySingletonå±æ€§ ,è¿™é‡ŒåŠ volatileå…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’åºå’Œå†…å­˜å¯è§ */ private volatile static LazyDoubleCheckSingleton lazySingleton = null; /** * æŒ‡å®šæ„é€ æ–¹æ³•æ˜¯ç§æœ‰çš„ */ private LazyDoubleCheckSingleton()&#123;&#125; /** * å…¨å±€æ§åˆ¶ç‚¹ * * åŒé‡æ£€é”æŒ‡çš„å°±æ˜¯ä¸¤æ¬¡åˆ¤æ–­ * * @return */ public static LazyDoubleCheckSingleton getInstance()&#123; /** * 1 è¿™ä¸€å±‚ifåˆ¤æ–­å¦‚æœä¸ä½¿ç”¨ä¹Ÿèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯é”çš„ç²’åº¦åˆå›åˆ°äº†å¤§ç²’åº¦ç‰ˆæœ¬ã€‚ä½¿ç”¨è¿™ä¸€å±‚åˆ¤æ–­æ˜¯ä¸ºäº†ç¼©å°synchronizedé”çš„ç²’åº¦ * 2 å¼•å…¥äº†è¿™ä¸€å±‚ä¼šå¢åŠ ä¸€ä¸ªéšæ‚£-ç”±äºæŒ‡ä»¤é‡æ’åºï¼Œèµ°åˆ°è¯¥å±‚ifåˆ¤æ–­lazySingletonå¯èƒ½ç¡®å®ä¸ä¸ºç©ºï¼Œä½†æ˜¯å®ƒæŒ‡å‘çš„å¯¹è±¡å¯èƒ½è¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆï¼Œå½“ä½¿ç”¨è¿™ä¸ªå¯¹è±¡çš„æ—¶å€™å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå¼‚å¸¸ */ if(lazySingleton == null)&#123; /** * åŠ é” */ synchronized (LazyDoubleCheckSingleton.class)&#123; /** * è¿™ä¸€å±‚ifå¿…é¡»è¦æœ‰ï¼Œå› ä¸ºsynchronizedé”çš„ç²’åº¦å°äº†ï¼Œä¸æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œå½“å‡ºç°çº¿ç¨‹è¿›å…¥ç¬¬ä¸€ä¸ªifå—ä¸­ä½†è¢«é˜»å¡åœ¨åŒæ­¥ä»£ç å—å¤–æ—¶ï¼ˆåˆ«çš„çº¿ç¨‹æ‹¿åˆ°äº†é”åœ¨é‡Œé¢åˆ›å»ºå¯¹è±¡ï¼‰ï¼Œ * å¦‚æœä¸åŠ è¯¥ifåˆ¤æ–­è¯¥çº¿ç¨‹è¿˜ä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸ä¼šç›´æ¥è¿”å›å·²ç»åˆ›å»ºå¥½çš„å¯¹è±¡çš„å¼•ç”¨ã€‚ */ if(lazySingleton == null)&#123; /** LazyDoubleCheckSingleton = new LazyDoubleCheckSingleton() JVMä¸»è¦åšçš„äº‹ç²—ç•¥æ­¥éª¤å¦‚ä¸‹ï¼š * * 1. åœ¨å †ç©ºé—´é‡Œåˆ†é…å†…å­˜ç»™è¿™ä¸ªå¯¹è±¡ * 2. æ‰§è¡Œæ„é€ æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œæ³¨æ„æ­¤åˆå§‹åŒ–ä¸æ˜¯ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åˆå§‹åŒ– * 3. è®¾ç½®lazySingletonæŒ‡å‘åˆ†é…å¥½çš„å†…å­˜åœ°å€ * æ³¨æ„ï¼šåœ¨æ²¡æœ‰å¤„ç†æŒ‡ä»¤é‡æ’åºçš„æƒ…å†µä¸‹2ã€3ä¸¤æ­¥ç”±äºé‡æ’åºå¯èƒ½æ­¥éª¤ä¼šå€’ç½®ï¼ˆå› ä¸ºJavaè¯­è¨€è§„èŒƒï¼Œå…è®¸é‚£äº›åœ¨å•çº¿ç¨‹å†…ä¸ä¼šæ”¹å˜å•çº¿ç¨‹ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼Œå› ä¸ºæœ‰çš„é‡æ’åºå¯ä»¥æé«˜ç¨‹åºæ‰§è¡Œæ€§èƒ½ ï¼‰ï¼Œè¿™ä¼šå¯èƒ½ä¼šé€ æˆçº¿ç¨‹æ‹¿åˆ°çš„å¼•ç”¨æŒ‡å‘çš„æ˜¯ä¸€ä¸ªè¿˜æ²¡æœ‰åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ï¼Œè™½ç„¶ä¸ä¸ºç©ºä½†å®ƒè¿˜æ²¡æœ‰æ‰§è¡Œæ„é€ æ–¹æ³•ï¼Œå¦‚æœæ°å·§æ„é€ æ–¹æ³•é‡Œé¢éœ€è¦å¯¹æŸäº›å‚æ•°è¿›è¡Œåˆå§‹åŒ–ï¼Œå½“ä½¿ç”¨è¿™ä¸ªå¯¹è±¡è¿˜æ²¡æœ‰åˆå§‹åŒ–çš„å‚æ•°æ—¶ä¼šå¯¼è‡´ç³»ç»Ÿå¼‚å¸¸ * * è¯¦ç»†çš„æ­¥éª¤å¦‚ä¸‹ï¼š * 1. å½“é‡åˆ°newæŒ‡ä»¤æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥è¿™ä¸ªæŒ‡å®šçš„å‚æ•°ä¹Ÿå°±æ˜¯LazyDoubleCheckSingletonèƒ½å¦åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¯¥ç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»æ‰§è¡Œè¿‡ç±»çš„åŠ è½½ï¼ˆåŠ è½½ã€è§£æã€å‡†å¤‡å’Œåˆå§‹åŒ–ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å°±æ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œå¦‚æœæ‰§è¡Œäº†æ¥ç€è™šæ‹Ÿæœºä¸ºæ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜ï¼ˆæ­¤æ—¶ä»è™šæ‹Ÿæœºçš„è§†è§’æ¥è¯´ä¸€ä¸ªæ–°å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼‰ï¼Œç´§æ¥ç€æ‰§è¡ŒnewæŒ‡ä»¤æ‰§è¡Œä¹‹åçš„è°ƒç”¨&lt;init&gt;æ–¹æ³•ã€‚ * 2. åŠ è½½ ï¼ˆ1 é€šè¿‡ç±»çš„å…¨é™å®šåè·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµ 2 å°†è¿™ä¸ªå­—èŠ‚æµä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„å³Classä¸­çš„å¸¸é‡æ± è¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ 3 åœ¨æ–¹æ³•åŒºç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„Classå¯¹è±¡ï¼‰ * 3. éªŒè¯ ï¼ˆç¡®ä¿Classæ–‡ä»¶çš„å­—èŠ‚æµä¸­åŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œç¡®ä¿è™šæ‹Ÿæœºè‡ªèº«å®‰å…¨ï¼‰ * 4. å‡†å¤‡ ï¼ˆåœ¨æ–¹æ³•åŒºä¸­ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼ï¼‰ * 5. è§£æ ï¼ˆå¯èƒ½ä¼šå‘ç”Ÿï¼Œå› ä¸ºå®ƒä¹Ÿå¯èƒ½å‘ç”Ÿåœ¨åˆå§‹åŒ–é˜¶æ®µä¹‹åã€‚ ä¸»è¦ä½œç”¨å°±æ˜¯å°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼‰ * 6. åˆå§‹åŒ– ï¼ˆè¿™æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œä¸»è¦å°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨&lt;clinit&gt;æ–¹æ³•ï¼Œåˆå§‹åŒ–ç±»å˜é‡ï¼‰ * * æœ€åï¼šè®¾ç½®lazySingletonæŒ‡å‘åˆ†é…å¥½çš„å†…å­˜åœ°å€ */ lazySingleton = new LazyDoubleCheckSingleton(); &#125; &#125; &#125; return lazySingleton; &#125;&#125; æšä¸¾å¼å•ä¾‹æ¨¡å¼ 12345678910111213141516171819202122232425262728293031323334353637383940package com.design.pattern.singleton.enuminstance;/** * EnumInstance ä½¿ç”¨æšä¸¾çš„æ–¹å¼å®ç°å•ä¾‹æ¨¡å¼ * * 1. æšä¸¾å®é™…ä¸Šæ˜¯ä¸€ä¸ªç»§æ‰¿Enumçš„è¢«finalä¿®é¥°çš„ç±»ï¼Œå®ƒçš„æ„é€ æ–¹æ³•ï¼ˆåªæœ‰æœ‰å‚æ„é€ æ–¹æ³•ï¼‰ä¹Ÿæ˜¯ç§æœ‰çš„ã€‚å…¶ä¸­æšä¸¾å¸¸é‡ä¹Ÿæ˜¯static finalçš„ï¼Œå¹¶ä¸”åœ¨staticä»£ç å—ä¸­å®ä¾‹åŒ–ï¼ˆå’Œæ¶æ±‰å¼å¾ˆåƒï¼‰ * 2. æšä¸¾å®ç°çš„å•ä¾‹é˜²æ­¢äº†åºåˆ—åŒ–æ”»å‡»ï¼ˆreadObjectæ–¹æ³•æ‰§è¡Œè·å–çš„å¯¹è±¡æ˜¯å·²ç»å­˜åœ¨çš„æšä¸¾å¸¸é‡ï¼‰å’Œåå°„æ”»å‡»ï¼ˆæšä¸¾ç±»çš„æ„é€ å‡½æ•°ä¼šåˆ¤æ–­ï¼Œå¦‚æœé€šè¿‡åå°„è°ƒç”¨å°±æŠ›å‡ºå¼‚å¸¸ï¼‰ä»¥åŠçº¿ç¨‹å®‰å…¨ * 3. æ¨èä½¿ç”¨æšä¸¾å®ç°å•ä¾‹ * * @author shunhua * @date 2019-10-03 */public enum EnumInstance &#123; /** * æšä¸¾å¸¸é‡ */ INSTANCE; /** * æšä¸¾çš„æˆå‘˜å˜é‡ */ private Object data; public Object getData() &#123; return data; &#125; public void setData(Object data) &#123; this.data = data; &#125; /** * æš´éœ²ç»™å¤–éƒ¨çš„å…¨å±€ç‚¹ * * @return */ public static EnumInstance getInstance() &#123; return INSTANCE; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105package com.design.pattern.singleton.enuminstance;import lombok.extern.slf4j.Slf4j;import java.io.*;import java.lang.reflect.Constructor;/** * EnumInstanceTest * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class EnumInstanceTest &#123; public static void main(String[] args) &#123; EnumInstance instance = EnumInstance.getInstance(); instance.setData(new Object()); try &#123; //------------------ æšä¸¾å®ç°çš„å•ä¾‹ï¼Œæ˜¯ä¸å—åºåˆ—åŒ–ç ´åçš„å½±å“---------------------/ File file = new File(\"singleton\"); // ä½¿ç”¨ObjectOutputStreamå¯¹è±¡è¾“å‡ºæµï¼ŒæŠŠå•ä¾‹å¯¹è±¡å†™å…¥æ–‡ä»¶ä¸­ã€‚æ³¨æ„æ–‡ä»¶çš„åç¼€åå¸¦ä¸å¸¦éƒ½è¡Œã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œå°±é»˜è®¤ä½¿ç”¨å½“å‰å·¥ç¨‹çš„ç›®å½•ä½œä¸ºè·¯å¾„ ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(file)); // å°†å•ä¾‹å¯¹è±¡å†™å…¥æ–‡ä»¶ä¸­ objectOutputStream.writeObject(instance); // ä½¿ç”¨ObjectInputStreamå¯¹è±¡è¾“å…¥æµï¼ŒæŠŠæ–‡ä»¶ä¸­çš„å•ä¾‹å¯¹è±¡è¯»åˆ°å†…å­˜ä¸­ ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(file)); EnumInstance newInstance = (EnumInstance) objectInputStream.readObject(); /** readObjectæ–¹æ³•è°ƒç”¨çš„æ ¸å¿ƒæ–¹æ³•ï¼šè¿™ä¸ªé€»è¾‘ä¿è¯äº†å–å‡ºçš„æšä¸¾å¯¹è±¡çš„å”¯ä¸€æ€§ private Enum&lt;?&gt; readEnum(boolean unshared) throws IOException &#123; if (bin.readByte() != TC_ENUM) &#123; throw new InternalError(); &#125; ObjectStreamClass desc = readClassDesc(false); if (!desc.isEnum()) &#123; throw new InvalidClassException(\"non-enum class: \" + desc); &#125; int enumHandle = handles.assign(unshared ? unsharedMarker : null); ClassNotFoundException resolveEx = desc.getResolveException(); if (resolveEx != null) &#123; handles.markException(enumHandle, resolveEx); &#125; // è·å–æšä¸¾å¯¹è±¡çš„åç§°ï¼Œè¿™ä¸ªæ˜¯å”¯ä¸€çš„ï¼Œå®ƒå¯¹åº”ä¸€ä¸ªæšä¸¾å¸¸é‡ String name = readString(false); Enum&lt;?&gt; result = null; // è·å–æšä¸¾å¯¹è±¡çš„Class Class&lt;?&gt; cl = desc.forClass(); if (cl != null) &#123; try &#123; // é€šè¿‡æšä¸¾å¯¹è±¡çš„Classå’Œæšä¸¾å¯¹è±¡çš„åç§°è·å–å¯¹åº”çš„æšä¸¾å¸¸é‡ï¼Œæ²¡æœ‰åˆ›å»ºæ–°çš„å¯¹è±¡ @SuppressWarnings(\"unchecked\") Enum&lt;?&gt; en = Enum.valueOf((Class)cl, name); result = en; &#125; catch (IllegalArgumentException ex) &#123; throw (IOException) new InvalidObjectException( \"enum constant \" + name + \" does not exist in \" + cl).initCause(ex); &#125; if (!unshared) &#123; handles.setObject(enumHandle, result); &#125; &#125; handles.finish(enumHandle); passHandle = enumHandle; return result; &#125; */ log.info(\"instance: \" + instance); log.info(\"newInstance: \" + newInstance); log.info(String.format(\"instance [%s] newInstance\", instance == newInstance)); System.out.println(\"------------------------------------------\"); log.info(\"instance: \" + instance.getData()); log.info(\"newInstance: \" + newInstance.getData()); log.info(String.format(\"instance.data [%s] newInstance.data\", instance.getData() == newInstance.getData())); //-------------------------- æšä¸¾å®ç°çš„å•ä¾‹,ä¸å—åå°„ç ´åçš„å½±å“ï¼Œ ----------------/ Class enumClass = EnumInstance.class; Constructor constructor = enumClass.getDeclaredConstructor(); constructor.setAccessible(true); /** * é€šè¿‡åå°„è°ƒç”¨æšä¸¾çš„æ„é€ å™¨ï¼ˆæ„é€ å™¨åªæœ‰æœ‰å‚æ„é€ ï¼‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé˜²æ­¢äº†åå°„æ”»å‡» */ &#125; catch (Exception e) &#123; log.info(e.getMessage()); &#125; &#125;&#125; å®¹å™¨å•ä¾‹æ¨¡å¼ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.design.pattern.singleton.containersingleton;import org.apache.commons.lang3.StringUtils;import org.springframework.util.ObjectUtils;import java.util.Map;import java.util.concurrent.ConcurrentHashMap;/** * ContainerSingleton å®¹å™¨å•ä¾‹æ¨¡å¼ * * ç»Ÿä¸€ç®¡ç†å¤šä¸ªå®ä¾‹ï¼ŒèŠ‚çœèµ„æº * * @author shunhua * @date 2019-10-03 */public class ContainerSingleton &#123; /** * å­˜æ”¾å¯¹è±¡ï¼Œç›¸å½“äºä¸€ä¸ªç¼“å­˜ */ private static Map&lt;String,Object&gt; SINGLETON_MAP = new ConcurrentHashMap&lt;&gt;(); /** * å¤šçº¿ç¨‹æƒ…å†µä¸‹ä¸å®‰å…¨ï¼Œå¯èƒ½å¯¼è‡´å€¼çš„è¦†ç›– * @param key * @param instance */ public static void putInstance(String key,Object instance)&#123; if(StringUtils.isNotBlank(key) &amp;&amp; !ObjectUtils.isEmpty(instance))&#123; if(!SINGLETON_MAP.containsKey(key))&#123; SINGLETON_MAP.put(key,instance); &#125; &#125; &#125; /** * è·å–å¯¹è±¡ * @param key * @return */ public static Object getInstance(String key)&#123; return SINGLETON_MAP.get(key); &#125;&#125; é¥¿æ±‰å¼å•ä¾‹æ¨¡å¼ 1234567891011121314151617181920212223242526272829303132333435363738394041package com.design.pattern.singleton.hungry;/** * HungrySingleton é¥¿æ±‰å¼ * &lt;p&gt; * 1 ä¼˜ç‚¹ * å†™æ³•ç®€å•ï¼Œç±»åŠ è½½ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„åˆå§‹åŒ–é˜¶æ®µä»¥åŠè°ƒç”¨æ„é€ å‡½æ•°ï¼‰çš„æ—¶å€™å°±å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œé¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ * 2 ç¼ºç‚¹ * ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œæ²¡æœ‰å»¶è¿Ÿæ•ˆæœï¼Œå¦‚æœç±»çš„å¯¹è±¡ä»å§‹è‡³ç»ˆéƒ½æ²¡æœ‰ç”¨è¿‡ï¼Œæˆ–è€…åªæ˜¯æƒ³è·å–ç±»çš„æŸä¸ªç±»å˜é‡ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šåˆ›å»ºå¯¹è±¡ï¼Œè¿™æ— ç–‘é€ æˆäº†å†…å­˜çš„æµªè´¹ * * * @author shunhua * @date 2019-10-03 */public class HungrySingleton &#123; /** * ç§æœ‰æ„é€ å‡½æ•° */ private HungrySingleton() &#123; &#125; /** * å£°æ˜ä¸ºfinalçš„å˜é‡å¿…é¡»åœ¨ç±»åŠ è½½å®Œæˆæ—¶ï¼ˆå‡†ç¡®çš„æ˜¯ç±»åŠ è½½åˆå§‹åŒ–çš„æ—¶å€™ï¼Œsingletonå°±éœ€è¦è¢«èµ‹å€¼å³HungrySingletonå¯¹è±¡çš„å¼•ç”¨ï¼‰å°±å·²ç»èµ‹å€¼ */ // private final static HungrySingleton singleton = new HungrySingleton(); private final static HungrySingleton singleton; static &#123; singleton = new HungrySingleton(); &#125; /** * å…¨å±€è®¿é—®ç‚¹ * @return */ public static HungrySingleton getInstance() &#123; return singleton; &#125;&#125; ç ´åé¥¿æ±‰å¼å•ä¾‹-æ–¹å¼1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.design.pattern.singleton.reflectattackresolve;/** * HungrySingleton é¥¿æ±‰å¼ * &lt;p&gt; * 1 ä¼˜ç‚¹ * å†™æ³•ç®€å•ï¼Œç±»åŠ è½½ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„åˆå§‹åŒ–é˜¶æ®µä»¥åŠè°ƒç”¨æ„é€ å‡½æ•°ï¼‰çš„æ—¶å€™å°±å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œé¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ * 2 ç¼ºç‚¹ * ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œæ²¡æœ‰å»¶è¿Ÿæ•ˆæœï¼Œå¦‚æœç±»çš„å¯¹è±¡ä»å§‹è‡³ç»ˆéƒ½æ²¡æœ‰ç”¨è¿‡ï¼Œæˆ–è€…åªæ˜¯æƒ³è·å–ç±»çš„æŸä¸ªç±»å˜é‡ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šåˆ›å»ºå¯¹è±¡ï¼Œè¿™æ— ç–‘é€ æˆäº†å†…å­˜çš„æµªè´¹ * * * @author shunhua * @date 2019-10-03 */public class HungrySingleton &#123; // private final static HungrySingleton singleton = new HungrySingleton(); private final static HungrySingleton singleton; /** * ç§æœ‰æ„é€ å‡½æ•° */ private HungrySingleton() &#123; if(singleton == null)&#123; System.out.println(\"è°ƒç”¨æ„é€ æ–¹æ³•åœ¨èµ‹å€¼å¼•ç”¨ç»™singletonä¹‹å‰ï¼Œè¿™æ˜¯æŒ‡ä»¤é‡æ’åºå¸¦æ¥çš„å¯èƒ½\"); &#125;else &#123; System.out.println(\"è°ƒç”¨æ„é€ æ–¹æ³•åœ¨èµ‹å€¼å¼•ç”¨ç»™singletonä¹‹åï¼Œè¿™æ˜¯æŒ‡ä»¤é‡æ’åºå¸¦æ¥çš„å¯èƒ½\"); &#125; &#125; /** * å£°æ˜ä¸ºfinalçš„å˜é‡å¿…é¡»åœ¨ç±»åŠ è½½å®Œæˆæ—¶ï¼ˆå‡†ç¡®çš„æ˜¯ç±»åŠ è½½åˆå§‹åŒ–çš„æ—¶å€™ï¼Œsingletonå°±éœ€è¦è¢«èµ‹å€¼å³HungrySingletonå¯¹è±¡çš„å¼•ç”¨ï¼‰å°±å·²ç»èµ‹å€¼ */ static &#123; singleton = new HungrySingleton(); &#125; /** * å…¨å±€è®¿é—®ç‚¹ * @return */ public static HungrySingleton getInstance() &#123; return singleton; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.design.pattern.singleton.reflectattackresolve;import lombok.extern.slf4j.Slf4j;import java.lang.reflect.Constructor;/** * HungrySingletonTest * * åå°„ç ´åå•ä¾‹æ¨¡å¼ä¸å®¹æ˜“å½»åº•é˜»æ­¢ï¼Œæ²¡æœ‰ç‰¹åˆ«å¥½çš„æ–¹å¼ã€‚ * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class HungrySingletonTest &#123; /** * å¯¹äºåœ¨ç±»åŠ è½½çš„æ•´ä¸ªè¿‡ç¨‹å®ä¾‹å°±èƒ½åˆ›å»ºå¥½çš„å•ä¾‹æ¨¡å¼ï¼ˆæ¶æ±‰å¼ã€é™æ€å†…éƒ¨ç±»ï¼‰ï¼Œä¸ºäº†é˜²æ­¢åå°„æ”»å‡»ï¼Œå¯ä»¥åœ¨æ„é€ æ–¹æ³•ä¸­è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯é€šè¿‡åå°„åˆ›å»ºå¯¹è±¡å°±æŠ›å‡ºå¼‚å¸¸ * * * @param args */ public static void main(String[] args) &#123; try &#123; // è·å–hungrySingletonçš„Classå¯¹è±¡ Class objectClass = HungrySingleton.class; // é€šè¿‡å…¨å±€è®¿é—®ç‚¹æ‹¿åˆ°å•ä¾‹å¯¹è±¡ HungrySingleton instance = HungrySingleton.getInstance(); // è·å–å£°æ˜çš„æ„é€ å™¨ Constructor constructor = objectClass.getDeclaredConstructor(); // å¼ºåˆ¶è®¾ç½®å£°æ˜çš„æ„é€ å™¨æ˜¯å¯ä»¥è®¿é—®çš„ constructor.setAccessible(true); // é€šè¿‡æ„é€ å™¨åå°„åˆ›å»ºå¯¹è±¡ HungrySingleton newInstance = (HungrySingleton) constructor.newInstance(); log.info(\"instance: \" + instance); log.info(\"newInstanceï¼š \" + newInstance); log.info(String.format(\"instance [%s] newInstance\",instance == newInstance)); &#125;catch (Exception e)&#123; log.info(e.getMessage()); &#125; &#125;&#125; ç ´åé¥¿æ±‰å¼å•ä¾‹-æ–¹å¼2 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package com.design.pattern.singleton.serializationdestroysingleton;import java.io.Serializable;/** * HungrySingleton é¥¿æ±‰å¼ * &lt;p&gt; * 1 ä¼˜ç‚¹ * å†™æ³•ç®€å•ï¼Œç±»åŠ è½½ï¼ˆä¸¥æ ¼æ¥è¯´æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„åˆå§‹åŒ–é˜¶æ®µä»¥åŠè°ƒç”¨æ„é€ å‡½æ•°ï¼‰çš„æ—¶å€™å°±å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œé¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ * 2 ç¼ºç‚¹ * ç±»åŠ è½½çš„æ—¶å€™å°±å®Œæˆäº†å¯¹è±¡çš„åˆ›å»ºï¼Œæ²¡æœ‰å»¶è¿Ÿæ•ˆæœï¼Œå¦‚æœç±»çš„å¯¹è±¡ä»å§‹è‡³ç»ˆéƒ½æ²¡æœ‰ç”¨è¿‡ï¼Œæˆ–è€…åªæ˜¯æƒ³è·å–ç±»çš„æŸä¸ªç±»å˜é‡ï¼Œé‚£ä¹ˆè¿˜æ˜¯ä¼šåˆ›å»ºå¯¹è±¡ï¼Œè¿™æ— ç–‘é€ æˆäº†å†…å­˜çš„æµªè´¹ * 3 å®ç°Serializableï¼Œä¸ºäº†å®ç°åºåˆ—åŒ– * * @author shunhua * @date 2019-10-03 */public class HungrySingleton implements Serializable &#123; private static final long serialVersionUID = 1136799709809340054L; /** * ç§æœ‰æ„é€ å‡½æ•° */ private HungrySingleton() &#123; &#125; /** * å£°æ˜ä¸ºfinalçš„å˜é‡å¿…é¡»åœ¨ç±»åŠ è½½å®Œæˆæ—¶ï¼ˆå‡†ç¡®çš„æ˜¯ç±»åŠ è½½åˆå§‹åŒ–çš„æ—¶å€™ï¼Œsingletonå°±éœ€è¦è¢«èµ‹å€¼å³HungrySingletonå¯¹è±¡çš„å¼•ç”¨ï¼‰å°±å·²ç»èµ‹å€¼ */ // private final static HungrySingleton singleton = new HungrySingleton(); private final static HungrySingleton singleton; static &#123; singleton = new HungrySingleton(); &#125; /** * å…¨å±€è®¿é—®ç‚¹ * @return */ public static HungrySingleton getInstance() &#123; return singleton; &#125; /** * 1. å¯¹äºä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–äº§ç”Ÿæ–°çš„å®ä¾‹çš„æ–¹å¼ç ´åäº†å•ä¾‹ï¼Œå¯ä»¥åœ¨ç±»ä¸­å¢åŠ readResolve()æ–¹æ³•æ¥é¢„é˜²ï¼ŒreadResolveï¼ˆï¼‰æ–¹æ³•è¿”å›å•ä¾‹å¯¹è±¡å³å¯ * 2. è¿™æ˜¯ååºåˆ—åŒ–æœºåˆ¶å†³å®šçš„ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™ä¼šåˆ¤æ–­ç±»å¦‚æœå®ç°äº†Serializableæˆ–è€…Externalizableæ¥å£åˆåŒ…å«readResolve()æ–¹æ³•çš„è¯ï¼Œä¼šç›´æ¥ * è°ƒç”¨readResolveï¼ˆï¼‰æ–¹æ³•æ¥è·å–å®ä¾‹ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒreadObjectæ–¹æ³•åº•å±‚ä¼šå…ˆé€šè¿‡åå°„åˆ›å»ºä¸€ä¸ªæ–°çš„å•ä¾‹å®ä¾‹ï¼Œç„¶åå†é€šè¿‡åå°„è°ƒç”¨readResolveæ–¹ * æ³•è·å–å•ä¾‹å¯¹è±¡ã€‚å³è™½ç„¶æœ€åé€šè¿‡readResolveæ‹¿åˆ°çš„æ˜¯å·²ç»åˆ›å»ºå¥½çš„å¯¹è±¡ï¼Œä½†æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡åå°„åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåªæ˜¯è¿™ä¸ªæ–°çš„å¯¹è±¡æ˜¯ç”¨æ¥è°ƒç”¨readResolveæ–¹æ³• * è¿”å›å•ä¾‹å¯¹è±¡è€Œå·²ã€‚ * * * @return */ public Object readResolve()&#123; return singleton; &#125;&#125; 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.design.pattern.singleton.serializationdestroysingleton;import lombok.extern.slf4j.Slf4j;import java.io.*;/** * HungrySingletonTest * * @author shunhua * @date 2019-10-03 */@Slf4jpublic class HungrySingletonTest &#123; public static void main(String[] args) &#123; HungrySingleton instance = HungrySingleton.getInstance(); try &#123; File file = new File(\"singleton\"); // ä½¿ç”¨ObjectOutputStreamå¯¹è±¡è¾“å‡ºæµï¼ŒæŠŠå•ä¾‹å¯¹è±¡å†™å…¥æ–‡ä»¶ä¸­ã€‚æ³¨æ„æ–‡ä»¶çš„åç¼€åå¸¦ä¸å¸¦éƒ½è¡Œã€‚å¦‚æœä¸æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œå°±é»˜è®¤ä½¿ç”¨å½“å‰å·¥ç¨‹çš„ç›®å½•ä½œä¸ºè·¯å¾„ ObjectOutputStream objectOutputStream = new ObjectOutputStream(new FileOutputStream(file)); // å°†å•ä¾‹å¯¹è±¡å†™å…¥æ–‡ä»¶ä¸­ objectOutputStream.writeObject(instance); // ä½¿ç”¨ObjectInputStreamå¯¹è±¡è¾“å…¥æµï¼ŒæŠŠæ–‡ä»¶ä¸­çš„å•ä¾‹å¯¹è±¡è¯»åˆ°å†…å­˜ä¸­ ObjectInputStream objectInputStream = new ObjectInputStream(new FileInputStream(file)); /** * * å¦‚æœHungrySingletonç±»å®ç°äº†Serializableæˆ–è€…Externalizableæ¥å£ï¼Œé‚£ä¹ˆreadObjectæ–¹æ³•åº•å±‚ä¼šä½¿ç”¨åå°„ï¼Œè°ƒç”¨ObjectStreamClass#newInstanceæ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å•ä¾‹å¯¹è±¡, * è¿™ä¸ªå•ä¾‹å¯¹è±¡æ˜¯ä¸ºäº†è°ƒç”¨å®ƒå¯¹åº”çš„ç±»ä¸­çš„readResolveæ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰å®ç°é‚£ä¸¤ä¸ªæ¥å£ä¸­çš„ä»»ä½•ä¸€ä¸ªå°±ä¼šè¿”å›nullã€‚å³æ¥ç€ä¼šåˆ¤æ–­è¿™ä¸ªæ–°åˆ›å»ºçš„å•ä¾‹å¯¹è±¡ä¸­æœ‰æ²¡æœ‰readResolveæ–¹æ³•ï¼Œå¦‚æœ * æœ‰å°±ä¼šé€šè¿‡åå°„è°ƒç”¨è¿™ä¸ªreadResolveæ–¹æ³•ï¼Œæœ€ç»ˆreadObjectæ–¹æ³•è¿”å›çš„æ˜¯readResolveæ–¹æ³•è¿”å›çš„å¯¹è±¡ * */ HungrySingleton newInstance = (HungrySingleton) objectInputStream.readObject(); log.info(\"instance: \" + instance); log.info(\"newInstance: \" + newInstance); log.info(String.format(\"instance [%s] newInstance\", instance == newInstance)); &#125; catch (Exception e) &#123; &#125; &#125;&#125; é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455package com.design.pattern.singleton.staticinnerclass;/** * StaticInnerClassSingleton é™æ€å†…éƒ¨ç±»çš„å•ä¾‹æ¨¡å¼ ï¼Œä½¿ç”¨é™æ€å†…éƒ¨ç±»ä¹Ÿæ˜¯åšå»¶è¿Ÿåˆå§‹åŒ–å•ä¾‹å¯¹è±¡ï¼Œæ¥é™ä½å•ä¾‹å®ä¾‹çš„å¼€é”€å³åœ¨éœ€è¦çš„æ—¶å€™æ‰è¿›è¡Œåˆå§‹åŒ– * * @author shunhua * @date 2019-10-03 */public class StaticInnerClassSingleton &#123; /** * ç§æœ‰æ„é€ å™¨ä¸èƒ½å°‘ï¼Œé˜²æ­¢å¤–éƒ¨åˆ›å»ºå¯¹è±¡ï¼Œè®©å¤–éƒ¨åªèƒ½é€šè¿‡å…¨å±€è®¿é—®ç‚¹æ‹¿åˆ°å•ä¾‹å¯¹è±¡ */ private StaticInnerClassSingleton()&#123;&#125; /** * 1. è¿™ä¸ªé™æ€å†…éƒ¨ç±»è¦å£°æ˜ä¸ºç§æœ‰çš„ï¼Œå› ä¸ºåˆ›å»ºå¯¹è±¡åœ¨å®ƒé‡Œé¢ï¼Œä¸èƒ½è®©å¤–é¢è®¿é—®å®ƒ * 2. å¦‚æœç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œéœ€è¦ç±»ç«‹å³åˆå§‹åŒ–çš„å¸¸è§æƒ…å†µï¼š * ï¼ˆ1ï¼‰new ä¸€ä¸ªå¯¹è±¡ * ï¼ˆ2ï¼‰ç±»ä¸­å£°æ˜çš„é™æ€æ–¹æ³•è¢«è°ƒç”¨ * ï¼ˆ3ï¼‰ç±»ä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€æˆå‘˜è¢«èµ‹å€¼ * ï¼ˆ4ï¼‰ç±»ä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€æˆå‘˜è¢«ä½¿ç”¨ï¼Œå¹¶ä¸”è¿™ä¸ªæˆå‘˜ä¸æ˜¯ä¸€ä¸ªå¸¸é‡ï¼ˆè¢«finalä¿®é¥°ï¼Œå·²åœ¨ç¼–è¯‘æœŸæŠŠç»“æœæ”¾å…¥å¸¸é‡æ± ä¸­çš„é™æ€å­—æ®µï¼‰ * ï¼ˆ5ï¼‰å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨ * ï¼ˆ6ï¼‰ä½œä¸ºçˆ¶ç±»ï¼ˆåŒ…æ‹¬æ¥å£ï¼‰ï¼Œå…¶å­ç±»è¢«åˆå§‹åŒ–äº†ï¼Œé‚£ä¹ˆçˆ¶ç±»éœ€è¦å…ˆåˆå§‹åŒ– * ï¼ˆ7ï¼‰æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å«mainæ–¹æ³•çš„ç±»ï¼‰ * * 3.ä½¿ç”¨é™æ€å†…éƒ¨ç±»åˆ›å»ºå•ä¾‹å¯¹è±¡åˆ©ç”¨äº†ç±»åŠ è½½è¿‡ç¨‹ä¸­çš„åˆå§‹åŒ–é˜¶æ®µçš„ç‰¹æ€§ï¼š * è™šæ‹Ÿæœºä¼šä¿è¯ä¸€ä¸ªç±»çš„ç±»æ„é€ å™¨&lt;clinit&gt;æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«æ­£ç¡®åœ°åŠ ç±»çš„å¯¹è±¡åˆå§‹åŒ–é”ï¼ˆè¿™æ˜¯JVMå¸®æˆ‘ä»¬è‡ªåŠ¨å®Œæˆçš„ï¼‰ã€åŒæ­¥ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å»åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œ * é‚£ä¹ˆåªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªç±»çš„ç±»æ„é€ å™¨æ–¹æ³•&lt;clinit&gt;ï¼Œå…¶ä»–çº¿ç¨‹éƒ½éœ€è¦é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°æ´»åŠ¨çº¿ç¨‹æ‰§è¡Œ&lt;clinit&gt;æ–¹æ³•å®Œæ¯•ã€‚ * å› æ­¤ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œ private static StaticInnerClassSingleton staticInnerClassSingleton = new StaticInnerClassSingleton()è¯­å¥ * ä¹Ÿä¸éœ€è¦å…³å¿ƒæŒ‡ä»¤é‡æ’åºçš„æƒ…å†µï¼Œå› ä¸ºåˆå§‹åŒ–é˜¶æ®µåœ¨å¯¹ç±»å˜é‡èµ‹å€¼çš„æ—¶å€™åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ‰§è¡Œ&lt;clinit&gt;æ–¹æ³•ï¼Œè€Œå•çº¿ç¨‹æ‰§è¡Œçš„æƒ…å†µä¸‹ï¼ŒæŒ‡ä»¤æ˜¯å¦é‡æ’åºæ˜¯æ²¡æœ‰å½±å“çš„ã€‚ */ private static class InnerClass &#123; /** * 1. åˆå§‹åŒ–æ—¶ï¼Œéœ€è¦staticInnerClassSingletonèµ‹å€¼ï¼Œå³ new StaticInnerClassSingleton()ä¼šè¢«æ‰§è¡Œã€‚è¿™äº›éƒ½æ˜¯&lt;clinit&gt;æ–¹æ³•æ‰§è¡Œçš„ç»“æœï¼Œè€Œ&lt;clinit&gt;æ–¹æ³•åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åªä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå³ä½¿è¿™ä¸ªæ–¹æ³•å†…éƒ¨æ¶‰åŠé‡æ’åºä¹Ÿå…³ç³»ã€‚ * 2. æ´»è·ƒçº¿ç¨‹åˆå§‹åŒ–ç±»ï¼ˆæ‰§è¡Œ&lt;clinit&gt;æ–¹æ³•ï¼‰å,ç±»å·²ç»åˆå§‹åŒ–å®Œæˆï¼Œä¸ä¼šå†è¿›è¡Œåˆå§‹åŒ–ï¼Œå…¶ä»–çº¿ç¨‹ç›´æ¥è®¿é—®ç±»æˆå‘˜å³å¯ */ private static StaticInnerClassSingleton staticInnerClassSingleton = new StaticInnerClassSingleton(); &#125; /** * å…¨å±€è®¿é—®ç‚¹ * * å½“æ‰§è¡ŒgetInstanceæ–¹æ³•æ—¶å°±å»è°ƒç”¨InnerClasså†…éƒ¨ç±»é‡Œé¢çš„staticInnerClassSingletonå®ä¾‹ï¼Œæ­¤æ—¶InnerClasså†…éƒ¨ç±»ä¼šè¢«åŠ è½½åˆ°å†…å­˜é‡Œï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆ›å»ºå¯¹è±¡ï¼Œå’Œé¥¿æ±‰å¼ä¸€ä¸ªé“ç†ï¼Œä¿è¯äº†åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œ * è€Œä¸”åœ¨è°ƒç”¨getInstanceæ–¹æ³•æ—¶æ‰è¿›è¡Œå•ä¾‹çš„åˆ›å»ºï¼Œåˆå…·æœ‰æ‡’æ±‰å¼çš„éƒ¨åˆ†ç‰¹æ€§ã€‚ * @return */ public static StaticInnerClassSingleton getInstance() &#123; /** * å¤–éƒ¨è®¿é—®getInstanceè¿™ä¸ªå…¨å±€è®¿é—®ç‚¹æ—¶ï¼Œä¼šé—´æ¥è®¿é—®InnerClassçš„é™æ€æˆå‘˜ï¼Œè¿™ä¼šå¯¼è‡´é™æ€å†…éƒ¨ç±»è¢«åˆå§‹åŒ– */ return InnerClass.staticInnerClassSingleton; &#125;&#125; å•ä¾‹æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨jdk-RunTime 12345678910111213141516171819202122232425262728293031package java.lang;import java.io.*;import java.util.StringTokenizer;import sun.reflect.CallerSensitive;import sun.reflect.Reflection;/** * Every Java application has a single instance of class * &lt;code&gt;Runtime&lt;/code&gt; that allows the application to interface with * the environment in which the application is running. The current * runtime can be obtained from the &lt;code&gt;getRuntime&lt;/code&gt; method. * &lt;p&gt; * An application cannot create its own instance of this class. * * @author unascribed * @see java.lang.Runtime#getRuntime() * @since JDK1.0 */public class Runtime &#123; private static Runtime currentRuntime = new Runtime(); public static Runtime getRuntime() &#123; return currentRuntime; &#125; private Runtime() &#123;&#125; // ... çœç•¥å…¶ä»–æ–¹æ³•&#125; Spring-AbstractFactoryBean 12345678910111213141516171819202122232425262728@Overridepublic final T getObject() throws Exception &#123; if (isSingleton()) &#123; return (this.initialized ? this.singletonInstance : getEarlySingletonInstance()); &#125; else &#123; return createInstance(); &#125;&#125;/** * Determine an 'early singleton' instance, exposed in case of a * circular reference. Not called in a non-circular scenario. */@SuppressWarnings(\"unchecked\")private T getEarlySingletonInstance() throws Exception &#123; Class&lt;?&gt;[] ifcs = getEarlySingletonInterfaces(); if (ifcs == null) &#123; throw new FactoryBeanNotInitializedException( getClass().getName() + \" does not support circular references\"); &#125; if (this.earlySingletonInstance == null) &#123; this.earlySingletonInstance = (T) Proxy.newProxyInstance( this.beanClassLoader, ifcs, new EarlySingletonInvocationHandler()); &#125; return this.earlySingletonInstance;&#125; MyBatis-ErrorContext 12345678910111213141516171819202122232425262728293031323334public class ErrorContext &#123; private static final String LINE_SEPARATOR = System.getProperty(\"line.separator\",\"\\n\"); // åŸºäºThreadLocalçš„å•ä¾‹æ¨¡å¼ï¼Œå®ƒä¸æ˜¯æ•´ä¸ªåº”ç”¨å…¨å±€å”¯ä¸€è€Œæ˜¯çº¿ç¨‹çº§åˆ«å”¯ä¸€ï¼Œä¿è¯äº†æ¯ä¸ªçº¿ç¨‹å„è‡ªçš„é”™è¯¯ä¸Šä¸‹æ–‡ private static final ThreadLocal&lt;ErrorContext&gt; LOCAL = new ThreadLocal&lt;&gt;(); private ErrorContext stored; private String resource; private String activity; private String object; private String message; private String sql; private Throwable cause; /** * ç§æœ‰æ„é€ å™¨ */ private ErrorContext() &#123; &#125; /** * æ¯ä¸ªçº¿ç¨‹è·å–å„è‡ªçš„å¯¹è±¡ * @return */ public static ErrorContext instance() &#123; ErrorContext context = LOCAL.get(); if (context == null) &#123; context = new ErrorContext(); LOCAL.set(context); &#125; return context; &#125; // ... ç­‰ç­‰&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è§£é‡Šå™¨æ¨¡å¼","slug":"design_pattern/behaviour_type/è§£é‡Šå™¨æ¨¡å¼","date":"2019-10-01T16:00:00.000Z","updated":"2020-07-04T16:28:45.960Z","comments":true,"path":"posts/30cf0cd2/","link":"","permalink":"https://gentryhuang.com/posts/30cf0cd2/","excerpt":"","text":"å®šä¹‰ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•ï¼ˆè¯­æ³•ï¼‰çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥è¡¨ç¤ºæ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚å³ ä¸ºäº†è§£é‡Šä¸€ç§è¯­è¨€ï¼ˆè¯­è¨€çš„è¯­æ³•ï¼‰ï¼Œè€Œä¸ºè¯­è¨€åˆ›å»ºçš„è§£é‡Šå™¨ ç±»å‹è¡Œä¸ºå‹ é€‚ç”¨åœºæ™¯1åœ¨å¤„ç†æ—¥å¿—çš„æ—¶å€™ï¼Œç”±äºå¤šä¸ªæœåŠ¡äº§ç”Ÿçš„æ—¥å¿—æ ¼å¼ä¸ä¸€å®šç»Ÿä¸€ï¼Œä½†æ˜¯æ•°æ®é‡Œé¢çš„è¦ç´ æ˜¯ç›¸åŒçš„ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¨‹åºæ¥è§£å†³è¯¥é—®é¢˜ï¼Œè€Œè¿™ä¸ªç¨‹åºæˆ‘ä»¬å°±å¯ä»¥ç†è§£ä¸ºè§£é‡Šå™¨ï¼Œåªä¸è¿‡å¯ä»¥è§£é‡Šä¸åŒæ—¥å¿—æ ¼å¼ã€‚åœ¨å®é™…é¡¹ç›®ä¸­è§£é‡Šå™¨æ¨¡å¼ä½¿ç”¨çš„æ¯”è¾ƒå°‘ï¼Œå¤šä½¿ç”¨å¼€æºåŒ…ã€‚ ä¼˜ç‚¹1è¯­æ³•ç”±å¾ˆå¤šç±»è¡¨ç¤ºï¼Œå®¹æ˜“æ”¹å˜åŠæ‰©å±•æ­¤â€œè¯­è¨€â€ï¼ˆæ¶‰åŠçš„ä»£ç è¿˜ä¸è¶³ä»¥è¯´æ˜æ˜¯ç§è¯­è¨€ï¼‰ ç¼ºç‚¹1å½“è¯­æ³•è§„åˆ™æ•°ç›®å¤ªå¤šæ—¶ï¼Œå¢åŠ äº†ç³»ç»Ÿå¤æ‚åº¦ ç®€å•éœ€æ±‚è‡ªå®šä¹‰ä¸€å¥—å¯ä»¥åŠ æ³•ã€ä¹˜æ³•çš„è¯­æ³•ï¼Œä½¿ç”¨æ ˆæ¥è¡¨ç¤ºï¼Œè¿™å’Œæ—¥å¸¸çš„åŠ æ³•å’Œä¹˜æ³•æ˜¯ä¸ä¸€æ ·çš„ã€‚ç„¶åå®šä¹‰åŠ æ³•å’Œä¹˜æ³•è§£é‡Šå™¨ï¼Œè§£é‡Šå¯¹åº”çš„è¡¨è¾¾å¼ç„¶åæ‹¿åˆ°æœ€ç»ˆçš„ç»“æœã€‚ è§£é‡Šå™¨æ¨¡å¼æ¼”ç»ƒ è§£é‡Šå™¨æ¥å£ 123456789101112131415package com.design.pattern.interpreter;/** * Interpreter è§£é‡Šæ¥å£ * * @author shunhua * @date 2019-10-02 */public interface Interpreter &#123; /** * è§£é‡Šæ–¹æ³• * @return */ int interpret();&#125; åŠ æ³•è§£é‡Šå™¨ 123456789101112131415161718192021222324252627282930313233343536373839package com.design.pattern.interpreter;/** * AddInterpreter åŠ æ³•è§£é‡Šå™¨ * * @author shunhua * @date 2019-10-02 */public class AddInterpreter implements Interpreter &#123; /** * å®ƒä»¬çš„æ–¹æ³•è¿”å›å€¼ä½œä¸ºåŠ æ•°å’Œè¢«åŠ æ•° */ private Interpreter firstExpression,secondeExpression; /** * åŠ æ³•éœ€è¦ åŠ æ•°å’Œè¢«åŠ æ•° * @param firstExpression * @param secondeExpression */ public AddInterpreter(Interpreter firstExpression,Interpreter secondeExpression)&#123; this.firstExpression = firstExpression; this.secondeExpression = secondeExpression; &#125; /** * è¿”å›ä¸¤ä¸ªè¡¨è¾¾å¼ç»“æœçš„å’Œ * @return */ @Override public int interpret() &#123; return this.firstExpression.interpret() + this.secondeExpression.interpret(); &#125; @Override public String toString() &#123; return \"+\"; &#125;&#125; ä¹˜æ³•è§£é‡Šå™¨ 1234567891011121314151617181920212223242526272829303132333435363738package com.design.pattern.interpreter;/** * MultiInterpreter ä¹˜æ³•è§£é‡Šå™¨ * * @author shunhua * @date 2019-10-02 */public class MultiInterpreter implements Interpreter &#123; /** * å®ƒä»¬çš„è¡¨è¾¾å¼ç»“æœä½œä¸ºä¹˜æ•°å’Œè¢«ä¹˜é™¤æ•° */ private Interpreter firstExpression,secondExpression; /** * ä¹˜æ³•éœ€è¦ ä¹˜æ•°å’Œè¢«ä¹˜æ•° * @param firstExpression * @param secondExpression */ public MultiInterpreter(Interpreter firstExpression,Interpreter secondExpression)&#123; this.firstExpression = firstExpression; this.secondExpression = secondExpression; &#125; /** * ä¹˜æ³•è§£é‡Šå™¨çš„è§£é‡Šæ–¹æ³• * @return */ @Override public int interpret() &#123; return this.firstExpression.interpret() * this.secondExpression.interpret(); &#125; @Override public String toString() &#123; return \"*\"; &#125;&#125; è¡¨è¾¾å¼å¤„ç†è§£é‡Šå™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041// æ³¨æ„è¿™ä¸ªè§£é‡Šå™¨å°±æ˜¯ç®€å•è½¬æ¢æ•°æ®çš„package com.design.pattern.interpreter;/** * NumberInterpreter è¡¨è¾¾å¼å¤„ç†è§£é‡Šå™¨ * * @author shunhua * @date 2019-10-02 */public class NumberInterpreter implements Interpreter &#123; /** * è¡¨è¾¾å¼è¦è¿”å›çš„å€¼ */ private int number; /** * æ•°å€¼æ„é€ å™¨ * @param number */ public NumberInterpreter(int number)&#123; this.number = number; &#125; /** * å­—ç¬¦ä¸²è½¬æ¢æ„é€ å™¨ * @param number */ public NumberInterpreter(String number)&#123; this.number = Integer.parseInt(number); &#125; /** * è§£é‡Šæ–¹æ³• * @return */ @Override public int interpret() &#123; return this.number; &#125;&#125; å°è£…è§£é‡Šå™¨çš„å¤„ç†ç±»â€“æš´éœ²ç»™ç”¨æˆ·çš„è§£é‡Šå™¨ï¼ˆå®ƒå†…éƒ¨æ˜¯å¯¹å‡ ä¸ªè§£é‡Šå™¨çš„å°è£…ï¼‰ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.design.pattern.interpreter;import lombok.extern.slf4j.Slf4j;import java.util.Arrays;import java.util.Stack;/** * ExpressionParse * * @author shunhua * @date 2019-10-02 */@Slf4jpublic class ExpressionParse &#123; /** * å®šä¹‰ä¸€ä¸ªæ ˆï¼Œè¿™é‡Œæ˜¯è§£é‡Šå™¨ç±»å‹æ ˆ */ private Stack&lt;Interpreter&gt; stack = new Stack&lt;&gt;(); public int parse(String str)&#123; String[] strItemArray = str.split(\" \"); Arrays.stream(strItemArray).forEach(symbol -&gt;&#123; // ä¸æ˜¯è¿ç®—ç¬¦ï¼Œéœ€è¦å…¥æ ˆ if(!OperatorUtil.isOperator(symbol))&#123; Interpreter numberExpression = new NumberInterpreter(symbol); stack.push(numberExpression); log.info(String.format(\"å…¥æ ˆï¼š%d\",numberExpression.interpret())); &#125;else &#123; // æ˜¯è¿ç®—ç¬¦ï¼Œå¯ä»¥è¿›è¡Œè®¡ç®— Interpreter firstExpression = stack.pop(); Interpreter secondExpression = stack.pop(); log.info(String.format(\"å‡ºæ ˆï¼š %d å’Œ %d\",firstExpression.interpret(),secondExpression.interpret())); Interpreter operator = OperatorUtil.getExpressionObject(firstExpression,secondExpression,symbol); log.info(String.format(\"è§£é‡Šå™¨ç±»å‹ï¼š%s\",operator.toString())); int result = operator.interpret(); NumberInterpreter resultExpression = new NumberInterpreter(result); stack.push(resultExpression); log.info(String.format(\"é˜¶æ®µç»“æœå…¥æ ˆï¼š %d\",resultExpression.interpret())); &#125; &#125;); int result = stack.pop().interpret(); return result; &#125;&#125; å·¥å…·ç±» 1234567891011121314151617181920212223242526272829303132333435package com.design.pattern.interpreter;/** * OperatorUtil * * @author shunhua * @date 2019-10-02 */public class OperatorUtil &#123; /** * æ˜¯å¦å¯æ“ä½œ * @param symbol * @return */ public static boolean isOperator(String symbol)&#123; return \"+\".equals(symbol) || \"*\".equals(symbol); &#125; /** * ä½¿ç”¨è§£é‡Šå™¨è¿›è¡Œè§£é‡Šï¼Œè¡¨è¾¾å¼çš„ç»“æœ * @param firstExpression * @param secondExpression * @param symbol * @return */ public static Interpreter getExpressionObject(Interpreter firstExpression,Interpreter secondExpression,String symbol)&#123; if(\"+\".equals(symbol))&#123; return new AddInterpreter(firstExpression,secondExpression); &#125; else if (\"*\".equals(symbol))&#123; return new MultiInterpreter(firstExpression,secondExpression); &#125; return null; &#125;&#125; åº”ç”¨ 12345678910111213141516171819202122232425package com.design.pattern.interpreter;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-10-02 */@Slf4jpublic class Client &#123; @Test public void test()&#123; // è¾“å…¥è¡¨è¾¾å¼ String inputStr = \"18 70 12 + *\"; // å¯¹è¡¨è¾¾å¼è¿›è¡Œè§£é‡Š ExpressionParse expressionParse = new ExpressionParse(); int result = expressionParse.parse(inputStr); log.info(\"æœ€ç»ˆè§£é‡Šç»“æœï¼š\" + result); &#125;&#125; è§£é‡Šå™¨æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨java.util.regex.Pattern 1æ­£åˆ™è¡¨è¾¾å¼å°±æ˜¯ä¸€ç§è¯­æ³•ï¼Œé€šè¿‡jdkä¸­çš„æ­£åˆ™è§£é‡Šå™¨æŠŠå®ƒè§£é‡Šå‡ºæ¥ 123456789101112131415161718192021222324252627282930package com.design.pattern.interpreter;import lombok.extern.slf4j.Slf4j;import org.junit.Test;import java.util.regex.Matcher;import java.util.regex.Pattern;/** * PatternTest * * @author shunhua * @date 2019-10-02 */@Slf4jpublic class PatternTest &#123; @Test public void test()&#123; String str = \"china\"; String patternStr = \"\\\\s+\" + str + \"\\\\s+\"; // æ­£åˆ™è§£é‡Šå™¨ï¼Œè§£é‡Šæ­£åˆ™è¡¨è¾¾å¼ Pattern pattern = Pattern.compile(patternStr); String content = \" china becames more and more beautiful! \"; Matcher matcher = pattern.matcher(content); if (matcher.find()) &#123; String content_new = matcher.replaceAll(\"China \"); log.info(String.format(\"old: %s, new: %s\",content,content_new)); &#125; &#125;&#125; Springçš„ELè§£é‡Šå™¨ 1Elè¡¨è¾¾å¼æ˜¯ä¸€ç§è¯­æ³•ï¼Œé€šè¿‡Springçš„è§£é‡Šå™¨å»è§£é‡Š 12345678910111213141516171819202122232425262728293031package com.design.pattern.interpreter.resource;import lombok.extern.slf4j.Slf4j;import org.junit.Test;import org.springframework.expression.Expression;import org.springframework.expression.ExpressionParser;import org.springframework.expression.spel.standard.SpelExpressionParser;/** * SpelParserTest * * @author shunhua * @date 2019-10-02 */@Slf4jpublic class SpelParserTest &#123; /** * ä½¿ç”¨Springçš„è¯­è¨€è§£é‡Šå™¨(ExpressionParser) è§£é‡ŠSpringçš„ELï¼ˆè§£é‡Šè¯­è¨€ï¼‰è¡¨è¾¾å¼ */ @Test public void test() &#123; // åˆ›å»ºSpringçš„è¯­è¨€è§£é‡Šå™¨ ExpressionParser parser = new SpelExpressionParser(); // ä½¿ç”¨è§£é‡Šè§£æSpringçš„Elè¡¨è¾¾å¼ Expression expression = parser.parseExpression(\"2 * 100 * 10 + 19\"); // å–å‡ºç»“æœ int result = (Integer) expression.getValue(); log.info(\"è§£é‡Šåçš„ç»“æœï¼š\" + result); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"ç­–ç•¥æ¨¡å¼","slug":"design_pattern/behaviour_type/ç­–ç•¥æ¨¡å¼","date":"2019-09-27T16:00:00.000Z","updated":"2020-07-04T16:28:45.958Z","comments":true,"path":"posts/72e3b671/","link":"","permalink":"https://gentryhuang.com/posts/72e3b671/","excerpt":"","text":"å®šä¹‰å®šä¹‰äº†ç®—æ³•å®¶æ—ï¼Œåˆ†åˆ«å°è£…èµ·æ¥ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢ï¼Œæ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°ä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·ã€‚å³æŠŠä¸åŒçš„ç®—æ³•å°è£…åˆ°ä¸åŒçš„ç±»é‡Œé¢ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œ åº”ç”¨å±‚ä¸ä¼šå—åˆ°å½±å“ã€‚ ç±»å‹è¡Œä¸ºå‹ ä½¿ç”¨åœºæ™¯12341 ç³»ç»Ÿæœ‰å¾ˆå¤šç±»ï¼Œè€Œä»–ä»¬çš„åŒºåˆ«ä»…ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºä¸åŒ - ä½¿ç”¨ç­–ç•¥æ¨¡å¼å°±å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨å¤šä¸ªè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æŠŠè¿™ä¸ªå¯¹è±¡ä¸åŒçš„è¡Œä¸ºæ”¾åˆ°ä¸åŒçš„ç±»é‡Œé¢ï¼Œè€Œæ¯ä¸€ç§è¡Œä¸ºå¯¹åº”ç€ä¸€ç§ç­–ç•¥2 ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ - è¿™é‡Œç®—æ³•å°±æ˜¯ç­–ç•¥ï¼Œç­–ç•¥é‡Œé¢å°è£…çš„å°±æ˜¯ä¸€ç³»åˆ—é€»è¾‘ä»¥åŠè®¡ç®—æ–¹å¼ ä¼˜ç‚¹1234561 ç¬¦åˆå¼€é—­åŸåˆ™ - ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹å¼€é—­åŸåˆ™çš„å®Œç¾æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šé€‰æ‹©å…·ä½“çš„è¡Œä¸º2 é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶è½¬ç§»è¯­å¥ - å¤§é‡çš„if...else, switchã€‚ æˆ‘ä»¬æŠŠå…·ä½“çš„ç­–ç•¥è¡Œä¸ºåˆ†ç¦»ä¸ºä¸€ä¸ªä¸€ä¸ªçš„å•ç‹¬çš„ç±»æ¥æ›¿æ¢if...elseé‡Œé¢çš„é€»è¾‘ï¼Œè¿™æ ·å†™ä¹Ÿå¯ä»¥é™ä½ä»£ç çš„è€¦åˆ3 æé«˜ç®—æ³•çš„ä¿å¯†æ€§å’Œå®‰å…¨æ€§ - åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬åªçŸ¥é“ç­–ç•¥çš„åŠŸèƒ½ï¼Œä¸éœ€è¦çŸ¥é“å…·ä½“çš„ç»†èŠ‚ã€‚åœ¨å…·ä½“çš„ç­–ç•¥ç±»ä¸­å°è£…äº†ä¸åŒçš„è¡Œä¸ºå’Œç®—æ³•ä»¥åŠç›¸å…³çš„æ•°æ®ç»“æ„ï¼Œå¯¹äºåº”ç”¨å±‚æ¥è¯´ï¼Œæ˜¯ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„ç»†èŠ‚çš„ã€‚æ¯”å¦‚ä½¿ç”¨Dubboçš„æœåŠ¡æä¾›è€…ï¼Œä¸éœ€è¦çŸ¥é“å†…éƒ¨é€»è¾‘çš„ç»†èŠ‚ã€‚ ç¼ºç‚¹121 åº”ç”¨å±‚å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»2 äº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±» ç­–ç•¥æ¨¡å¼ç›¸å…³çš„è®¾è®¡æ¨¡å¼ç­–ç•¥æ¨¡å¼å’Œå·¥å‚æ¨¡å¼ 121 å·¥å‚æ¨¡å¼æ˜¯åˆ›å»ºå‹çš„è®¾è®¡æ¨¡å¼ï¼Œç­–ç•¥æ¨¡å¼æ˜¯è¡Œä¸ºå‹çš„è®¾è®¡æ¨¡å¼2 å·¥å‚æ¨¡å¼æ¥å—æŒ‡ä»¤ï¼Œåˆ›å»ºç¬¦åˆè¦æ±‚çš„å¯¹è±¡ã€‚ç­–ç•¥æ¨¡å¼æ¥å—åˆ›å»ºå¥½çš„å¯¹è±¡ï¼Œä»è€Œå®ç°ä¸åŒçš„è¡Œä¸º ç­–ç•¥æ¨¡å¼å’ŒçŠ¶æ€æ¨¡å¼ 121 ä½¿ç”¨ç­–ç•¥æ¨¡å¼çš„æ—¶å€™ï¼Œåº”ç”¨å±‚éœ€è¦çŸ¥é“åº”è¯¥é€‰æ‹©å“ªä¸€ç§ç­–ç•¥ã€‚åœ¨ä½¿ç”¨çŠ¶æ€æ¨¡å¼çš„æ—¶å€™ï¼Œåº”ç”¨å±‚æ˜¯ä¸éœ€è¦å…³å¿ƒå…·ä½“çš„çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€ä¼šè‡ªåŠ¨è½¬æ¢2 å¦‚æœç³»ç»Ÿä¸­æŸä¸ªç±»çš„å¯¹è±¡å­˜åœ¨å¤šç§çŠ¶æ€ï¼Œä¸åŒçŠ¶æ€ä¸‹è¡Œä¸ºåˆæœ‰å·®å¼‚ï¼Œè€Œä¸”è¿™äº›çŠ¶æ€å¯ä»¥å‘ç”Ÿè½¬æ¢æ—¶å¯ä»¥ä½¿ç”¨çŠ¶æ€æ¨¡å¼ã€‚å¦‚æœç³»ç»Ÿä¸­æŸä¸ªç±»çš„æŸç§è¡Œä¸ºå­˜åœ¨å¤šç§å®ç°æ–¹å¼ï¼Œå¦‚ä¿ƒé”€æ˜¯ä¸ªè¡Œä¸ºï¼Œè¿™ç§è¡Œä¸ºå°±æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œè¿™ç§æƒ…å†µä¸‹åº”è¯¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼ã€‚ ç®€å•éœ€æ±‚å½“å½“ç½‘åœ¨åŒåä¸€æˆ–è€…618çš„æ—¶å€™ä¼šæœ‰å¾ˆå¤šçš„ä¿ƒé”€æ´»åŠ¨ï¼Œä¿ƒé”€æ˜¯ä¹¦ç±çš„ä¸€ä¸ªè¡Œä¸ºï¼Œè¿™ä¸ªä¿ƒé”€è¡Œä¸ºæœ‰å¤šç§å®ç°ã€‚ ç­–ç•¥æ¨¡å¼æ¼”ç»ƒæœ€åŸºæœ¬çš„ä½¿ç”¨ ç­–ç•¥çˆ¶ç±»å‹ï¼ˆè¿™é‡Œæ˜¯æ¥å£çš„æ–¹å¼ï¼‰ 12345678910111213package com.design.pattern.strategy.base;/** * PromotionStrategy ä¿ƒé”€ç­–ç•¥çˆ¶ç±»å‹ * @author shunhua * @date 2019-09-28 */public interface PromotionStrategy &#123; /** * è¿›è¡Œä¿ƒé”€ */ void doPromotion();&#125; å…·ä½“ç­–ç•¥å®ä¾‹ å‘ç°ç­–ç•¥ 123456789101112131415161718192021package com.design.pattern.strategy.base;import lombok.extern.slf4j.Slf4j;/** * FanXianPromotionStrategy è¿”ç°ï¼ˆæ”¯ä»˜é‡‘é¢è¾¾åˆ°ä¸€å®šæ•°é¢è¿›è¡Œè¿”ç°åˆ°è´¦å·ï¼‰ç­–ç•¥ * * @author shunhua * @date 2019-09-28 */@Slf4jpublic class FanXianPromotionStrategy implements PromotionStrategy &#123; /** * ä¿ƒé”€ */ @Override public void doPromotion() &#123; log.info(\"è¿”ç°ä¿ƒé”€ï¼Œè¿”å›çš„é‡‘é¢å­˜æ”¾åˆ°è´¦å·çš„ä½™é¢ä¸­\"); &#125;&#125; ç«‹å‡ä¼˜æƒ ç­–ç•¥ 123456789101112131415161718192021package com.design.pattern.strategy.base;import lombok.extern.slf4j.Slf4j;/** * LiJianPromotionStrategy ç«‹å‡ï¼ˆä¸‹å•ç«‹å‡ä¸€å®šçš„é‡‘é¢ï¼‰ç­–ç•¥ * * @author shunhua * @date 2019-09-28 */@Slf4jpublic class LiJianPromotionStrategy implements PromotionStrategy &#123; /** * ä¿ƒé”€ */ @Override public void doPromotion() &#123; log.info(\"ç«‹å‡ä¿ƒé”€ï¼Œä¹¦ç±çš„ä»·æ ¼ç›´æ¥å‡å»ç«‹å‡æ´»åŠ¨è®¾ç½®çš„ä»·æ ¼\"); &#125;&#125; æ»¡å‡ç­–ç•¥ 123456789101112131415161718192021package com.design.pattern.strategy.base;import lombok.extern.slf4j.Slf4j;/** * ManJianPromotionStrategy æ»¡å‡ï¼ˆå½“æ”¯ä»˜é‡‘é¢è¾¾åˆ°è§„å®šçš„æœ€ä½æ•°å°±è¿›è¡Œä¼˜æƒ ï¼‰ç­–ç•¥ * * @author shunhua * @date 2019-09-28 */@Slf4jpublic class ManJianPromotionStrategy implements PromotionStrategy &#123; /** * ä¿ƒé”€ */ @Override public void doPromotion() &#123; log.info(\"æ»¡å‡ä¿ƒé”€ï¼Œæ»¡200å‡50\"); &#125;&#125; ç­–ç•¥åŒ…è£…ç±» 1234567891011121314151617181920212223242526package com.design.pattern.strategy.base;/** * PromotionActivity ä¿ƒé”€æ´»åŠ¨ï¼ŒåŒ…è£…ï¼ˆä½¿ç”¨ï¼‰ç­–ç•¥æ¨¡å¼ * * @author shunhua * @date 2019-09-28 */public class PromotionActivity &#123; /** * ä¿ƒé”€ç­–ç•¥ */ private PromotionStrategy promotionStrategy; public PromotionActivity(PromotionStrategy promotionStrategy)&#123; this.promotionStrategy = promotionStrategy; &#125; /** * æ‰§è¡Œå…·ä½“çš„ä¿ƒé”€ç­–ç•¥ */ public void execute()&#123; promotionStrategy.doPromotion(); &#125;&#125; åº”ç”¨å±‚ 12345678910111213141516171819202122232425262728293031package com.design.pattern.strategy.base;import com.design.pattern.strategy.base.FanXianPromotionStrategy;import com.design.pattern.strategy.base.ManJianPromotionStrategy;import com.design.pattern.strategy.base.PromotionActivity;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-28 */public class Client &#123; @Test public void test()&#123; /** * 618æ»¡å‡æ´»åŠ¨ç­–ç•¥ */ PromotionActivity activity618 = new PromotionActivity(new ManJianPromotionStrategy()); /** * åŒ11 è¿”ç°æ´»åŠ¨ç­–ç•¥ */ PromotionActivity activity11 = new PromotionActivity(new FanXianPromotionStrategy()); activity618.execute(); activity11.execute(); &#125;&#125; å°ç»“ 1è¿™æ˜¯ç­–ç•¥æ¨¡å¼çš„ç®€å•ä½¿ç”¨ï¼Œæ•´ä½“ä¸Šæ‰©å±•æ€§æ¯”è¾ƒå¥½ï¼Œæƒ³å¢åŠ ç­–ç•¥å¾ˆæ–¹ä¾¿ã€‚ åŸºæœ¬ä½¿ç”¨æ¼”è¿›åº”ç”¨å±‚ 123456789101112131415161718192021222324252627282930313233343536package com.design.pattern.strategy.v1;import org.junit.Test;import org.springframework.util.ObjectUtils;/** * Client * * @author shunhua * @date 2019-09-28 */public class Client &#123; @Test public void test()&#123; PromotionActivity activity ; // åº”ç”¨å±‚å‚æ•° String promotion = \"FANXIAN\"; switch (promotion)&#123; case \"FANXIAN\" : activity = new PromotionActivity(new FanXianPromotionStrategy()); break; case \"LIJIAN\": activity = new PromotionActivity(new LiJianPromotionStrategy()); break; case \"MANJIAN\": activity = new PromotionActivity(new ManJianPromotionStrategy()); break; default: activity = null; &#125; if(!ObjectUtils.isEmpty(activity))&#123; activity.execute(); &#125; &#125;&#125; å°ç»“ 12è¿™ç§æ–¹å¼å’Œåº”ç”¨äº¤äº’å®¹æ˜“ä½¿ä»£ç è¿‡äºè‡ƒè‚¿ï¼Œå› ä¸ºæ¯æ¬¡éœ€è¦çš„æ—¶å€™éƒ½ä¼šåˆ›å»ºç­–ç•¥å¯¹è±¡å’ŒåŒ…è£…ç­–ç•¥çš„å¯¹è±¡ï¼Œå¹¶ä¸”è¿‡å¤šçš„é€‰æ‹©åˆ¤æ–­ï¼Œæ•´ä¸ªä»£ç çœ‹èµ·æ¥ä¸ä¼˜é›…ã€‚ ä¼˜åŒ–åç‰ˆæœ¬ç­–ç•¥å·¥å‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package com.design.pattern.strategy.v2;import java.util.Map;import java.util.concurrent.ConcurrentHashMap;/** * PromotionStrategyFactory ä¿ƒé”€ç­–ç•¥å·¥å‚ * * @author shunhua * @date 2019-09-28 */public class PromotionStrategyFactory &#123; /** * ç­–ç•¥é›†åˆ */ private final static Map&lt;String,PromotionStrategy&gt; PROMOTION_STRATEGY_MAP = new ConcurrentHashMap&lt;&gt;(); /** * ç±»åŠ è½½çš„æ—¶å€™å°±å¼€å§‹åˆ›å»ºå¯¹è±¡ */ static &#123; PROMOTION_STRATEGY_MAP.put(PromotionKey.LIJIAN_STRATEGY,new LiJianPromotionStrategy()); PROMOTION_STRATEGY_MAP.put(PromotionKey.FANXIAN_STRATEGY,new FanXianPromotionStrategy()); PROMOTION_STRATEGY_MAP.put(PromotionKey.MANJIAN_STRATEGY,new ManJianPromotionStrategy()); &#125; /** * å•ä¾‹çš„ */ private PromotionStrategyFactory()&#123;&#125; /** * æ ¹æ®ç­–ç•¥æ¨¡å¼åè·å–å¯¹åº”çš„ç­–ç•¥ * @param strategy * @return */ public static PromotionStrategy getPromotionStrategy(String strategy)&#123; return PROMOTION_STRATEGY_MAP.get(strategy); &#125; private interface PromotionKey&#123; /** * ç«‹å‡ç­–ç•¥ */ String LIJIAN_STRATEGY = \"LIJIAN\"; /** * æ»¡å‡ç­–ç•¥ */ String MANJIAN_STRATEGY = \"LIJIAN\"; /** * è¿”ç°ç­–ç•¥ */ String FANXIAN_STRATEGY = \"FANXIAN\"; &#125;&#125; åº”ç”¨å±‚ 123456789101112131415161718192021222324package com.design.pattern.strategy.v2;import org.junit.Test;import org.springframework.util.ObjectUtils;/** * Client * * @author shunhua * @date 2019-09-28 */public class Client &#123; @Test public void test()&#123; // åº”ç”¨å±‚å‚æ•° String promotion = \"FANXIAN\"; // ä½¿ç”¨å·¥å‚æ¨¡å¼ PromotionActivity activity = new PromotionActivity(PromotionStrategyFactory.getPromotionStrategy(promotion)); if(!ObjectUtils.isEmpty(activity))&#123; activity.execute(); &#125; &#125;&#125; å°ç»“ 121. ä½¿ç”¨ç­–ç•¥å·¥å‚é˜²æ­¢ç­–ç•¥å¯¹è±¡é¢‘ç¹åˆ›å»º2. ç­–ç•¥æ¨¡å¼å¸¸å¸¸ç»“åˆå•ä¾‹ã€å·¥å‚ä»¥åŠäº«å…ƒæ¨¡å¼ç­‰ä½¿ç”¨ ç­–ç•¥æ¨¡å¼æºç è§£æjdkçš„Comparator 1Comparatorå°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒç­–ç•¥æ¥å£ï¼Œå®ƒæœ‰å¾ˆå¤šçš„å®ç°ï¼Œä¹Ÿæ”¯æŒè‡ªå®šä¹‰ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å®ç°å°±æ˜¯ä¸€ä¸ªä¸ªç­–ç•¥ã€‚ 12345678910111213141516171819 /** * æ’åºä¼šæ ¹æ®å…·ä½“çš„æ’åºç­–ç•¥æ‰§è¡Œ * @since 1.8 */@SuppressWarnings(\"unchecked\")public static &lt;T&gt; void parallelSort(T[] a, Comparator&lt;? super T&gt; cmp) &#123; if (cmp == null) cmp = NaturalOrder.INSTANCE; int n = a.length, p, g; if (n &lt;= MIN_ARRAY_SORT_GRAN || (p = ForkJoinPool.getCommonPoolParallelism()) == 1) TimSort.sort(a, 0, n, cmp, null, 0, 0); else new ArraysParallelSortHelpers.FJObject.Sorter&lt;T&gt; (null, a, (T[])Array.newInstance(a.getClass().getComponentType(), n), 0, n, 0, ((g = n / (p &lt;&lt; 2)) &lt;= MIN_ARRAY_SORT_GRAN) ? MIN_ARRAY_SORT_GRAN : g, cmp).invoke(); &#125; Springçš„Resource 1Resourceæ˜¯èµ„æºè®¿é—®æ¥å£ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªèµ„æºè®¿é—®ç›¸å…³çš„ç­–ç•¥æ¥å£ï¼Œå®ƒæœ‰å¾ˆå¤šçš„å®ç°ç±»ï¼Œä¹Ÿå°±æ„å‘³ç€æœ‰å¾ˆå¤šè®¿é—®èµ„æºçš„ç­–ç•¥ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package org.springframework.core.io;import java.io.File;import java.io.IOException;import java.net.URI;import java.net.URL;import java.nio.channels.Channels;import java.nio.channels.ReadableByteChannel;import org.springframework.lang.Nullable;public interface Resource extends InputStreamSource &#123; boolean exists(); default boolean isReadable() &#123; return this.exists(); &#125; default boolean isOpen() &#123; return false; &#125; default boolean isFile() &#123; return false; &#125; URL getURL() throws IOException; URI getURI() throws IOException; File getFile() throws IOException; default ReadableByteChannel readableChannel() throws IOException &#123; return Channels.newChannel(this.getInputStream()); &#125; long contentLength() throws IOException; long lastModified() throws IOException; Resource createRelative(String var1) throws IOException; @Nullable String getFilename(); String getDescription();&#125; Springçš„InstantiationStrategy 1Springåˆå§‹åŒ–ç­–ç•¥æ¥å£ï¼Œå®ƒçš„å®ç°ç±»ï¼šSimpleInstantiationStrategyå’ŒCglibSubclassingInstantiationStrategyåˆå§‹åŒ–ç­–ç•¥","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼","slug":"design_pattern/behaviour_type/æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼","date":"2019-09-26T16:00:00.000Z","updated":"2020-07-04T16:28:45.955Z","comments":true,"path":"posts/5029c2a3/","link":"","permalink":"https://gentryhuang.com/posts/5029c2a3/","excerpt":"","text":"å®šä¹‰å®šä¹‰äº†ä¸€ä¸ªç®—æ³•çš„éª¨æ¶ï¼Œå¹¶å…è®¸å­ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ­¥éª¤æä¾›å®ç°ã€‚æ¨¡ç‰ˆæ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹ï¼Œé‡æ–°å®šä¹‰ç®—æ³•çš„æŸäº›æ­¥éª¤ã€‚ ç±»å‹è¡Œä¸ºå‹ ä½¿ç”¨åœºæ™¯12â—† å„å­ç±»ä¸­å…¬å…±çš„è¡Œä¸ºè¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ï¼Œä»è€Œé¿å…ä»£ç é‡å¤â—† ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç° ä¼˜ç‚¹123â—†æé«˜å¤ç”¨æ€§ï¼ˆå°†ç›¸åŒä»£ç éƒ¨åˆ†æ”¾åˆ°æŠ½è±¡çˆ¶ç±»ä¸­ï¼‰â—†æé«˜æ‰©å±•æ€§â—†ç¬¦åˆå¼€é—­åŸåˆ™ ç¼ºç‚¹123â—†ç»§æ‰¿å…³ç³»è‡ªèº«ç¼ºç‚¹ï¼Œå¦‚æœçˆ¶ç±»æ·»åŠ æ–°çš„æŠ½è±¡æ–¹æ³•ï¼Œæ‰€æœ‰å­ç±»éƒ½è¦æ”¹ä¸€éâ—†ç±»æ•°ç›®å¢åŠ â—†å¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ æ¨¡ç‰ˆæ–¹æ³•æ‰©å±• æ¨¡ç‰ˆæ–¹æ³•ä¸­æœ‰ä¸€ä¸ªå®šä¹‰ï¼šé’©å­æ–¹æ³•ã€‚å®ƒæä¾›äº†ç¼ºçœçš„è¡Œä¸ºï¼Œå­ç±»å¯ä»¥åœ¨å¿…è¦æ—¶è¿›è¡Œæ‰©å±•ï¼Œåˆ©ç”¨å®ƒå’Œçˆ¶ç±»äº¤äº’ã€‚å³æ„é€ æ–¹æ³•æ˜¯è¿™ä¸ªæ¨¡ç‰ˆå¯¹å­ç±»æ›´è¿›ä¸€æ­¥çš„å¼€æ”¾ä»¥åŠæ‰©å±•ã€‚ ç›¸å…³çš„è®¾è®¡æ¨¡å¼æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼ å·¥å‚æ–¹æ³•æ˜¯æ¨¡ç‰ˆæ–¹æ³•çš„ä¸€ç§ç‰¹æ®Šå®ç° æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼ æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ä¸æ”¹å˜ç®—æ³•æµç¨‹ï¼Œç­–ç•¥æ¨¡å¼å¯ä»¥æ”¹å˜ç®—æ³•æµç¨‹ï¼Œå¹¶ä¸”ç­–ç•¥æ–¹æ³•ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’æ›¿æ¢çš„ã€‚ç­–ç•¥æ¨¡å¼çš„ç›®çš„æ˜¯ä½¿ä¸åŒçš„ç®—æ³•å¯ä»¥ç›¸äº’æ›¿æ¢ï¼Œå¹¶ä¸”ä¸å½±å“åº”ç”¨å±‚å®¢æˆ·ç«¯çš„ä½¿ç”¨ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯é’ˆå¯¹å®šä¹‰ä¸€ä¸ªç®—æ³•çš„æµç¨‹ï¼Œå°†ä¸€äº›ä¸å¤ªä¸€æ ·çš„å…·ä½“æ­¥éª¤äº¤ç»™å­ç±»å»å®ç°ã€‚ ç®€å•éœ€æ±‚æŸæœºæ„è¦åˆ¶ä½œä¸€é—¨è¯¾ç¨‹ï¼Œåˆ¶ä½œè¿™ä¸ªè¯¾ç¨‹éœ€è¦ä¸€å®šçš„æ­¥éª¤ï¼Œç”±äºè¯¾ç¨‹çš„ç§ç±»ä¸åŒå¯èƒ½æŸä¸ªæ­¥éª¤ä¸åŒï¼Œä½†æ˜¯æ•´ä½“æ­¥éª¤éƒ½æ˜¯ä¸€è‡´çš„ã€‚ æ¨¡ç‰ˆæ–¹æ³•æ¼”ç»ƒ æŠ½è±¡è¯¾ç¨‹ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package com.design.pattern.template;import lombok.extern.slf4j.Slf4j;/** * Course è¯¾ç¨‹æŠ½è±¡ç±» * * @author shunhua * @date 2019-09-27 */@Slf4jpublic abstract class Course &#123; /** * æ¨¡ç‰ˆæ–¹æ³• å®šä¹‰æµç¨‹çš„ * 1 è¯¥æ–¹æ³•çš„æµç¨‹æ˜¯å›ºå®šçš„ï¼Œæœ‰äº›æ­¥éª¤çš„ç»†èŠ‚å¯èƒ½å› å­ç±»ä¸åŒ * 2 è¯¥æ–¹æ³•å¿…é¡»ç”³æ˜ä¸ºfinalï¼Œå­ç±»ä¸èƒ½é‡å†™ã€‚ */ protected final void makeCourse()&#123; // åˆ¶ä½œPPT makePPT(); // åˆ¶ä½œè§†é¢‘ makeVideo(); // é€šè¿‡æ„é€ æ–¹æ³•å®ç°æ‰€éœ€é€»è¾‘ if(needMakeArticle())&#123; // ç¼–å†™æ‰‹ç¨¿ makeArticle(); &#125; // æ‰“åŒ…è¯¾ç¨‹ä¸Šçº¿ packageCourse(); &#125; /** * åˆ¶ä½œPPTæ˜¯å…±æœ‰çš„æ–¹æ³•ï¼Œå› æ­¤æ˜¯å›ºå®šçš„ï¼Œå­ç±»ä¸éœ€è¦æœ‰è‡ªå·±çš„å®ç° */ final void makePPT()&#123; log.info(\"åˆ¶ä½œppt\"); &#125; /** * åˆ¶ä½œè§†é¢‘æ˜¯å…±æœ‰çš„æ–¹æ³•ï¼Œå› æ­¤æ˜¯å›ºå®šçš„ï¼Œå­ç±»ä¸éœ€è¦æœ‰è‡ªå·±çš„å®ç° */ final void makeVideo()&#123; log.info(\"åˆ¶ä½œè§†é¢‘\"); &#125; /** * ç¼–å†™æ‰‹è®°ï¼Œè¿™ä¸ªæ˜¯å›ºå®šçš„ä¸éœ€è¦ä¹‹ç±»æœ‰è‡ªå·±çš„å®ç°ï¼Œä¸è¿‡å®ƒä¸ä¸€å®šæ˜¯å…±æœ‰çš„ï¼Œéœ€è¦çœ‹æƒ…å†µ */ final void makeArticle()&#123; log.info(\"ç¼–å†™æ‰‹è®°\"); &#125; /** * é’©å­æ–¹æ³• å­ç±»å¯ä»¥é‡å†™ç”¨æ¥è·Ÿçˆ¶ç±»äº¤äº’çš„ã€‚é»˜è®¤æ˜¯falseï¼Œä¸éœ€è¦æ‰‹è®° */ protected boolean needMakeArticle()&#123; return false; &#125; /** * æ‰“åŒ…è¯¾ç¨‹çš„æ–¹æ³•ï¼Œä¸åŒçš„è¯¾ç¨‹å¯èƒ½åŒ…è£…çš„ä¸ä¸€æ ·ï¼Œæ ¹æ®å­ç±»æƒ…å†µé‡å†™ */ abstract void packageCourse();&#125; è¯¾ç¨‹ç±»1 123456789101112131415161718192021package com.design.pattern.template;import lombok.extern.slf4j.Slf4j;/** * FECourse * * @author shunhua * @date 2019-09-27 */@Slf4jpublic class FECourse extends Course &#123; /** * é‡å†™æ‰“åŒ…è¯¾ç¨‹çš„æ–¹æ³• */ @Override void packageCourse() &#123; log.info(\"æä¾›å‰ç«¯è¯¾ç¨‹çš„æºä»£ç å’Œå›¾ç‰‡ç´ æ\"); &#125;&#125; è¯¾ç¨‹ç±»2 1234567891011121314151617181920212223242526272829303132333435363738package com.design.pattern.template;import lombok.extern.slf4j.Slf4j;/** * JvmCource * * @author shunhua * @date 2019-09-27 */@Slf4jpublic class JvmCource extends Course &#123; private boolean flag = Boolean.FALSE; /** * é€šè¿‡æ„é€ æ–¹æ³•è®¾ç½®é’©å­æ–¹æ³•çš„å‚æ•°ï¼ŒæŠŠé’©å­æ–¹æ³•å¼€æ”¾ç»™å®¢æˆ·ç«¯æ›´åŠ çµæ´» * * @param flag */ public JvmCource(boolean flag)&#123; this.flag = flag; &#125; @Override void packageCourse() &#123; log.info(\"Jvmè¯¾ç¨‹æä¾›è°ƒä¼˜å·¥å…·è½¯ä»¶åŒ…\"); &#125; /** * ä½¿ç”¨é’©å­æ–¹æ³•æ¥å’Œçˆ¶ç±»äº¤äº’ï¼Œå¢åŠ è‡ªå·±çš„é€»è¾‘ * @return */ @Override protected boolean needMakeArticle() &#123; return flag; &#125;&#125; å®¢æˆ·ç«¯ 1234567891011121314151617181920212223package com.design.pattern.template;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-27 */public class Client &#123; @Test public void test()&#123; Course jvmCourse = new JvmCource(Boolean.TRUE); jvmCourse.makeCourse(); Course feCourse = new FECourse(); feCourse.makeCourse(); &#125;&#125; æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼æºç è§£æAbstractList(çˆ¶)-ArrayList(å­)AbstractList 1234567public abstract class AbstractList&lt;E&gt; extends AbstractCollection&lt;E&gt; implements List&lt;E&gt; &#123;//getæ–¹æ³•ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œå®Œå…¨äº¤ç»™å­ç±»å»å®ç°abstract public E get(int index);&#125; ArrayList 12345678910public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable&#123;//å­ç±»æ¥å®ç°getæ–¹æ³• public E get(int index) &#123; rangeCheck(index); return elementData(index); &#125;&#125; åŒç†ï¼šAbstractSetã€AbstractMapåŒæ ·é‡‡ç”¨äº†æ¨¡ç‰ˆæ–¹æ³•æ¨¡å¼ HttpServlet1æˆ‘ä»¬ä¸€èˆ¬ç»§æ‰¿HttpServletï¼Œç„¶åé‡å†™doGetæˆ–è€…doPostç­‰doXxxæ–¹æ³•ï¼ŒHttpServletä¸­å®šä¹‰äº†ä¸€å¥—æ¨¡ç‰ˆï¼Œåªè¦è¦†å†™è¿™äº›æ–¹æ³•å³å¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; String method = req.getMethod();if (method.equals(METHOD_GET)) &#123; long lastModified = getLastModified(req); if (lastModified == -1) &#123; // servlet doesn't support if-modified-since, no reason // to go through further expensive logic doGet(req, resp); &#125; else &#123; long ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE); if (ifModifiedSince &lt; (lastModified / 1000 * 1000)) &#123; // If the servlet mod time is later, call doGet() // Round down to the nearest second for a proper compare // A ifModifiedSince of -1 will always be less maybeSetLastModified(resp, lastModified); doGet(req, resp); &#125; else &#123; resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED); &#125; &#125;&#125; else if (method.equals(METHOD_HEAD)) &#123; long lastModified = getLastModified(req); maybeSetLastModified(resp, lastModified); doHead(req, resp);&#125; else if (method.equals(METHOD_POST)) &#123; doPost(req, resp); &#125; else if (method.equals(METHOD_PUT)) &#123; doPut(req, resp); &#125; else if (method.equals(METHOD_DELETE)) &#123; doDelete(req, resp); &#125; else if (method.equals(METHOD_OPTIONS)) &#123; doOptions(req,resp); &#125; else if (method.equals(METHOD_TRACE)) &#123; doTrace(req,resp); &#125; else &#123; // // Note that this means NO servlet supports whatever // method was requested, anywhere on this server. // String errMsg = lStrings.getString(\"http.method_not_implemented\"); Object[] errArgs = new Object[1]; errArgs[0] = method; errMsg = MessageFormat.format(errMsg, errArgs); resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);&#125; &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è¿­ä»£å™¨æ¨¡å¼","slug":"design_pattern/behaviour_type/è¿­ä»£å™¨æ¨¡å¼","date":"2019-09-26T16:00:00.000Z","updated":"2020-07-04T16:28:45.964Z","comments":true,"path":"posts/9055d217/","link":"","permalink":"https://gentryhuang.com/posts/9055d217/","excerpt":"","text":"å®šä¹‰æä¾›ä¸€ç§æ–¹æ³•ï¼Œé¡ºåºè®¿é—®ä¸€ä¸ªé›†åˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚ ç±»å‹è¡Œä¸ºå‹ é€‚ç”¨åœºæ™¯121 è®¿é—®ä¸€ä¸ªé›†åˆå¯¹è±¡çš„å†…å®¹è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤º2 ä¸ºéå†ä¸åŒçš„é›†åˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ ä¼˜ç‚¹1åˆ†ç¦»äº†é›†åˆå¯¹è±¡çš„éå†è¡Œä¸ºï¼Œå› ä¸ºæŠ½è±¡å‡ºäº†è¿­ä»£å™¨æ¥éå†å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡è¿­ä»£å™¨æ¥è®¿é—®é›†åˆå¯¹è±¡å†…éƒ¨å…ƒç´ äº†ã€‚ ç¼ºç‚¹1ç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œç”±äºè¿­ä»£å™¨æ¨¡å¼æ˜¯å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®è¿™ä¸ªä¸¤ä¸ªèŒè´£è¿›è¡Œåˆ†ç¦»ï¼Œæ‰€ä»¥å½“æ–°å‡ºç°ä¸€ç§é›†åˆç±»å°±éœ€è¦å¢åŠ ä¸€ç§æ–°çš„å¯¹åº”çš„è¿­ä»£å™¨ã€‚è¿™æ ·ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ è¿­ä»£å™¨ç›¸å…³çš„è®¾è®¡æ¨¡å¼è¿­ä»£å™¨æ¨¡å¼å’Œè®¿é—®è€…æ¨¡å¼ 121 è¿™ä¸¤è€…éƒ½æ˜¯è¿­ä»£åœ°è®¿é—®é›†åˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ 2 è®¿é—®è€…æ¨¡å¼ä¸­æ‰©å±•å¼€æ”¾çš„éƒ¨åˆ†åœ¨ä½œç”¨äºå¯¹è±¡çš„æ“ä½œä¸Šï¼Œè€Œåœ¨è¿­ä»£å™¨æ¨¡å¼ä¸­æ‰©å±•å¼€æ”¾çš„éƒ¨åˆ†æ˜¯åœ¨é›†åˆå¯¹è±¡çš„ç§ç±»ä¸Š è¯´æ˜è¿­ä»£å™¨æ¨¡å¼åœ¨æ—¥å¸¸å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šè‡ªå·±å†™ï¼Œé™¤éæˆ‘ä»¬å®šä¹‰è‡ªå·±çš„æ•°æ®ç»“æ„ï¼Œç„¶åä¸ºè¿™ä¸ªæ•°æ®ç»“æ„å®ç°å¯¹åº”çš„è¿­ä»£å™¨ã€‚ ç®€å•éœ€æ±‚è¯¾ç¨‹çš„å¢åŠ å’Œåˆ é™¤ä»¥åŠè¿­ä»£è¯¥è¯¾ç¨‹é›† è¿­ä»£å™¨æ¨¡å¼æ¼”ç»ƒ å®ä½“ç±» 1234567891011121314151617181920package com.design.pattern.iterator.v2;import lombok.AllArgsConstructor;import lombok.Data;/** * Course ç›¸å½“äºé›†åˆä¸­çš„å…ƒç´  * * @author shunhua * @date 2019-09-27 */@Data@AllArgsConstructorpublic class Course &#123; /** * è¯¾ç¨‹çš„åå­— */ private String name;&#125; é›†åˆç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.design.pattern.iterator.v2;import java.util.ArrayList;import java.util.List;/** * MyCollection * * @author shunhua * @date 2019-09-27 */public class MyCollection&lt;T&gt; &#123; /** * å…ƒç´ é›†åˆ */ private final List&lt;T&gt; list = new ArrayList&lt;&gt;(); /** * å¢åŠ å…ƒç´  * @param item */ public void add(T item)&#123; list.add(item); &#125; /** * ç§»å‡ºå…ƒç´  */ public void remove(T item)&#123; this.list.remove(item); &#125; /** * åˆ é™¤æ‰€æœ‰å…ƒç´  */ public void removeAll()&#123; this.list.removeAll(list); &#125; /** * è·å–è¿­ä»£å™¨ï¼Œæ³¨æ„éœ€è¦æŠŠå®ä½“å¯¹è±¡åˆ—è¡¨ä¼ ç»™è¿­ä»£å™¨ * @return */ public MyIterator iterator()&#123; return new MyIterator(list); &#125;&#125; è¿­ä»£å™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package com.design.pattern.iterator.v2;import java.util.List;/** * MyIterator * * @author shunhua * @date 2019-09-27 */public class MyIterator&lt;T&gt; &#123; /** * é›†åˆ */ private List&lt;T&gt; list ; /** * æ¸¸æ ‡ */ private int position; /** * é›†åˆä¸­çš„å…ƒç´  */ private T item; public MyIterator(List&lt;T&gt; list)&#123; this.list = list; &#125; /** * æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´  * @return */ public boolean hasNext()&#123; if( this.position &lt; list.size())&#123; return true; &#125; return false; &#125; /** * è¿­ä»£å…ƒç´  * @return */ public T next()&#123; T item = list.get(position); position ++; return item; &#125;&#125; åº”ç”¨å±‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.design.pattern.iterator.v2;import com.design.pattern.iterator.v1.Course;import com.design.pattern.iterator.v1.CourseHandler;import com.design.pattern.iterator.v1.CourseHandlerImpl;import com.design.pattern.iterator.v1.CourseIterator;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-27 */@Slf4jpublic class Client &#123; @Test public void test() &#123; Course course1 = new Course(\"Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ\"); Course course2 = new Course(\"MySqlä»åˆ åº“åˆ°è·‘è·¯\"); Course course3 = new Course(\"Pythonä»å…¥é—¨åˆ°ç²¾é€š\"); MyCollection&lt;Course&gt; collection = new MyCollection(); collection.add(course1); collection.add(course2); collection.add(course3); log.info(\"----------è¯¾ç¨‹åˆ—è¡¨-------------\"); printCourses(collection); collection.remove(course1); log.info(\"----------åˆ é™¤æ“ä½œä¹‹åçš„è¯¾ç¨‹---- \"); printCourses(collection); &#125; private void printCourses(MyCollection collection) &#123; MyIterator iterator = collection.iterator(); while (iterator.hasNext()) &#123; Course course = (Course) iterator.next(); log.info(course.toString()); &#125; &#125;&#125; è¿­ä»£å™¨æ¨¡å¼æºç è§£æArrayListçš„è¿­ä»£å™¨ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667/** ArrayListçš„å†…éƒ¨ç±»å®ç°äº†Iterator * An optimized version of AbstractList.Itr */private class Itr implements Iterator&lt;E&gt; &#123; int cursor; // index of next element to return int lastRet = -1; // index of last element returned; -1 if no such int expectedModCount = modCount; public boolean hasNext() &#123; return cursor != size; &#125; @SuppressWarnings(\"unchecked\") public E next() &#123; checkForComodification(); int i = cursor; if (i &gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; return (E) elementData[lastRet = i]; &#125; public void remove() &#123; if (lastRet &lt; 0) throw new IllegalStateException(); checkForComodification(); try &#123; ArrayList.this.remove(lastRet); cursor = lastRet; lastRet = -1; expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125; &#125; @Override @SuppressWarnings(\"unchecked\") public void forEachRemaining(Consumer&lt;? super E&gt; consumer) &#123; Objects.requireNonNull(consumer); final int size = ArrayList.this.size; int i = cursor; if (i &gt;= size) &#123; return; &#125; final Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) &#123; throw new ConcurrentModificationException(); &#125; while (i != size &amp;&amp; modCount == expectedModCount) &#123; consumer.accept((E) elementData[i++]); &#125; // update once at end of iteration to reduce heap write traffic cursor = i; lastRet = i - 1; checkForComodification(); &#125; final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException(); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"ç»„åˆæ¨¡å¼","slug":"design_pattern/structure_type/ç»„åˆæ¨¡å¼","date":"2019-09-23T16:00:00.000Z","updated":"2020-07-04T16:28:45.971Z","comments":true,"path":"posts/df879792/","link":"","permalink":"https://gentryhuang.com/posts/df879792/","excerpt":"","text":"å®šä¹‰å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤ºâ€œéƒ¨åˆ†-æ•´ä½“â€çš„å±‚æ¬¡ç»“æ„ã€‚ä½œç”¨æ˜¯ä½¿å®¢æˆ·ç«¯å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡ä¿æŒä¸€è‡´çš„æ–¹å¼å¤„ç†ã€‚ç»„åˆæ¨¡å¼å°±æ˜¯å°†å¤šä¸ªå¯¹è±¡ç»„åˆæˆä¸€ä¸ªå¯¹è±¡ï¼ˆè¿™äº›å¯¹è±¡å…·æœ‰ç›¸åŒçš„ç±»å‹ï¼Œä½¿ç”¨å®ƒä»¬çš„çˆ¶ç±»å‹ä½œä¸ºç»Ÿä¸€çš„å¯¹è±¡ä¾›å®¢æˆ·ç«¯è®¿é—®ï¼‰ï¼Œç®€åŒ–äº†å¯¹å¤šä¸ªå¯¹è±¡çš„è®¿é—® ç±»å‹ç»“æ„å‹ ä½¿ç”¨åœºæ™¯121. å¸Œæœ›å®¢æˆ·ç«¯å¯ä»¥å¿½ç•¥ç»„åˆå¯¹è±¡ä¸å•ä¸ªå¯¹è±¡çš„å·®å¼‚æ—¶2. å¤„ç†ä¸€ä¸ªæ ‘å½¢ç»“æ„æ—¶ ä¼˜ç‚¹1234â—†æ¸…æ¥šåœ°å®šä¹‰äº†åˆ†å±‚æ¬¡çš„å¤æ‚å¯¹è±¡ï¼Œè¡¨ç¤ºå¯¹è±¡çš„å…¨éƒ¨æˆ–éƒ¨åˆ†å±‚æ¬¡â—†è®©å®¢æˆ·ç«¯å¿½ç•¥äº†å±‚æ¬¡çš„å·®å¼‚ï¼Œæ–¹ä¾¿å¯¹æ•´ä¸ªå±‚æ¬¡ç»“æ„è¿›è¡Œæ§åˆ¶â—†ç®€åŒ–å®¢æˆ·ç«¯ä»£ç â—†ç¬¦åˆå¼€é—­åŸåˆ™ ç¼ºç‚¹121. é™åˆ¶ç±»å‹æ—¶ä¼šè¾ƒä¸ºå¤æ‚ï¼Œå› ä¸ºå®ƒä»¬éƒ½å…·æœ‰ç›¸åŒçš„çˆ¶ç±»å‹2. ä½¿è®¾è®¡å˜å¾—æ›´åŠ æŠ½è±¡ ç›¸å…³çš„è®¾è®¡æ¨¡å¼ç»„åˆæ¨¡å¼å’Œè®¿é—®è€…æ¨¡å¼ å¯ä»¥ç”¨è®¿é—®æ¨¡å¼è®¿é—®ç»„åˆæ¨¡å¼çš„é€’å½’ç»“æ„ ç®€å•éœ€æ±‚è¯¾ç¨‹åˆ†ä¸ºä¸åŒçš„ç±»å‹ï¼Œæ¯ä¸€ç§ç±»å‹å¯¹åº”ä¸€ä¸ªè¯¾ç¨‹ç›®å½•ï¼Œè¯¾ç¨‹ç›®å½•ä¸‹åˆæœ‰å¾ˆå¤šçš„è¯¾ç¨‹ï¼Œè¦æ±‚æ‰“å°å‡ºè¯¾ç¨‹çš„ç»“æ„ ç»„åˆæ¨¡å¼çš„æ¼”ç»ƒ 1æˆ‘ä»¬å¯ä»¥é€šè¿‡è¡Œä¸ºæ–¹æ³•è¿›è¡Œè¯†åˆ«ç»„åˆæ¨¡å¼ï¼Œç»„åˆæ¨¡å¼æ˜¯å°†ç›¸åŒçš„æŠ½è±¡ç±»ç±»å‹æˆ–è€…æ¥å£ç±»å‹è½¬ä¸ºç›¸åŒçš„æ ‘çŠ¶ç»“æ„ï¼Œä½¿ç”¨æŠ½è±¡ä½œä¸ºè®¿é—®çš„å…¥å£ã€‚å¶å­å¯¹è±¡ï¼ˆå•ä¸ªå¯¹è±¡ï¼‰å’Œç»„åˆå¥½çš„å¯¹è±¡ï¼ˆåŒ…å«å¶å­å¯¹è±¡çš„é›†åˆï¼‰éƒ½è¦ç»§æ‰¿æˆ–å®ç°ç›¸åŒçš„çˆ¶ç±»ï¼Œè¿™æ ·ç»„åˆæ¨¡å¼æ‰èƒ½å°†å®ƒä»¬è¿›è¡Œç»Ÿä¸€å¤„ç†ã€‚ ç»Ÿä¸€æŠ½è±¡ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package com.design.pattern.composite;/** * 1. æ–¹æ³•ä¸­çš„æŠ›å‡ºå¼‚å¸¸å¤„ç†ï¼Œæ˜¯ä½“ç°æ–¹æ³•ä¸èƒ½è¢«ä½¿ç”¨ï¼Œå› ä¸ºè¯¾ç¨‹å’Œè¯¾ç¨‹ç›®å½•ä½¿ç”¨çš„æ–¹æ³•ä¸åŒ * 2. è¯¾ç¨‹å’Œè¯¾ç¨‹ç›®å½•ä½¿ç”¨ç»Ÿä¸€ç±»å‹ä¾›å®¢æˆ·ç«¯è®¿é—® * @author shunhua * @date 2019-09-24 */public abstract class CourseComponet &#123; /** * æ‰©å±•è¯¾ç¨‹ç›®å½• * @param courseComponet */ public void addCatalog(CourseComponet courseComponet)&#123; throw new UnsupportedOperationException(\"ä¸æ”¯æŒæ·»åŠ è¯¾ç¨‹ç›®å½•æ“ä½œ\"); &#125; /** * åˆ é™¤è¯¾ç¨‹ç›®å½• * @param courseComponet */ public void removeCatalog(CourseComponet courseComponet)&#123; throw new UnsupportedOperationException(\"ä¸æ”¯æŒåˆ é™¤è¯¾ç¨‹ç›®å½•æ“ä½œ\"); &#125; /** * è·å–è¯¾ç¨‹åç§° * @param courseComponet * @return */ public String getName(CourseComponet courseComponet)&#123; throw new UnsupportedOperationException(\"ä¸æ”¯æŒè·å–è¯¾ç¨‹åç§°æ“ä½œ\"); &#125; /** * è·å–è¯¾ç¨‹ä»·æ ¼ * @param courseComponet * @return */ public double getPrice(CourseComponet courseComponet)&#123; throw new UnsupportedOperationException(\"ä¸æ”¯æŒè·å–è¯¾ç¨‹ä»·æ ¼æ“ä½œ\"); &#125; /** * æ‰“å°ä¿¡æ¯ */ public void print()&#123; throw new UnsupportedOperationException(\"ä¸æ”¯æŒæ‰“å°æ“ä½œ\"); &#125;&#125; è¯¾ç¨‹ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041package com.design.pattern.composite;import lombok.extern.slf4j.Slf4j;&#x2F;** * Course è¯¾ç¨‹ç±» * * @author shunhua * @date 2019-09-24 *&#x2F;@Slf4jpublic class Course extends CourseComponet &#123; &#x2F;** * è¯¾ç¨‹å *&#x2F; private String courseName; &#x2F;** * è¯¾ç¨‹ä»·æ ¼ *&#x2F; private double price; public Course(String courseName, double price) &#123; this.courseName &#x3D; courseName; this.price &#x3D; price; &#125; @Override public String getName(CourseComponet courseComponet) &#123; return this.courseName; &#125; @Override public double getPrice(CourseComponet courseComponet) &#123; return this.price; &#125; @Override public void print() &#123; log.info(&quot;è¯¾ç¨‹åï¼š&quot; + courseName + &quot;, è¯¾ç¨‹ä»·æ ¼ï¼š&quot; + price); &#125;&#125; è¯¾ç¨‹ç›®å½•ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162package com.design.pattern.composite;import lombok.extern.slf4j.Slf4j;import java.util.ArrayList;import java.util.List;/** * CourseCatalog è¯¾ç¨‹ç›®å½•ç±» * * @author shunhua * @date 2019-09-24 */@Slf4jpublic class CourseCatalog extends CourseComponet &#123; /** * è¯¾ç¨‹ç›®å½•ä¸‹çš„è¯¾ç¨‹é›†åˆ ï¼Œè¿™é‡Œä½¿ç”¨ç»Ÿä¸€æŠ½è±¡ç±»å‹è¡¨ç¤ºï¼Œè¿™é‡Œå°±ç»„åˆäº†è¯¾ç¨‹å¯¹è±¡ */ private List&lt;CourseComponet&gt; items = new ArrayList&lt;&gt;(); /** * è¯¾ç¨‹ç›®å½•å */ private String catalogName; public CourseCatalog(String catalogName)&#123; this.catalogName = catalogName; &#125; /** * ä¸ºè¯¾ç¨‹ç›®å½•æ·»åŠ è¯¾ç¨‹ * @param courseComponet */ @Override public void addCatalog(CourseComponet courseComponet) &#123; this.items.add(courseComponet); &#125; /** * åˆ é™¤è¯¾ç¨‹ç›®å½•ä¸­çš„è¯¾ç¨‹ * @param courseComponet */ @Override public void removeCatalog(CourseComponet courseComponet) &#123; this.items.remove(courseComponet); &#125; @Override public String getName(CourseComponet courseComponet) &#123; return this.catalogName; &#125; /** * æ‰“å°ç›®å½•ä»¥åŠç›®å½•ä¸‹çš„è¯¾ç¨‹ */ @Override public void print() &#123; log.info(catalogName); for(CourseComponet courseComponet : items)&#123; courseComponet.print(); &#125; &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233package com.design.pattern.composite;import org.junit.Test;&#x2F;** * Client è¯¾ç¨‹ç›®å½•å’Œè¯¾ç¨‹ï¼Œå¯¹å®¢æˆ·ç«¯æ¥è¯´éƒ½æ˜¯ä¸€ä¸ªç±»å‹çš„å¯¹è±¡ * * @author shunhua * @date 2019-09-24 *&#x2F;public class Client &#123; @Test public void test()&#123; CourseComponet catalog &#x3D; new CourseCatalog(&quot;è¯¾ç¨‹é¡¶çº§ç›®å½•&quot;); CourseComponet linuxCourse &#x3D; new Course(&quot;é¸Ÿå“¥ç§æˆ¿èœ&quot;,80); CourseComponet gitCourse &#x3D; new Course(&quot;Gitæƒå¨æŒ‡å—&quot;,120); CourseComponet javaCatalog &#x3D; new CourseCatalog(&quot;Javaè¯¾ç¨‹ç›®å½•&quot;); CourseComponet spring &#x3D; new Course(&quot;Springå®æˆ˜&quot;,70); CourseComponet mybatis &#x3D; new Course(&quot;MyBatisæŠ€æœ¯å†…å¹•&quot;,60); javaCatalog.addCatalog(spring); javaCatalog.addCatalog(mybatis); catalog.addCatalog(linuxCourse); catalog.addCatalog(gitCourse); catalog.addCatalog(javaCatalog); &#x2F;&#x2F; æ‰“å°è¯¾ç¨‹ç›®å½•ä»¥åŠç›®å½•ä¸‹çš„è¯¾ç¨‹åˆ—è¡¨ catalog.print(); &#125;&#125; ç»„åˆæ¨¡å¼æºç è§£æjdkæºç ä¹‹HashMap 1234567891011121314151617181920212223242526272829303132public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable&#123; /** * æ–¹æ³•çš„å…¥å‚æ˜¯Mapç±»å‹ï¼Œä½¿ç”¨Mapç±»å‹ä½œä¸ºç»Ÿä¸€çš„æ¥æ”¶å‚æ•°ï¼Œä¸éœ€è¦å…³æ³¨ä»»ä½•ä¹‹ç±»å‹çš„å¯¹è±¡ */ public void putAll(Map&lt;? extends K, ? extends V&gt; m) &#123; int numKeysToBeAdded = m.size(); if (numKeysToBeAdded == 0) return; if (table == EMPTY_TABLE) &#123; inflateTable((int) Math.max(numKeysToBeAdded * loadFactor, threshold)); &#125; if (numKeysToBeAdded &gt; threshold) &#123; int targetCapacity = (int)(numKeysToBeAdded / loadFactor + 1); if (targetCapacity &gt; MAXIMUM_CAPACITY) targetCapacity = MAXIMUM_CAPACITY; int newCapacity = table.length; while (newCapacity &lt; targetCapacity) newCapacity &lt;&lt;= 1; if (newCapacity &gt; table.length) resize(newCapacity); &#125; for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) put(e.getKey(), e.getValue()); &#125;&#125; jdkæºç ä¹‹ArrayList 1234567891011/** * æ–¹æ³•çš„å…¥å‚ä½¿ç”¨ç»Ÿä¸€çš„çˆ¶ç±»å‹Collectionï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦å…³æ³¨å…·ä½“çš„å­ç±»å‹å¯¹è±¡ */ public boolean addAll(Collection&lt;? extends E&gt; c) &#123; Object[] a = c.toArray(); int numNew = a.length; ensureCapacityInternal(size + numNew); // Increments modCount System.arraycopy(a, 0, elementData, size, numNew); size += numNew; return numNew != 0; &#125; MyBatisæºç ä¹‹SqlNode 12MyBatisçš„sqlè¯­å¥ä¼šè¢«è§£ææˆä¸åŒçš„SqlNodeç±»å‹çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡éƒ½å®ç°äº†SqlNodeã€‚å…¶ä¸­MixedSqlNodeæ˜¯è”ç³»ä¸åŒçš„SqlNodeçš„ä¸€ä¸ªæ ¸å¿ƒå¯¹è±¡ï¼Œç»„åˆæ¨¡å¼å¯ä»¥ç»Ÿä¸€å¤„ç†çš„å®ƒä»¬ã€‚ 12345678910111213141516171819202122package org.apache.ibatis.scripting.xmltags;import java.util.List;public class MixedSqlNode implements SqlNode &#123; /** * SqlNodeä¸åŒå®ç°çš„é›†åˆ */ private final List&lt;SqlNode&gt; contents; public MixedSqlNode(List&lt;SqlNode&gt; contents) &#123; this.contents = contents; &#125; @Override public boolean apply(DynamicContext context) &#123; for (SqlNode sqlNode : contents) &#123; sqlNode.apply(context); &#125; return true; &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"äº«å…ƒæ¨¡å¼","slug":"design_pattern/structure_type/äº«å…ƒæ¨¡å¼","date":"2019-09-22T16:00:00.000Z","updated":"2020-07-04T16:28:45.970Z","comments":true,"path":"posts/e19da94a/","link":"","permalink":"https://gentryhuang.com/posts/e19da94a/","excerpt":"","text":"å®šä¹‰æä¾›äº†å‡å°‘å¯¹è±¡æ•°é‡ä»è€Œæ”¹å–„åº”ç”¨çš„å¯¹è±¡ç»“æ„çš„æ–¹å¼ã€‚è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦çš„å¯¹è±¡ã€‚å³å‡å°‘åˆ›å»ºå¯¹è±¡çš„æ•°é‡ï¼Œå…±äº«å¯¹è±¡ï¼Œä»è€Œå‡å°‘å†…å­˜çš„å ç”¨å¹¶ä¸”æé«˜æ€§èƒ½ ã€‚æ³¨æ„ï¼šäº«å…ƒæ¨¡å¼é‡è¦çš„å°±æ˜¯å…±äº«ã€‚ ç±»å‹ç»“æ„å‹ åº”ç”¨åœºæ™¯1234â—† å¸¸å¸¸åº”ç”¨äºç³»ç»Ÿåº•å±‚çš„å¼€å‘ï¼Œä»¥ä¾¿è§£å†³ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ å¦‚Stringç±»å‹å°±æ˜¯ä½¿ç”¨äº†äº«å…ƒæ¨¡å¼ï¼ŒStringå¯¹è±¡å­˜åœ¨å³è¿”å›ï¼Œæ²¡æœ‰å°±åˆ›å»ºç„¶åæ”¾å…¥åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ã€‚å†æ¯”å¦‚æ•°æ®åº“è¿æ¥æ± ï¼Œé‡Œé¢éƒ½æ˜¯åˆ›å»ºå¥½çš„æ•°æ®åº“è¿æ¥ï¼Œéœ€è¦çš„æ—¶å€™æ‹¿æ¥ç”¨ä¸éœ€è¦çš„æ—¶å€™å½’è¿˜å›å»ã€‚å³ç³»ç»Ÿä¸­å¦‚æœæœ‰å¤§é‡çš„å¯¹è±¡ï¼Œå¯èƒ½ä¼šé€ æˆå†…å­˜æº¢å‡ºï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå…±åŒçš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥ï¼Œæœ‰ç›¸åŒçš„ä¸šåŠ¡è¯·æ±‚ï¼Œåˆ™è¿”å›åœ¨å†…å­˜ä¸­çš„å·²æœ‰å¯¹è±¡ï¼Œé¿å…é‡æ–°åˆ›å»ºâ—† ç³»ç»Ÿæœ‰å¤§é‡ç›¸ä¼¼å¯¹è±¡ã€éœ€è¦ç¼“å†²æ± çš„åœºæ™¯ æŸä¸ªå¯¹è±¡çš„å¤ç”¨åº¦è¶Šé«˜ï¼Œè¶Šå€¾å‘äºä½¿ç”¨äº«å…ƒæ¨¡å¼ ä¼˜ç‚¹12â—†å‡å°‘å¯¹è±¡çš„åˆ›å»ºï¼Œé™ä½å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ï¼Œé™ä½ç³»ç»Ÿçš„å†…å­˜ï¼Œæé«˜æ•ˆç‡â—†å‡å°‘å†…å­˜ä¹‹å¤–çš„å…¶ä»–èµ„æºå ç”¨(æ—¶é—´èµ„æºã€æ–‡ä»¶å¥æŸ„ã€çª—å£å¥æŸ„ç­‰) ç¼ºç‚¹1234â—†å…³æ³¨å†…&#x2F;å¤–éƒ¨çŠ¶æ€ã€å…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ æˆ‘ä»¬ä½¿ç”¨å…±äº«æ¨¡å¼çš„æ—¶å€™ï¼Œå¤§éƒ½æ˜¯ä½¿ç”¨hashMapï¼Œä¸ä¼šç”¨HashTableï¼ˆå› ä¸ºhashTableä¼šç”±äºåŒæ­¥é”é€ æˆæ•ˆç‡è¿‡ä½ï¼Œè¿™æ ·å¾—ä¸å¿å¤±ï¼‰ï¼Œè¿™æ ·å°±éœ€è¦åœ¨æœ‰äº›åœºæ™¯ä¸‹å…³æ³¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚åŒæ—¶è¿˜è¦å…³æ³¨å†…ã€å¤–éƒ¨çŠ¶æ€ã€‚â—†ä½¿ç³»ç»Ÿã€ç¨‹åºçš„é€»è¾‘å¤æ‚åŒ– ä½¿ç”¨äº†äº«å…ƒå¯¹è±¡æé«˜äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè¿˜è¦åˆ†ç¦»å†…å¤–ä¸çŠ¶æ€ï¼Œå¹¶ä¸”å¤–éƒ¨çŠ¶æ€ä¸åº”è¯¥éšç€å†…éƒ¨çŠ¶æ€çš„å˜åŒ–è€Œå˜åŒ–ï¼Œå¦åˆ™ç³»ç»Ÿå°±æ··ä¹±äº†ã€‚ æ‰©å±•å†…éƒ¨çŠ¶æ€ 1åœ¨äº«å…ƒæ¨¡å¼å†…éƒ¨å¹¶ä¸”ä¸ä¼šéšç€ç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„å…±äº«éƒ¨åˆ†ï¼›æ— è®ºå¤–éƒ¨ç¯å¢ƒå¦‚ä½•å˜åŒ–ï¼Œæˆ‘éƒ½ä¸å˜ï¼Œå¹¶ä¸”è¯¥çŠ¶æ€åœ¨äº«å…ƒæ¨¡å¼å†…éƒ¨ã€‚å¯ç†è§£ä¸ºæ˜¯äº«å…ƒå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸ä¼šä¸å¤–éƒ¨äº¤äº’ã€‚ å¤–éƒ¨çŠ¶æ€ 1éšç€ç¯å¢ƒæ”¹å˜è€Œæ”¹å˜çš„å°±æ˜¯å¤–éƒ¨çŠ¶æ€ï¼Œè¿™ç§çŠ¶æ€æ˜¯ä¸å¯ä»¥å…±äº«çš„çŠ¶æ€ï¼Œå¹¶ä¸”è®°å½•åœ¨äº«å…ƒæ¨¡å¼çš„å¤–éƒ¨ã€‚å¯ç†è§£ä¸ºäº«å…ƒå¯¹è±¡çš„ä¸€ä¸ªå¯ä»¥å’Œå¤–ç•Œäº¤äº’çš„å±æ€§ï¼Œå®ƒä¼šéšæ—¶å‘ç”Ÿæ”¹å˜ã€‚ ç›¸å…³è®¾è®¡æ¨¡å¼äº«å…ƒæ¨¡å¼å’Œä»£ç†æ¨¡å¼ 1ä»£ç†æ¨¡å¼æ˜¯ä»£ç†ä¸€ä¸ªç±»ï¼Œå¦‚æœç”Ÿæˆè¿™ä¸ªä»£ç†ç±»èŠ±çš„èµ„æºå’Œæ—¶é—´æ¯”è¾ƒå¤šï¼Œå¯ä»¥ä½¿ç”¨äº«å…ƒæ¨¡å¼å¤„ç†è¿™ä¸ªç±»çš„é€Ÿåº¦ äº«å…ƒæ¨¡å¼å’Œå•ä¾‹æ¨¡å¼ 1å®¹å™¨å•ä¾‹æ˜¯ä¸¤ç§æ–¹å¼çš„ä¸€ç§ç»“åˆã€‚äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç§å¤ç”¨å¯¹è±¡çš„æ€æƒ³ ç®€å•éœ€æ±‚å¹´ç»ˆäº†ï¼Œç ”å‘éƒ¨é—¨Leaderå¯èƒ½éœ€è¦å¤šæ¬¡åœ°å»æ±‡æŠ¥å·¥ä½œæƒ…å†µï¼Œå·²ç»æœ‰æŠ¥å‘Šç»“æœçš„å°±ä¸éœ€è¦å†æ•´ç†æŠ¥å‘Šäº†ï¼Œç›´æ¥æ‹¿åˆ°æŠ¥å‘Šå°±å¯ä»¥å»æ±‡æŠ¥äº†ã€‚æ²¡æœ‰åšè¿‡æ±‡æŠ¥çš„å°±éœ€è¦å…ˆæ•´ç†æŠ¥å‘Šã€‚ äº«å…ƒæ¨¡å¼æ¼”ç»ƒ æŠ¥å‘Š 1234567891011121314151617181920212223242526272829303132333435363738package com.design.pattern.flyweight;import lombok.Data;import lombok.extern.slf4j.Slf4j;/** * Presentation æŠ¥å‘Šç±» * * @author shunhua * @date 2019-09-23 */@Data@Slf4jpublic class Presentation &#123; /** * æŠ¥å‘Šç›¸å…³éƒ¨é—¨ */ private String department; /** * æ±‡æŠ¥å†…å®¹ */ private String content; /** * é€šè¿‡å¤–éƒ¨çŠ¶æ€å±æ€§è¿›è¡Œæ„é€  * @param department */ public Presentation(String department)&#123; this.department = department; &#125; /** * æŠ¥å‘Šå†…å®¹ */ public void report() &#123; log.info(content); &#125;&#125; æŠ¥å‘Šå·¥å‚ 1234567891011121314151617181920212223242526272829303132333435363738394041package com.design.pattern.flyweight;import lombok.extern.slf4j.Slf4j;import org.springframework.util.ObjectUtils;import java.util.HashMap;import java.util.Map;/** * PresentationFactory æŠ¥å‘Šå·¥å‚ * * @author shunhua * @date 2019-09-23 */@Slf4jpublic class PresentationFactory &#123; /** * æ­¤å¤„åº”ç”¨äº† finalä¿®é¥° å¼•ç”¨æˆå‘˜å˜é‡ï¼Œå¼•ç”¨å¯¹è±¡çš„å†…å®¹å¯ä»¥ä¿®æ”¹ï¼Œä½†æ˜¯å¼•ç”¨åœ°å€ä¸å¯ä»¥ä¿®æ”¹ã€‚è¿™é‡Œä½œä¸ºæŠ¥å‘Šæ± ã€‚ */ private static final Map&lt;String,Presentation&gt; PRESENTATION_MAP = new HashMap&lt;&gt;(16); /** * è¿™é‡Œä¸è€ƒè™‘å®‰å…¨é—®é¢˜ * @param department * @return */ public static Presentation getPresentation(String department)&#123; // å…ˆä»æŠ¥å‘Šæ± ä¸­è·å– Presentation leaderPresentation = PRESENTATION_MAP.get(department); // æŠ¥å‘Šæ± ä¸­æ²¡æœ‰å†åˆ›å»ºä¸€ä¸ªï¼Œç„¶åæ”¾åˆ°æŠ¥å‘Šæ± ä¸­ if(ObjectUtils.isEmpty(leaderPresentation))&#123; leaderPresentation = new Presentation(department); log.info(\"----------- æŠ¥å‘Šæ± ä¸­æ²¡æœ‰éœ€å…ˆåˆ›å»º----------\"); PRESENTATION_MAP.put(department,leaderPresentation); leaderPresentation.setContent(\"éƒ¨é—¨ï¼š\" + department +\" æ±‡æŠ¥...\"); leaderPresentation.report(); &#125; return leaderPresentation; &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122package com.design.pattern.flyweight;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-23 */public class Client &#123; private final String presentation[] = &#123;\"ä¸šåŠ¡éƒ¨\",\"ç ”å‘éƒ¨\",\"ç®¡ç†éƒ¨\"&#125;; @Test public void test()&#123; for(int i = 0; i &lt; 20; i++)&#123; String department = presentation[(int)(Math.random() * presentation.length)]; Presentation leaderPresentation = PresentationFactory.getPresentation(department); leaderPresentation.report(); &#125; &#125;&#125; äº«å…ƒæ¨¡å¼æºç è§£æInteger 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public final class Integer extends Number implements Comparable&lt;Integer&gt; &#123; /** * This method will always cache values in the range -128 to 127, * inclusive, and may cache other values outside of this range. * å¦‚æœä¼ å…¥çš„æ•°å€¼åœ¨ç¼“å­˜çš„-127å’Œ128ä¹‹é—´ï¼Œé‚£ä¹ˆéƒ½ä¼šåœ¨cacheä¸­ï¼Œå¦åˆ™çš„è¯ï¼Œä¼šnewå‡ºæ–°çš„å¯¹è±¡ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ100==100ä¸ºtrueï¼Œ1000==1000ä¸ºfalse * @param i an &#123;@code int&#125; value. * @return an &#123;@code Integer&#125; instance representing &#123;@code i&#125;. * @since 1.5 */ public static Integer valueOf(int i) &#123; assert IntegerCache.high &gt;= 127; if (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high) return IntegerCache.cache[i + (-IntegerCache.low)]; return new Integer(i); &#125;/** åªè¦åœ¨-128-127ï¼Œä½¿ç”¨ == åˆ¤æ–­æ˜¯å¯ä»¥çš„ï¼Œä¸å†è¿™ä¸ªèŒƒå›´å°±ä¸èƒ½ä½¿ç”¨==,éœ€è¦ä½¿ç”¨equqls * Cache to support the object identity semantics of autoboxing for values between * -128 and 127 (inclusive) as required by JLS. * */ private static class IntegerCache &#123; static final int low = -128; static final int high; static final Integer cache[]; static &#123; // high value may be configured by property int h = 127; String integerCacheHighPropValue = sun.misc.VM.getSavedProperty(\"java.lang.Integer.IntegerCache.high\"); if (integerCacheHighPropValue != null) &#123; int i = parseInt(integerCacheHighPropValue); i = Math.max(i, 127); // Maximum array size is Integer.MAX_VALUE h = Math.min(i, Integer.MAX_VALUE - (-low) -1); &#125; high = h; cache = new Integer[(high - low) + 1]; int j = low; for(int k = 0; k &lt; cache.length; k++) cache[k] = new Integer(j++); &#125; private IntegerCache() &#123;&#125; &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"æ¡¥æ¥æ¨¡å¼","slug":"design_pattern/structure_type/æ¡¥æ¥æ¨¡å¼","date":"2019-09-20T16:00:00.000Z","updated":"2020-07-04T16:28:45.966Z","comments":true,"path":"posts/563268dc/","link":"","permalink":"https://gentryhuang.com/posts/563268dc/","excerpt":"","text":"å®šä¹‰å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å…·ä½“å®ç°éƒ¨åˆ†åˆ†ç¦»å¼€æ¥ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ï¼ˆè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå®ç°è§£è€¦ï¼‰ã€‚æ¡¥æ¥æ¨¡å¼å°†ç»§æ‰¿å…³ç³»è½¬åŒ–æˆå…³è”å…³ç³»ï¼Œå®ƒé™ä½äº†ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå‡å°‘äº†ç³»ç»Ÿä¸­ç±»çš„æ•°é‡ï¼Œé˜²æ­¢ç±»çˆ†ç‚¸ã€‚ä»å®ƒçš„å‘½åå¯ä»¥çœ‹å‡ºï¼Œbridgeæ˜¯æ¡¥æ¢çš„æ„æ€ï¼Œ å°†æ¡¥ä¸¤è¾¹è”ç³»èµ·æ¥ã€‚ç›®çš„å°±æ˜¯æŠŠä¸¤ä¸ªä¸åŒçš„ç±»ä¹‹é—´å»ºç«‹è”ç³»ï¼Œè€Œä¸¤ä¸ªç±»ä¹‹é—´å»ºç«‹è”ç³»çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œè€Œæ¡¥æ¥æ¨¡å¼æ˜¯é€šè¿‡ç»„åˆçš„æ–¹å¼å»ºç«‹ä¸¤ä¸ªä¸åŒç±»ä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯ç»§æ‰¿ã€‚è¿™ä¹Ÿç¬¦åˆåˆæˆå¤ç”¨åŸåˆ™ï¼šä¼˜å…ˆé€šè¿‡ç»„åˆçš„æ–¹å¼å»ºç«‹ä¸¤ä¸ªç±»ä¹‹é—´è”ç³»ï¼Œè€Œä¸æ˜¯ç»§æ‰¿ï¼Œç»§æ‰¿è¿‡å¤šä¼šå‘ç”Ÿç±»çˆ†ç‚¸çš„æƒ…å†µã€‚è¯´æ˜ä¸€ç‚¹:è¿™é‡Œè¯´çš„æŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†ï¼Œå¹¶ä¸å±€é™ä¸€ä¸ªæ˜¯æŠ½è±¡çš„ï¼Œå¦ä¸€ä¸ªæ˜¯å…·ä½“çš„å®ç°ï¼Œè¿™åªæ˜¯ä»æ¦‚å¿µä¸Šå»å®šä¹‰ã€‚ 1å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ƒçš„å…·ä½“å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œå…¶å®è¿™å¹¶ä¸æ˜¯å°†æŠ½è±¡ç±»ä¸ä»–çš„æ´¾ç”Ÿç±»åˆ†ç¦»ï¼Œè€Œæ˜¯æŠ½è±¡ç±»å’Œå®ƒçš„æ´¾ç”Ÿç±»ç”¨æ¥å®ç°è‡ªå·±çš„å¯¹è±¡ã€‚æˆ–è€…è¯´åœ¨ä¸€ä¸ªç³»ç»Ÿçš„æŠ½è±¡åŒ–å’Œå®ç°åŒ–ä¹‹é—´ä½¿ç”¨å…³è”å…³ç³»ï¼ˆç»„åˆæˆ–è€…èšåˆå…³ç³»ï¼‰è€Œä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œä»è€Œä½¿ä¸¤è€…å¯ä»¥ç›¸å¯¹ç‹¬ç«‹åœ°å˜åŒ–ã€‚ ç±»å‹ç»“æ„å‹ é€‚ç”¨åœºæ™¯ æŠ½è±¡å’Œå…·ä½“å®ç°ä¹‹é—´å¢åŠ æ›´å¤šçš„çµæ´»æ€§ 1ä½¿ç”¨æ¡¥æ¥æ¨¡å¼å°±å¯ä»¥é¿å…åœ¨è¿™ä¸¤ä¸ªå±‚æ¬¡ä¹‹é—´å»ºç«‹é™æ€çš„ç»§æ‰¿å…³ç³»ï¼Œè€Œæ˜¯å»ºç«‹å…³è”å…³ç³»ã€‚æ­¤å¤–ï¼ŒæŠ½è±¡éƒ¨åˆ†å’Œå…·ä½“å®ç°éƒ¨åˆ†ï¼Œå®ƒä»¬éƒ½å¯ä»¥åˆ†åˆ«é€šè¿‡ç»§æ‰¿å…³ç³»ç‹¬ç«‹æ‰©å±•ï¼Œå¹¶ä¸”äº’ä¸å½±å“ï¼Œå°±å¯ä»¥åŠ¨æ€åœ°å°†ä¸€ä¸ªæŠ½è±¡åŒ–å­ç±»çš„å¯¹è±¡å’Œä¸€ä¸ªå…·ä½“å®ç°åŒ–å­ç±»çš„å¯¹è±¡è¿›è¡Œç»„åˆï¼Œè¿™æ ·å°±æŠŠæŠ½è±¡åŒ–è§’è‰²å’Œå…·ä½“å®ç°åŒ–è§’è‰²å®ç°äº†è§£è€¦ã€‚ ä¸€ä¸ªç±»å­˜åœ¨ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ï¼Œä¸”è¿™ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç»´åº¦éƒ½éœ€è¦ç‹¬ç«‹è¿›è¡Œæ‰©å±• 1æŠ½è±¡çš„éƒ¨åˆ†å¯ä»¥ç‹¬ç«‹æ‰©å±•ï¼Œå…·ä½“å®ç°ä¹Ÿå¯ä»¥ç‹¬ç«‹æ‰©å±• ä¸å¸Œæœ›ä½¿ç”¨ç»§æ‰¿ï¼Œæˆ–å› ä¸ºå¤šå±‚ç»§æ‰¿å¯¼è‡´ç³»ç»Ÿç±»çš„ä¸ªæ•°å‰§å¢ ä¼˜ç‚¹ åˆ†ç¦»æŠ½è±¡éƒ¨åˆ†åŠå…¶å…·ä½“å®ç°éƒ¨åˆ† 1å› ä¸ºæ¡¥æ¥æ¨¡å¼ä½¿ç”¨äº†ç»„åˆï¼Œä½¿ç”¨å¯¹è±¡é—´çš„å…³è”å…³ç³»ï¼Œæ¥è§£è€¦äº†æŠ½è±¡å’Œå…·ä½“å®ç°ä¹‹é—´çš„å›ºæœ‰ç»‘å®šå…³ç³»ï¼Œä½¿æŠ½è±¡å’Œå®ç°å¯ä»¥æ²¿ç€å„è‡ªçš„ç»´åº¦è¿›è¡Œæ‰©å±•ã€å˜åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŠ½è±¡å’Œå®ç°ä¸åœ¨åŒä¸€ä¸ªç»§æ‰¿å±‚æ¬¡ç»“æ„ä¸­ï¼Œä»è€Œé€šè¿‡ç»„åˆæ¥è·å¾—å¤šç»´åº¦çš„ç»„åˆå¯¹è±¡ã€‚ æé«˜äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ 1åœ¨ä¸¤ä¸ªå˜åŒ–ç»´åº¦ä¸­ï¼Œæ‰©å±•ä»»æ„ä¸€ä¸ªç»´åº¦éƒ½ä¸éœ€è¦ä¿®æ”¹åŸæœ‰çš„ç³»ç»Ÿ ç¬¦åˆå¼€é—­åŸåˆ™ ç¬¦åˆåˆæˆå¤ç”¨åŸåˆ™ ç¼ºç‚¹ å¢åŠ äº†ç³»ç»Ÿçš„ç†è§£ä¸è®¾è®¡éš¾åº¦ 1ç”±äºç±»ä¹‹é—´çš„å…³ç³»å»ºç«‹åœ¨æŠ½è±¡å±‚ï¼Œè¦æ±‚æˆ‘ä»¬åœ¨ç¼–ç çš„æ—¶å€™ï¼Œä¸€å¼€å§‹å°±è¦é’ˆå¯¹æŠ½è±¡å±‚è¿›è¡Œè®¾è®¡å’Œç¼–ç¨‹ éœ€è¦æ­£ç¡®åœ°è¯†åˆ«å‡ºç³»ç»Ÿä¸­ä¸¤ä¸ªç‹¬ç«‹å˜åŒ–çš„ç»´åº¦ ç›¸å…³è®¾è®¡æ¨¡å¼ ç»„åˆæ¨¡å¼ 1ç»„åˆæ¨¡å¼æ›´å¼ºè°ƒçš„æ˜¯éƒ¨åˆ†å’Œæ•´ä½“é—´çš„ç»„åˆï¼Œè€Œæ¡¥æ¥æ¨¡å¼å¼ºè°ƒçš„æ˜¯å¹³è¡Œçº§åˆ«ä¸Šä¸åŒç±»çš„ç»„åˆ é€‚é…å™¨æ¨¡å¼ 1é€‚é…å™¨æ¨¡å¼å’Œæ¡¥æ¥æ¨¡å¼éƒ½æ˜¯ä¸ºäº†è®©ä¸¤ä¸ªä¸œè¥¿é…åˆå·¥ä½œï¼Œä½†å®ƒä»¬ä¸¤ä¸ªçš„ç›®çš„ä¸ä¸€æ ·ï¼Œé€‚é…å™¨æ¨¡å¼æ˜¯æ”¹å˜å·²æœ‰çš„æ¥å£ï¼Œè®©å®ƒä»¬ä¹‹é—´å¯ä»¥ç›¸äº’é…åˆï¼Œè€Œæ¡¥æ¥æ¨¡å¼æ˜¯åˆ†ç¦»æŠ½è±¡å’Œå…·ä½“å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€‚é…å™¨æ¨¡å¼å¯ä»¥æŠŠåŠŸèƒ½ä¸Šç›¸ä¼¼ä½†æ˜¯æ¥å£ä¸åŒçš„ç±»é€‚é…èµ·æ¥ï¼Œè€Œæ¡¥æ¥æ¨¡å¼æ˜¯æŠŠç±»çš„æŠ½è±¡å’Œç±»çš„å…·ä½“å®ç°åˆ†ç¦»å¼€ï¼Œç„¶ååœ¨æ­¤åŸºç¡€ä¸Šä½¿è¿™äº›å±‚æ¬¡ç»“æ„ç»“åˆèµ·æ¥ã€‚ å…³é”®ä¸€ç‚¹æ¡¥æ¥æ¨¡å¼é‡è¦çš„å°±æ˜¯æŠŠæŠ½è±¡å’Œå…·ä½“å®ç°åˆ†ç¦»å¼€ï¼Œä¸­é—´é€šè¿‡ç»„åˆæ¥æ­å»ºå®ƒä»¬ä¹‹é—´çš„æ¡¥æ¢ æ¡ˆä¾‹åˆ†æ åœºæ™¯ 121ï¼‰æœ‰ä¸¤ä¸ªé“¶è¡Œï¼Œåˆ†åˆ«æ˜¯ABCå’ŒICBCé“¶è¡Œï¼ŒåŒæ—¶æœ‰ä¸¤ä¸ªè´¦å·ï¼Œåˆ†åˆ«æ˜¯å®šæœŸè´¦å·å’Œæ´»æœŸè´¦å·ã€‚2ï¼‰ä½¿ç”¨æ¡¥æ¥æ¨¡å¼å¯ä»¥ è®©å®ç°ï¼ˆè¿™é‡Œå°±æ˜¯è´¦å·å…·ä½“å®ç°ï¼‰å’ŒæŠ½è±¡ï¼ˆè¿™é‡Œå°±æ˜¯æŠ½è±¡çš„é“¶è¡Œç±»ï¼‰åˆ†ç¦»ï¼Œé“¶è¡Œå±æ€§å¢åŠ ä¿®æ”¹é“¶è¡Œç±»å³å¯ï¼Œè´¦å·ç±»å±æ€§å¢åŠ ä¿®æ”¹è´¦å·ç±»å³å¯ã€‚é€»è¾‘æ¸…æ™°ï¼ŒåŒæ—¶ä¹Ÿè§£å†³äº†ä¸Šè¿°ç±»çˆ†ç‚¸çš„æƒ…å†µã€‚ ç¼–ç  è´¦å·æ¥å£ Account 12345678910public interface Account &#123; /** * å¼€æˆ· */ Account openAccount(); /** * å¼€æˆ·ç±»å‹ */ void showAccountType();&#125; â€‹ è´¦å·çš„ä¸¤ä¸ªå®ç°ç±» SavingAccountå’Œ DepositAccount 1234567891011121314151617181920212223242526public class SavingAccount implements Account &#123; @Override public Account openAccount() &#123; System.out.println(\"SavingAccount--å¼€æ´»æœŸè´¦å·\"); return new SavingAccount(); &#125; @Override public void showAccountType() &#123; System.out.println(\"SavingAccount--è¿™æ˜¯ä¸€ä¸ªæ´»æœŸè´¦å·\"); &#125;&#125;-----public class DepositAccount implements Account &#123; @Override public Account openAccount() &#123; System.out.println(\"DepositAccount--å¼€å®šæœŸè´¦å·\"); return new DepositAccount(); &#125; @Override public void showAccountType() &#123; System.out.println(\"DepositAccouont--è¿™æ˜¯ä¸€ä¸ªå®šæœŸè´¦å·\"); &#125;&#125; â€‹ é“¶è¡ŒæŠ½è±¡ç±» Bank 123456789101112131415161718192021222324252627public abstract class Bank &#123; /** * è¿™é‡Œè¦å†™æˆä¸€ä¸ªæŠ½è±¡çš„ï¼Œå› ä¸ºè¦æŠŠAccountå¼•å…¥åˆ°Banké‡Œé¢ï¼Œé€š * è¿‡è¿™ç§ç»„åˆçš„æ–¹å¼ï¼ŒæŠŠAccountçš„è¡Œä¸ºäº¤ç»™Bankçš„å­ç±»æ¥å®ç°ï¼Œå³ * Bankè¿™ä¸ªæŠ½è±¡ç±»ä¸­çš„æŸä¸ªè¡Œä¸ºè¦å§”æ‰˜ç»™Accountè¿™ä¸ªæ¥å£çš„å®ç°ï¼Œ * æŠ½è±¡å’Œå…·ä½“çš„å®ç°åˆ†ç¦»æŒ‡å®šçš„å°±æ˜¯è¿™ç§æƒ…å†µã€‚ */ /** * è¦äº¤ç»™å­ç±»ï¼Œå£°æ˜ä¸ºprotectedï¼Œè¿™æ ·åªæœ‰å­ç±»èƒ½å¤Ÿæ‹¿åˆ° */ protected Account account; /** * é€šè¿‡æ„é€ å™¨æŠŠAccountä¼ è¿‡æ¥ï¼Œä¹Ÿå¯ä»¥é€šè¿‡setteræ³¨å…¥çš„æ–¹å¼èµ‹å€¼ */ public Bank(Account account)&#123; this.account = account; &#125; /** * è¿™ä¸ªæ–¹æ³•è¦å‚ç…§Accountæ¥å£ä¸­çš„æ–¹æ³•ï¼Œå› ä¸ºBanké‡Œé¢çš„å…·ä½“æ–¹æ³•è¦å§”æ‰˜ç»™Accounté‡Œé¢ * çš„openAccountæ–¹æ³•ï¼Œä½†è¿™é‡Œé¢æ–¹æ³•åä¸è¦æ±‚ä¸€å®šä¸€è‡´ */ abstract Account openAccount();&#125; â€‹ é“¶è¡ŒæŠ½è±¡ç±»çš„å­ç±» ABCBankå’ŒICBCBank 123456789101112131415161718192021222324252627282930313233343536373839404142434445public class ABCBank extends Bank &#123; /** * æ„é€ çš„æ—¶å€™ä¼ å…¥çš„æ˜¯å“ªä¸ªAccountå°±è¿”å›å“ªä¸€ä¸ªAccount(openAccountæ–¹æ³•) * @param account */ public ABCBank(Account account) &#123; super(account); &#125; /** * è¿™é‡Œè¿”å›çš„å°±æ˜¯çˆ¶ç±»ä¸­çš„Account * @return */ @Override Account openAccount() &#123; System.out.println(\"ABCBank--å¼€æˆ·ä¸­å›½å†œä¸šé“¶è¡Œè´¦å·\"); // å¾ˆé‡è¦ï¼Œè¦ä½¿ç”¨çˆ¶ç±»é‡Œç»„åˆè¿›æ¥çš„Accountï¼Œä¸ç„¶æ¡¥æ¥æ¨¡å¼å°±æ²¡ä»€ä¹ˆæ„ä¹‰äº† account.openAccount(); return account; &#125;&#125;---public class ICBCBank extends Bank &#123; /** * æ„é€ çš„æ—¶å€™ä¼ å…¥çš„æ˜¯å“ªä¸ªAccountå°±è¿”å›å“ªä¸€ä¸ªAccount(openAccountæ–¹æ³•) * @param account */ public ICBCBank(Account account) &#123; super(account); &#125; /** * è¿™é‡Œè¿”å›çš„å°±æ˜¯çˆ¶ç±»ä¸­çš„Account * @return */ @Override Account openAccount() &#123; System.out.println(\"ICBC--å¼€æˆ·ä¸­å›½å·¥å•†é“¶è¡Œè´¦å·\"); // å¾ˆé‡è¦ï¼Œè¦ä½¿ç”¨çˆ¶ç±»é‡Œç»„åˆè¿›æ¥çš„Accountï¼Œä¸ç„¶æ¡¥æ¥æ¨¡å¼å°±æ²¡ä»€ä¹ˆæ„ä¹‰äº† account.openAccount(); return account; &#125;&#125; å•å…ƒæµ‹è¯• TestDemo 1234567891011121314151617181920212223242526272829public class TestDemo &#123; public static void main(String[] args) &#123; // ICBCBank-DepositAccount Bank icbcBank = new ICBCBank(new DepositAccount()); Account icbcAccount = icbcBank.openAccount(); System.out.println(\"**************************\"); icbcAccount.showAccountType(); System.out.println(\"--------------------------\"); // ICBCBank-SavingAccount Bank icbcBank2 = new ICBCBank(new SavingAccount()); Account icbcAccount2 = icbcBank2.openAccount(); System.out.println(\"**************************\"); icbcAccount2.showAccountType(); System.out.println(\"--------------------------\"); // ABCBank-DepositAccount Bank abcBank2 = new ABCBank(new DepositAccount()); Account abcAccount2 = abcBank2.openAccount(); System.out.println(\"**************************\"); abcAccount2.showAccountType(); System.out.println(\"--------------------------\"); // ABCBank-SavingAccount Bank abcBank = new ABCBank(new SavingAccount()); Account abcAccount = abcBank.openAccount(); System.out.println(\"**************************\"); abcAccount.showAccountType(); &#125;&#125; æ€»ç»“ é€šè¿‡æ¡¥æ¥æ¨¡å¼ï¼ŒæŠŠå®ç°éƒ¨åˆ†Accountï¼ˆAccountçš„å…·ä½“å®ç°ç±»ï¼‰å’ŒæŠ½è±¡éƒ¨åˆ†Bankï¼ˆBankæŠ½è±¡ç±»ï¼‰è¿›è¡Œäº†æ¡¥æ¥ï¼Œä½¿ç”¨ç»„åˆä½œä¸ºä¸€æ ¹çº¿è¿æ¥å®ƒä»¬ã€‚å½“ç„¶ä¹Ÿæœ‰èšåˆçš„æ–¹å¼å®ç°æ¡¥æ¥ã€‚ æ¡¥æ¥æ¨¡å¼åœ¨JDKæºç ä¸­çš„åº”ç”¨å®ç°éƒ¨åˆ†1java.sql.Driveræ¥å£çš„å®ç°ï¼š å¦‚MySQLçš„Driverï¼ŒOracleçš„Driver Driveræ¥å£ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package java.sql;import java.util.logging.Logger;/** * The interface that every driver class must implement. * &lt;P&gt;The Java SQL framework allows for multiple database drivers. * * &lt;P&gt;Each driver should supply a class that implements * the Driver interface. * * &lt;P&gt;The DriverManager will try to load as many drivers as it can * find and then for any given connection request, it will ask each * driver in turn to try to connect to the target URL. * * &lt;P&gt;It is strongly recommended that each Driver class should be * small and standalone so that the Driver class can be loaded and * queried without bringing in vast quantities of supporting code. * * &lt;P&gt;When a Driver class is loaded, it should create an instance of * itself and register it with the DriverManager. This means that a * user can load and register a driver by calling: * &lt;p&gt; * &#123;@code Class.forName(\"foo.bah.Driver\")&#125; * &lt;p&gt; * A JDBC driver may create a &#123;@linkplain DriverAction&#125; implementation in order * to receive notifications when &#123;@linkplain DriverManager#deregisterDriver&#125; has * been called. * @see DriverManager * @see Connection * @see DriverAction */public interface Driver &#123; Connection connect(String url, java.util.Properties info) throws SQLException; boolean acceptsURL(String url) throws SQLException; DriverPropertyInfo[] getPropertyInfo(String url, java.util.Properties info) throws SQLException; int getMajorVersion(); int getMinorVersion(); boolean jdbcCompliant(); public Logger getParentLogger() throws SQLFeatureNotSupportedException;&#125; Driveræ¥å£çš„MySqlé©±åŠ¨å®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142package com.mysql.cj.jdbc;import java.sql.SQLException;/** * The Java SQL framework allows for multiple database drivers. Each driver should supply a class that implements the Driver interface * * &lt;p&gt; * The DriverManager will try to load as many drivers as it can find and then for any given connection request, it will ask each driver in turn to try to * connect to the target URL. * * &lt;p&gt; * It is strongly recommended that each Driver class should be small and standalone so that the Driver class can be loaded and queried without bringing in vast * quantities of supporting code. * * &lt;p&gt; * When a Driver class is loaded, it should create an instance of itself and register it with the DriverManager. This means that a user can load and register a * driver by doing Class.forName(\"foo.bah.Driver\") */public class Driver extends NonRegisteringDriver implements java.sql.Driver &#123; // // Register ourselves with the DriverManager // static &#123; try &#123; // æŠŠé©±åŠ¨æ³¨å†Œåˆ°DriverManagerä¸­ java.sql.DriverManager.registerDriver(new Driver()); &#125; catch (SQLException E) &#123; throw new RuntimeException(\"Can't register driver!\"); &#125; &#125; /** * Construct a new driver and register it with DriverManager * * @throws SQLException * if a database error occurs. */ public Driver() throws SQLException &#123; // Required for Class.forName().newInstance() &#125;&#125; æŠ½è±¡éƒ¨åˆ†1java.sql.DriverManagerè¿™ä¸ªç±»ä½œä¸ºæŠ½è±¡éƒ¨åˆ†ï¼Œå®ƒå¹¶ä¸æ˜¯æŠ½è±¡ç±»ã€‚å†æ¬¡è¯´æ˜ï¼ŒæŠ½è±¡éƒ¨åˆ†å¹¶ä¸ä¸€å®šå°±æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œåªæ˜¯ä»æ¡¥æ¥æ¨¡å¼æ•´ä½“çœ‹ï¼ŒæŠŠå®ƒåˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†ã€‚registeredDriversä½œä¸ºå®ç°éƒ¨åˆ†ç»„åˆåˆ°æŠ½è±¡éƒ¨åˆ†ã€‚ DriverInfoå®ç°éƒ¨åˆ†çš„çˆ¶ç±»å‹æ¥å£Driveråªæ˜¯ä½œä¸ºDriverInfoçš„ä¸€ä¸ªå±æ€§ 123456789101112131415161718192021222324252627282930class DriverInfo &#123; final Driver driver; DriverAction da; DriverInfo(Driver driver, DriverAction action) &#123; this.driver = driver; da = action; &#125; @Override public boolean equals(Object other) &#123; return (other instanceof DriverInfo) &amp;&amp; this.driver == ((DriverInfo) other).driver; &#125; @Override public int hashCode() &#123; return driver.hashCode(); &#125; @Override public String toString() &#123; return (\"driver[className=\" + driver + \"]\"); &#125; DriverAction action() &#123; return da; &#125;&#125; DriverManager 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209 package java.sql; import java.util.Iterator; import java.util.ServiceLoader; import java.security.AccessController; import java.security.PrivilegedAction; import java.util.concurrent.CopyOnWriteArrayList; import sun.reflect.CallerSensitive; import sun.reflect.Reflection; /** * @see Driver * @see Connection */ public class DriverManager &#123; // æ³¨å†Œ JDBC driver çš„åˆ—è¡¨ private final static CopyOnWriteArrayList&lt;DriverInfo&gt; registeredDrivers = new CopyOnWriteArrayList&lt;&gt;(); private static volatile int loginTimeout = 0; private static volatile java.io.PrintWriter logWriter = null; private static volatile java.io.PrintStream logStream = null; // Used in println() to synchronize logWriter private final static Object logSync = new Object(); /* Prevent the DriverManager class from being instantiated. */ private DriverManager()&#123;&#125; /** * Load the initial JDBC drivers by checking the System property * jdbc.properties and then use the &#123;@code ServiceLoader&#125; mechanism */ static &#123; loadInitialDrivers(); println(\"JDBC DriverManager initialized\"); &#125; /** * The &lt;code&gt;SQLPermission&lt;/code&gt; constant that allows the * setting of the logging stream. * @since 1.3 */ final static SQLPermission SET_LOG_PERMISSION = new SQLPermission(\"setLog\"); /** * The &#123;@code SQLPermission&#125; constant that allows the * un-register a registered JDBC driver. * @since 1.8 */ final static SQLPermission DEREGISTER_DRIVER_PERMISSION = new SQLPermission(\"deregisterDriver\"); //--------------------------JDBC 2.0----------------------------- /** * Retrieves the log writer. * * The &lt;code&gt;getLogWriter&lt;/code&gt; and &lt;code&gt;setLogWriter&lt;/code&gt; * methods should be used instead * of the &lt;code&gt;get/setlogStream&lt;/code&gt; methods, which are deprecated. * @return a &lt;code&gt;java.io.PrintWriter&lt;/code&gt; object * @see #setLogWriter * @since 1.2 */ public static java.io.PrintWriter getLogWriter() &#123; return logWriter; &#125; public static void setLogWriter(java.io.PrintWriter out) &#123; SecurityManager sec = System.getSecurityManager(); if (sec != null) &#123; sec.checkPermission(SET_LOG_PERMISSION); &#125; logStream = null; logWriter = out; &#125; @CallerSensitive public static Connection getConnection(String url, java.util.Properties info) throws SQLException &#123; return (getConnection(url, info, Reflection.getCallerClass())); &#125; @CallerSensitive public static Connection getConnection(String url, String user, String password) throws SQLException &#123; java.util.Properties info = new java.util.Properties(); if (user != null) &#123; info.put(\"user\", user); &#125; if (password != null) &#123; info.put(\"password\", password); &#125; return (getConnection(url, info, Reflection.getCallerClass())); &#125; @CallerSensitive public static Connection getConnection(String url) throws SQLException &#123; java.util.Properties info = new java.util.Properties(); return (getConnection(url, info, Reflection.getCallerClass())); &#125; /** * Attempts to locate a driver that understands the given URL. * The &lt;code&gt;DriverManager&lt;/code&gt; attempts to select an appropriate driver from * the set of registered JDBC drivers. * * @param url a database URL of the form * &lt;code&gt;jdbc:&lt;em&gt;subprotocol&lt;/em&gt;:&lt;em&gt;subname&lt;/em&gt;&lt;/code&gt; * @return a &lt;code&gt;Driver&lt;/code&gt; object representing a driver * that can connect to the given URL * @exception SQLException if a database access error occurs */ @CallerSensitive public static Driver getDriver(String url) throws SQLException &#123; println(\"DriverManager.getDriver(\\\"\" + url + \"\\\")\"); Class&lt;?&gt; callerClass = Reflection.getCallerClass(); for (DriverInfo aDriver : registeredDrivers) &#123; // If the caller does not have permission to load the driver then // skip it. if(isDriverAllowed(aDriver.driver, callerClass)) &#123; try &#123; if(aDriver.driver.acceptsURL(url)) &#123; // Success! println(\"getDriver returning \" + aDriver.driver.getClass().getName()); return (aDriver.driver); &#125; &#125; catch(SQLException sqe) &#123; // Drop through and try the next driver. &#125; &#125; else &#123; println(\" skipping: \" + aDriver.driver.getClass().getName()); &#125; &#125; println(\"getDriver: no suitable driver\"); throw new SQLException(\"No suitable driver\", \"08001\"); &#125; /** * Registers the given driver with the &#123;@code DriverManager&#125;. * A newly-loaded driver class should call * the method &#123;@code registerDriver&#125; to make itself * known to the &#123;@code DriverManager&#125;. If the driver is currently * registered, no action is taken. * * @param driver the new JDBC Driver that is to be registered with the * &#123;@code DriverManager&#125; * @exception SQLException if a database access error occurs * @exception NullPointerException if &#123;@code driver&#125; is null */ public static synchronized void registerDriver(java.sql.Driver driver) throws SQLException &#123; registerDriver(driver, null); &#125; /** * Registers the given driver with the &#123;@code DriverManager&#125;. * A newly-loaded driver class should call * the method &#123;@code registerDriver&#125; to make itself * known to the &#123;@code DriverManager&#125;. If the driver is currently * registered, no action is taken. * * @param driver the new JDBC Driver that is to be registered with the * &#123;@code DriverManager&#125; * @param da the &#123;@code DriverAction&#125; implementation to be used when * &#123;@code DriverManager#deregisterDriver&#125; is called * @exception SQLException if a database access error occurs * @exception NullPointerException if &#123;@code driver&#125; is null * @since 1.8 */ public static synchronized void registerDriver(java.sql.Driver driver, DriverAction da) throws SQLException &#123; /* Register the driver if it has not already been added to our list */ if(driver != null) &#123; registeredDrivers.addIfAbsent(new DriverInfo(driver, da)); &#125; else &#123; // This is for compatibility with the original DriverManager throw new NullPointerException(); &#125; println(\"registerDriver: \" + driver); &#125;&#125; â€‹ â€‹ â€‹ â€‹ â€‹","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"é€‚é…å™¨æ¨¡å¼","slug":"design_pattern/structure_type/é€‚é…å™¨æ¨¡å¼","date":"2019-09-20T16:00:00.000Z","updated":"2020-07-04T16:28:45.972Z","comments":true,"path":"posts/f5c535ea/","link":"","permalink":"https://gentryhuang.com/posts/f5c535ea/","excerpt":"","text":"å®šä¹‰å°†ä¸€ä¸ªç±»ï¼ˆè¢«é€‚é…è€…ï¼‰è½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼ˆç›®æ ‡ï¼‰ï¼Œä½¿åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»ï¼ˆå®ƒä»¬çš„æ¥å£ä¸åŒï¼‰å¯ä»¥ä¸€èµ·å·¥ä½œï¼ˆä½¿ç”¨åŒä¸€æ¥å£äº†ï¼‰ã€‚ ç±»å‹ç»“æ„å‹ åº”ç”¨åœºæ™¯12â—†å·²ç»å­˜åœ¨çš„ç±»ï¼Œå®ƒçš„æ–¹æ³•å’Œéœ€æ±‚ä¸åŒ¹é…æ—¶â—†ä¸æ˜¯è½¯ä»¶è®¾è®¡é˜¶æ®µè€ƒè™‘çš„è®¾è®¡æ¨¡å¼ï¼Œæ˜¯éšç€è½¯ä»¶ç»´æŠ¤ï¼Œç”±äºä¸åŒäº§å“ã€ä¸åŒå‚å®¶é€ æˆåŠŸèƒ½ç±»ä¼¼è€Œæ¥å£ä¸ç›¸åŒæƒ…å†µä¸‹çš„è§£å†³æ–¹æ¡ˆï¼Œæ˜¯è½¯ä»¶ç»´æŠ¤é˜¶æ®µéœ€è¦è€ƒè™‘çš„äº‹æƒ… ä¼˜ç‚¹123â—†èƒ½æé«˜ç±»çš„é€æ˜æ€§å’Œå¤ç”¨ï¼Œç°æœ‰çš„ç±»å¤ç”¨ä½†ä¸éœ€è¦æ”¹å˜ï¼Œè§£å†³äº†ç°æœ‰ç±»å’Œç›®æ ‡ç±»ä¸åŒ¹é…çš„é—®é¢˜â—†ç›®æ ‡ç±»å’Œé€‚é…å™¨ç±»è§£è€¦ï¼Œæé«˜ç¨‹åºæ‰©å±•æ€§â—†ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå…·ä½“çš„æ“ä½œéƒ½åœ¨é€‚é…è€…ä¸­ï¼Œå®¢æˆ·ç«¯åªçŸ¥é“é€‚é…è€…ï¼Œæ‰©å±•åªéœ€å¯¹é€‚é…è€…æ‰©å±•å³å¯ ç¼ºç‚¹12â—†é€‚é…å™¨ç¼–å†™è¿‡ç¨‹éœ€è¦å…¨é¢è€ƒè™‘ï¼Œå¯èƒ½ä¼šå¢åŠ ç³»ç»Ÿçš„å¤æ‚æ€§â—†å¢åŠ ç³»ç»Ÿä»£ç å¯è¯»çš„éš¾åº¦ï¼Œå¦‚æˆ‘ä»¬è°ƒç”¨çš„æ˜¯Aæ¥å£å®ç°ï¼Œå…¶å®å†…éƒ¨å·²ç»è¢«é€‚é…æˆäº†Bæ¥å£çš„å®ç° æ‰©å±•12â—†å¯¹è±¡é€‚é…å™¨ï¼ˆç¬¦åˆç»„åˆå¤ç”¨åŸåˆ™ï¼Œå¹¶ä¸”ä½¿ç”¨å§”æ‰˜æœºåˆ¶ï¼‰â—†ç±»é€‚é…å™¨ï¼ˆé€šè¿‡ç±»ç»§æ‰¿å®ç°ï¼‰ ç›¸å…³çš„è®¾è®¡æ¨¡å¼é€‚é…å™¨æ¨¡å¼å’Œå¤–è§‚æ¨¡å¼ 123a éƒ½æ˜¯ç°æœ‰ç±»ç°å­˜ç³»ç»Ÿçš„å°è£…ï¼Œå‰è€…å¤ç”¨åŸæœ‰çš„æ¥å£ï¼Œåè€…å®šä¹‰äº†æ–°çš„æ¥å£b å‰è€…ä½¿åŸæœ‰çš„ä¸¤ä¸ªæ¥å£ååŒå·¥ä½œï¼Œåè€…åœ¨ç°æœ‰çš„ç³»ç»Ÿä¸­æä¾›ä¸€ä¸ªæ›´ä¸ºæ–¹ä¾¿çš„è®¿é—®å…¥å£c é€‚é…åŠ›åº¦ä¸åŒï¼Œåè€…é€‚é…æ•´ä¸ªå­ç³»ç»Ÿ é€‚é…å™¨æ¨¡å¼æ¼”ç»ƒ1ç±»é€‚é…å™¨é€šè¿‡ ç»§æ‰¿å…³ç³» è¾¾åˆ°é€‚é…çš„ç›®çš„ï¼Œè€Œå¯¹è±¡é€‚é…å™¨é€šè¿‡ ç»„åˆ è¾¾åˆ°é€‚é…ç›®çš„ ç±»é€‚é…å™¨æ¨¡å¼ è¢«é€‚é…è€… 12345678910111213141516171819package com.design.pattern.adapter.classadapter;import lombok.extern.slf4j.Slf4j;/** * Adaptee è¢«é€‚é…è€… * * @author shunhua * @date 2019-09-21 */@Slf4jpublic class Adaptee &#123; /** * é€‚é…æ–¹æ³•ï¼Œæƒ³è¦å’Œç›®æ ‡ç±»ä¸€èµ·å·¥ä½œ */ public void adaptee()&#123; log.info(\"è¢«é€‚é…è€…...run\"); &#125;&#125; é€‚é…å™¨ï¼ˆé€‚é…è€…ï¼‰ 1234567891011121314151617181920212223package com.design.pattern.adapter.classadapter;import lombok.extern.slf4j.Slf4j;/** * Adapter * * @author shunhua * @date 2019-09-21 */@Slf4jpublic class Adapter extends Adaptee implements Target &#123; /** * 1ã€é€‚é…è€…åªæ˜¯å®ç°ç›®æ ‡ç±»çš„æ¥å£ï¼Œå¹¶ä¸”ç»§æ‰¿è¢«é€‚é…ç±»ï¼Œè¿™æ ·ä½¿å¾—è¢«é€‚é…ç±»æ‹¥æœ‰ç›®æ ‡ç±»ç›¸å®¹çš„æ¥å£ * 2ã€åœ¨é€‚é…å™¨å®ç°ç›®æ ‡æ¥å£çš„æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»è¢«é€‚é…è€…çš„æ–¹æ³• */ @Override public void run() &#123; // TODO è¿™é‡Œå¯ä»¥æ·»åŠ å…¶ä»–çš„æ“ä½œ log.info(\"é€‚é…å™¨...run\"); super.adaptee(); &#125;&#125; ç›®æ ‡æ¥å£ 1234567891011121314package com.design.pattern.adapter.classadapter;/** * Target ç›®æ ‡ç±»æ¥å£ * * @author shunhua * @date 2019-09-21 */public interface Target &#123; /** * ç›®æ ‡æ“ä½œ */ void run();&#125; ç›®æ ‡ç±» 123456789101112131415161718package com.design.pattern.adapter.classadapter;import lombok.extern.slf4j.Slf4j;/** * CurrTarget ç›®æ ‡æ¥å£çš„å®ç°ç±»ï¼Œå¯çœå»ï¼Œåªæ˜¯ä½œæ¯”è¾ƒ * * @author shunhua * @date 2019-09-21 */@Slf4jpublic class CurrTarget implements Target &#123; @Override public void run() &#123; log.info(\"ç›®æ ‡...run\"); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425package com.design.pattern.adapter.classadapter;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-21 */public class Client &#123; @Test public void test()&#123; // ç›®æ ‡ç±»çš„æ“ä½œ Target target = new CurrTarget(); // ç›®æ ‡ç±»çš„æ–¹æ³• target.run(); // è¢«é€‚é…è€…é€šè¿‡é€‚é…å™¨è¿›è¡Œé€‚é…ï¼Œå¯ä»¥å’Œç›®æ ‡ç±»ä¸€èµ·å·¥ä½œ target = new Adapter(); // é€‚é…è€…çš„æ–¹æ³•ï¼Œå†…éƒ¨æ˜¯è¢«é€‚é…è€…çš„æ–¹æ³• target.run(); &#125;&#125; å¯¹è±¡é€‚é…æ¨¡å¼ è¢«é€‚é…è€… 12345678910111213141516171819package com.design.pattern.adapter.objectadapter;import lombok.extern.slf4j.Slf4j;/** * Adaptee è¢«é€‚é…è€… * * @author shunhua * @date 2019-09-21 */@Slf4jpublic class Adaptee &#123; /** * é€‚é…æ–¹æ³•ï¼Œæƒ³è¦å’Œç›®æ ‡ç±»ä¸€èµ·å·¥ä½œ */ public void adaptee()&#123; log.info(\"è¢«é€‚é…è€…...run\"); &#125;&#125; é€‚é…å™¨ï¼ˆé€‚é…è€…ï¼‰ 12345678910111213141516171819202122232425262728package com.design.pattern.adapter.objectadapter;import lombok.extern.slf4j.Slf4j;/** * Adapter * * @author shunhua * @date 2019-09-21 */@Slf4jpublic class Adapter implements Target &#123; /** * é€šè¿‡ç»„åˆ */ private Adaptee adaptee = new Adaptee(); /** * 1 é€‚é…å™¨æ˜¯å®ç°äº†ç›®æ ‡ç±»çš„æ¥å£ï¼Œä¸ºäº†æ˜¯è¢«é€‚é…è€…å’Œç›®æ ‡ç±»æ‹¥æœ‰åŒä¸€æ¥å£ * 2 é€šè¿‡ç»„åˆçš„æ–¹æ³•ï¼Œç›´æ¥åœ¨é€‚é…å™¨å®ç°ç›®æ ‡æ¥å£çš„æ–¹æ³•ä¸­è°ƒç”¨è¢«é€‚é…è€…å®ä¾‹çš„æ–¹æ³• */ @Override public void run() &#123; // TODO å¯ä»¥æ ¹æ®å…·ä½“ä¸šåŠ¡å¢åŠ å…¶ä»–çš„æ“ä½œ log.info(\"é€‚é…å™¨...run\"); adaptee.adaptee(); &#125;&#125; ç›®æ ‡æ¥å£ 1234567891011121314package com.design.pattern.adapter.objectadapter;/** * Target ç›®æ ‡ç±»æ¥å£ * * @author shunhua * @date 2019-09-21 */public interface Target &#123; /** * ç›®æ ‡æ“ä½œ */ void run();&#125; ç›®æ ‡ç±» 12345678910111213141516171819package com.design.pattern.adapter.objectadapter;;import lombok.extern.slf4j.Slf4j;/** * CurrTarget ç›®æ ‡æ¥å£çš„å®ç°ç±»ï¼Œå¯çœå»ï¼Œåªæ˜¯ä½œæ¯”è¾ƒ * * @author shunhua * @date 2019-09-21 */@Slf4jpublic class CurrTarget implements Target &#123; @Override public void run() &#123; log.info(\"ç›®æ ‡...run\"); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425package com.design.pattern.adapter.objectadapter;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-22 */public class Client &#123; @Test public void test()&#123; // ç›®æ ‡ç±» Target target = new CurrTarget(); target.run(); // é€šè¿‡é€‚é…å™¨æŠŠè¢«é€‚é…è€…è½¬æ¢æˆç›®æ ‡æ¥å£ç±»å‹ target = new Adapter(); // è°ƒç”¨é€‚é…å™¨å®ç°ç›®æ ‡æ¥å£çš„æ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨çš„æ˜¯è¢«é€‚é…è€…çš„æ–¹æ³• target.run(); &#125;&#125; ç®€å•éœ€æ±‚1æ‰‹æœºç”µæºé€‚é…å™¨å¯ä»¥æŠŠ220väº¤æµç”µè½¬åŒ–ä¸º5vç›´æµç”µ ç›®æ ‡æ¥å£-5vç›´æµç”µ 123456789101112131415package com.design.pattern.adapter.demand;/** * DC5V ç›®æ ‡ç”µå‹ * * @author shunhua * @date 2019-09-22 */public interface DC5V &#123; /** * 5Vç›´æµç”µ * @return */ int outPutDC5V();&#125; éœ€è¦è¢«é€‚é…çš„ç±»-220väº¤æµç”µ 123456789101112131415161718192021package com.design.pattern.adapter.demand;import lombok.extern.slf4j.Slf4j;/** * AC220V éœ€è¦è¢«é€‚é…çš„ç”µå‹ * * @author shunhua * @date 2019-09-22 */@Slf4jpublic class AC220V &#123; /** * 220Väº¤æµç”µ * @return */ public int outputAC220V()&#123; return 220; &#125;&#125; å˜å‹å™¨-é€‚é…å™¨ 1234567891011121314151617181920212223242526package com.design.pattern.adapter.demand;import lombok.extern.slf4j.Slf4j;/** * PowerAdapter ç”µæºé€‚é…å™¨ * * @author shunhua * @date 2019-09-22 */@Slf4jpublic class PowerAdapter implements DC5V &#123; /** * é€šè¿‡ç»„åˆçš„æ–¹å¼ */ private AC220V ac220V = new AC220V(); @Override public int outPutDC5V() &#123; int ac = ac220V.outputAC220V(); int target = ac/44; // å˜å‹å¤„ç† log.info(String.format(\"é€‚é…å™¨å¤„ç†åï¼Œ%dVç”µå‹å˜ä¸º%dV\",220,target)); return 5; &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819package com.design.pattern.adapter.demand;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-22 */public class Client &#123; @Test public void test() &#123; DC5V dc5V = new PowerAdapter(); // é€šè¿‡PowerAdapteré€‚é…ï¼ŒæŠŠ220Väº¤æµè½¬ä¸º5Vç›´æµç”µ dc5V.outPutDC5V(); &#125;&#125; æºç è§£æ12åœ¨SpringMVCä¸­ï¼Œå‰ç«¯æ§åˆ¶å™¨æ¥åˆ°è¯·æ±‚åä¼šé€šè¿‡å¤„ç†å™¨æ˜ å°„å™¨æ‰¾å¤„ç†å™¨ï¼Œç„¶åè¿”å›ä¸€ä¸ªå¤„ç†å™¨æ‰§è¡Œé“¾ï¼Œæ¥ç€é€šè¿‡åŒ¹é…å¤„ç†å™¨é€‚é…å™¨æ¥ç¡®å®šå“ªä¸€ä¸ªå¤„ç†å™¨é€‚é…å™¨å¯ä»¥é€‚é…å½“å‰çš„å¤„ç†å™¨ï¼Œç¡®å®šåæ‰§è¡Œå¤„ç†æ–¹æ³•ï¼Œç„¶åè¿”å›ModelAndViewã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121protected void doDispatch(HttpServletRequest request, HttpServletResponse response) throws Exception &#123; HttpServletRequest processedRequest = request; HandlerExecutionChain mappedHandler = null; boolean multipartRequestParsed = false; WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request); try &#123; ModelAndView mv = null; Exception dispatchException = null; try &#123; processedRequest = checkMultipart(request); multipartRequestParsed = (processedRequest != request); // Determine handler for the current request. mappedHandler = getHandler(processedRequest); if (mappedHandler == null) &#123; noHandlerFound(processedRequest, response); return; &#125; // æ‰¾åˆ°å¤„ç†å™¨å¯¹åº”çš„å¤„ç†å™¨é€‚é…å™¨ HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler()); // Process last-modified header, if supported by the handler. String method = request.getMethod(); boolean isGet = \"GET\".equals(method); if (isGet || \"HEAD\".equals(method)) &#123; long lastModified = ha.getLastModified(request, mappedHandler.getHandler()); if (new ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123; return; &#125; &#125; if (!mappedHandler.applyPreHandle(processedRequest, response)) &#123; return; &#125; // å®é™…è°ƒç”¨å¤„ç†å™¨ï¼Œç„¶åè¿”å›ModelAndView mv = ha.handle(processedRequest, response, mappedHandler.getHandler()); if (asyncManager.isConcurrentHandlingStarted()) &#123; return; &#125; applyDefaultViewName(processedRequest, mv); mappedHandler.applyPostHandle(processedRequest, response, mv); &#125; catch (Exception ex) &#123; dispatchException = ex; &#125; catch (Throwable err) &#123; // As of 4.3, we're processing Errors thrown from handler methods as well, // making them available for @ExceptionHandler methods and other scenarios. dispatchException = new NestedServletException(\"Handler dispatch failed\", err); &#125; processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException); &#125; catch (Exception ex) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, ex); &#125; catch (Throwable err) &#123; triggerAfterCompletion(processedRequest, response, mappedHandler, new NestedServletException(\"Handler processing failed\", err)); &#125; finally &#123; if (asyncManager.isConcurrentHandlingStarted()) &#123; // Instead of postHandle and afterCompletion if (mappedHandler != null) &#123; mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response); &#125; &#125; else &#123; // Clean up any resources used by a multipart request. if (multipartRequestParsed) &#123; cleanupMultipart(processedRequest); &#125; &#125; &#125; &#125; // å¤„ç†å™¨æ˜ å°„å™¨æ‰¾å¤„ç†å™¨é€»è¾‘ï¼ˆè¿”å›å¤„ç†å™¨æ‰§è¡Œé“¾ï¼ŒåŒ…å«äº†å¤„ç†å™¨ï¼‰/** * Return the HandlerExecutionChain for this request. * &lt;p&gt;Tries all handler mappings in order. * @param request current HTTP request * @return the HandlerExecutionChain, or &#123;@code null&#125; if no handler could be found */ @Nullable protected HandlerExecutionChain getHandler(HttpServletRequest request) throws Exception &#123; if (this.handlerMappings != null) &#123; for (HandlerMapping mapping : this.handlerMappings) &#123; HandlerExecutionChain handler = mapping.getHandler(request); if (handler != null) &#123; return handler; &#125; &#125; &#125; return null; &#125; // åŒ¹é…åˆé€‚çš„å¤„ç†å™¨é€‚é…å™¨é€»è¾‘ /** * Return the HandlerAdapter for this handler object. * @param handler the handler object to find an adapter for * @throws ServletException if no HandlerAdapter can be found for the handler. This is a fatal error. */ protected HandlerAdapter getHandlerAdapter(Object handler) throws ServletException &#123; if (this.handlerAdapters != null) &#123; for (HandlerAdapter adapter : this.handlerAdapters) &#123; if (adapter.supports(handler)) &#123; return adapter; &#125; &#125; &#125; throw new ServletException(\"No adapter for handler [\" + handler + \"]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler\"); &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è£…é¥°è€…æ¨¡å¼","slug":"design_pattern/structure_type/è£…é¥°è€…æ¨¡å¼","date":"2019-09-18T16:00:00.000Z","updated":"2020-07-04T16:28:45.971Z","comments":true,"path":"posts/a708a60d/","link":"","permalink":"https://gentryhuang.com/posts/a708a60d/","excerpt":"","text":"å®šä¹‰åœ¨ä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„åŸºç¡€ä¸Šï¼Œå°†åŠŸèƒ½é™„åŠ åˆ°å¯¹è±¡ä¸Šã€‚æä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆï¼ˆæ‰©å±•åŸæœ‰å¯¹è±¡åŠŸèƒ½ï¼‰ã€‚ ç±»å‹ç»“æ„å‹ åº”ç”¨åœºæ™¯12â—†æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½æˆ–ç»™ä¸€ä¸ªç±»æ·»åŠ é™„åŠ èŒè´£â—†åŠ¨æ€çš„ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥å†åŠ¨æ€çš„æ’¤é”€ ä¼˜ç‚¹123â—†ç»§æ‰¿çš„æœ‰åŠ›è¡¥å……ï¼Œæ¯”ç»§æ‰¿çµæ´»ï¼Œä¸æ”¹å˜åŸæœ‰å¯¹è±¡çš„æƒ…å†µä¸‹ç»™ä¸€ä¸ªå¯¹è±¡æ‰©å±•åŠŸèƒ½ã€‚ä¸€èˆ¬æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»§æ‰¿å®ç°åŠŸèƒ½çš„æ‰©å±•ï¼Œå¦‚æœéœ€è¦æ‰©å±•çš„åŠŸèƒ½ç§ç±»ç¹å¤šï¼Œé‚£ä¹ˆåŠ¿å¿…ä¼šç”Ÿæˆå¾ˆå¤šå­ç±»ï¼Œè¿™æ— ç–‘å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚å¹¶ä¸”ä½¿ç”¨ç»§æ‰¿éœ€è¦æå‰é¢„çŸ¥å“ªäº›åŠŸèƒ½ï¼Œå› ä¸ºç»§æ‰¿å…³ç³»åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ç¡®å®šäº†ã€‚è€Œè£…é¥°è€…æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°åŠ å…¥ã€‚å…¶å®è£…é¥°è€…æ¨¡å¼ä¹Ÿæ˜¯å»ºç«‹åœ¨ç»§æ‰¿çš„å…³ç³»åŸºç¡€ä¹‹ä¸Šçš„ï¼Œæ³¨æ„ï¼Œè¿™ä¸æ„å‘³ç€å°±ä¸ä½¿ç”¨ç»§æ‰¿äº†ï¼Œç»§æ‰¿ä¹Ÿæ˜¯æ‰©å±•å½¢å¼ä¹‹ä¸€ï¼Œåªæ˜¯æŸäº›æ—¶å€™ä¸ä¸€å®šèƒ½è¾¾åˆ°å¼¹æ€§è®¾è®¡çš„æœ€ä½³æ–¹å¼ã€‚â—†é€šè¿‡ä½¿ç”¨ä¸åŒè£…é¥°ç±»ä»¥åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥å®ç°ä¸åŒæ•ˆæœâ—†ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œè£…é¥°è€…å’Œè¢«è£…é¥°è€…å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼ŒåŸæœ‰çš„ä»£ç ä¸éœ€è¦æ”¹å˜ã€‚å…¶å®è£…é¥°è€…åšçš„æ˜¯æŠŠè£…é¥°åŠŸèƒ½ä»ç±»ä¸­ç§»å‡ºå»ï¼Œè¿™æ ·ç®€åŒ–äº†åŸæ¥è¢«è£…é¥°çš„ç±»ï¼ŒåŒæ—¶æŠŠç±»çš„æ ¸å¿ƒèŒè´£å’Œè£…é¥°åŠŸèƒ½åŒºåˆ†å¼€ã€‚ ç¼ºç‚¹12â—†ä¼šå‡ºç°æ›´å¤šçš„ä»£ç ï¼Œæ›´å¤šçš„ç±»ï¼Œå¢åŠ ç¨‹åºå¤æ‚æ€§ã€‚è£…é¥°è€…æ¨¡å¼å¯èƒ½ä¼šæ¯”ç»§æ‰¿æ–¹å¼çš„ä½¿ç”¨çš„ç±»è¦å°‘ï¼Œä½†æ˜¯å¯¹è±¡å¾ˆå¤šï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡ç±»å‹æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè£…é¥°è€…ä¼šç»§æ‰¿è¢«è£…é¥°ç±»ï¼Œè€Œè¢«è£…é¥°ç±»åˆæœ‰å…·ä½“çš„å®ä½“ï¼Œè¿™äº›å®ä½“å¯¹è±¡ç±»å‹åˆä¸€æ ·ï¼Œæ‰€æœ‰æ’æŸ¥é—®é¢˜å¢åŠ äº†éš¾åº¦ã€‚â—†åŠ¨æ€è£…é¥°æ—¶ï¼Œå¤šå±‚è£…é¥°æ—¶ä¼šæ›´å¤æ‚ å…³è”çš„è®¾è®¡æ¨¡å¼è£…é¥°è€…æ¨¡å¼å’Œä»£ç†æ¨¡å¼ 121 è£…é¥°è€…æ¨¡å¼å…³æ³¨åŠ¨æ€åœ°æ·»åŠ æ–¹æ³•ï¼Œä»£ç†æ¨¡å¼å…³æ³¨äºæ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®2 ä»£ç†æ¨¡å¼ä¸­çš„ä»£ç†ç±»å¯ä»¥å¯¹å®ƒçš„å®¢æˆ·éšè—ä¸€ä¸ªå¯¹è±¡çš„å…·ä½“ä¿¡æ¯ï¼Œé€šå¸¸åœ¨ä½¿ç”¨ä»£ç†æ¨¡å¼çš„æ—¶å€™å¸¸å¸¸åœ¨ä»£ç†ç±»ä¸­åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ï¼Œè£…é¥°è€…æ¨¡å¼é€šå¸¸æŠŠåŸå§‹å¯¹è±¡ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ å…¥è£…é¥°è€…çš„æ„é€ å™¨ï¼Œè¿™æ˜¯ä½¿ç”¨ä¸Šçš„ä¸åŒã€‚ è£…é¥°è€…æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼ 1231 ä¸¤è€…éƒ½æ˜¯åŒ…è£…è€…æ¨¡å¼2 è£…é¥°è€…å’Œè¢«è£…é¥°è€…å¯ä»¥å®ç°ç›¸åŒçš„æ¥å£æˆ–è€…è£…é¥°è€…æ˜¯è¢«è£…é¥°è€…çš„å­ç±»3 é€‚é…å™¨å’Œè¢«é€‚é…çš„ç±»æœ‰ä¸åŒçš„æ¥å£ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯éƒ¨åˆ†æ¥å£æ˜¯é‡åˆçš„ ç®€å•éœ€æ±‚ä¹°ç…é¥¼çš„æ—¶å€™å¯ä»¥æ ¹æ®è‡ªèº«æƒ…å†µè¦æ±‚åŠ é¸¡è›‹æˆ–è€…é¦™è‚ ï¼Œå–ç…é¥¼çš„æ ¹æ®éœ€æ±‚å»åšç…é¥¼ã€‚ è£…é¥°è€…æ¨¡å¼æ¼”ç»ƒéè£…é¥°è€…æ¨¡å¼12éœ€æ±‚ï¼šåŠ ä¸€ä¸ªé¸¡è›‹åŠ ä¸€å…ƒï¼Œä¸€ä¸ªç«è…¿ä¸¤å…ƒï¼Œç°åœ¨aä¹°ä¸€ä¸ªç…é¥¼ï¼Œbä¹°åŠ è›‹çš„ç…é¥¼ï¼Œcä¹°åŠ è‚ çš„ç…é¥¼æ–¹æ¡ˆï¼šé€šè¿‡å †ç§¯ç±»å®Œæˆéœ€æ±‚ï¼Œä½†æ˜¯é¢å¯¹ä¼—å¤šçš„éœ€æ±‚ä¼šç±»çˆ†ç‚¸çš„ã€‚ ç…é¥¼ç±» 12345678910111213141516171819202122232425package com.design.pattern.decorator.v1;/** * BatterCake ç…é¥¼ç±» * * @author shunhua * @date 2019-09-19 */public class BatterCake &#123; /** * è·å–é£Ÿå“æè¿° * @return */ public String getDesc()&#123; return \"ç…é¥¼\"; &#125; /** * é£Ÿå“å•ä»· * @return */ public int cost()&#123; return 5; &#125;&#125; é¸¡è›‹ç…é¥¼ç±» 1234567891011121314151617181920package com.design.pattern.decorator.v1;/** * BatterCakeWithEgg åŠ é¸¡è›‹çš„ç…é¥¼ * * @author shunhua * @date 2019-09-19 */public class BatterCakeWithEgg extends BatterCake &#123; @Override public String getDesc() &#123; return super.getDesc() + \" åŠ ä¸€ä¸ªé¸¡è›‹\"; &#125; @Override public int cost() &#123; return super.cost() + 1; &#125;&#125; é¦™è‚ ç…é¥¼ç±» 12345678910111213141516171819package com.design.pattern.decorator.v1;/** * BatterCakeWithSausage åŠ é¦™è‚ çš„ç…é¥¼ * * @author shunhua * @date 2019-09-19 */public class BatterCakeWithSausage extends BatterCake &#123; @Override public String getDesc() &#123; return super.getDesc() + \" åŠ ä¸€ä¸ªé¦™è‚ \"; &#125; @Override public int cost() &#123; return super.cost() + 2; &#125;&#125; å®¢æˆ·ç«¯ 1234567891011121314151617181920212223242526272829package com.design.pattern.decorator.v1;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-19 */@Slf4jpublic class Client &#123; @Test public void test()&#123; // ç…é¥¼ BatterCake batterCake = new BatterCake(); log.info(batterCake.getDesc() + \"é”€å”®ä»·æ ¼ä¸º \" + batterCake.cost()); // é¸¡è›‹ç…é¥¼ BatterCakeWithEgg batterCakeWithEgg = new BatterCakeWithEgg(); log.info(batterCakeWithEgg.getDesc() + \"é”€å”®ä»·æ ¼ä¸º \" + batterCakeWithEgg.cost()); // é¦™è‚ ç…é¥¼ BatterCakeWithSausage batterCakeWithSausage = new BatterCakeWithSausage(); log.info(batterCakeWithSausage.getDesc() + \"é”€å”®ä»·æ ¼ä¸º \" + batterCakeWithEgg.cost()); &#125;&#125; è£…é¥°è€…æ¨¡å¼12éœ€æ±‚ï¼šç°åœ¨è‚ å’Œè›‹éšæœºï¼Œa åŠ 2è›‹2è‚  båŠ 1è›‹2è‚ æ–¹æ¡ˆï¼šä½¿ç”¨è£…é¥°ç±»æ·»åŠ åŠŸèƒ½ï¼Œä¸ºç…é¥¼åŠ é¸¡è›‹ã€åŠ é¦™è‚  è¦æ±‚ï¼š æ‰€è°“è£…é¥°è€…æ¨¡å¼ï¼Œé€šç”¨åšæ³•è¦æœ‰æŠ½è±¡çš„å®ä½“ç±»å’Œç¡®å®šçš„å®ä½“ç±»ï¼ŒåŒæ—¶è¦æœ‰æŠ½è±¡çš„è£…é¥°è€…å’Œç¡®å®šçš„è£…é¥°è€…ã€‚ç°åœ¨å®ä½“ç±»æ˜¯ç…é¥¼ï¼Œè£…é¥°è€…æ˜¯é¸¡è›‹å’Œé¦™è‚ ã€‚ å…³è”ï¼š ç…é¥¼å®ä½“ç±»ç»§æ‰¿ç…é¥¼æŠ½è±¡ç±»ï¼Œè£…é¥°è€…æŠ½è±¡ç±»ä¹Ÿç»§æ‰¿ç…é¥¼æŠ½è±¡ç±»ï¼Œé€šè¿‡å®ƒä»¬çš„çˆ¶ç±»ç»„åˆæ¥è¾¾åˆ°ç…é¥¼å®ä½“ç±»å’Œè£…é¥°è€…æŠ½è±¡ç±»çš„å…³ç³» æŠ½è±¡ç…é¥¼ç±» 123456789101112131415161718192021package com.design.pattern.decorator.v2;/** * AbstractBatterCake æŠ½è±¡ç…é¥¼ç±»ï¼ˆä¹Ÿå¯ä»¥æ˜¯æ¥å£ï¼‰ * * @author shunhua * @date 2019-09-19 */public abstract class AbstractBatterCake &#123; /** * é£Ÿå“æè¿° * @return */ public abstract String getDesc(); /** * ä»·æ ¼ * @return */ public abstract int cost();&#125; ç…é¥¼ç±» 1234567891011121314151617181920package com.design.pattern.decorator.v2;/** * BatterCake å®ä½“ç…é¥¼ç±» * * @author shunhua * @date 2019-09-19 */public class BatterCake extends AbstractBatterCake &#123; @Override public String getDesc() &#123; return \"ç…é¥¼\"; &#125; @Override public int cost() &#123; return 5; &#125;&#125; æŠ½è±¡è£…é¥°ç±» 123456789101112131415161718192021222324252627282930313233343536package com.design.pattern.decorator.v2;/** * * è£…é¥°è€…åŒæ ·ç»§æ‰¿ æŠ½è±¡ç…é¥¼ç±»ï¼Œè¿™æ˜¯ä¸ºäº†æ–¹ä¾¿ ï¼Œå’Œç…é¥¼ç±»äº¤äº’ * * å¦‚æœä¸ç”¨æ„é€ å™¨çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨setæ–¹å¼ * * @author shunhua * @date 2019-09-19 */public abstract class AbstractDecorator extends AbstractBatterCake &#123; /** * å®šä¹‰ç…é¥¼å±æ€§ï¼Œç”¨äºæ³¨å…¥ */ private AbstractBatterCake batterCake; public AbstractDecorator(AbstractBatterCake batterCake)&#123; this.batterCake = batterCake; &#125; @Override public String getDesc() &#123; return batterCake.getDesc(); &#125; @Override public int cost() &#123; return batterCake.cost(); &#125; /** * è£…é¥°è€…å®ä½“ç±»ç‰¹æœ‰æ“ä½œ */ protected abstract void handle();&#125; é¸¡è›‹è£…é¥°ç±» 1234567891011121314151617181920212223242526272829303132package com.design.pattern.decorator.v2;import lombok.extern.slf4j.Slf4j;/** * EggDecorator * * @author shunhua * @date 2019-09-19 */@Slf4jpublic class EggDecorator extends AbstractDecorator &#123; public EggDecorator(AbstractBatterCake batterCake) &#123; super(batterCake); &#125; @Override public String getDesc() &#123; return super.getDesc() + \" åŠ ä¸€ä¸ªé¸¡è›‹\"; &#125; @Override public int cost() &#123; return super.cost() + 1; &#125; @Override protected void handle() &#123; log.info(\"é¸¡è›‹è£…é¥°è€…ç‰¹æœ‰çš„å¤„ç†\"); &#125;&#125; é¦™è‚ è£…é¥°ç±» 1234567891011121314151617181920212223242526272829303132package com.design.pattern.decorator.v2;import lombok.extern.slf4j.Slf4j;/** * SauseDecorator * * @author shunhua * @date 2019-09-19 */@Slf4jpublic class SauseDecorator extends AbstractDecorator &#123; public SauseDecorator(AbstractBatterCake batterCake) &#123; super(batterCake); &#125; @Override public String getDesc() &#123; return super.getDesc() + \" åŠ ä¸€ä¸ªé¦™è‚ \"; &#125; @Override public int cost() &#123; return super.cost() + 2; &#125; @Override protected void handle() &#123; log.info(\"é¦™è‚ è£…é¥°è€…ç‰¹æœ‰çš„å¤„ç†æ–¹å¼\"); &#125;&#125; å®¢æˆ·ç«¯ 1234567891011121314151617181920212223242526272829package com.design.pattern.decorator.v2;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-19 */@Slf4jpublic class Client &#123; @Test public void test()&#123; AbstractBatterCake batterCake; // è£…é¥°ç…é¥¼ batterCake = new BatterCake(); // é¸¡è›‹è£…é¥° batterCake = new EggDecorator(batterCake); batterCake = new EggDecorator(batterCake); ((EggDecorator) batterCake).handle(); // é¦™è‚ è£…é¥° batterCake = new SauseDecorator(batterCake); ((SauseDecorator) batterCake).handle(); log.info(batterCake.getDesc() + \" ä¸€å…±å–äº†\" + batterCake.cost() + \"å…ƒ\"); &#125;&#125; è£…é¥°è€…æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨BufferedReader 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081public class BufferedReader extends Reader &#123; private Reader in; private char cb[]; private int nChars, nextChar; // todo çœç•¥ /** * å¯¹Readerç±»å‹çš„ å®ä¾‹è¿›è¡ŒåŒ…è£… */ public BufferedReader(Reader in, int sz) &#123; super(in); if (sz &lt;= 0) throw new IllegalArgumentException(\"Buffer size &lt;= 0\"); this.in = in; cb = new char[sz]; nextChar = nChars = 0; &#125; /** * Creates a buffering character-input stream that uses a default-sized * input buffer. * * @param in A Reader */ public BufferedReader(Reader in) &#123; this(in, defaultCharBufferSize); &#125; /** * è¿™é‡Œä½¿ç”¨Reader ç±»å‹å¯¹è±¡è¿›è¡Œæ“ä½œ */ private void fill() throws IOException &#123; int dst; if (markedChar &lt;= UNMARKED) &#123; /* No mark */ dst = 0; &#125; else &#123; /* Marked */ int delta = nextChar - markedChar; if (delta &gt;= readAheadLimit) &#123; /* Gone past read-ahead limit: Invalidate mark */ markedChar = INVALIDATED; readAheadLimit = 0; dst = 0; &#125; else &#123; if (readAheadLimit &lt;= cb.length) &#123; /* Shuffle in the current buffer */ System.arraycopy(cb, markedChar, cb, 0, delta); markedChar = 0; dst = delta; &#125; else &#123; /* Reallocate buffer to accommodate read-ahead limit */ char ncb[] = new char[readAheadLimit]; System.arraycopy(cb, markedChar, ncb, 0, delta); cb = ncb; markedChar = 0; dst = delta; &#125; nextChar = nChars = delta; &#125; &#125; int n; do &#123; n = in.read(cb, dst, cb.length - dst); &#125; while (n == 0); if (n &gt; 0) &#123; nChars = dst + n; nextChar = dst; &#125; &#125;&#125;/** * æ³¨æ„Readeræ˜¯æŠ½è±¡çš„ */public abstract class Reader implements Readable, Closeable &#123; // todo çœç•¥&#125; InputStreamç±»å‹ä½œä¸ºè¢«è£…é¥°ç±»å‹ï¼Œå®ƒçš„è£…é¥°è€…æœ‰å¾ˆå¤šï¼Œå¦‚ä¸Šå›¾ä¸­åˆ—å‡ºFilerInputStreamã€BufferedInputStreamä»¥åŠLineInputStreamã€‚åœ¨è£…é¥°è€…å†…éƒ¨æœ¬è´¨ä¸Šéƒ½æ˜¯ä½¿ç”¨InputStreamçš„å®ä¾‹æ“ä½œçš„ã€‚ BufferedInputStream 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public class BufferedInputStream extends FilterInputStream &#123; private static int DEFAULT_BUFFER_SIZE = 8192; private static int MAX_BUFFER_SIZE = Integer.MAX_VALUE - 8; protected volatile byte buf[]; private static final AtomicReferenceFieldUpdater&lt;BufferedInputStream, byte[]&gt; bufUpdater = AtomicReferenceFieldUpdater.newUpdater (BufferedInputStream.class, byte[].class, \"buf\"); protected int count; protected int pos; protected int markpos = -1; protected int marklimit; private InputStream getInIfOpen() throws IOException &#123; InputStream input = in; if (input == null) throw new IOException(\"Stream closed\"); return input; &#125; /** * å¯¹InputStreamç±»å‹è¿›è¡ŒåŒ…è£… */ public BufferedInputStream(InputStream in) &#123; this(in, DEFAULT_BUFFER_SIZE); &#125; /** * å¯¹InputStreamç±»å‹è¿›è¡ŒåŒ…è£… */ public BufferedInputStream(InputStream in, int size) &#123; super(in); if (size &lt;= 0) &#123; throw new IllegalArgumentException(\"Buffer size &lt;= 0\"); &#125; buf = new byte[size]; &#125;&#125; Servletçš„HttpServletRequestWrapper HttpServletRequestWrapperç»§æ‰¿äº†ServletRequestWrapperä¹Ÿå®ç°äº†HttpServletRequest,å®ƒä»¬çš„å…¬å…±çˆ¶ç±»æ˜¯ServletRequest. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798/** * HttpServletRequestWrapperè£…é¥°ç±» */public class HttpServletRequestWrapper extends ServletRequestWrapper implements HttpServletRequest &#123; /** * å¯¹HttpServletRequestè¿›è¡Œè£…é¥°ï¼ŒServletRequestWrapperæŠ½è±¡çš„è£…é¥°è€…ä¹Ÿå¯¹HttpServletRequestçš„çˆ¶ç±»è¿›è¡Œè£…é¥° */ public HttpServletRequestWrapper(HttpServletRequest request) &#123; super(request); &#125; private HttpServletRequest _getHttpServletRequest() &#123; return (HttpServletRequest) super.getRequest(); &#125; /** * The default behavior of this method is to return getAuthType() * on the wrapped request object. */ public String getAuthType() &#123; return this._getHttpServletRequest().getAuthType(); &#125; /** * The default behavior of this method is to return getCookies() * on the wrapped request object. */ public Cookie[] getCookies() &#123; return this._getHttpServletRequest().getCookies(); &#125; /** * The default behavior of this method is to return getDateHeader(String name) * on the wrapped request object. */ public long getDateHeader(String name) &#123; return this._getHttpServletRequest().getDateHeader(name); &#125;&#125;/*** ServletRequestWrapperè£…é¥°ç±»*/public class ServletRequestWrapper implements ServletRequest &#123; private ServletRequest request; /** * Creates a ServletRequest adaptor wrapping the given request object. * @throws java.lang.IllegalArgumentException if the request is null */ public ServletRequestWrapper(ServletRequest request) &#123; if (request == null) &#123; throw new IllegalArgumentException(\"Request cannot be null\"); &#125; this.request = request; &#125; /** * Return the wrapped request object. */ public ServletRequest getRequest() &#123; return this.request; &#125; /** * Sets the request object being wrapped. * @throws java.lang.IllegalArgumentException if the request is null. */ public void setRequest(ServletRequest request) &#123; if (request == null) &#123; throw new IllegalArgumentException(\"Request cannot be null\"); &#125; this.request = request; &#125; /** * * The default behavior of this method is to call getAttribute(String name) * on the wrapped request object. */ public Object getAttribute(String name) &#123; return this.request.getAttribute(name); &#125; /** * The default behavior of this method is to return getAttributeNames() * on the wrapped request object. */ public Enumeration getAttributeNames() &#123; return this.request.getAttributeNames(); &#125; &#125; MyBatisçš„FifoCache MyBatisçš„Cacheæ¨¡å—ä¸­ä½¿ç”¨å¤§é‡çš„è£…é¥°è€…æ¨¡å¼ï¼Œåœ¨decoratorsåŒ…ä¸‹éƒ½æ˜¯çš„ï¼Œä¸‹é¢åˆ—ä¸¾æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥çš„è£…é¥°ç±»ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839/*** lruç®—æ³• æœ€è¿‘æœ€å°‘ä½¿ç”¨*/public class LruCache implements Cache &#123; private final Cache delegate; private Map&lt;Object, Object&gt; keyMap; private Object eldestKey; public LruCache(Cache delegate) &#123; this.delegate = delegate; setSize(1024); &#125; @Override public String getId() &#123; return delegate.getId(); &#125; @Override public int getSize() &#123; return delegate.getSize(); &#125; public void setSize(final int size) &#123; keyMap = new LinkedHashMap&lt;Object, Object&gt;(size, .75F, true) &#123; private static final long serialVersionUID = 4267176411845948333L; @Override protected boolean removeEldestEntry(Map.Entry&lt;Object, Object&gt; eldest) &#123; boolean tooBig = size() &gt; size; if (tooBig) &#123; eldestKey = eldest.getKey(); &#125; return tooBig; &#125; &#125;; &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å¤–è§‚æ¨¡å¼","slug":"design_pattern/structure_type/å¤–è§‚æ¨¡å¼","date":"2019-09-16T16:00:00.000Z","updated":"2020-07-04T16:28:45.972Z","comments":true,"path":"posts/f7de8aa8/","link":"","permalink":"https://gentryhuang.com/posts/f7de8aa8/","excerpt":"","text":"å®šä¹‰åˆå«é—¨é¢æ¨¡å¼ï¼Œæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼Œç”¨æ¥è®¿é—®å­ç³»ç»Ÿä¸­çš„ä¸€ç¾¤æ¥å£ã€‚å¤–è§‚æ¨¡å¼å®šä¹‰äº†ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œè®©å­ç³»ç»Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚ ç±»å‹ç»“æ„å‹ ä½¿ç”¨åœºæ™¯ å­ç³»ç»Ÿè¶Šæ¥è¶Šå¤æ‚ï¼Œå¢åŠ å¤–è§‚æ¨¡å¼æä¾›ç®€å•è°ƒç”¨æ¥å£ æ„å»ºå¤šå±‚ç³»ç»Ÿç»“æ„ï¼Œåˆ©ç”¨å¤–è§‚å¯¹è±¡ä½œä¸ºæ¯å±‚çš„å…¥å£ï¼Œç®€åŒ–å±‚é—´è°ƒç”¨ ä¼˜ç‚¹1234â—†ç®€åŒ–äº†è°ƒç”¨è¿‡ç¨‹ï¼Œæ— éœ€äº†è§£æ·±å…¥å­ç³»ç»Ÿï¼Œé˜²æ­¢å¸¦æ¥é£é™©(å°†å­ç³»ç»Ÿé›†æˆåˆ°ä¸€èµ·ï¼Œä¸å»ä¿®æ”¹å­ç³»ç»Ÿ)ã€‚â—†å‡å°‘ç³»ç»Ÿä¾èµ–ã€æ¾æ•£è€¦åˆï¼ˆå®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿï¼‰â—†æ›´å¥½çš„åˆ’åˆ†è®¿é—®å±‚æ¬¡â—†ç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ï¼Œå³æœ€å°‘çŸ¥é“åŸåˆ™ ç¼ºç‚¹12â—†å¢åŠ å­ç³»ç»Ÿã€æ‰©å±•å­ç³»ç»Ÿè¡Œä¸ºå®¹æ˜“å¼•å…¥é£é™©â—†å¢åŠ å­ç³»ç»Ÿã€æ‰©å±•å­ç³»ç»Ÿè¡Œä¸ºä¸ç¬¦åˆå¼€é—­åŸåˆ™ ç›¸å…³è”è®¾è®¡æ¨¡å¼å¯¹æ¯”å¤–è§‚æ¨¡å¼å’Œä¸­ä»‹è€…æ¨¡å¼ 1å‰è€…å…³æ³¨å¤–ç•Œå’Œå­ç³»ç»Ÿçš„äº¤äº’ï¼Œåè€…å…³æ³¨å­ç³»ç»Ÿå†…éƒ¨çš„äº¤äº’ å¤–è§‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼ 1å¤–è§‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼å¯ä»¥ç»“åˆä½¿ç”¨,é€šå¸¸æŠŠå¤–è§‚æ¨¡å¼ä¸­çš„å¤–è§‚åšæˆå•ä¾‹çš„ å¤–è§‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼ 1å‰è€…å¯ä»¥é€šè¿‡åè€…è·å–å­ç³»ç»Ÿçš„å®ä¾‹ï¼Œå­ç³»ç»Ÿå¯ä»¥ç»å†…éƒ¨å¯¹å¤–è§‚ç±»è¿›è¡Œå±è”½ ç®€å•éœ€æ±‚ æŸç½‘ç«™æœ‰ç§¯åˆ†å…‘æ¢ç¤¼ç‰©çš„åŠŸèƒ½ï¼Œè®¾è®¡çš„æ—¶å€™éœ€è¦æ ¡éªŒä¸‰æ­¥ï¼š a èµ„æ ¼æ ¡éªŒç³»ç»Ÿï¼Œæ˜¯æœ¨æœ¨ç½‘ä¼šå‘˜ã€‚ b ç§¯åˆ†ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿæ”¾çš„æ˜¯å„ä¸ªç§¯åˆ†çš„è·å–æ”¯å‡ºï¼Œéœ€è¦æ‹¿å‡ºè¯¥ç”¨æˆ·ç›®å‰çš„ç§¯åˆ†å’Œè¯¥ç¤¼ç‰©æ‰€éœ€è¦çš„ç§¯åˆ†è¿›è¡Œå¯¹æ¯” c ç‰©æµç³»ç»Ÿï¼Œå¦‚æœæ»¡è¶³abï¼Œåˆ™è¿”å›æˆåŠŸï¼Œå¹¶è¿”å›ä¸€ä¸ªè®¢å•å·ã€‚ å…³æ³¨ç‚¹ï¼š åº”ç”¨å±‚æ— éœ€çŸ¥é“èµ„æ ¼æ ¡éªŒç±»ç­‰å…¶ä»–å­ç³»ç»Ÿçš„ç±» å¤–è§‚æ¨¡å¼æ¼”ç»ƒ 121. åº”ç”¨å±‚ä¸å…³å¿ƒå­ç³»ç»Ÿï¼Œåº”ç”¨å±‚åªå’Œå¤–è§‚ç±»é€šä¿¡ï¼Œå­ç³»ç»Ÿåªå’Œå¤–è§‚ç±»é€šä¿¡2. å¦‚æœæ‰©å±•å­ç³»ç»Ÿçš„ï¼Œä½¿ç”¨å®ä½“å¤–è§‚ç±»çš„è¯ï¼Œä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¦‚æœä½¿ç”¨æŠ½è±¡å¤–è§‚ç±»æˆ–è€…å¤–è§‚æ¥å£ï¼Œç„¶åç”¨å®ä½“ç»§æ‰¿æˆ–å®ç°çš„è¯ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚ä¸»è¦çœ‹å¤–è§‚å¯¹åº”çš„å­ç³»ç»Ÿç¾¤æ˜¯å¦å˜æ›´é¢‘ç¹ï¼Œä¸é¢‘ç¹å¯ä»¥ä½¿ç”¨å®ä½“å¤–è§‚ï¼Œè¿™æ ·æ›´ç®€å•ã€‚ å®ä½“ç±» 1234567891011121314151617181920package com.design.pattern.facade;import lombok.AllArgsConstructor;import lombok.Data;/** * PointsGift ç§¯åˆ†å…‘æ¢ç¤¼ç‰© * * @author shunhua * @date 2019-09-17 */@Data@AllArgsConstructorpublic class PointsGift &#123; /** * ç¤¼ç‰©åç§° */ private String name;&#125; èµ„æ ¼éªŒè¯ç³»ç»Ÿç±» 1234567891011121314151617181920212223package com.design.pattern.facade;import lombok.extern.slf4j.Slf4j;/** * QualifyService æ ¡éªŒç³»ç»Ÿ * * @author shunhua * @date 2019-09-17 */@Slf4jpublic class QualifyService &#123; /** * æ ¡éªŒé€»è¾‘ï¼Œç§¯åˆ†æ˜¯å¦å¤Ÿ * @param pointsGift * @return */ public boolean isAvailable(PointsGift pointsGift)&#123; log.info(pointsGift.getName() + \"ç§¯åˆ†é€šè¿‡\"); return true; &#125;&#125; ç§¯åˆ†ç³»ç»Ÿç±» 1234567891011121314151617181920212223package com.design.pattern.facade;import lombok.extern.slf4j.Slf4j;&#x2F;** * PointsPaymentService ç§¯åˆ†æ”¯ä»˜ * * @author shunhua * @date 2019-09-17 *&#x2F;@Slf4jpublic class PointsPaymentService &#123; &#x2F;** * ç§¯åˆ†å…‘æ¢ç¤¼ç‰© * @param pointsGift * @return *&#x2F; public boolean pay(PointsGift pointsGift)&#123; log.info(&quot;æ”¯ä»˜&quot; + pointsGift.getName() + &quot;ç§¯åˆ†æˆåŠŸ&quot;); return true; &#125;&#125; ç‰©æµç³»ç»Ÿç±» 1234567891011121314151617181920212223package com.design.pattern.facade;import lombok.extern.slf4j.Slf4j;/** * ShippingService * * @author shunhua * @date 2019-09-17 */@Slf4jpublic class ShippingService &#123; /** * ç‰©æµç³»ç»Ÿå¯¹æ¥ * @param pointsGift * @return */ public String shipGift(PointsGift pointsGift)&#123; log.info(pointsGift.getName() + \"è¿›å…¥ç‰©æµç³»ç»Ÿ\"); return \"123456\"; &#125;&#125; å®¢æˆ·ç«¯ 1234567891011121314151617181920package com.design.pattern.facade;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-17 */public class Client &#123; @Test public void test()&#123; PointsGift pointsGift = new PointsGift(\"æœºæ¢°é”®ç›˜\"); GiftExchangeService giftExchangeService = new GiftExchangeService(); giftExchangeService.giftExchange(pointsGift); &#125;&#125; å¤–è§‚æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨Spring-jdbc 1Springå¯¹åŸç”Ÿçš„JDBCè¿›è¡Œäº†å°è£…ï¼Œæˆ‘ä»¬åªéœ€è¦è®¿é—®Springæä¾›çš„æ¥å£æ–¹æ³•å°±å¯ä»¥è¾¾åˆ°ç›®çš„ã€‚ MyBatisçš„Configuration 123456/** Configuration#newMetaObjectæ–¹æ³•åº•å±‚ä¹Ÿæ˜¯å¯¹ä¸€äº›åˆ—é€»è¾‘çš„å°è£…ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨newMetaObjectå³å¯ï¼Œä¸éœ€å…³ç³»å†…éƒ¨ã€‚ * å¦‚æœéœ€è¦ä¿®æ”¹å†…éƒ¨é€»è¾‘ï¼Œè¿™å¤–è§‚æ¥å£æ˜¯ä¸éœ€è¦æ”¹å˜çš„ */public MetaObject newMetaObject(Object object) &#123; return MetaObject.forObject(object, objectFactory, objectWrapperFactory, reflectorFactory); &#125; Tomcatæºç  12341. Tomcatä¸­å¤§é‡ä½¿ç”¨äº†å¤–è§‚æ¨¡å¼ï¼Œå¦‚RequestFacadeã€ResponseFacadeç­‰ã€‚2. RequestFacade implements HttpServletRequestï¼ŒRequest implements HttpServletRequestï¼ŒRequestä½¿ç”¨äº†RequestFacadeåŒ…è£…äº† è‡ªå·±ã€‚Request#getRequeståœ¨è·å–HttpServletRequestæ—¶ï¼Œè¿”å›çš„å…¶å®æ˜¯RequestFacadeï¼Œä¹‹åç”¨è¿™ä¸ªè¿”å›çš„å¯¹è±¡å®Œæˆçš„æ“ä½œéƒ½æ˜¯RequestFacade æ¥å®Œæˆçš„ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"åŸå‹æ¨¡å¼","slug":"design_pattern/creation_type/åŸå‹æ¨¡å¼","date":"2019-09-15T16:00:00.000Z","updated":"2020-07-04T16:28:45.962Z","comments":true,"path":"posts/91ad9ce3/","link":"","permalink":"https://gentryhuang.com/posts/91ad9ce3/","excerpt":"","text":"å®šä¹‰åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚å¯ä»¥ç†è§£ä¸ºå…‹éš†æ–¹æ³•å…‹éš†å¯¹è±¡ã€‚ ç‰¹ç‚¹ä¸éœ€è¦çŸ¥é“ä»»ä½•åˆ›å»ºçš„ç»†èŠ‚ï¼Œä¸è°ƒç”¨æ„é€ å‡½æ•° ç±»å‹åˆ›å»ºå‹ é€‚ç”¨åœºæ™¯1234â—†ç±»åˆå§‹åŒ–æ¶ˆè€—è¾ƒå¤šèµ„æºâ—†newäº§ç”Ÿçš„ä¸€ä¸ªå¯¹è±¡éœ€è¦éå¸¸ç¹ççš„è¿‡ç¨‹ï¼ˆæ•°æ®å‡†å¤‡ã€è®¿é—®æƒé™ç­‰ï¼‰â—†æ„é€ å‡½æ•°æ¯”è¾ƒå¤æ‚â—†å¾ªç¯ä½“ä¸­ç”Ÿäº§å¤§é‡å¯¹è±¡æ—¶ ä¼˜ç‚¹ åŸå‹æ¨¡å¼æ€§èƒ½æ¯”ç›´æ¥newä¸€ä¸ªå¯¹è±¡æ€§èƒ½é«˜ ç®€åŒ–åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ ç¼ºç‚¹ å¿…é¡»é…å¤‡å…‹éš†æ–¹æ³•ï¼ˆé‡å†™Objectçš„cloneæ–¹æ³•ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆï¼Œå…‹éš†ä¹Ÿæ˜¯åŸå‹æ¨¡å¼çš„æ ¸å¿ƒï¼‰ å¯¹å…‹éš†å¤æ‚å¯¹è±¡æˆ–å¯¹å…‹éš†å‡ºçš„å¯¹è±¡è¿›è¡Œå¤æ‚æ”¹é€ æ—¶ï¼Œå®¹æ˜“å¼•å…¥é£é™© å¯¹å¤æ‚å¯¹è±¡çš„æ·±æ‹·è´ã€æµ…æ‹·è´è¦è¿ç”¨å¾—å½“ æ‰©å±•æ·±å…‹éš†1åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæœ¬ä½“å¯¹è±¡çš„å¼•ç”¨ç±»å‹å±æ€§éœ€è¦è¿›è¡Œæ·±å…‹éš†ï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šå†æŒ‡å‘åŸæœ‰å¯¹è±¡åœ°å€ã€‚ æµ…å…‹éš†1åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œæ–°å¯¹è±¡çš„å±æ€§å’ŒåŸæ¥å¯¹è±¡å®Œå…¨ç›¸åŒï¼Œå¯¹äºéåŸºæœ¬ç±»å‹å±æ€§ï¼Œä»æŒ‡å‘åŸæœ‰å±æ€§æ‰€æŒ‡å‘çš„å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ å°ç»“1æ·±æµ…å…‹éš†éƒ½ä¼šåœ¨å †ä¸­æ–°åˆ†é…ä¸€å—åŒºåŸŸï¼Œå®ƒç”¨æ¥æŒ‡å‘æœ¬ä½“ï¼ŒåŒºåˆ«åœ¨äºå¯¹è±¡å±æ€§å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦éœ€è¦è¿›è¡Œå…‹éš†ï¼ˆé€’å½’æ€§çš„ï¼‰ ç®€å•éœ€æ±‚æŸä¸ªå¯¹è±¡åˆ›å»ºçš„æ—¶å€™ç›¸å¯¹æ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œä½†æ˜¯è¿™ä¸ªå¯¹è±¡åˆä¸å¾—ä¸åˆ›å»ºå¤šæ¬¡ï¼Œè¿™æ—¶å¯ä»¥ä½¿ç”¨åŸå‹æ¨¡å¼ã€‚åŸå‹æ¨¡å¼æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡ŒäºŒè¿›åˆ¶å­—èŠ‚æµçš„æ‹·è´ï¼Œæ¯”newä¸€ä¸ªå¯¹è±¡æ€§èƒ½å¥½å¾ˆå¤š åŸå‹æ¨¡å¼å®è·µä½¿ç”¨åŸå‹æ¨¡å¼ä¹‹å‰é‚®ä»¶ç±» 12345678910111213141516171819202122232425package com.design.pattern.prototype;import lombok.Data;/** * Mail * * @author shunhua * @date 2019-09-16 */@Datapublic class Mail &#123; /** * é‚®ä»¶å */ private String name; /** * é‚®ä»¶åœ°å€ */ private String address; /** * é‚®ä»¶å†…å®¹ */ private String content;&#125; é‚®ä»¶å·¥å…·ç±» 123456789101112131415161718192021222324252627282930package com.design.pattern.prototype;import lombok.extern.slf4j.Slf4j;import java.text.MessageFormat;/** * MailUtil * * @author shunhua * @date 2019-09-16 */@Slf4jpublic class MailUtil &#123; /** * å‘é€é‚®ä»¶ * é‡ç‚¹ï¼š å ä½ç¬¦èµ‹å€¼çš„å®ç° * @param mail */ public static void sendMail(Mail mail)&#123; String content = \"å‘&#123;0&#125;,é‚®ä»¶åœ°å€:&#123;1&#125;,é‚®ä»¶å†…å®¹ï¼š&#123;2&#125;å‘é€é‚®ä»¶\"; log.info(MessageFormat.format(content,mail.getName(),mail.getAddress(),mail.getContent())); &#125; /** * ä¿å­˜é‚®ä»¶çš„æ¨¡ç‰ˆå†…å®¹ * @param mail */ public static void mailTemplate(Mail mail)&#123; log.info(\"é‚®ä»¶çš„æ¨¡ç‰ˆå†…å®¹ï¼š\" + mail.getContent()); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425package com.design.pattern.prototype;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-16 */public class Client &#123; @Test public void test()&#123; Mail mail = new Mail(); mail.setContent(\"é‚®ä»¶æ¨¡ç‰ˆ\"); for(int i = 0; i &lt; 10; i++)&#123; mail.setName(\"å§“å\" + i); mail.setAddress(\"å§“å\" + i + \"@\" + \"gmail.com\"); mail.setContent(\"ä½ æ”¶åˆ°ä¸€å°é‚®ä»¶\"); MailUtil.sendMail(mail); &#125; MailUtil.mailTemplate(mail); &#125;&#125; ä½¿ç”¨åŸå‹æ¨¡å¼é»˜è®¤æ–¹å¼ï¼ˆæµ…æ‹·è´ï¼‰é‚®ä»¶ç±» 123456789101112131415161718192021222324252627282930313233343536package com.design.pattern.prototype;import lombok.Data;/** * Mail æƒ³è¦èƒ½è¢«å…‹éš†éœ€è¦å®ç°Cloneableæ¥å£ * * @author shunhua * @date 2019-09-16 */@Datapublic class Mail implements Cloneable &#123; /** * é‚®ä»¶å */ private String name; /** * é‚®ä»¶åœ°å€ */ private String address; /** * é‚®ä»¶å†…å®¹ */ private String content; /** * é‡å†™å…‹éš†æ–¹æ³• * @return * @throws CloneNotSupportedException */ @Override protected Object clone() throws CloneNotSupportedException &#123; System.out.println(\"å…‹éš†Mail...\"); return super.clone(); &#125;&#125; é‚®ä»¶å·¥å…·ç±» 12345678910111213141516171819202122232425262728293031package com.design.pattern.prototype;import lombok.extern.slf4j.Slf4j;import java.text.MessageFormat;/** * MailUtil * * @author shunhua * @date 2019-09-16 */@Slf4jpublic class MailUtil &#123; /** * å‘é€é‚®ä»¶ * @param mail */ public static void sendMail(Mail mail)&#123; String content = \"å‘&#123;0&#125;,é‚®ä»¶åœ°å€:&#123;1&#125;,é‚®ä»¶å†…å®¹ï¼š&#123;2&#125;å‘é€é‚®ä»¶\"; log.info(MessageFormat.format(content,mail.getName(),mail.getAddress(),mail.getContent())); &#125; /** * ä¿å­˜é‚®ä»¶çš„æ¨¡ç‰ˆå†…å®¹ * @param mail */ public static void mailTemplate(Mail mail)&#123; log.info(\"é‚®ä»¶çš„æ¨¡ç‰ˆå†…å®¹ï¼š\" + mail.getContent()); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425262728package com.design.pattern.prototype;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-16 */public class Client &#123; @Test public void test() throws CloneNotSupportedException &#123; Mail mail = new Mail(); mail.setContent(\"é‚®ä»¶æ¨¡ç‰ˆ\"); for(int i = 0; i &lt; 10; i++)&#123; /** éœ€è¦åˆ›å»ºå¤šä¸ªMailå¯¹è±¡,æ³¨æ„ä¸ä¼šè°ƒç”¨Mailçš„æ„é€ æ–¹æ³•ï¼Œè€Œæ˜¯è°ƒç”¨äº†Mailä¸­çš„cloneæ–¹æ³• **/ Mail mailTemp = (Mail) mail.clone(); mailTemp.setName(\"å§“å\" + i); mailTemp.setAddress(\"å§“å\" + i + \"@\" + \"gmail.com\"); mailTemp.setContent(\"ä½ æ”¶åˆ°ä¸€å°é‚®ä»¶\"); MailUtil.sendMail(mailTemp); &#125; // å¾—åˆ°åŸå§‹çš„é‚®ä»¶æ¨¡ç‰ˆ MailUtil.mailTemplate(mail); &#125;&#125; ä½¿ç”¨åŸå‹æ¨¡å¼é»˜è®¤æ–¹å¼ï¼ˆæ·±æ‹·è´ï¼‰12345678å¯¹äºè¢«å…‹éš†çš„ç›®æ ‡å¯¹è±¡ä¸­æœ‰å¼•ç”¨ç±»å‹çš„å±æ€§æ—¶ï¼Œå¦‚æœä¸å¯¹è¯¥å¼•ç”¨ç±»å‹çš„å±æ€§è¿›è¡Œå…‹éš†å¤„ç†ï¼Œé‚£ä¹ˆè¯¥å±æ€§å¯¹äºç›®æ ‡å¯¹è±¡å’Œå…‹éš†å¾—åˆ°çš„æ–°å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªï¼Œè¿™å¾ˆå®¹æ˜“å¼•èµ·é—®é¢˜ï¼Œä¸€å®šè¦æ³¨æ„ã€‚è¿™æ ·æƒ…å†µï¼Œåªéœ€è¦å¯¹è¿™ä¸ªå±æ€§è¿›è¡Œæµ…æ‹·è´å¤„ç†å³å¯è§£å†³ã€‚@Override protected Object clone() throws CloneNotSupportedException &#123; Mail mail = (Mail) super.clone(); //æ·±å…‹éš† mail.date = (Date) pig.date.clone(); return mail; &#125; åŸå‹æ¨¡å¼æ‰©å±•å®ä½“ç±» 1234567891011/** * ä¸€ç§å¸¸ç”¨çš„åŸå‹æ¨¡å¼ * é€šè¿‡æŠ½è±¡ç±»æ¥å®ç°åŸå‹æ¨¡å¼ */public abstract class A implements Cloneable&#123; @Override protected Object clone() throws CloneNotSupportedException &#123; return super.clone(); &#125;&#125; ç»§æ‰¿ç±» 123456789101112131415/** * ç»§æ‰¿Aç±»ï¼Œç›´æ¥è°ƒç”¨cloneæ¥å£ */public class B extends A&#123; public static void main(String [] args)&#123; B b = new B(); try &#123; b.clone(); &#125; catch (CloneNotSupportedException e) &#123; e.printStackTrace(); System.out.println(\"å¤„ç†å¼‚å¸¸\"); &#125; &#125;&#125; å…‹éš†ç ´åå•ä¾‹123å…‹éš†ç ´åå•ä¾‹çš„æ ¹æœ¬åŸå› æ˜¯ï¼Œé€šè¿‡åå°„æš´åŠ›è°ƒç”¨å•ä¾‹ç±»ä¸­çš„cloneæ–¹æ³•ï¼Œè¿™æ ·å°±ä¼šå¾—åˆ°ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå•ä¾‹ä¹Ÿå°±å˜æˆäº†å¤šä¾‹ã€‚é˜²æ­¢å…‹éš†ç ´åå•ä¾‹ï¼Œåªéœ€è¦è®©å•ä¾‹ç±»ä¸å®ç°å…‹éš†æ¥å£å³å¯ï¼Œæˆ–è€…å®ç°äº†å…‹éš†æ¥å£ä½†æ˜¯å…‹éš†æ–¹æ³•è¿”å›çš„ä»ç„¶æ˜¯åŒä¸€å¯¹è±¡ï¼Œè€Œä¸æ˜¯å¤„ç†å…‹éš†ã€‚ åŸå‹æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨1å¯ä»¥é€šè¿‡è§‚å¯ŸCloneableæ¥å£çš„ä½¿ç”¨ï¼Œå°±å¯ä»¥è¿½è¸ªåŸå‹æ¨¡å¼æ˜¯æ€æ ·ä½¿ç”¨çš„ æºç è§£æ1(Object) 12//native è°ƒç”¨éjavaä»£ç æ¥å£ protected native Object clone() throws CloneNotSupportedException; æºç è§£æ2(ArrayListå®ç°å…‹éš†) 1234567891011121314151617181920212223public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt; implements List&lt;E&gt;, RandomAccess, Cloneable, java.io.Serializable&#123;/** * Returns a shallow copy of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance. (The * elements themselves are not copied.) * * @return a clone of this &lt;tt&gt;ArrayList&lt;/tt&gt; instance */ public Object clone() &#123; try &#123; @SuppressWarnings(\"unchecked\") ArrayList&lt;E&gt; v = (ArrayList&lt;E&gt;) super.clone(); v.elementData = Arrays.copyOf(elementData, size); v.modCount = 0; return v; &#125; catch (CloneNotSupportedException e) &#123; // this shouldn't happen, since we are Cloneable throw new InternalError(); &#125; &#125;&#125; æºç è§£æ3(MyBatisçš„cacheKey) 12345678910111213141516171819package org.apache.ibatis.cache;import java.io.Serializable;import java.lang.reflect.Array;import java.util.ArrayList;import java.util.List;/** * @author Clinton Begin */public class CacheKey implements Cloneable, Serializable &#123; @Override public CacheKey clone() throws CloneNotSupportedException &#123; CacheKey clonedCacheKey = (CacheKey) super.clone(); clonedCacheKey.updateList = new ArrayList&lt;Object&gt;(updateList); return clonedCacheKey; &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å»ºé€ è€…æ¨¡å¼","slug":"design_pattern/creation_type/å»ºé€ è€…æ¨¡å¼","date":"2019-09-11T14:33:47.000Z","updated":"2020-07-04T16:28:45.965Z","comments":true,"path":"posts/fe816c3c/","link":"","permalink":"https://gentryhuang.com/posts/fe816c3c/","excerpt":"","text":"å®šä¹‰ å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚ç”¨æˆ·åªéœ€æŒ‡å®šéœ€è¦å»ºé€ çš„ç±»å‹å°±å¯ä»¥å¾—åˆ°å®ƒä»¬ï¼Œå»ºé€ è¿‡ç¨‹åŠç»†èŠ‚ä¸éœ€è¦çŸ¥é“ã€‚ ç±»å‹ åˆ›å»ºå‹ é€‚ç”¨åœºæ™¯ å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰éå¸¸å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼ˆå¾ˆå¤šå±æ€§ï¼‰ æƒ³æŠŠå¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦»ä¼˜ç‚¹ å°è£…æ€§å¥½ï¼Œåˆ›å»ºå’Œä½¿ç”¨åˆ†ç¦» æ‰©å±•æ€§å¥½ã€å»ºé€ ç±»ä¹‹é—´ç‹¬ç«‹ã€ä¸€å®šç¨‹åº¦ä¸Šè§£è€¦ ç¼ºç‚¹ äº§ç”Ÿå¤šä½™çš„Builderå¯¹è±¡ äº§å“å†…éƒ¨å‘ç”Ÿå˜åŒ–ï¼Œå»ºé€ è€…éƒ½éœ€è¦ä¿®æ”¹ï¼Œæˆæœ¬è¾ƒå¤§ å»ºé€ è€…æ¨¡å¼å’Œå·¥å‚æ¨¡å¼æ¯”è¾ƒ å»ºé€ è€…æ¨¡å¼æ›´æ³¨é‡æ–¹æ³•çš„è°ƒç”¨é¡ºåºï¼Œè€Œå·¥å‚æ¨¡å¼æ›´æ³¨é‡ç”Ÿäº§äº§å“ åˆ›å»ºå¯¹è±¡çš„ç²’åº¦ä¸åŒï¼Œå»ºé€ è€…æ¨¡å¼å¯ä»¥åˆ›å»ºå¤æ‚çš„äº§å“ï¼Œæœ‰å„ç§å¤æ‚çš„éƒ¨ä»¶ç»„æˆã€‚è€Œå·¥ç¨‹æ¨¡å¼åˆ›å»ºå‡ºæ¥çš„éƒ½å‡ ä¹ä¸€ä¸ªæ ·å­ å·¥å‚æ¨¡å¼æ³¨é‡æŠŠäº§å“åˆ›å»ºå‡ºæ¥ï¼Œè€Œå»ºé€ è€…ä¸ä»…è¦åˆ›å»ºå‡ºäº§å“ï¼Œè¿˜è¦çŸ¥é“äº§å“æœ‰å“ªäº›éƒ¨ä»¶ç»„æˆçš„ ç®€å•éœ€æ±‚è¯´æ˜ æœ‰ä¸€ä¸ªè¯¾ç¨‹éœ€è¦ä¸Šçº¿åœ¨ç½‘ç«™ï¼Œè¿™ä¸ªè¯¾ç¨‹éœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼šè¯¾ç¨‹åã€è¯¾ç¨‹çš„è¯¾ä»¶èµ„æºä»¥åŠè§†é¢‘èµ„æºï¼Œåªæœ‰è¿™ä¸ªä¸‰ä¸ªç»„ä»¶æœ‰äº† æ‰èƒ½ç»„è£…æˆä¸Šçº¿çš„è¯¾ç¨‹ã€‚è¿™é‡Œåœ¨åˆ›å»ºè¯¾æ—¶ï¼Œéœ€è¦æœ‰é¡ºåºçš„æ‰§è¡Œï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„è¯¾ç¨‹ã€‚ v1 é€šè¿‡ä¸­é—´ç±»å®ç°umlç±»å›¾ è¯¾ç¨‹ç±» 1234567891011121314151617181920212223242526package com.design.pattern.builder;import lombok.Data;/** * Course * * @author shunhua * @date 2019-09-11 */@Datapublic class Course &#123; /** * è¯¾ç¨‹å */ private String name; /** * è¯¾ç¨‹èµ„æ–™ */ private String source; /** * è¯¾ç¨‹è§†é¢‘ */ private String video;&#125; å»ºé€ è€…æŠ½è±¡ç±» 123456789101112131415161718192021222324252627282930313233package com.design.pattern.builder;/** * CourseBuilder * * @author shunhua * @date 2019-09-11 */public abstract class CourseBuilder &#123; /** * å»ºé€ è¯¾ç¨‹å * @param name */ public abstract void buildName(String name); /** * å»ºé€ è¯¾ç¨‹èµ„æ–™ * @param source */ public abstract void buildSource(String source); /** * å»ºé€ è¯¾ç¨‹è§†é¢‘ * @param video */ public abstract void buildVideo(String video); /** * æ„å»ºè¯¾ç¨‹ * @return */ public abstract Course buildCourse();&#125; å»ºé€ è€…å®ç°ç±» 1234567891011121314151617181920212223242526272829303132package com.design.pattern.builder;/** * ActualCourseBuilder çœŸæ­£çš„è¯¾ç¨‹åˆ›å»ºè€… * * @author shunhua * @date 2019-09-11 */public class ActualCourseBuilder extends CourseBuilder&#123; private Course course = new Course(); @Override public void buildName(String name) &#123; course.setName(name); &#125; @Override public void buildSource(String source) &#123; course.setSource(source); &#125; @Override public void buildVideo(String video) &#123; course.setVideo(video); &#125; @Override public Course buildCourse() &#123; return course; &#125;&#125; åŠ©æ•™ï¼ˆå¯¹è¯¾ç¨‹è¿›è¡Œç»„è£…ï¼‰ 12345678910111213141516171819202122232425262728293031package com.design.pattern.builder;/** * Assistant è¯¾ç¨‹åŠ©æ•™ * * @author shunhua * @date 2019-09-11 */public class Assistant &#123; private CourseBuilder courseBuilder; public void setCourseBuilder(CourseBuilder courseBuilder)&#123; this.courseBuilder = courseBuilder; &#125; /** * è¯¾ç¨‹åŠ©æ•™ ç»„è£…è¯¾ç¨‹ * @param name * @param source * @param video * @return */ public Course buildCourse(String name,String source,String video)&#123; this.courseBuilder.buildName(name); this.courseBuilder.buildSource(source); this.courseBuilder.buildVideo(video); return this.courseBuilder.buildCourse(); &#125;&#125; å®¢æˆ·ç«¯ 1234567891011121314151617181920212223package com.design.pattern.builder;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-11 */@Slf4jpublic class Client &#123; @Test public void test()&#123; CourseBuilder courseBuilder = new ActualCourseBuilder(); Assistant assistant = new Assistant(); assistant.setCourseBuilder(courseBuilder); Course course = assistant.buildCourse(\"Javaè¿›é˜¶\",\"ppt\",\"Javaè¿›é˜¶è§†é¢‘\"); log.info(course.toString()); &#125;&#125; v2 é™æ€å†…éƒ¨ç±»æ¼”ç»ƒå»ºé€ è€…æ¨¡å¼ï¼ˆé“¾å¼è°ƒç”¨ï¼‰umlç±»å›¾ 1é™æ€å†…éƒ¨ç±»builderæœ‰3ä¸ªå±æ€§ï¼Œè¯¾ç¨‹ç±»æœ‰ç›¸åŒçš„3ä¸ªå±æ€§ï¼Œé“¾å¼è°ƒç”¨çš„æ—¶å€™ï¼Œç»™builderå…¨éƒ¨æˆ–è€…éƒ¨åˆ†èµ‹å€¼ï¼Œbuildçš„æ—¶å€™ï¼ŒæŠŠbuilderå¯¹è±¡ä¼ é€åˆ°courseï¼Œcourseè·å–åˆ°builderçš„å±æ€§ï¼Œç„¶åè¿”å›è¿™ä¸ªcourseï¼› Courseç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374package com.design.pattern.builder.v2;import lombok.Data;/** * Course * * @author shunhua * @date 2019-09-11 */@Datapublic class Course &#123; /** * è¯¾ç¨‹å */ private String name; /** * è¯¾ç¨‹èµ„æ–™ */ private String source; /** * è¯¾ç¨‹è§†é¢‘ */ private String video; public Course(CourseBuilder courseBuilder)&#123; this.name = courseBuilder.name; this.source = courseBuilder.source; this.video = courseBuilder.video; &#125; /** * æŠŠå®ä½“ç±»ä¸å¯¹åº”çš„åˆ›å»ºç±»å†™åœ¨ä¸€èµ·ï¼Œè¿™ç§ä½¿ç”¨æ›´å¸¸è§,ä½¿ç”¨é“¾å¼è°ƒç”¨ */ public static class CourseBuilder &#123; /** * è¯¾ç¨‹å */ private String name; /** * è¯¾ç¨‹èµ„æ–™ */ private String source; /** * è¯¾ç¨‹è§†é¢‘ */ private String video; public CourseBuilder buildName(String name) &#123; this.name = name; return this; &#125; public CourseBuilder buildSource(String source) &#123; this.source = source; return this; &#125; public CourseBuilder buildVideo(String video) &#123; this.video = video; return this; &#125; /** * * @return */ public Course build()&#123; return new Course(this); &#125; &#125;&#125; å®¢æˆ·ç«¯ 1234567891011121314151617181920212223package com.design.pattern.builder.v2;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-11 */@Slf4jpublic class Client &#123; @Test public void test()&#123; Course course = new Course.CourseBuilder() .buildName(\"javaè¿›é˜¶\") .buildSource(\"pptè¯¾ä»¶\") .buildVideo(\"javaè¿›é˜¶è§†é¢‘\") .build(); log.info(course.toString()); &#125;&#125; å»ºé€ è€…æ¨¡å¼åœ¨æºç ä¸­çš„ä½¿ç”¨jdkçš„StringBuilderå’ŒStringBuffer12345678910111213// å¦‚StringBuilderçš„appendæ–¹æ³• @Override public StringBuilder append(String str) &#123; super.append(str); return this; &#125;// å¦‚StringBufferçš„appendæ–¹æ³• @Override public synchronized StringBuffer append(String str) &#123; toStringCache = null; super.append(str); return this; &#125; MyBatisçš„SqlSessionFactoryBuilder1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253 public SqlSessionFactory build(InputStream inputStream, String environment, Properties properties) &#123; try &#123; // XMLé…ç½®çš„builder æ¥åˆ›å»º Configuration XMLConfigBuilder parser = new XMLConfigBuilder(inputStream, environment, properties); // parseæ–¹æ³•åˆ›å»ºConfiguration ï¼ŒSqlSessionFactoryBuilderçš„buildæ–¹æ³•åˆ›å»ºSqlSessionFactory return build(parser.parse()); &#125; catch (Exception e) &#123; throw ExceptionFactory.wrapException(\"Error building SqlSession.\", e); &#125; finally &#123; ErrorContext.instance().reset(); try &#123; inputStream.close(); &#125; catch (IOException e) &#123; // Intentionally ignore. Prefer previous error. &#125; &#125; &#125; // public SqlSessionFactory build(Configuration config) &#123; return new DefaultSqlSessionFactory(config); &#125; // XMLConfigBuilder#parse public Configuration parse() &#123; if (parsed) &#123; throw new BuilderException(\"Each XMLConfigBuilder can only be used once.\"); &#125; parsed = true; parseConfiguration(parser.evalNode(\"/configuration\")); return configuration; &#125; private void parseConfiguration(XNode root) &#123; try &#123; Properties settings = settingsAsPropertiess(root.evalNode(\"settings\")); //issue #117 read properties first propertiesElement(root.evalNode(\"properties\")); loadCustomVfs(settings); typeAliasesElement(root.evalNode(\"typeAliases\")); pluginElement(root.evalNode(\"plugins\")); objectFactoryElement(root.evalNode(\"objectFactory\")); objectWrapperFactoryElement(root.evalNode(\"objectWrapperFactory\")); reflectorFactoryElement(root.evalNode(\"reflectorFactory\")); settingsElement(settings); // read it after objectFactory and objectWrapperFactory issue #631 environmentsElement(root.evalNode(\"environments\")); databaseIdProviderElement(root.evalNode(\"databaseIdProvider\")); typeHandlerElement(root.evalNode(\"typeHandlers\")); mapperElement(root.evalNode(\"mappers\")); &#125; catch (Exception e) &#123; throw new BuilderException(\"Error parsing SQL Mapper Configuration. Cause: \" + e, e); &#125; &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"æŠ½è±¡å·¥å‚","slug":"design_pattern/creation_type/æŠ½è±¡å·¥å‚","date":"2019-09-09T16:00:00.000Z","updated":"2020-07-04T16:28:45.965Z","comments":true,"path":"posts/df11d265/","link":"","permalink":"https://gentryhuang.com/posts/df11d265/","excerpt":"","text":"å®šä¹‰ æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„çš„æ¥å£ã€‚æ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ã€‚ ç±»å‹ åˆ›å»ºå‹ ä½¿ç”¨åœºæ™¯ å®¢æˆ·ç«¯ï¼ˆåº”ç”¨å±‚ï¼‰ä¸ä¾èµ–äºäº§å“å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€å®ç°ç­‰ç»†èŠ‚ å¼ºè°ƒä¸€ç³»åˆ—ç›¸å…³çš„äº§å“å¯¹è±¡ï¼ˆå±äºåŒä¸€äº§å“æ—ï¼‰ä¸€èµ·ä½¿ç”¨åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡é‡å¤çš„ä»£ç  æä¾›ä¸€ä¸ªäº§å“ç±»çš„åº“ï¼Œæ‰€æœ‰çš„äº§å“ä»¥åŒæ ·çš„æ¥å£å‡ºç°ï¼Œä»è€Œä½¿å®¢æˆ·ç«¯ä¸ä¾èµ–äºå…·ä½“å®ç°ã€‚ ä¼˜ç‚¹ åº”ç”¨å±‚ä»£ç ä¸å’Œå…·ä½“çš„äº§å“å‘ç”Ÿä¾èµ–ï¼Œåªå’Œå…·ä½“çš„äº§å“æ—å·¥å‚å‘ç”Ÿä¾èµ–å…³ç³»ï¼Œä½è€¦åˆï¼Œé«˜å†…èš ä»å…·ä½“çš„äº§å“å·¥å‚å–å‡ºæ¥çš„è‚¯å®šæ˜¯åŒä¸€äº§å“æ—ï¼Œå¼€å‘çš„æ—¶å€™é€»è¾‘æ¸…æ™° å¯¹äºäº§å“æ—æ¥è¯´ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ï¼Œå¢åŠ æ–°çš„äº§å“æ—çš„æ—¶å€™ï¼Œå¯¹æ‰©å±•å¼€æ”¾ç¼ºç‚¹è§„å®šäº†æ‰€æœ‰å¯èƒ½è¢«åˆ›å»ºçš„äº§å“é›†åˆï¼Œäº§å“æ—ä¸­æ‰©å±•æ–°çš„äº§å“å›°éš¾ï¼Œéœ€è¦ä¿®æ”¹æŠ½è±¡å·¥ç¨‹çš„æ¥å£ã€‚å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ã€‚ ä¸ºä½•æœ‰äº§å“æ—çš„ä¸šåŠ¡åœºæ™¯å®œç”¨æŠ½è±¡å·¥å‚è®¾è®¡æ¨¡å¼ï¼Ÿè€Œä¸æ˜¯å·¥å‚è®¾è®¡æ¨¡å¼å¦‚æœä½¿ç”¨å·¥å‚è®¾è®¡æ¨¡å¼ï¼Œå¯èƒ½ä¼šå› ä¸ºå·¥å‚ç±»å¤ªå¤šè€Œäº§ç”Ÿç±»çˆ†ç‚¸çš„ç°è±¡äº§å“æ—å’Œäº§å“ç­‰çº§ å·¥å‚æ–¹æ³•é’ˆå¯¹çš„å°±æ˜¯äº§å“ç­‰çº§ç»“æ„ï¼Œå®ƒå¤„ç†çš„å°±æ˜¯åŒä¸€ç±»å‹äº§å“ï¼ˆå¦‚ï¼šäº§å“ç±»å‹éƒ½æ˜¯å†°ç®±ä½†æ˜¯æœ‰ä¸åŒå“ç‰Œï¼‰ æŠ½è±¡å·¥å‚é’ˆå¯¹çš„å°±æ˜¯äº§å“æ—ï¼Œå®ƒå¤„ç†çš„å°±æ˜¯ä¸€ç³»åˆ—äº§å“ï¼ˆå¦‚ï¼šæµ·å°”æ——ä¸‹ä¸åŒçš„äº§å“ï¼‰ ç®€å•åœºæ™¯è¯´æ˜ ä¸€ä¸ªè¯¾ç¨‹ä¸ä»…è¦æœ‰è§†é¢‘èµ„æ–™ï¼Œè¿˜éœ€è¦æœ‰å¯¹åº”çš„ç¬”è®°,è¿™æ ·ä¸¤è€…éƒ½å­˜åœ¨æ‰æ˜¯ä¸€é—¨è¯¾ç¨‹ã€‚ æŠ½è±¡å·¥å‚æ¼”ç»ƒ ç¬”è®° 1234567891011121314package com.design.pattern.abstractfactory;/** * Article * * @author shunhua * @date 2019-09-10 */public abstract class Article &#123; /** * ç”Ÿäº§ç¬”è®°çš„æ–¹æ³• */ public abstract void produce();&#125; javaç¬”è®° 123456789101112131415161718package com.design.pattern.abstractfactory;import lombok.extern.slf4j.Slf4j;/** * JavaArticle * * @author shunhua * @date 2019-09-10 */@Slf4jpublic class JavaArticle extends Article &#123; @Override public void produce() &#123; log.info(\"ç”Ÿäº§Javaç¬”è®°\"); &#125;&#125; pythonç¬”è®° 123456789101112131415161718package com.design.pattern.abstractfactory;import lombok.extern.slf4j.Slf4j;/** * PythonArticle * * @author shunhua * @date 2019-09-10 */@Slf4jpublic class PythonArticle extends Article &#123; @Override public void produce() &#123; log.info(\"ç”Ÿäº§pythonç¬”è®°\"); &#125;&#125; è§†é¢‘èµ„æº 1234567891011121314package com.design.pattern.abstractfactory;/** * Video * * @author shunhua * @date 2019-09-10 */public abstract class Video &#123; /** * ç”Ÿäº§è§†é¢‘çš„æŠ½è±¡æ–¹æ³• */ public abstract void produce();&#125; Javaè§†é¢‘èµ„æº 123456789101112131415161718package com.design.pattern.abstractfactory;import lombok.extern.slf4j.Slf4j;/** * JavaVideo * * @author shunhua * @date 2019-09-10 */@Slf4jpublic class JavaVideo extends Video &#123; @Override public void produce() &#123; log.info(\"ç”ŸæˆJavaè§†é¢‘èµ„æº\"); &#125;&#125; pythonè§†é¢‘èµ„æº 123456789101112131415161718package com.design.pattern.abstractfactory;import lombok.extern.slf4j.Slf4j;/** * PythonVideo * * @author shunhua * @date 2019-09-10 */@Slf4jpublic class PythonVideo extends Video &#123; @Override public void produce() &#123; log.info(\"ç”Ÿäº§pythonè§†é¢‘\"); &#125;&#125; è¯¾ç¨‹å·¥å‚ï¼ˆäº§å“æ—å·¥å‚ï¼‰ 1234567891011121314151617181920package com.design.pattern.abstractfactory;/** * CourseFactory * * @author shunhua * @date 2019-09-10 */public interface CourseFactory &#123; /** * ç”Ÿäº§è§†é¢‘ * @return */ Video getVideo(); /** * ç”Ÿäº§ç¬”è®° * @return */ Article getArticle();&#125; Javaè¯¾ç¨‹å·¥å‚ 1234567891011121314151617181920package com.design.pattern.abstractfactory;/** * JavaCourseFactory * * @author shunhua * @date 2019-09-10 */public class JavaCourseFactory implements CourseFactory &#123; @Override public Video getVideo() &#123; return new JavaVideo(); &#125; @Override public Article getArticle() &#123; return new JavaArticle(); &#125;&#125; Pythonè¯¾ç¨‹å·¥å‚ 1234567891011121314151617181920package com.design.pattern.abstractfactory;/** * PythonCourseFactory * * @author shunhua * @date 2019-09-10 */public class PythonCourseFactory implements CourseFactory&#123; @Override public Video getVideo() &#123; return new PythonVideo(); &#125; @Override public Article getArticle() &#123; return new PythonArticle(); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.design.pattern.abstractfactory;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-10 */public class Client &#123; @Test public void test()&#123; CourseFactory courseFactory = new JavaCourseFactory(); Video video = courseFactory.getVideo(); Article article = courseFactory.getArticle(); video.produce(); article.produce(); &#125;&#125;``` ## æŠ½è±¡å·¥å‚åœ¨æºç ä¸­çš„ä½¿ç”¨### è¿æ¥æºç è§£æ**Connectionçš„ä¸¤ä¸ªæ–¹æ³•å±æ€§åŒä¸€ä¸ªäº§å“æ—ï¼Œè¿™æ˜¯ä¸€ä¸ªçˆ¶ç±»**```java// mysqlå’Œoracleè·å–çš„æ˜¯åŒä¸€äº§å“æ—ä¸‹çš„statementå’ŒåŒä¸€äº§å“æ—ä¸‹çš„preparestatementpublic interface Connection extends Wrapper, AutoCloseable &#123; Statement createStatement() throws SQLException; PreparedStatement prepareStatement(String sql) throws SQLException; // ... &#125; // executeQueryæ–¹æ³•å’ŒexecureUpdateæ–¹æ³•å±äºåŒä¸€ä¸ªäº§å“æ—public interface Statement extends Wrapper, AutoCloseable &#123; ResultSet executeQuery(String sql) throws SQLException; int executeUpdate(String sql) throws SQLException; &#125; MyBatisçš„SqlSessionæºç è§£æjava.sql.Connection/java.sql.Statement/org.apache.ibatis.session.SqlSessionFactoryç­‰ æ¥å£å°±æ˜¯ä¸€ä¸ªæŠ½è±¡å·¥å‚ï¼ˆä»åŒä¸€ä¸ªæŠ½è±¡å·¥å‚ä¸­è¿”å›çš„äº§å“ä¸€å®šå±äºåŒä¸€ä¸ªäº§å“æ—ï¼‰å®ƒé‡Œé¢æœ‰å¤šä¸ªå·¥å‚æ–¹æ³•ï¼Œå®ƒçš„å®ç°ç±»é€šè¿‡å®ç°ä¸åŒçš„å·¥å‚æ–¹æ³•ï¼Œæ¥åˆ›å»ºå‡ºä¸åŒçš„äº§å“ã€‚ SqlSessionFactory 12345678910111213141516171819202122232425package org.apache.ibatis.session;import java.sql.Connection;/** * Creates an &#123;@link SqlSession&#125; out of a connection or a DataSource * * @author Clinton Begin */public interface SqlSessionFactory &#123; SqlSession openSession(); SqlSession openSession(boolean autoCommit); SqlSession openSession(Connection connection); SqlSession openSession(TransactionIsolationLevel level); SqlSession openSession(ExecutorType execType); SqlSession openSession(ExecutorType execType, boolean autoCommit); SqlSession openSession(ExecutorType execType, TransactionIsolationLevel level); SqlSession openSession(ExecutorType execType, Connection connection); Configuration getConfiguration();&#125; SqlSessionFactoryå­ç±» SqlSessionManagerSqlSessionFactoryå­ç±» DefaultSqlSessionFactory","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å·¥å‚æ–¹æ³•","slug":"design_pattern/creation_type/å·¥å‚æ–¹æ³•","date":"2019-09-08T16:00:00.000Z","updated":"2020-07-04T14:26:53.332Z","comments":true,"path":"posts/a778ad08/","link":"","permalink":"https://gentryhuang.com/posts/a778ad08/","excerpt":"","text":"å®šä¹‰ å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼ˆæŠ½è±¡æ–¹æ³•ï¼‰ï¼Œè®©å®ç°è¿™ä¸ªæ¥å£çš„ç±»ï¼ˆå®ç°æŠ½è±¡æ–¹æ³•ï¼‰æ¥å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ï¼Œå·¥å‚æ–¹æ³•è®©ç±»çš„å®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»ä¸­è¿›è¡Œï¼Œå³é€šè¿‡å­ç±»å®ç°æŠ½è±¡æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚ å·¥å‚æ–¹æ³•å°±æ˜¯ç”¨æ¥è§£å†³åŒä¸€äº§å“ç­‰çº§çš„ä¸šåŠ¡æŠ½è±¡é—®é¢˜ã€‚å·¥å‚åˆ›å»ºå¯¹è±¡ç”¨çš„ï¼Œæ–¹æ³•é€šè¿‡å­ç±»å®ç°æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚ ç±»å‹ åˆ›å»ºå‹ ä½¿ç”¨åœºæ™¯ åˆ›å»ºå¯¹è±¡éœ€è¦å¤§é‡çš„é‡å¤ä»£ç  å®¢æˆ·ç«¯ï¼ˆåº”ç”¨å±‚ï¼‰ä¸ä¾èµ–äºäº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€å®ç°ç­‰ç»†èŠ‚ ä¸€ä¸ªç±»é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå“ªä¸ªå¯¹è±¡ä¼˜ç‚¹ç”¨æˆ·åªéœ€è¦å…³å¿ƒæ‰€éœ€äº§å“å¯¹åº”çš„å·¥å‚ï¼Œæ— é¡»å…³å¿ƒåˆ›å»ºç»†èŠ‚ã€‚åŠ å…¥æ–°çš„äº§å“ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæé«˜äº†å¯æ‰©å±•æ€§ã€‚ç¼ºç‚¹å®ç°ç±»çš„ä¸ªæ•°å®¹æ˜“è¿‡å¤šï¼ˆå¢åŠ æ–°äº§å“çš„æ—¶å€™ï¼Œä¸ä»…éœ€è¦ç¼–å†™æ–°çš„äº§å“ç±»è¿˜éœ€è¦ç¼–å†™å¯¹åº”çš„å·¥å‚ç±»ï¼Œå› æ­¤ç±»çš„ä¸ªæ•°å¢åŠ ï¼‰ã€å¢åŠ å¤æ‚åº¦ã€‚å·¥å‚æ–¹æ³•æœ¬èº«ä½¿ç”¨äº†æŠ½è±¡ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥æŠ½è±¡å±‚ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€åˆ›å»ºå¯èƒ½è¿˜ä¼šä½¿ç”¨åå°„æŠ€æœ¯ï¼Œè¿™éƒ½å¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦äº§å“ç­‰çº§å’Œäº§å“æ— å·¥å‚æ–¹æ³•æ˜¯ä¸ºäº†å†³ç»åŒä¸€äº§å“ç­‰çº§çš„ä¸šåŠ¡æŠ½è±¡é—®é¢˜ï¼ŒæŠ½è±¡å·¥å‚æ˜¯ä¸ºäº†è§£å†³åŒä»¥äº§å“æ—çš„é—®é¢˜ äº§å“ç­‰çº§ç›¸åŒç±»å‹çš„äº§å“ä¸ºåŒä¸€äº§å“ç­‰çº§ï¼Œå¦‚ï¼šæ±½è½¦æœ‰å¤§ä¼—ã€é•¿å®‰ã€å¥¥è¿ªç­‰ï¼Œå®ƒä»¬å±äºåŒä¸€äº§å“ç­‰çº§ äº§å“æ—ä¸åŒç±»å‹çš„äº§å“ï¼Œå¦‚é•¿å®‰æ±½è½¦ã€é•¿å®‰æ‘©æ‰˜ã€é•¿å®‰è‡ªè¡Œè½¦ å·¥å‚æ–¹æ³•æ¼”ç»ƒ Foodç±» 1234567891011121314package com.design.pattern.factorymethod;/** * ç›¸åŒç±»å‹çš„äº§å“å±äºåŒä¸€äº§å“ç­‰çº§ï¼Œæ— è®ºæ˜¯é¢åŒ…è¿˜æ˜¯æ²™æ‹‰ï¼Œå®ƒä»¬éƒ½æ˜¯åŒä¸€ä¸ªç­‰çº§ï¼Œè¿™é‡Œæ˜¯Food * * @author shunhua * @date 2019-09-09 */public abstract class Food &#123; /** * ç”Ÿäº§äº§å“æ–¹æ³• */ public abstract void produce();&#125; é¢åŒ…ç±» 123456789101112131415161718192021package com.design.pattern.factorymethod;import lombok.Data;import lombok.ToString;import lombok.extern.slf4j.Slf4j;/** * Bread * * @author shunhua * @date 2019-09-09 */@Slf4j@ToStringpublic class Bread extends Food &#123; @Override public void produce() &#123; log.info(\"ç”Ÿäº§é¢åŒ…!\"); &#125;&#125; æ²™æ‹‰ç±» 1234567891011121314151617181920package com.design.pattern.factorymethod;import lombok.ToString;import lombok.extern.slf4j.Slf4j;/** * Salad * * @author shunhua * @date 2019-09-09 */@Slf4j@ToStringpublic class Salad extends Food &#123; @Override public void produce() &#123; log.info(\"ç”Ÿæˆæ²™æ‹‰!\"); &#125;&#125; æŠ½è±¡å·¥å‚ 123456789101112131415package com.design.pattern.factorymethod;/** * å·¥å‚æ–¹æ³•,å­ç±»ç»§æ‰¿å³å¯ * è¿™é‡Œä½¿ç”¨æŠ½è±¡ç±»ä¸»è¦è€ƒè™‘åˆ°åœ¨ç±»ä¸­æœ‰äº›æ˜¯å·²çŸ¥çš„ï¼Œä½¿ç”¨æŠ½è±¡ç±»åˆé€‚ã€‚å¦‚æœå…¨éƒ½æ˜¯æœªçŸ¥çš„ä½¿ç”¨æ¥å£æ¯”è¾ƒåˆé€‚ã€‚ * @author shunhua * @date 2019-09-09 */public abstract class FoodFactory &#123; /** * å·¥å‚æ–¹æ³•ï¼Œèµ·åˆ°è§„çº¦çš„ä½œç”¨ï¼Œå¹¶ä¸ç”Ÿäº§å…·ä½“çš„äº§å“ï¼Œå…·ä½“äº§å“çš„ç”Ÿæˆç”±å…¶å®ç°å®Œæˆ * @return */ public abstract Food createFood();&#125; å­å·¥å‚ç±»-é¢åŒ…å·¥å‚ 12345678910111213141516171819package com.design.pattern.factorymethod;/** * BreadFactory åªç”Ÿäº§Bread * * @author shunhua * @date 2019-09-10 */public class BreadFactory extends FoodFactory &#123; /** * ç”Ÿäº§é¢åŒ…çš„å·¥å‚æ–¹æ³• * @return */ @Override public Food createFood() &#123; return new Bread(); &#125;&#125; å­å·¥å‚ç±»-æ²™æ‹‰å·¥å‚ 123456789101112131415161718package com.design.pattern.factorymethod;/** * SaladFactory åªç”Ÿäº§Salad * * @author shunhua * @date 2019-09-10 */public class SaladFactory extends FoodFactory &#123; /** * ç”Ÿäº§é¢åŒ…çš„å·¥å‚æ–¹æ³• * @return */ @Override public Food createFood() &#123; return new Salad(); &#125;&#125; å®¢æˆ·ç«¯ 12345678910111213141516171819202122232425262728package com.design.pattern.factorymethod;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-10 */@Slf4jpublic class Client &#123; @Test public void test()&#123; // é¢åŒ…å·¥å‚æ–¹æ³• FoodFactory breadFactory = new BreadFactory(); Food bread = breadFactory.createFood(); log.info(String.valueOf(bread)); // æ²™æ‹‰å·¥å‚æ–¹æ³• FoodFactory saladFactory = new SaladFactory(); Food salad = saladFactory.createFood(); log.info(String.valueOf(salad)); &#125;&#125; å·¥å‚æ–¹æ³•åœ¨æºç ä¸­çš„ä½¿ç”¨Collectionçš„Iteratorè§£æCollectionæ¥å£ç›¸å½“äºæŠ½è±¡å·¥å‚ï¼ˆå› ä¸ºå®ƒå¤„ç†çš„æ˜¯ç­‰çº§ç»„é—®é¢˜å³å¤šä¸ªç±»å‹çš„äº§å“ï¼‰ï¼Œå…¶ä¸­å®ƒé‡Œé¢çš„Iterator iterator()æ–¹æ³•ç›¸å½“äºå·¥å‚æ–¹æ³•ã€‚ArrayListå®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸ºArrayListç”Ÿäº§Itrï¼ŒItræ˜¯Iteratorç±»å‹ã€‚è¿˜æœ‰ILoggerFactoryå’ŒLoggeräº§å“æ—å¯¹åº”çš„å·¥å‚æ–¹æ³•çš„ä½¿ç”¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970public Iterator&lt;E&gt; iterator() &#123; return new Itr(); &#125; /** * An optimized version of AbstractList.Itr */ private class Itr implements Iterator&lt;E&gt; &#123; int cursor; // index of next element to return int lastRet = -1; // index of last element returned; -1 if no such int expectedModCount = modCount; public boolean hasNext() &#123; return cursor != size; &#125; @SuppressWarnings(\"unchecked\") public E next() &#123; checkForComodification(); int i = cursor; if (i &gt;= size) throw new NoSuchElementException(); Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) throw new ConcurrentModificationException(); cursor = i + 1; return (E) elementData[lastRet = i]; &#125; public void remove() &#123; if (lastRet &lt; 0) throw new IllegalStateException(); checkForComodification(); try &#123; ArrayList.this.remove(lastRet); cursor = lastRet; lastRet = -1; expectedModCount = modCount; &#125; catch (IndexOutOfBoundsException ex) &#123; throw new ConcurrentModificationException(); &#125; &#125; @Override @SuppressWarnings(\"unchecked\") public void forEachRemaining(Consumer&lt;? super E&gt; consumer) &#123; Objects.requireNonNull(consumer); final int size = ArrayList.this.size; int i = cursor; if (i &gt;= size) &#123; return; &#125; final Object[] elementData = ArrayList.this.elementData; if (i &gt;= elementData.length) &#123; throw new ConcurrentModificationException(); &#125; while (i != size &amp;&amp; modCount == expectedModCount) &#123; consumer.accept((E) elementData[i++]); &#125; // update once at end of iteration to reduce heap write traffic cursor = i; lastRet = i - 1; checkForComodification(); &#125; final void checkForComodification() &#123; if (modCount != expectedModCount) throw new ConcurrentModificationException(); &#125; &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"åˆæˆå¤ç”¨åŸåˆ™","slug":"design_pattern/principle/åˆæˆå¤ç”¨åŸåˆ™","date":"2019-09-04T16:00:00.000Z","updated":"2020-07-04T13:42:18.872Z","comments":true,"path":"posts/b91a199d/","link":"","permalink":"https://gentryhuang.com/posts/b91a199d/","excerpt":"","text":"ç»§æ‰¿å…³ç³»çš„é€‰æ‹© ç»§æ‰¿å…³ç³»æ˜¯is açš„å…³ç³»ï¼Œæ‰€ä»¥çœ‹æ˜¯å¦æœ‰ç»§æ‰¿å…³ç³»ï¼Œé€šå¸¸è¦çœ‹å­ç±»å’Œçˆ¶ç±»å…±ç”¨çš„æ–¹æ³•ï¼Œå­ç±»æ˜¯å¦èƒ½å¤Ÿå®ç°çˆ¶ç±»çš„æ–¹æ³• èµ·å åˆæˆå¤ç”¨åŸåˆ™ï¼Œç»„åˆå¤ç”¨åŸåˆ™ï¼Œèšåˆå¤ç”¨åŸåˆ™ å®šä¹‰ å°½é‡ä½¿ç”¨ç»„åˆï¼Œèšåˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿å…³ç³»è¾¾åˆ°å¤ç”¨è½¯ä»¶çš„ç›®çš„ ç»„åˆèšåˆï¼ˆé»‘ç®±å¤ç”¨ï¼‰ ä¼˜ç‚¹é™ä½è€¦åˆï¼Œæé«˜ç³»ç»Ÿçš„çµæ´»æ€§ã€‚ä½¿ä¸€ä¸ªç±»çš„å˜åŒ–å¯¹å…¶ä»–ç±»é€ æˆçš„å½±å“è¾ƒå° ç¼ºç‚¹ä¼šç”Ÿæˆè¾ƒå¤šçš„å¯¹è±¡è¿›è¡Œç®¡ç† ç»§æ‰¿ï¼ˆç™½ç®±å¤ç”¨ï¼‰ ä¼˜ç‚¹æ–°çš„æ‰©å±•æ€§å®¹æ˜“å®ç°ï¼Œä¿®æ”¹å’Œæ‰©å±•ç›¸å¯¹å®¹æ˜“ ç¼ºç‚¹çˆ¶ç±»çš„æ–¹æ³•ä¾µå…¥æ€§çš„å¸¦ç»™å­ç±»ï¼Œçˆ¶ç±»æ–¹æ³•çš„æ”¹å˜ï¼Œå­ç±»ä¹Ÿå¿…é¡»æ”¹å˜ï¼Œç›¸æ¯”è€¦åˆè¾ƒé«˜ ç»„åˆèšåˆåŒºåˆ«å…³ç³»å¼ºå¼±ï¼Œç»„åˆå¼ºï¼Œèšåˆå¼±","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"é‡Œæ°æ›¿æ¢åŸåˆ™","slug":"design_pattern/principle/é‡Œæ°æ›¿æ¢åŸåˆ™","date":"2019-09-03T16:00:00.000Z","updated":"2020-07-04T13:42:18.873Z","comments":true,"path":"posts/3d1cbe69/","link":"","permalink":"https://gentryhuang.com/posts/3d1cbe69/","excerpt":"","text":"å®šä¹‰ å¦‚æœå¯¹æ¯ä¸€ä¸ªç±»å‹ä¸ºT1çš„å¯¹è±¡o1ï¼Œéƒ½æœ‰ç±»å‹ä¸ºT2çš„å¯¹è±¡o2ï¼Œä½¿å¾—ä»¥T1å®šä¹‰çš„æ‰€æœ‰ç¨‹åºPåœ¨æ‰€æœ‰çš„å¯¹è±¡o1éƒ½æ›¿æ¢æˆo2æ—¶ï¼Œç¨‹åºPçš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹T2æ˜¯ç±»å‹T1çš„å­ç±»å‹ã€‚ å®šä¹‰æ‰©å±• ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚æœé€‚ç”¨ä¸€ä¸ªçˆ¶ç±»çš„è¯ï¼Œé‚£ä¸€å®šé€‚ç”¨äºå…¶å­ç±»ï¼Œæ‰€æœ‰å¼•ç”¨çˆ¶ç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ï¼Œå­ç±»å¯¹è±¡èƒ½å¤Ÿæ›¿æ¢çˆ¶ç±»å¯¹è±¡ï¼Œè€Œç¨‹åºé€»è¾‘ä¸å˜ã€‚ï¼ˆåå¯¹å­ç±»é‡å†™çˆ¶ç±»ï¼‰ ç‰¹ç‚¹123456789â—†å¼•ç”³æ„ä¹‰ï¼šå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚â—†å«ä¹‰1ï¼šå­ç±»å¯ä»¥å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸èƒ½è¦†ç›–çˆ¶ç±»çš„éæŠ½è±¡æ–¹æ³•ã€‚â—†å«ä¹‰2ï¼šå­ç±»ä¸­å¯ä»¥å¢åŠ è‡ªå·±ç‰¹æœ‰çš„æ–¹æ³•ã€‚â—†å«ä¹‰3ï¼šå½“å­ç±»çš„æ–¹æ³•é‡è½½çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•çš„å‰ç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å…¥&#x2F;å…¥å‚ï¼‰è¦æ¯”çˆ¶ç±»æ–¹æ³•çš„è¾“å…¥å‚æ•°æ›´å®½æ¾ã€‚ï¼ˆå…¥å‚å®½æ¾ï¼‰â—†å«ä¹‰4ï¼šå½“å­ç±»çš„æ–¹æ³•å®ç°çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼ˆé‡å†™&#x2F;é‡è½½æˆ–å®ç°æŠ½è±¡æ–¹æ³•ï¼‰ï¼Œæ–¹æ³•çš„åç½®æ¡ä»¶ï¼ˆå³æ–¹æ³•çš„è¾“å‡º&#x2F;è¿”å›å€¼ï¼‰è¦æ¯”çˆ¶ç±»æ›´ä¸¥æ ¼æˆ–ç›¸ç­‰ã€‚ï¼ˆå‡ºå‚ä¸¥è°¨ï¼‰ï¼ˆå‰ä¸¤æ¡ï¼Œçº¦å®šå­ç±»æœ€å¥½ä¸è¦é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¦‚æœä¸€å®šè¦é‡å†™çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ç»„åˆèšåˆç­‰æ–¹æ³•å®ç°ï¼‰ï¼ˆåä¸¤æ¡,çº¦å®šäº†å­å•Šé‡è½½æˆ–å®ç°çˆ¶ç±»æ–¹æ³•çš„æ¡ä»¶ï¼‰ ä¼˜ç‚¹ çº¦æŸäº†ç»§æ‰¿æ³›æ»¥ï¼Œå¾ˆå¤šéå­ç±»çˆ¶ç±»å…³ç³»çš„ç±»ï¼Œæ²¡å¿…è¦ä½¿ç”¨ç»§æ‰¿å…³ç³» åŠ å¼ºç¨‹åºçš„å¯ç»´æŠ¤æ€§ï¼Œé™ä½éœ€æ±‚å˜æ›´æ—¶å¼•èµ·çš„é£é™© codingé‡Œæ°æ›¿æ¢åŸåˆ™ç»§æ‰¿å…³ç³»åˆ¤åˆ«ï¼ˆæ˜¯å¦æ˜¯çœŸæ­£æ„ä¹‰çš„ç»§æ‰¿ï¼‰1å­ç±»è¡Œä¸ºè§„åˆ™åº”ä¸çˆ¶ç±»è¡Œä¸ºè§„åˆ™ä¸€è‡´ï¼Œå¦‚æœå­ç±»è¾¾ä¸åˆ°è¿™ä¸€ç‚¹ï¼Œåˆ™ä¼šè¿èƒŒé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œè¿èƒŒé‡Œæ°æ›¿æ¢åŸåˆ™ä¼šæ€æ ·ï¼Ÿç»§æ‰¿é€»è¾‘æ··ä¹±ï¼Œä»£ç ä¸ä¾¿äºç»´æŠ¤ å…¥å‚æ§åˆ¶1é‡è½½çš„æ—¶å€™å…¥å‚è¦æ›´åŠ å®½æ¾ï¼Œå¯ä»¥ä¸å¼•èµ·é€»è¾‘æ··ä¹± çˆ¶ç±» 1234567import java.util.HashMap;public class Base &#123; public void method(HashMap hashMap)&#123; System.out.println(\"æ‰§è¡Œçˆ¶ç±»HashMapæ–¹æ³•\"); &#125;&#125; å­ç±» 12345678910111213141516171819import java.util.HashMap;import java.util.Map;public class Child extends Base&#123; // @Override // public void method(HashMap hashMap) &#123; // System.out.println(\"æ‰§è¡Œå­ç±»çš„HashMapæ–¹æ³•\"); // &#125; /** * å­ç±»é‡è½½ * é‡è½½çš„æ—¶å€™å…¥å‚ Mapæ¯” Hashmapå®½æ¾ï¼Œæ­¤æ—¶æ‰§è¡Œçš„æ—¶å€™ä¼šæ‰§è¡Œçˆ¶ç±»ï¼Œä¸æ‰§è¡Œé‡è½½çš„ç±» * @param Map */ public void method(Map Map) &#123; System.out.println(\"æ‰§è¡Œå­ç±»Mapæ–¹æ³•\"); &#125;&#125; å‡ºå‚æ§åˆ¶1å­ç±»çš„å‡ºå‚å¦‚æœåŒ…å«çˆ¶ç±»ï¼Œä¼šç›´æ¥æŠ¥é”™ çˆ¶ç±» 12345678910111213package com.design.pattern.principle.liskovSubstitutation.outputmethod;import java.util.Map;/** * Base * * @author shunhua * @date 2019-09-15 */public abstract class Base &#123; public abstract Map method();&#125; å­ç±» 12345678910111213141516171819202122232425262728293031package com.design.pattern.principle.liskovSubstitutation.outputmethod;import java.util.HashMap;import java.util.Map;/** * Child * * @author shunhua * @date 2019-09-15 */public class Child extends Base &#123; /** * å­ç±»çš„å‡ºå‚å¦‚æœåŒ…å«çˆ¶ç±»ï¼Œä¼šç›´æ¥æŠ¥é”™ã€‚ * @return */ /* @Override public Object method() &#123; return null; &#125;*/ /** * çˆ¶ç±»çš„å‡ºå‚åŒ…å«å­ç±»çš„å‡ºå‚æ˜¯å¯ä»¥çš„ * @return */ @Override public HashMap method()&#123; return new HashMap(2); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"æ¥å£éš”ç¦»åŸåˆ™","slug":"design_pattern/principle/æ¥å£éš”ç¦»åŸåˆ™","date":"2019-09-02T16:00:00.000Z","updated":"2020-07-04T13:42:18.871Z","comments":true,"path":"posts/e0ec8882/","link":"","permalink":"https://gentryhuang.com/posts/e0ec8882/","excerpt":"","text":"å®šä¹‰ ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ã€‚ æ³¨æ„ç‚¹ ä¸€ä¸ªç±»å¯¹ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šï¼ˆè¿™é‡Œçš„ç±»æ˜¯æ³›æŒ‡ï¼Œä¹Ÿä»£è¡¨æ¥å£ï¼‰ã€‚ å»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿çš„æ¥å£ å°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ æ³¨æ„é€‚åº¦åŸåˆ™ï¼Œä¸€å®šè¦é€‚åº¦ï¼Œè™½ç„¶æ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ï¼Œä½†æ˜¯ä¹Ÿè¦æœ‰é™åº¦ã€‚ä¼˜ç‚¹ç¬¦åˆæˆ‘ä»¬å¸¸è¯´çš„é«˜å†…èšä½è€¦åˆçš„è®¾è®¡æ€æƒ³ï¼Œä»è€Œä½¿å¾—ç±»å…·æœ‰å¾ˆå¥½çš„å¯è¯»æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å’Œå•ä¸€èŒè´£åŸåˆ™æ¯”è¾ƒå•ä¸€èŒè´£åŸåˆ™æŒ‡çš„æ˜¯ç±»ã€æ¥å£å’Œæ–¹æ³•çš„èŒè´£æ˜¯å•ä¸€çš„ï¼Œå¼ºè°ƒçš„æ˜¯èŒè´£ï¼Œå¦‚æœèŒè´£æ˜¯å•ä¸€çš„é‚£ä¹ˆåœ¨ç±»æˆ–è€…æ¥å£ä¸­å…·æœ‰å¤šä¸ªæ–¹æ³•éƒ½æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ä¸€ç±»çš„ï¼Œæ¯”å¦‚å«å£°ï¼Œä¸åŒçš„åŠ¨ç‰©æœ‰ä¸åŒçš„å«ã€‚æ¥å£éš”ç¦»åŸåˆ™æ³¨é‡åœ°æ˜¯å¯¹æ¥å£ä¾èµ–çš„éš”ç¦»ã€‚ç®€å•éœ€æ±‚è¯´æ˜ä½¿ç”¨ç»Ÿä¸€çš„æ¥å£å®šä¹‰å¤šä¸ªåŠŸèƒ½çš„æ–¹æ³•ï¼Œä½†æ˜¯æœ‰çš„å®ç°ä¸ä¸€å®šä¼šå…¨éƒ¨ç”¨åˆ°ï¼Œæœ€å¥½æ˜¯å°†è¿™ä¸ªç»Ÿä¸€çš„æ¥å£æ ¹æ®ä¸åŒçš„ç»´åº¦è¿›è¡Œæ‹†åˆ†æˆå¤šä¸ªæ¥å£ï¼Œå®ç°æ ¹æ®éœ€è¦è¿›è¡Œæ¥å£çš„å®ç°ã€‚ codingæ¥å£éš”ç¦»åŸåˆ™åä¾‹æ¥å£ 12345public interface IAnimalAction &#123; void eat(); void fly(); void swim();&#125; ç‹—å®ç°ç±» 1234567891011121314151617181920public class DogCaseOne implements IAnimalAction&#123; @Override public void eat() &#123; &#125; /** * æ³¨ï¼šè¿™é‡Œæ˜¯ç©ºæ–¹æ³•ï¼Œç‹—ä¸ä¼šé£ï¼Œæ‰€ä»¥æ˜æ˜¾è®¾è®¡çš„ä¸åˆç†ï¼Œæœ€å¥½ä¸è¦æœ‰å¤ªå¤šçš„ç©ºæ–¹æ³• */ @Override public void fly() &#123; &#125; @Override public void swim() &#123; &#125;&#125; é¸Ÿå®ç°ç±» 12345678910111213141516171819public class LarkCaseOne implements IAnimalAction&#123; @Override public void eat() &#123; &#125; @Override public void fly() &#123; &#125; /** * å¾ˆæ˜æ˜¾ï¼Œç™¾çµé¸Ÿä¸ä¼šæ¸¸æ³³ï¼Œæ­¤å¤„ä¸ºç©ºæ–¹æ³•ï¼Œè®¾è®¡ä¸åˆç† */ @Override public void swim() &#123; &#125;&#125; æ¥å£éš”ç¦»åŸåˆ™æ­£ä¾‹åƒä¸œè¥¿æ¥å£ 123456public interface IEat&#123; /** * åƒä¸œè¥¿ */ void eat();&#125; é£ç¿”æ¥å£ 123456public interface IFly&#123; /** * é£ç¿” */ void fly();&#125; æ¸¸æ³³æ¥å£ 123456public interface ISwim&#123; /** * æ¸¸æ³³ */ void swim();&#125; ç‹—å®ç°ç±» 123456789101112131415/** * ç‹—åªç”¨å®ç° åƒå’Œæ¸¸æ³³æ–¹æ³•å³å¯ */@Slf4jpublic class DogCaseTwo implements IEat,ISwim&#123; @Override public void eat() &#123; log.info(\"ç‹—åƒä¸œè¥¿!\"); &#125; @Override public void swim() &#123; log.info(\"ç‹—æ¸¸æ³³\"); &#125;&#125; é¸Ÿå®ç°ç±» 123456789101112131415/** * é¸Ÿå®ç° åƒå’Œé£æ–¹æ³•å³å¯ */@Slf4jpublic class LarkCaseTwo implements IEat,IFly&#123; @Override public void eat() &#123; log.info(\"é¸Ÿåƒä¸œè¥¿\"); &#125; @Override public void fly() &#123; log.info(\"é¸Ÿé£ç¿”\"); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"è¿ªç±³ç‰¹æ³•åˆ™","slug":"design_pattern/principle/è¿ªç±³ç‰¹æ³•åˆ™","date":"2019-09-02T16:00:00.000Z","updated":"2020-07-04T13:42:18.870Z","comments":true,"path":"posts/ebdadec7/","link":"","permalink":"https://gentryhuang.com/posts/ebdadec7/","excerpt":"","text":"å®šä¹‰ è¿ªç±³ç‰¹æ³•åˆ™ä¹Ÿå«æœ€å°‘çŸ¥é“åŸåˆ™,ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ï¼ˆæ¯”å¦‚åŒ…çš„æƒé™ï¼Œä¿®é¥°çš„å…³é”®å­—ï¼‰ã€‚å°½é‡é™ä½ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆã€‚ ä¼˜ç‚¹ é™ä½ç±»ä¹‹é—´çš„è€¦åˆã€‚ å¼ºè°ƒ åªå…³å¿ƒå‡ºç°åœ¨æˆå‘˜å˜é‡ã€æ–¹æ³•çš„å…¥å‚å’Œå‡ºå‚ä¸­çš„ç±»ï¼Œä¸å…³å¿ƒæ–¹æ³•ä½“å†…éƒ¨çš„ç±»ã€‚ ç®€å•éœ€æ±‚è¯´æ˜ å…¬å¸è€æ¿æƒ³äº†è§£æŸä¸ªä¸šåŠ¡ç»„çš„é¡¹ç›®æƒ…å†µï¼Œè€æ¿ç›´æ¥æ‰¾åˆ°TeamLeaderï¼Œä¸éœ€è¦å…³å¿ƒé¡¹ç›®ç»„å…¶ä»–æˆå‘˜ã€‚è€ŒTeamLeaderéœ€è¦è®©ç»„å†… æŸä¸ªæˆå‘˜è¿›è¡Œæ•´ç†èµ„æ–™ï¼Œç„¶äº¤ç»™è‡ªå·±ï¼Œè‡ªå·±å†äº¤ç»™è€æ¿ã€‚ codingè¿ªç±³ç‰¹æ³•åˆ™åä¾‹è€æ¿ç±» 123456789101112131415161718import java.util.ArrayList;import java.util.List;/** * æ­¤å¤„è®¾è®¡ä¸åˆç†ï¼Œåªè®¿é—®æœ‹å‹ç±»ï¼ˆæˆå‘˜å˜é‡ä¸­çš„ç±»ï¼Œè¾“å…¥ä¸­å‡ºç°çš„ç±»ï¼Œè¾“å‡ºä¸­å‡ºç°çš„ç±»ï¼‰ * æˆå‘˜æ–¹æ³•ä¸­çš„ç±»ä¸éœ€è¦å¼•å…¥(Member) */public class Boss &#123; public void findMembers()&#123; TeamLeader leader = new TeamLeader(); List&lt;Member&gt; list = new ArrayList&lt;Member&gt;(); for(int i= 0;i&lt;10;i++)&#123; list.add(new Member()); &#125; leader.countMember(list); &#125;&#125; ä¸»ç®¡ç±» 12345678import java.util.List;@Slf4jpublic class TeamLeader &#123; public void countMember(List list)&#123; log.info(\"å½“å‰é¡¹ç›®ç»„çš„æˆå‘˜æ•°ï¼š\"+list.size()); &#125;&#125; é¡¹ç›®ç»„æˆå‘˜ç±» 12345678910111213public class Member &#123; // ..&#125;``` **åº”ç”¨ç±»**```javapublic class Client&#123; public static void main(String[] args)&#123; Boss boss = new Boss(); boss.findMembers(); &#125;&#125; è¿ªç±³ç‰¹æ³•åˆ™æ­£ä¾‹è€æ¿ç±» 1234567891011121314151617package com.design.pattern.principle.demeter;/** * Boss * * @author shunhua * @date 2019-09-03 */public class Boss &#123; /** * å¯¹Memberä¸éœ€è¦è§ï¼Œåªå…³å¿ƒTeamLeader * @param teamLeader */ public void findProject(TeamLeader teamLeader)&#123; teamLeader.findProject(); &#125;&#125; ä¸»ç®¡ç±» 1234567891011121314151617181920package com.design.pattern.principle.demeter;import lombok.extern.slf4j.Slf4j;/** * TeamLeader * * @author shunhua * @date 2019-09-03 */@Slf4jpublic class TeamLeader &#123; /** * å…³æ³¨Member */ public void findProject()&#123; Member member = new Member(); log.info(String.valueOf(member)); &#125;&#125; æˆå‘˜ç±» 1234567891011package com.design.pattern.principle.demeter;/** * Member * * @author shunhua * @date 2019-09-03 */public class Member &#123; // ..&#125; åº”ç”¨ 12345678910111213141516171819202122package com.design.pattern.principle;import com.design.pattern.principle.demeter.Boss;import com.design.pattern.principle.demeter.TeamLeader;import org.junit.Test;/** * DemeterTest * * @author shunhua * @date 2019-09-03 */public class DemeterTest &#123; @Test public void test()&#123; Boss boss = new Boss(); TeamLeader teamLeader = new TeamLeader(); boss.findProject(teamLeader); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"ä¾èµ–å€’ç½®åŸåˆ™","slug":"design_pattern/principle/ä¾èµ–å€’ç½®åŸåˆ™","date":"2019-09-01T16:00:00.000Z","updated":"2020-07-04T13:42:18.866Z","comments":true,"path":"posts/91021fa8/","link":"","permalink":"https://gentryhuang.com/posts/91021fa8/","excerpt":"","text":"å®šä¹‰ é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ã€‚ ä¼˜ç‚¹ å¯ä»¥å‡å°‘ç±»é—´çš„è€¦åˆæ€§ã€æé«˜ç³»ç»Ÿç¨³å®šæ€§ï¼Œå¢å¼ºä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå¯é™ä½ä¿®æ”¹ç¨‹åºé€ æˆçš„é£é™©ã€‚ ç»†èŠ‚æè¿° æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚é’ˆå¯¹æ¥å£ç¼–ç¨‹è€Œä¸è¦é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚ ç®€å•éœ€æ±‚è¯´æ˜ æŸåŒå­¦æƒ³è¦å­¦ä¹ æŸä¸€è¯¾ç¨‹ï¼Œæœ€ç®€å•çš„æ–¹å¼ç›´æ¥åœ¨Personä¸­ç¼–å†™ä¸€ä¸ªæ–¹æ³•å³å¯ï¼Œä½†æ˜¯å¦‚æœä»¥åæƒ³è¦å­¦ä¹ å…¶ä»–è¯¾ç¨‹å°± éœ€è¦ä¿®æ”¹Personç±»ã€‚ä¸ºäº†è§£è€¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¯¾ç¨‹æŠ½è±¡å‡ºå»ï¼Œé«˜å±‚å¯¹åº•å±‚çš„ä¾èµ–ï¼Œè¿™æ ·Personä¾èµ–çš„å°±æ˜¯æŠ½è±¡ï¼Œæˆ‘ ä»¬é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚ codingéé¢å‘æŠ½è±¡ç¼–ç¨‹12345678910111213141516171819202122232425ç¼ºç‚¹ï¼šåº”ç”¨ä¾èµ–å…·ä½“çš„å®ç°ï¼Œå¯¹äºåç»­éœ€æ±‚å˜æ›´æ›´åŠ ä¸é€‚ç”¨&#96;&#96;&#96; **å®ä½“ç±»**&#96;&#96;&#96;javapackage com.design.pattern.principle.dependenceinversion;import lombok.extern.slf4j.Slf4j;&#x2F;** * Person * * @author shunhua * @date 2019-09-02 *&#x2F;@Slf4jpublic class Person &#123; public void learnJavaCourse()&#123; log.info(&quot;å­¦ä¹ Javaè¯¾ç¨‹&quot;); &#125; public void learnPythonCourse()&#123; log.info(&quot;å­¦ä¹ Pythonè¯¾ç¨‹&quot;); &#125;&#125; åº”ç”¨ 12345678910111213141516171819202122package com.design.pattern.principle;import com.design.pattern.principle.dependenceinversion.PythonCourse;import com.design.pattern.principle.dependenceinversion.JavaCourse;import com.design.pattern.principle.dependenceinversion.Person;import org.junit.Test;/** * DependeceinversionTest * * @author shunhua * @date 2019-09-02 */public class DependeceinversionTest &#123; @Test public void test()&#123; Person person = new Person(); person.studyJava(); person.studyPython(); &#125;&#125; é¢å‘æ¥å£ç¼–ç¨‹1è¿™é‡Œä½¿ç”¨æ¥å£æ–¹æ³•ä¼ å‚çš„æ–¹å¼ è¯¾ç¨‹æ¥å£ 1234567891011121314package com.design.pattern.principle.dependenceinversion;/** * ICourse * * @author shunhua * @date 2019-09-02 */public interface ICourse &#123; /** * å­¦ä¹ è¯¾ç¨‹ */ void learnCourse();&#125; Javaè¯¾ç¨‹ 123456789101112131415161718package com.design.pattern.principle.dependenceinversion;import lombok.extern.slf4j.Slf4j;/** * JavaCourse * * @author shunhua * @date 2019-09-02 */@Slf4jpublic class JavaCourse implements ICourse &#123; @Override public void learnCourse() &#123; log.info(\"gentryhuang is learning java\"); &#125;&#125; Pythonè¯¾ç¨‹ 123456789101112131415161718package com.design.pattern.principle.dependenceinversion;import lombok.extern.slf4j.Slf4j;/** * PythonCourse * * @author shunhua * @date 2019-09-02 */@Slf4jpublic class PythonCourse implements ICourse &#123; @Override public void learnCourse() &#123; log.info(\"gentryhuang is learning python\"); &#125;&#125; å®ä½“ 1234567891011121314151617package com.design.pattern.principle.dependenceinversion;import lombok.extern.slf4j.Slf4j;/** * Person * * @author shunhua * @date 2019-09-02 */@Slf4jpublic class Person &#123; public void learnCource(ICourse course)&#123; course.learnCourse(); &#125;&#125; åº”ç”¨ 123456789101112131415161718192021package com.design.pattern.principle;import com.design.pattern.principle.dependenceinversion.PythonCourse;import com.design.pattern.principle.dependenceinversion.JavaCourse;import com.design.pattern.principle.dependenceinversion.Person;import org.junit.Test;/** * DependeceinversionTest * * @author shunhua * @date 2019-09-02 */public class DependeceinversionTest &#123; @Test public void test()&#123; Person person = new Person(); person.learnCource(new JavaCourse()); person.learnCource(new PythonCourse()); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å•ä¸€èŒè´£åŸåˆ™","slug":"design_pattern/principle/å•ä¸€èŒè´£åŸåˆ™","date":"2019-09-01T16:00:00.000Z","updated":"2020-07-04T13:42:18.868Z","comments":true,"path":"posts/46a1bcf2/","link":"","permalink":"https://gentryhuang.com/posts/46a1bcf2/","excerpt":"","text":"å®šä¹‰ ä¸è¦å­˜åœ¨å¤šäºä¸€ä¸ªå¯¼è‡´ç±»å˜æ›´çš„åŸå› ã€‚ä½“ç°åœ¨ä¸€ä¸ªç±»/æ¥å£/æ–¹æ³•åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚ ä¼˜ç‚¹ é™ä½ç±»çš„å¤æ‚åº¦ã€æé«˜ç±»çš„å¯è¯»æ€§ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ï¼Œé™ä½å˜æ›´å¼•èµ·çš„é£é™©ã€‚ è¯¦è§£ åœ¨ç±»çš„çº§åˆ«ä¸Šï¼Œå¯ä»¥å®šä¹‰ä¸åŒçš„ç±»å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œåœ¨æ¥å£çº§åˆ«ä¸Šï¼Œå¯ä»¥æ ¹æ®åŠŸèƒ½æŠ½è±¡å‡ºä¸åŒçš„æ¥å£ï¼Œç„¶åæŒ‰éœ€è¦å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚æ–¹æ³•çº§åˆ«ä¸Šï¼Œå¯ä»¥åšåˆ°ä¸åŒçš„æ–¹æ³•å®ç°ä¸åŒçš„æ“ä½œã€‚ è¦ç‚¹è®²è§£12341. å®é™…åº”ç”¨ä¸­ï¼Œç±»ä¸é‡‡ç”¨å•ä¸€èŒè´£ï¼Œæ¥å£å’Œæ–¹æ³•é‡‡ç”¨å•ä¸€èŒè´£ã€‚2. å®šä¹‰ï¼šå•ä¸€èŒè´£è§„å®š ä¸€ä¸ªç±»ï¼Œæ¥å£æˆ–è€…æ–¹æ³•ï¼Œåªæœ‰ä¸€ä¸ªå˜åŒ–çš„åŸå› 3. ä¼˜ç‚¹ï¼šé™ä½ç±»çš„å¤æ‚æ€§ï¼Œæé«˜å¯è¯»æ€§ï¼Œç»´æŠ¤æ—¶é£é™©é™ä½4. å®é™…åº”ç”¨ï¼Œå—ä¾èµ–ï¼Œç»„åˆï¼Œèšåˆè¿™äº›å…³ç³»å½±å“ï¼ŒåŒæ—¶å—æ§äºé¡¹ç›®è§„æ¨¡ï¼Œé¡¹ç›®å‘¨æœŸï¼ŒæŠ€æœ¯äººå‘˜æ°´å¹³ï¼Œå¯¹è¿›åº¦æŠŠæ§ç­‰å½±å“ã€‚åº”é€‚å½“çš„åº”ç”¨å•ä¸€èŒè´£åŸåˆ™ ç®€å•éœ€æ±‚è¯´æ˜ å®Œæˆä¸åŒåŠŸèƒ½ï¼Œå¹¶ä¸”ä½¿è®¾è®¡æ¨¡å—å…·æœ‰å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚å¯ä»¥ä½¿ç”¨ä¸åŒçš„ç±»æˆ–æ¥å£æˆ–æ–¹æ³•å»å®ŒæˆæŸä¸€ç±»åŠŸèƒ½ï¼Œè¿™æ ·å°±æ˜¾å¾—å•ä¸€ï¼Œå…·æœ‰é’ˆå¯¹æ€§ã€‚ ç±»çš„å•ä¸€èŒè´£åŸåˆ™å®ä½“ç±»1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263package com.design.pattern.principle.singleresponsibility;import lombok.extern.slf4j.Slf4j;/** * WalkBird * * @author shunhua * @date 2019-09-02 */@Slf4jpublic class WalkBird &#123; public void moveMode(String birdName)&#123; log.info(birdName + \"é™†åœ°å¥”è·‘\"); &#125;&#125;``` **å®ä½“ç±»2**```javapackage com.design.pattern.principle.singleresponsibility;import lombok.extern.slf4j.Slf4j;/** * FlyBird * * @author shunhua * @date 2019-09-02 */@Slf4jpublic class FlyBird &#123; public void moveMode(String birdName)&#123; log.info(birdName + \"ç”¨ç¿…è†€é£\"); &#125;&#125;``` **åº”ç”¨**```javapublic class Client &#123; public static void main(String[] args) &#123; WalkBird walkBird = new WalkBird(); walkBird.birdMove(\"é¸µé¸Ÿ\"); FlyBird flyBird = new FlyBird(); flyBird.birdMove(\"å¤§é›\"); &#125;&#125;``` ### æ¥å£çš„å•ä¸€èŒè´£**æ¥å£1**```java/** * è¿™ä¸ªæ¥å£å’Œè·å–å†…å®¹çš„æ¥å£æœ‰å…ˆåé¡ºåºï¼Œåªæœ‰å¼€å§‹å­¦ä¹ ï¼Œæ‰èƒ½è·å–å†…å®¹ï¼Œå¦‚æœé€€å‡ºå­¦ä¹ ï¼Œå°±ä¸èƒ½åœ¨è·å–å†…å®¹äº†ï¼Œ * ç”±äºèŒè´£ä¸åŒï¼Œæ‰€ä»¥è®¾è®¡ä¸¤ä¸ªæ¥å£ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ */public interface IcourseAction &#123; void beginStudy(); void quitStudy();&#125; æ¥å£2 1234567/** * æ³¨ï¼Œæœ¬æ¥å£ä¸»è¦æ˜¯è·å–è¯¾ç¨‹çš„å†…å®¹ */public interface IcourseContent &#123; String getCourseText();//è·å–è¯¾ç¨‹æ–‡æœ¬å†…å®¹ byte[] getCourseVideo();//è·å–è¯¾ç¨‹çš„è§†é¢‘&#125; å®ä½“ç±» 12345678910111213141516171819202122@Slf4jpublic class Course implements IcourseAction,IcourseContent&#123; @Override public void beginStudy() &#123; log.info(\"å¼€å§‹å­¦ä¹ !\"); &#125; @Override public void quitStudy() &#123; log.info(\"å­¦ä¹ å®Œæˆï¼\"); &#125; @Override public String getCourseText() &#123; return \"Java èµ„æ–™\"; &#125; @Override public byte[] getCourseVideo() &#123; return new byte[0]; &#125;&#125; æ–¹æ³•çš„å•ä¸€èŒè´£12345678910111213141516171819202122232425public class Method &#123; /** * å•ä¸€èŒè´£åŸåˆ™ï¼Œä¿®æ”¹ç”¨æˆ·çš„åç§° * @return */ public String updateUserName()&#123; return \"\"; &#125; /** * å•ä¸€èŒè´£åŸåˆ™,ä¿®æ”¹ç”¨æˆ·çš„å¯†ç  * @return */ public String updateUserPassWord()&#123; return \"\"; &#125; /** * ä¸ç¬¦åˆå•ä¸€èŒè´£ * @return */ public String updateUserInfo(String userId,String gender)&#123; return \" \"; &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"å¼€é—­åŸåˆ™","slug":"design_pattern/principle/å¼€é—­åŸåˆ™","date":"2019-08-31T16:00:00.000Z","updated":"2020-07-04T13:42:18.869Z","comments":true,"path":"posts/f50731fc/","link":"","permalink":"https://gentryhuang.com/posts/f50731fc/","excerpt":"","text":"å®šä¹‰ ä¸€ä¸ªè½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—å’Œå‡½æ•°åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ å¼ºè°ƒçš„æ˜¯ç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ã€‚ æ ¸å¿ƒæ€æƒ³ é¢å‘æŠ½è±¡ç¼–ç¨‹ï¼Œå› ä¸ºæŠ½è±¡æ˜¯ç¨³å®šçš„ã€‚ ç†è§£ ä¸æ”¹å˜åŸå…ˆçš„ä¸šåŠ¡é€»è¾‘ï¼Œæ–°å¢çš„åŠŸèƒ½ç‚¹é€šè¿‡é‡å†™å¤ç”¨çš„æ–¹æ³•è¿›è¡Œç¼–ç¨‹ã€‚ ä¼˜ç‚¹ æé«˜è½¯ä»¶ç³»ç»Ÿçš„å¯å¤ç”¨æ€§ä»¥åŠå¯ç»´æŠ¤æ€§ ç®€å•éœ€æ±‚è¯´æ˜ è½¯ä»¶å®ä½“ICourseï¼Œä»¥åŠå®ƒçš„å®ç°JavaCourceå®ç°äº†åŸºæœ¬åŠŸèƒ½ï¼Œå¦‚éœ€è¦é¢å¤–çš„åŠŸèƒ½å¯ä»¥å¯¹JavaCourseè¿›è¡Œæ‰©å±•å³ç»§æ‰¿æ¥æ·»åŠ ï¼Œ è¿™æ ·åœ¨ä¸ä¿®æ”¹åº•å±‚çš„ICourseå’ŒJavaCourseçš„å‰æä¸‹ï¼Œåšåˆ°åŠŸèƒ½çš„æ·»åŠ ã€‚å³ï¼Œè¶ŠåŸºå±‚çš„æ¨¡å—å½±å“èŒƒå›´è¶Šå¤§ï¼Œè¶Šé«˜å±‚çš„æ¨¡å—å½±å“ èŒƒå›´è¾ƒå°ï¼Œæ€»ä½“å®ç°äº†å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼Œè¿™æ ·å°±å¯ä»¥æœ‰æ•ˆè§£å†³å½±å“èŒƒå›´ã€‚ codingv1 åŸºç±»1éœ€æ±‚ï¼šæ‰“å°å‡ºåŸä»·ä»¥åŠè¯¾ç¨‹å…¶ä»–ä¿¡æ¯ æ¥å£ 12345678910111213141516171819202122232425package com.design.pattern.principle.openclose;/** * ICourse * * @author shunhua * @date 2019-09-01 */public interface ICourse &#123; /** * è·å–è¯¾ç¨‹id * @return */ Integer getId(); /** * è·å–è¯¾ç¨‹åç§° * @return */ String getName(); /** * è·å–è¯¾ç¨‹ä»·æ ¼ * @return */ Double getPrice();&#125; å®ä½“ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.design.pattern.principle.openclose;import lombok.AllArgsConstructor;import lombok.Data;import lombok.NoArgsConstructor;/** * JavaCourse * * @author shunhua * @date 2019-09-01 */@AllArgsConstructor@NoArgsConstructor@Datapublic class JavaCourse implements ICourse &#123; /** * è¯¾ç¨‹id */ private Integer id; /** * è¯¾ç¨‹åç§° */ private String name; /** * è¯¾ç¨‹ä»·æ ¼ */ private Double price; @Override public Integer getId() &#123; return this.id; &#125; @Override public String getName() &#123; return this.name; &#125; @Override public Double getPrice() &#123; return this.price; &#125;&#125; åº”ç”¨ 123456789101112131415161718192021222324252627package com.design.pattern.principle;import com.design.pattern.principle.openclose.ICourse;import com.design.pattern.principle.openclose.JavaCourse;import com.design.pattern.principle.openclose.JavaDiscountCourse;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * OpencloseTest * * @author shunhua * @date 2019-09-01 */@Slf4jpublic class OpencloseTest &#123; @Test public void testBase()&#123; ICourse javaCourse = new JavaCourse(100,\"Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ\",200d); log.info(String.format(\"è¯¾ç¨‹id: %d,è¯¾ç¨‹å: %s, è¯¾ç¨‹ä»·æ ¼ï¼š%f\", javaCourse.getId(), javaCourse.getName(), javaCourse.getPrice()) ); &#125;&#125; v21éœ€æ±‚ï¼šæ‰“å°å‡ºåŸä»·å’ŒæŠ˜æ‰£åçš„ä»·æ ¼ä»¥åŠè¯¾ç¨‹å…¶ä»–ä¿¡æ¯ï¼ˆæ¥å£ä¸åº”è¯¥éšæ„å‘ç”Ÿå˜åŒ–ï¼Œé¢å‘æ¥å£ç¼–ç¨‹ï¼‰ æ¥å£ 12345678910111213141516171819202122232425package com.design.pattern.principle.openclose;/** * ICourse * * @author shunhua * @date 2019-09-01 */public interface ICourse &#123; /** * è·å–è¯¾ç¨‹id * @return */ Integer getId(); /** * è·å–è¯¾ç¨‹åç§° * @return */ String getName(); /** * è·å–è¯¾ç¨‹ä»·æ ¼ * @return */ Double getPrice();&#125; å®ä½“ç±» 1234567891011121314151617181920212223242526272829303132package com.design.pattern.principle.openclose;/** * JavaDiscountCourse * * @author shunhua * @date 2019-09-01 */public class JavaDiscountCourse extends JavaCourse &#123; public JavaDiscountCourse(Integer id, String name, Double price) &#123; super(id, name, price); &#125; /** * è·å–æŠ˜æ‰£ä»· * @return */ @Override public Double getPrice() &#123; return super.getPrice() * 0.8; &#125; /** * è·å–åŸä»· * @return */ public Double getOriginPrice()&#123; return super.getPrice(); &#125;&#125; åº”ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839package com.design.pattern.principle;import com.design.pattern.principle.openclose.ICourse;import com.design.pattern.principle.openclose.JavaCourse;import com.design.pattern.principle.openclose.JavaDiscountCourse;import lombok.extern.slf4j.Slf4j;import org.junit.Test;/** * OpencloseTest * * @author shunhua * @date 2019-09-01 */@Slf4jpublic class OpencloseTest &#123; @Test public void testBase()&#123; ICourse javaCourse = new JavaCourse(100,\"Javaä»å…¥é—¨åˆ°æ”¾å¼ƒ\",200d); log.info(String.format(\"è¯¾ç¨‹id: %d,è¯¾ç¨‹å: %s, è¯¾ç¨‹ä»·æ ¼ï¼š%f\", javaCourse.getId(), javaCourse.getName(), javaCourse.getPrice()) ); &#125; @Test public void testEx()&#123; ICourse javaCource = new JavaDiscountCourse(100,\"javaä»å…¥é—¨åˆ°æ”¾å¼ƒ\",200d); log.info(String.format(\"è¯¾ç¨‹id: %d,è¯¾ç¨‹å: %s, è¯¾ç¨‹åŸä»·ï¼š%fï¼Œè¯¾ç¨‹æŠ˜æ‰£ä»·æ ¼ï¼š%f\", javaCource.getId(), javaCource.getName(), ((JavaDiscountCourse) javaCource).getOriginPrice(), javaCource.getPrice()) ); &#125;&#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"ç®€å•å·¥å‚","slug":"design_pattern/other_type/ç®€å•å·¥å‚","date":"2019-08-28T16:00:00.000Z","updated":"2020-08-04T06:13:21.253Z","comments":true,"path":"posts/90fd4bf3/","link":"","permalink":"https://gentryhuang.com/posts/90fd4bf3/","excerpt":"","text":"å®šä¹‰ ç”±ä¸€ä¸ªå·¥å‚å¯¹è±¡å†³å®šåˆ›å»ºå‡ºå“ªä¸€ç§äº§å“ç±»çš„å®ä¾‹ ç±»å‹ åˆ›å»ºå‹ï¼Œä½†ä¸å±äºGOF23ç§è®¾è®¡æ¨¡å¼ã€‚ç®€å•å·¥å‚æ¨¡å¼ä¸¥æ ¼æ„ä¹‰ä¸Šè¯´å¹¶ä¸æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒæ˜¯ä¸€ç§ç¼–ç ä¸Šçš„é£æ ¼å’Œä¹ æƒ¯ ä½¿ç”¨åœºæ™¯ å·¥å‚ç±»è´Ÿè´£åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°‘ å®¢æˆ·ç«¯ï¼ˆåº”ç”¨å±‚ï¼‰åªçŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¯¹è±¡ï¼ˆé€»è¾‘ï¼‰ä¸å…³å¿ƒä¼˜ç‚¹åªéœ€è¦ä¼ å…¥ä¸€ä¸ªæ­£ç¡®çš„å‚æ•°ï¼Œå°±å¯ä»¥è·å–æ‰€éœ€è¦çš„å¯¹è±¡è€Œæ— é¡»çŸ¥é“å…¶åˆ›å»ºç»†èŠ‚ç¼ºç‚¹ç®€å•å·¥å‚ç±»çš„èŒè´£ç›¸å¯¹è¿‡é‡ï¼Œå¢åŠ æ–°çš„äº§å“éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„åˆ¤æ–­é€»è¾‘ï¼Œè¿èƒŒäº†å¼€é—­åŸåˆ™ã€‚ codingæœªä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼çš„ä»£ç çˆ¶ç±» 12345678910111213public abstract class Video&#123; public abstract void printVideo();&#125;``` **å­ç±»JavaVideo**```java@Slf4jpublic class JavaVideo extends Video&#123; @Override public void printVideo() &#123; log.info(\"å½•åˆ¶javaè§†é¢‘\"); &#125;&#125; å­ç±»PythonVideo 1234567@Slf4jpublic class PythonVideo extends Video&#123; @Override public void printVideo() &#123; log.info(\"å½•åˆ¶pythonè§†é¢‘\"); &#125;&#125; åº”ç”¨ 1234567public class client&#123; @Test public void test()&#123; Video video = new JavaVideo(); video.printVideo(); &#125;&#125; ä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼ å·¥å‚ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.design.pattern.simplefactory;/** * ç®€å•å·¥å‚ * * @author shunhua * @date 2019-09-09 */public class FoodFactory &#123; /** * éšç€è¦äº§å“å¢å¤šï¼Œä»¥ä¸‹é€»è¾‘å¿…é¡»è¦ä¿®æ”¹ * @param type è¿™é‡Œä½¿ç”¨å­—ç¬¦ä¸²æ ¹æ®ç±»å‹è¿›è¡Œåˆ›å»ºä¸åŒçš„å®ä¾‹ * @return */ public Food createFood(String type)&#123; if(\"salad\".equalsIgnoreCase(type))&#123; return new Salad(); &#125;else if(\"bread\".equalsIgnoreCase(type))&#123; return new Bread(); &#125; return null; &#125; /** * * @param c è¿™é‡Œä½¿ç”¨åå°„åˆ›å»ºä¸åŒçš„å®ä¾‹ * @return */ public Food createFood(Class c)&#123; Food food = null; try &#123; food = (Food) Class.forName(c.getName()).newInstance(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; return food; &#125;&#125; çˆ¶ç±» 1234567891011121314package com.design.pattern.simplefactory;/** * Food * * @author shunhua * @date 2019-09-09 */public abstract class Food &#123; /** * ç”Ÿäº§äº§å“æ–¹æ³• */ public abstract void produce();&#125; å­ç±»é¢åŒ… 123456789101112131415161718package com.design.pattern.simplefactory;import lombok.extern.slf4j.Slf4j;/** * Bread * * @author shunhua * @date 2019-09-09 */@Slf4jpublic class Bread extends Food &#123; @Override public void produce() &#123; log.info(\"ç”Ÿäº§é¢åŒ…!\"); &#125;&#125; å­ç±»æ²™æ‹‰ 123456789101112131415161718package com.design.pattern.simplefactory;import lombok.extern.slf4j.Slf4j;/** * Salad * * @author shunhua * @date 2019-09-09 */@Slf4jpublic class Salad extends Food &#123; @Override public void produce() &#123; log.info(\"ç”Ÿæˆæ²™æ‹‰!\"); &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.design.pattern.simplefactory;import com.common.base.ObjectUtils;import com.design.pattern.simplefactory.Bread;import com.design.pattern.simplefactory.Food;import com.design.pattern.simplefactory.FoodFactory;import com.design.pattern.simplefactory.Salad;import org.junit.Test;/** * Client * * @author shunhua * @date 2019-09-09 */public class Client &#123; /* éç®€å•å·¥å‚æ¨¡å¼ @Test public void simpleFactoryBefore()&#123; // è¿™é‡Œéœ€è¦ä¾èµ–å…·ä½“çš„ç”Ÿäº§ç±» Food food = new Bread(); Food food1 = new Salad(); food.produce(); food1.produce(); &#125;*/ /* @Test public void simpleFactoryByType()&#123; // åˆ›å»ºä¸€ä¸ªç®€å•å·¥å‚ FoodFactory factory = new FoodFactory(); // ç”±å·¥å‚åˆ›å»ºå®ä¾‹å¯¹è±¡ Food food = factory.createFood(\"salad\"); food.produce(); &#125; */ @Test public void simpleFactoryByClass()&#123; FoodFactory factory = new FoodFactory(); Food food = factory.createFood(Bread.class); if(ObjectUtils.isNotNull(food))&#123; food.produce(); &#125; &#125;&#125; ç®€å•å·¥å‚åœ¨æºç ä¸­çš„ä½¿ç”¨jdkçš„Calendaræºç è§£æ123456789101112131415161718192021222324252627282930313233343536373839404142434445// è¿™é‡Œä½¿ç”¨çš„æ˜¯é™æ€æ–¹æ³•ï¼Œå› ä¸ºä¸éœ€è¦å†é€šè¿‡ç»§æ‰¿è¿›è¡Œæ‰©å±•ã€‚å¦‚éœ€æ‰©å±•å°±ä¸ä½¿ç”¨staticå…³é”®å­—public static Calendar getInstance(TimeZone zone, Locale aLocale)&#123; return createCalendar(zone, aLocale); &#125; private static Calendar createCalendar(TimeZone zone, Locale aLocale) &#123; CalendarProvider provider = LocaleProviderAdapter.getAdapter(CalendarProvider.class, aLocale).getCalendarProvider(); if (provider != null) &#123; try &#123; return provider.getInstance(zone, aLocale); &#125; catch (IllegalArgumentException iae) &#123; // fall back to the default instantiation &#125; &#125; Calendar cal = null; if (aLocale.hasExtensions()) &#123; String caltype = aLocale.getUnicodeLocaleType(\"ca\"); if (caltype != null) &#123; // æ ¹æ®ä¸åŒçš„ç±»å‹åˆ›å»ºæ—¥æœŸå¯¹è±¡ switch (caltype) &#123; case \"buddhist\": cal = new BuddhistCalendar(zone, aLocale); break; case \"japanese\": cal = new JapaneseImperialCalendar(zone, aLocale); break; case \"gregory\": cal = new GregorianCalendar(zone, aLocale); break; &#125; &#125; &#125; if (cal == null) &#123; if (aLocale.getLanguage() == \"th\" &amp;&amp; aLocale.getCountry() == \"TH\") &#123; cal = new BuddhistCalendar(zone, aLocale); &#125; else if (aLocale.getVariant() == \"JP\" &amp;&amp; aLocale.getLanguage() == \"ja\" &amp;&amp; aLocale.getCountry() == \"JP\") &#123; cal = new JapaneseImperialCalendar(zone, aLocale); &#125; else &#123; cal = new GregorianCalendar(zone, aLocale); &#125; &#125; return cal; &#125; DriverManageræºç è§£æï¼ˆé€šè¿‡classForNameè·å–ï¼‰123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778public static Connection getConnection(String url, java.util.Properties info) throws SQLException &#123; // Gets the classloader of the code that called this method, may // be null. ClassLoader callerCL = DriverManager.getCallerClassLoader(); return (getConnection(url, info, callerCL)); &#125;// Worker method called by the public getConnection() methods. private static Connection getConnection( String url, java.util.Properties info, ClassLoader callerCL) throws SQLException &#123; java.util.Vector drivers = null; /* * When callerCl is null, we should check the application's * (which is invoking this class indirectly) * classloader, so that the JDBC driver class outside rt.jar * can be loaded from here. */ synchronized(DriverManager.class) &#123; // synchronize loading of the correct classloader. if(callerCL == null) &#123; callerCL = Thread.currentThread().getContextClassLoader(); &#125; &#125; if(url == null) &#123; throw new SQLException(\"The url cannot be null\", \"08001\"); &#125; println(\"DriverManager.getConnection(\\\"\" + url + \"\\\")\"); if (!initialized) &#123; initialize(); &#125; synchronized (DriverManager.class)&#123; // use the readcopy of drivers drivers = readDrivers; &#125; // Walk through the loaded drivers attempting to make a connection. // Remember the first exception that gets raised so we can reraise it. SQLException reason = null; for (int i = 0; i &lt; drivers.size(); i++) &#123; DriverInfo di = (DriverInfo)drivers.elementAt(i); // If the caller does not have permission to load the driver then // skip it. if ( getCallerClass(callerCL, di.driverClassName ) != di.driverClass ) &#123; println(\" skipping: \" + di); continue; &#125; try &#123; println(\" trying \" + di); Connection result = di.driver.connect(url, info); if (result != null) &#123; // Success! println(\"getConnection returning \" + di); return (result); &#125; &#125; catch (SQLException ex) &#123; if (reason == null) &#123; reason = ex; &#125; &#125; &#125; // if we got here nobody could connect. if (reason != null) &#123; println(\"getConnection failed: \" + reason); throw reason; &#125; println(\"getConnection: no suitable driver found for \"+ url); throw new SQLException(\"No suitable driver found for \"+ url, \"08001\"); &#125;","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]},{"title":"umlåŸºç¡€","slug":"design_pattern/uml","date":"2019-08-27T16:00:00.000Z","updated":"2020-08-04T06:13:21.249Z","comments":true,"path":"posts/cadc5d6c/","link":"","permalink":"https://gentryhuang.com/posts/cadc5d6c/","excerpt":"","text":"å®šä¹‰ç»Ÿä¸€å»ºæ¨¡è¯­è¨€ï¼ˆç¼©å†™UMLï¼‰ï¼Œéä¸“åˆ©çš„ç¬¬ä¸‰ä»£å»ºæ¨¡å’Œè§„çº¦è¯­è¨€ ç‰¹ç‚¹ UMLæ˜¯ä¸€ç§å¼€æ”¾çš„æ–¹æ³• UMLç”¨äºè¯´æ˜ã€å¯è§†åŒ–ã€æ„å»ºå’Œç¼–å†™ä¸€ä¸ªæ­£åœ¨å¼€å‘çš„é¢å‘å¯¹è±¡çš„ã€è½¯ä»¶å¯†é›†ç³»ç»Ÿçš„åˆ¶å“çš„å¼€æ”¾æ–¹æ³• UMLå±•ç°äº†ä¸€ç³»åˆ—æœ€ä½³å·¥ç¨‹çš„å®è·µï¼Œè¿™äº›æœ€ä½³å®è·µåœ¨å¯¹å¤§è§„æ¨¡ï¼Œå¤æ‚ç³»ç»Ÿè¿›è¡Œå»ºæ¨¡æ–¹é¢ï¼Œç‰¹åˆ«æ˜¯åœ¨è½¯ä»¶æ¶æ„å±‚é¢å·²ç»è¢«éªŒè¯æœ‰æ•ˆ UMLåˆ†ç±» ç»“æ„å¼å›¾å½¢ å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿå¼çš„å»ºæ¨¡ï¼Œå…·ä½“åŒ…å«é™æ€å›¾ï¼ˆç±»å›¾ã€å¯¹è±¡å›¾ã€åŒ…å›¾ï¼‰ã€å®ç°å›¾ï¼ˆç»„ä»¶å›¾ã€éƒ¨ç½²å›¾ï¼‰ã€å‰–é¢å›¾ä»¥åŠå¤åˆç»“æ„å›¾ è¡Œä¸ºå¼å›¾å½¢ å¼ºè°ƒç³»ç»Ÿæ¨¡å‹ä¸­è§¦å‘çš„äº‹ä»¶ï¼Œå…·ä½“åŒ…å«æ´»åŠ¨å›¾ã€çŠ¶æ€å›¾ä»¥åŠç”¨ä¾‹å›¾ äº¤äº’å¼å›¾å½¢ å±äºè¡Œä¸ºå¼å›¾å½¢å­é›†åˆï¼Œå¼ºè°ƒç³»ç»Ÿæ¨¡å‹ä¸­èµ„æºæµç¨‹ã€‚å…·ä½“åŒ…å«é€šä¿¡å›¾ã€äº¤äº’æ¦‚å¿µå›¾ã€æ—¶åºå›¾ ä»¥åŠæ—¶é—´å›¾ â€‹ UMLç±»å›¾ç”¨äºè¡¨ç¤ºç±»ã€æ¥å£ã€å®ä¾‹ç­‰ä¹‹é—´ç›¸äº’çš„é™æ€å…³ç³»ã€‚è™½ç„¶åå­—å«ç±»å›¾ï¼Œä½†ç±»å›¾ä¸­å¹¶ä¸åªæœ‰ç±»ï¼Œè¿˜å¯èƒ½åŒ…æ‹¬æƒé™ã€å±æ€§ã€æ–¹æ³•ç­‰ UMLè®°å¿†æ–¹å¼12341. umlç®­å¤´ï¼šä»å­ç±»æŒ‡å‘çˆ¶ç±»ï¼Œåªæœ‰çŸ¥é“å¯¹æ–¹ä¿¡æ¯æ—¶æ‰èƒ½æŒ‡å‘å¯¹æ–¹æ–¹å‘2. ç©ºå¿ƒä¸‰è§’ç®­å¤´ï¼šç»§æ‰¿æˆ–å®ç°ï¼Œå®çº¿-ç»§æ‰¿ï¼šç§¯æçš„ï¼Œå¼ºå…³è”ï¼Œå…³è”ï¼Œé€šå¸¸ä¸€ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªç±»çš„å¯¹è±¡åšå±æ€§ï¼›è™šçº¿-å®ç°ï¼šæ¶ˆæçš„ï¼Œå¼±å…³è”ï¼Œä¾èµ–3. ç©ºå¿ƒè±å½¢ï¼šèšåˆï¼Œï¼ˆæ³¨ï¼šå¯ä»¥çœ‹ä½œä¸€ä¸ªç›˜å­ï¼Œå¯ä»¥æ”¾å¾ˆå¤šç›¸åŒçš„ä¸œè¥¿ï¼ˆç®­å¤´æ–¹å‘æ‰€æŒ‡çš„ç±»ï¼‰ï¼Œèšåœ¨ä¸€èµ·ã€‚æ˜¯has açš„å…³ç³»ï¼‰å¼±å…³è”4. å®å¿ƒè±å½¢ï¼šç»„åˆï¼Œï¼ˆæ³¨ï¼šä»£è¡¨å™¨çš¿é‡Œæœ‰å®ä½“ç»“æ„å­˜åœ¨ï¼Œç»„åˆèµ·æ¥æˆä¸ºä¸€ä¸ªã€‚æ˜¯contains-açš„å…³ç³»ï¼‰å¼ºå…³è” umlç®­å¤´ï¼šä»å­ç±»æŒ‡å‘çˆ¶ç±»ï¼Œå®šä¹‰å­ç±»æ—¶éœ€è¦é€šè¿‡extendså…³é”®å­—æŒ‡å®šçˆ¶ç±»ï¼Œåªæœ‰çŸ¥é“å¯¹æ–¹ä¿¡æ¯æ—¶æ‰èƒ½æŒ‡å‘å¯¹æ–¹æ–¹å‘ å®çº¿-ç»§æ‰¿ | è™šçº¿-å®ç° â€‹ ç©ºå¿ƒè±å½¢-èšåˆ å®å¿ƒè±å½¢-ç»„åˆ ç»„åˆå…³ç³»ä¸­å¸¸è§çš„æ•°å­—è¡¨è¾¾ 123456â—†å¸¸è§æ•°å­—è¡¨è¾¾åŠå«ä¹‰ï¼Œå‡è®¾æœ‰Aç±»å’ŒBç±»ï¼Œæ•°å­—æ ‡è®°åœ¨Aç±»ä¾§â—†0..1ï¼š0æˆ–1ä¸ªå®ä¾‹ åœ¨ç³»ç»ŸæŸä¸€æ—¶åˆ»ï¼Œbçš„å®ä¾‹å¯ä»¥ä¸0ä¸ªæˆ–1ä¸ªAå®ä¾‹ç›¸å…³â—†0..*ï¼š0æˆ–å¤šä¸ªå®ä¾‹ åœ¨ç³»ç»ŸæŸä¸€æ—¶åˆ»ï¼Œbçš„å®ä¾‹å¯ä»¥ä¸0ä¸ªæˆ–å¤šä¸ªAå®ä¾‹ç›¸å…³â—†1..1ï¼š1ä¸ªå®ä¾‹. bçš„å®ä¾‹å¯ä»¥å’Œ1ä¸ªAå®ä¾‹ç›¸å…³â—†1åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹. bçš„å®ä¾‹å¯ä»¥å’Œ1ä¸ªAå®ä¾‹ç›¸å…³â—†1..*ï¼šè‡³å°‘æœ‰ä¸€ä¸ªå®ä¾‹. bå®ä¾‹å¯ä»¥ä¸ä¸€ä¸ªæˆ–å¤šä¸ªAå®ä¾‹ç›¸å…³ UMLæ—¶åºå›¾ æ˜¯æ˜¾ç¤ºå¯¹è±¡ä¹‹é—´äº¤äº’çš„å›¾ï¼Œè¿™äº›å¯¹è±¡æ˜¯æŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—çš„ æ—¶åºå›¾ä¸­ åŒ…å«çš„å»ºæ¨¡å…ƒç´  å¯¹è±¡ï¼ˆActorï¼‰ã€ç”Ÿå‘½çº¿ï¼ˆlifelineï¼‰ã€æ§åˆ¶ç„¦ç‚¹ï¼ˆFocus of controlï¼‰ã€æ¶ˆæ¯ï¼ˆMessageï¼‰ç­‰ æ—¶åºå›¾ç¤ºä¾‹ 12345678910111213ç«–çº¿ä»£è¡¨ç”Ÿå‘½çº¿å¯¹è±¡ï¼šcï¼šclient ï¼Œsï¼šserverï¼Œdï¼šdevice ä»£è¡¨å®ä¾‹æ¶ˆæ¯ï¼šç®­å¤´ä»£è¡¨çš„å…ƒç´ (open,workç­‰)ç«–çŸ©å½¢ä»£è¡¨å®ä¾‹å¤„äºæŸç§æ´»åŠ¨ä¸­ï¼Œå®çº¿å®å¿ƒç®­å¤´ï¼šä»£è¡¨æ–¹æ³•è°ƒç”¨ï¼ŒåŒæ­¥è°ƒç”¨å®çº¿éå®å¿ƒç®­å¤´ï¼šä»£è¡¨å¼‚æ­¥è°ƒç”¨è™šçº¿ï¼šä»£è¡¨è¿”å› UMLç±»å›¾è®²è§£1234567891011121314151617+ å…¬å…±æ–¹æ³•- privateæƒé™# protectedæƒé™ åŒ…å†…å’ŒåŒ…å¤–ç»§æ‰¿çš„å­ç±»éƒ½èƒ½å¼•ç”¨~ defaultæƒé™ï¼ˆåŒ…æƒé™ï¼‰åªæœ‰åŒ…å†…èƒ½å¼•ç”¨ä¸‹åˆ’çº¿ é™æ€ Staticæ–œä½“ æŠ½è±¡ç±»ï¼ˆæˆ–æŠ½è±¡æ–¹æ³•ï¼‰ï¼ˆåŒ…å«æŠ½è±¡æ–¹æ³•çš„å¿…æ˜¯æŠ½è±¡ç±»ï¼‰ï¼ˆç±»å’Œè‡³å°‘ä¸€ä¸ªæ–¹æ³•éƒ½æ˜¯æ–œä½“ï¼‰æ–¹æ³• å¯ä»¥å¸¦å‚ï¼Œå¯ä»¥ä¸å¸¦å‚ è¿”å›å€¼å†™åˆ°å†’å·åè¾¹ï¼Œvoidä¸ç”¨åŠ æ³¨æ„ï¼šä¸‹å›¾ç±»ååº”è¯¥ä¸ºæ–œä½“ï¼Œå› ä¸ºæœ‰æŠ½è±¡æ–¹æ³•studyï¼ˆï¼‰ï¼Œæ‰€ä»¥GeelyClassä¸ºæŠ½è±¡ç±»ï¼Œåº”è¯¥ä¸ºæ–œä½“ã€‚ UMLæ•´ä½“è®²è§£12345678910è®¾è®¡æ¨¡å¼ä¸­çš„å¯¹è±¡å…³ç³»: ä¾èµ–å…³ç³» è™šçº¿ç®­å¤´ï¼Œç®­å¤´æ–¹å‘æŒ‡å‘è¢«ä¾èµ–çš„éƒ¨åˆ† ç»„åˆå…³ç³» å®å¿ƒè±å½¢ èšåˆå…³ç³» ç©ºå¿ƒè±å½¢ï¼ˆæƒ³è±¡æˆç›˜å­ï¼Œç››ä¸œè¥¿ï¼Œç›˜å­çš„å¤šï¼Œå¦ä¸€æ–¹å°‘ï¼‰ å…³è”å…³ç³» å®çº¿ç®­å¤´ï¼Œç®­å¤´æŒ‡å‘è¢«å…³è”çš„éƒ¨åˆ† ç±»ä¸ç±»çš„è¿æ¥ï¼Œï¼ˆå®ƒä½¿ä¸€ä¸ªç±»çŸ¥é“å¦ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå…³è”å…³ ç³»ä¸€èˆ¬ç”¨æˆå‘˜å˜é‡å®ç°ï¼‰ ç»§æ‰¿ ç©ºå¿ƒä¸‰è§’å½¢å®çº¿ å®ç° ç©ºå¿ƒä¸‰è§’å½¢è™šçº¿æ³¨æ„ï¼š å®ç°æ¥å£æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æ£’æ£’ç³–çš„å½¢å¼ï¼Œå¦ä¸€ç§æ˜¯è™šçº¿ç©ºå¿ƒä¸‰è§’å½¢çš„æ–¹å¼ UMLä¸­éƒ¨åˆ†å¯¹æ¯”1234567891.1 å…³è”å’Œä¾èµ–çš„å¯¹æ¯”å…³è”æ˜¯aç±»ä¸­å­˜åœ¨bç±»å¯¹è±¡ï¼Œä¼é¹…ç±»ä¸­æœ‰æ°”å€™ç±»çš„å±æ€§ä¾èµ–æ˜¯aç±»æˆå‘˜æ–¹æ³•ä¸­æœ‰bç±»çš„å±æ€§ï¼ŒåŠ¨ç‰©æ–°é™ˆä»£è°¢æ–¹æ³•ä¸­æœ‰æ°´å’Œç©ºæ°”çš„å±æ€§ï¼Œåªæœ‰è°ƒè¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰å¯èƒ½ä¸´æ—¶ç”¨ä¸€ä¸‹1.2 ç»„åˆå’Œèšåˆçš„å¯¹æ¯”ç»„åˆæœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œé¸Ÿæœ‰ç¿…è†€ï¼Œé¸Ÿæ­»äº†ï¼Œç¿…è†€ä¸å¤å­˜åœ¨å¤§é›ç¾¤æœ‰å¤§é›ï¼Œä¸€åªå¤§é›æŒ‚äº†ï¼Œå¤§é›ç¾¤ä¸ä¼šæ¶ˆå¤±1.3 ç»§æ‰¿å’Œå®ç°çš„å¯¹å®çº¿ï¼šç»§æ‰¿è™šçº¿ï¼šå®ç°","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]}],"categories":[{"name":"RedisåŸç†","slug":"RedisåŸç†","permalink":"https://gentryhuang.com/categories/Redis%E5%8E%9F%E7%90%86/"},{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/categories/rpc/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"Redisæ•°æ®ç»“æ„","slug":"Redisæ•°æ®ç»“æ„","permalink":"https://gentryhuang.com/tags/Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"},{"name":"dubbo","slug":"dubbo","permalink":"https://gentryhuang.com/tags/dubbo/"},{"name":"rpc","slug":"rpc","permalink":"https://gentryhuang.com/tags/rpc/"},{"name":"spring","slug":"spring","permalink":"https://gentryhuang.com/tags/spring/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://gentryhuang.com/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}]}